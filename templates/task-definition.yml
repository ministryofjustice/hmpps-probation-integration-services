# Generic task-definition template
cpu: "{{ .values.limits.cpu }}"
memory: "{{ .values.limits.memory }}"
containerDefinitions:
  - name: {{ .values.image.name }}
    image: ghcr.io/ministryofjustice/hmpps-probation-integration-services/{{ .values.image.name }}:{{ .Env.VERSION }}
    healthCheck:
      command: ["CMD-SHELL", "{{ .values.healthcheck.command }}"]
    cpu: "{{ .values.reservations.cpu }}"
    memory: "{{ .values.limits.memory }}"
    memoryReservation: "{{ .values.reservations.memory }}"
    environment:
      - name: VERSION
        value: {{ .Env.VERSION }}
    {{- range $key, $val := .values.env }}
      - name: {{ $key }}
        value: {{ $val | strings.Quote }}
    {{- end }}
    secrets:
    {{- range $key, $val := .values.secrets }}
      - name: {{ $key }}
        valueFrom: /{{ $.Env.ENVIRONMENT_NAME }}/delius/probation-integration{{ $val }}
    {{- end }}
