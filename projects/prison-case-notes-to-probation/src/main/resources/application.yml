# Default config
spring:
  jpa:
    database-platform: org.hibernate.dialect.Oracle12cDialect
    hibernate.ddl-auto: validate
  jms:
    template.delivery-delay: 10m # DLQ retry interval
    listener:
      concurrency: 1
      max-concurrency: 10
      acknowledge-mode: client

management.endpoints.web:
  base-path: /
  exposure.include: "health"

feign.client.config:
  default:
    logger-level: full
    connect-timeout: 5000
    read-timeout: 5000

spring.security.oauth2.client:
  registration:
    prison-case-notes:
      provider: hmpps-auth
      authorization-grant-type: client_credentials
      client-id: ${integrations.prison-case-notes.client-id}
      client-secret: ${integrations.prison-case-notes.client-secret}
  provider:
    hmpps-auth:


---
# Shared dev/test config
spring.config.activate.on-profile: ["dev", "integration-test", "oracle"]

spring:
  activemq.broker-url: vm://localhost?broker.persistent=false&broker.useShutdownHook=false

  datasource.url: jdbc:h2:file:./dev;MODE=Oracle;DEFAULT_NULL_ORDERING=HIGH;AUTO_SERVER=true;AUTO_SERVER_PORT=9092
  jpa.hibernate.ddl-auto: create-drop

hoverfly:
  enabled: true
  port: 8500

integrations:
  prison-offender-events:
    queue: prison-offender-events-queue
    dlq: ActiveMQ.DLQ
  prison-case-notes:
    url: http://localhost:${hoverfly.port}
    client-id: prison-case-notes-to-probation
    client-secret: prison-case-notes-to-probation

spring.security.oauth2.client.provider:
  hmpps-auth:
    token-uri: http://localhost:${hoverfly.port}/auth/oauth/token

management.endpoints.web:
  base-path: /
  exposure.include: [ "hawtio", "health", "jolokia" ]
hawtio.authenticationEnabled: false

logging.level:
  uk.gov.justice.digital.hmpps: DEBUG
  org.hibernate.tool.schema: ERROR



---
spring.config.activate.on-profile: dev
hoverfly.enabled: true # Start the Hoverfly mock web server when using the dev profile



---
spring.config.activate.on-profile: integration-test
hoverfly.enabled: false # Hoverfly is already embedded in the integration tests by using the JUnit extension
spring.datasource.url: jdbc:h2:file:./test;MODE=Oracle;DEFAULT_NULL_ORDERING=HIGH;AUTO_SERVER=true;AUTO_SERVER_PORT=9092



---
spring.config.activate.on-profile: oracle
spring:
  datasource:
    url: 'jdbc:oracle:thin:@//localhost:1521/XEPDB1'
    username: delius_pool
    password: NDelius1
  jpa:
    hibernate.ddl-auto: validate
    properties:
      hibernate.dialect: org.hibernate.dialect.Oracle12cDialect
