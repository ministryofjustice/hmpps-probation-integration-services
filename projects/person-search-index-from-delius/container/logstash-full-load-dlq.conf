input {
    dead_letter_queue {
        id => "read-logstash-dlq"
        path => "/usr/share/logstash/data/dead_letter_queue"
        pipeline_id => "full-load"
    }
}

filter {
    mutate {
        id => "synthesize-sqs-message"
        add_field => {
            "Message" => "{\"offenderId\": %{offenderId}}"
            "error_reason" => "%{[@metadata][dead_letter_queue][reason]}"
            "plugin_id" => "%{[@metadata][dead_letter_queue][plugin_id]}"
            "plugin_type" => "%{[@metadata][dead_letter_queue][plugin_type]}"
            "entry_time" => "%{[@metadata][dead_letter_queue][entry_time]}"
       }
    }
}

output {
    sqs {
        id => "send-to-sqs-dlq"
        queue => "${SQS_DLQ_NAME}"
        access_key_id => "${SQS_DLQ_ACCESS_KEY_ID}"
        secret_access_key => "${SQS_DLQ_SECRET_ACCESS_KEY}"
        region => "eu-west-2"
    }
}
