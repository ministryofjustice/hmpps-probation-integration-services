input {
    jdbc {
        id => "full-index"
        jdbc_driver_library => "/etc/logstash/ojdbc11.jar"
        jdbc_driver_class => "Java::oracle.jdbc.driver.OracleDriver"
        jdbc_connection_string => "${JDBC_CONNECTION_STRING}"
        jdbc_user => "${JDBC_USER}"
        jdbc_password => "${JDBC_PASSWORD}"
        statement_filepath => "/etc/logstash/statement.sql"
        parameters => { "batch_size" => 100000 }
        schedule => "* * * * *"
        use_column_value => true
        tracking_column => "lastUpdatedDateTime"
        tracking_column_type => "timestamp"
        last_run_metadata_path => "/etc/logstash/.logstash_jdbc_last_run_person-search"
    }
}

filter {
    json {
        source => "json"
    }
    mutate {
        remove_field => [ "json" ]
    }
}

output {
    elasticsearch {
        id => "person-search"
        hosts => ["${ELASTIC_SEARCH_HOST}"]
        index => "${SEARCH_INDEX}"
        action => "index"
        document_id => "%{id}"
        version => "%{version}"
        version_type => "external"
        ssl_certificate_verification => "false"
        ilm_enabled => "false"
    }
}