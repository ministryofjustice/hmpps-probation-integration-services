input {
    jdbc {
        id => "load-all-records"
        jdbc_driver_library => "/etc/logstash/ojdbc11.jar"
        jdbc_driver_class => "Java::oracle.jdbc.driver.OracleDriver"
        jdbc_connection_string => "${JDBC_CONNECTION_STRING}"
        jdbc_user => "${JDBC_USER}"
        jdbc_password => "${JDBC_PASSWORD}"
        statement_filepath => "/etc/logstash/statement.sql"
        parameters => { "offender_id" => 0 }
        use_column_value => false
        lowercase_column_names => false
        schedule => "${INDEX_SCHEDULE}"
    }
}

filter {
    json {
        id => "parse-json"
        source => "json"
    }
    mutate {
        id => "remove-unused-fields"
        remove_field => [ "json" ]
    }
}

output {
    if [tags] and [tags][0] {
        sqs {
            id => "send-to-sqs-dlq"
            queue => "${SQS_DLQ_NAME}"
            access_key_id => "${SQS_DLQ_ACCESS_KEY_ID}"
            secret_access_key => "${SQS_DLQ_SECRET_ACCESS_KEY}"
            region => "eu-west-2"
        }
    } else {
        opensearch {
            id => "index-into-standby"
            hosts => ["${SEARCH_INDEX_HOST}"]
            user => "${SEARCH_INDEX_USERNAME}"
            password => "${SEARCH_INDEX_PASSWORD}"
            index => "${STANDBY_INDEX_NAME}"
            document_id => "%{offenderId}"
            action => "index"
        }
    }
}