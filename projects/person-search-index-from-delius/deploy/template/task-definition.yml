# Generic task-definition template
cpu: "{{ .values.cpu }}"
memory: "{{ .values.memory }}"
containerDefinitions:
  - name: {{ .values.image.name }}
    image: ghcr.io/ministryofjustice/hmpps-probation-integration-services/{{ .values.image.name }}:{{ .Env.VERSION }}
    healthCheck:
      command: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:9600 || exit 1"]
    cpu: "{{ .values.cpu }}"
    memory: "{{ .values.memory }}"
    environment:
      - name: VERSION
        value: {{ .Env.VERSION }}
    {{- range $key, $val := .values.env }}
      - name: {{ $key }}
        value: {{ $val }}
    {{- end }}
    secrets:
    {{- range $key, $val := .values.secrets }}
      - name: {{ $key }}
        valueFrom: /{{ $.values.environment_name }}/delius/probation-integration{{ $val }}
    {{- end }}
