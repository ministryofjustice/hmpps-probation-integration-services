<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.PKG_SEARCH</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY pkg_search&#10;AS&#10;--&#10;--&#10;--&#10;--&#10;&#10;--&#10;-- Global variables&#10;--&#10;g_label VARCHAR2(100);&#10;&#10;g_limit                 NUMBER :&#61; NULL;&#10;g_transfer_pending_id   NUMBER :&#61; NULL;&#10;&#10;--&#10;--&#10;-- PKG_COMMON wrappers&#10;--&#10;PROCEDURE procDebug(p_msg CLOB) IS&#10;BEGIN&#10;    PKG_Debug.procDebug(p_msg);&#10;END procDebug;&#10;&#10;FUNCTION funcgetDebugMode RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Debug.funcgetDebugMode;&#10;END funcgetDebugMode;&#10;--&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level INTEGER DEFAULT 0) IS&#10;BEGIN&#10;    PKG_Common.print_message(&#10;        p_msg         &#61;&gt; p_msg,&#10;        p_trace_level &#61;&gt; NVL(p_trace_level, PKG_Common.GC_TRACE_LEVEL),&#10;        p_label       &#61;&gt; g_label );&#10;END message;&#10;--&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;&#10;FUNCTION bool_2_char(p_val BOOLEAN) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.bool_2_char(p_val);&#10;END bool_2_char;&#10;--&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;--&#10;PROCEDURE raise_error(p_err_msg VARCHAR2, p_proc VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    PKG_Common.raise_error( p_err_msg, p_proc, p_label );&#10;END raise_error;&#10;--&#10;--&#10;--&#10;&#10;--&#10;-- RBAC WRAPPERS&#10;--&#10;PROCEDURE do_set_rbac_levels(&#10;    p_offender_id        NUMBER,&#10;    p_L1          IN OUT NUMBER,&#10;    p_L2          IN OUT NUMBER,&#10;    p_L3          IN OUT NUMBER,&#10;    p_username    IN VARCHAR2 DEFAULT NULL )&#10;IS&#10;BEGIN&#10;    PKG_RBAC.do_set_rbac_levels( p_offender_id, p_L1, p_L2, p_L3, p_username );&#10;END do_set_rbac_levels;&#10;--&#10;FUNCTION procGetOwnersTAB(&#10;    p_user_id             NUMBER,&#10;    p_offender_id_LST     CLOB&#10;)&#10;RETURN PKG_RBAC.ttabOwners PIPELINED&#10;IS&#10;    l_tab PKG_RBAC.ttabOwners;&#10;BEGIN&#10;    --&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_RBAC.procGetOwnersTAB(p_user_id, p_offender_id_LST) );&#10;    --&#10;    FOR l_idx IN 1..l_tab.COUNT LOOP&#10;        PIPE ROW ( l_tab(l_idx) );&#10;    END LOOP;&#10;END procGetOwnersTAB;&#10;--&#10;PROCEDURE procGetOwnershipLevel(&#10;    p_offender_id       NUMBER,&#10;    p_user_id           NUMBER,&#10;    p_outcursor     OUT SYS_REFCURSOR )&#10;AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        &#39;L&#39; || rownum AS rbac_level,&#10;        column_value AS rbac_value&#10;      FROM&#10;        TABLE(&#10;            PKG_LstUtl.get_list_2_array(&#10;                PKG_Lookups.funcgetTabRecord_CACHED_1(&#10;                    p_table       &#61;&gt; &#39;TABLE( PKG_RBAC.procGetOwnersTAB(p_user_id&#61;&gt;:p_user_id, p_offender_id_lst&#61;&gt;TO_CLOB(TO_CHAR(:p_offender_id))) )&#39;,&#10;                    p_data_fld    &#61;&gt; &#39;L1 || &#39;&#39;,&#39;&#39; || L2  || &#39;&#39;,&#39;&#39; || L3&#39;,&#10;                    p_default_val &#61;&gt; &#39;0|0|1&#39;,&#10;                    p_ref_col     &#61;&gt; &#39;1&#39;,&#10;                    p_ref_val     &#61;&gt; TO_CHAR(p_user_id),&#10;                    p_bind_var1   &#61;&gt; TO_CHAR(p_offender_id),&#10;                    p_bind_var2   &#61;&gt; &#39;1&#39; )&#10;            )&#10;          ) T&#10;      ;&#10;END procGetOwnershipLevel;&#10;--&#10;PROCEDURE procGetOwnershipLevels(&#10;    p_offender_id_LST CLOB,&#10;    p_user_id         NUMBER,&#10;    p_outcursor   OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;  OPEN p_outcursor FOR&#10;    SELECT&#10;      T.offender_id,&#10;      T.L1,&#10;      T.L2,&#10;      T.L3&#10;    FROM TABLE( PKG_RBAC.procGetOwnersTAB( p_user_id&#61;&gt;p_user_id, p_offender_id_LST&#61;&gt;p_offender_id_LST) ) T;&#10;END procGetOwnershipLevels;&#10;--&#10;PROCEDURE procGetAlfrescoPermissions(&#10;    p_offender_id NUMBER,&#10;    p_outcursor   OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;  OPEN p_outcursor FOR&#10;    SELECT&#10;      /*00*/ crn,&#10;      /*01*/ area_code,&#10;      /*02*/ level1_value,&#10;      /*03*/ level2_value,&#10;      /*04*/ level3_value,&#10;      /*05*/ alfresco_value&#10;    FROM TABLE( ALFRESCOSUPPORT.get_alfresco_permissions(p_offender_id) ) T;&#10;END procGetAlfrescoPermissions;&#10;&#10;--&#10;--------------------------------------------------------------------------------&#10;--&#10;-- Public Offender Search Procedures&#10;--&#10;--------------------------------------------------------------------------------&#10;FUNCTION funcFindOffendersTAB(&#10;    p_firstname             OFFENDER.first_name%TYPE,&#10;    p_middlename            OFFENDER.second_name%TYPE,&#10;    p_lastname              OFFENDER.surname%TYPE,&#10;    p_aliasfirstname        ALIAS.first_name%TYPE,&#10;    p_aliassecondname       ALIAS.second_name%TYPE,&#10;    p_aliasthirdname        ALIAS.third_name%TYPE,&#10;    p_aliassurname          ALIAS.surname%TYPE,&#10;    p_gender                NUMBER,&#10;    p_otheridentifierType   VARCHAR2,&#10;    p_otheridentifier       VARCHAR2,&#10;    p_nationalsearch        VARCHAR2,&#10;    p_trust                 PROBATION_AREA.code%TYPE,&#10;    --&#10;    p_crn                   OFFENDER.CRN%TYPE         DEFAULT NULL,&#10;    p_pnc_number            OFFENDER.pnc_number%TYPE  DEFAULT NULL,&#10;    p_date_of_birth         DATE                      DEFAULT NULL,&#10;    --&#10;    p_exclude_inactive_flag  VARCHAR2                 DEFAULT &#39;N&#39;,&#10;    p_include_preferred_name VARCHAR2                 DEFAULT &#39;N&#39; )&#10;RETURN PKG_OFF_NAT_SEARCH.ttabOffenders PIPELINED&#10;IS&#10;    l_rec PKG_OFF_NAT_SEARCH.trecOffender;&#10;    l_tab PKG_OFF_NAT_SEARCH.ttabOffenders;&#10;BEGIN&#10;    SELECT *&#10;    BULK COLLECT INTO l_tab&#10;    FROM&#10;      TABLE(&#10;          PKG_OFF_NAT_SEARCH.funcFindOffendersTAB(&#10;              p_first_name            &#61;&gt; p_firstname,&#10;              p_middle_name           &#61;&gt; p_middlename,&#10;              p_last_name             &#61;&gt; p_lastname,&#10;              --&#10;              p_alias_first_name      &#61;&gt; p_aliasfirstname,&#10;              p_alias_second_name     &#61;&gt; p_aliassecondname,&#10;              p_alias_third_name      &#61;&gt; p_aliasthirdname,&#10;              p_alias_surname         &#61;&gt; p_aliassurname,&#10;              p_gender                &#61;&gt; p_gender,&#10;              --&#10;              p_other_identifier_type &#61;&gt; p_otheridentifierType,&#10;              p_other_identifier      &#61;&gt; p_otheridentifier,&#10;              --&#10;              p_national_search       &#61;&gt; p_nationalsearch,&#10;              p_trust                 &#61;&gt; p_trust,&#10;              --&#10;              p_crn                   &#61;&gt; p_crn,&#10;              p_pnc_number            &#61;&gt; p_pnc_number,&#10;              --&#10;              p_date_of_birth         &#61;&gt; p_date_of_birth,&#10;              --&#10;              p_exclude_inactive_flag &#61;&gt; p_exclude_inactive_flag,&#10;              p_include_preferred_name&#61;&gt; p_include_preferred_name,&#10;              --&#10;              p_max_rows              &#61;&gt; 10000 ) );&#10;    --&#10;    FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;        PIPE ROW (l_tab(l_idx));&#10;    END LOOP;&#10;    --&#10;END funcFindOffendersTAB;&#10;--&#10;PROCEDURE procfindOffenders(&#10;    p_firstname             OFFENDER.first_name%TYPE,&#10;    p_middlename            OFFENDER.second_name%TYPE,&#10;    p_lastname              OFFENDER.surname%TYPE,&#10;    p_aliasfirstname        ALIAS.first_name%TYPE,&#10;    p_aliassecondname       ALIAS.second_name%TYPE,&#10;    p_aliasthirdname        ALIAS.third_name%TYPE,&#10;    p_aliassurname          ALIAS.surname%TYPE,&#10;    p_gender                NUMBER,&#10;    p_otheridentifierType   VARCHAR2,&#10;    p_otheridentifier       VARCHAR2,&#10;    p_nationalsearch        VARCHAR2,&#10;    p_trust                 PROBATION_AREA.code%TYPE,&#10;    --&#10;    p_crn                   OFFENDER.CRN%TYPE         DEFAULT NULL,&#10;    p_pnc_number            OFFENDER.pnc_number%TYPE  DEFAULT NULL,&#10;    p_date_of_birth         DATE                      DEFAULT NULL,&#10;    --&#10;    p_exclude_inactive_flag  VARCHAR2                 DEFAULT &#39;N&#39;,&#10;    p_include_preferred_name VARCHAR2                 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_outcursor             OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT *&#10;      FROM&#10;        TABLE(&#10;            PKG_OFF_NAT_SEARCH.funcFindOffendersTAB(&#10;                p_first_name            &#61;&gt; p_firstname,&#10;                p_middle_name           &#61;&gt; p_middlename,&#10;                p_last_name             &#61;&gt; p_lastname,&#10;                --&#10;                p_alias_first_name      &#61;&gt; p_aliasfirstname,&#10;                p_alias_second_name     &#61;&gt; p_aliassecondname,&#10;                p_alias_third_name      &#61;&gt; p_aliasthirdname,&#10;                p_alias_surname         &#61;&gt; p_aliassurname,&#10;                p_gender                &#61;&gt; p_gender,&#10;                --&#10;                p_other_identifier_type &#61;&gt; p_otheridentifierType,&#10;                p_other_identifier      &#61;&gt; p_otheridentifier,&#10;                --&#10;                p_national_search       &#61;&gt; p_nationalsearch,&#10;                p_trust                 &#61;&gt; p_trust,&#10;                --&#10;                p_crn                   &#61;&gt; p_crn,&#10;                p_pnc_number            &#61;&gt; p_pnc_number,&#10;                --&#10;                p_date_of_birth         &#61;&gt; p_date_of_birth,&#10;                --&#10;                p_exclude_inactive_flag &#61;&gt; p_exclude_inactive_flag,&#10;                p_include_preferred_name&#61;&gt; p_include_preferred_name,&#10;                --&#10;                p_max_rows              &#61;&gt; 10000 ) );&#10;END procfindOffenders;&#10;--&#10;-- National Custody Search&#10;--&#10;FUNCTION funcFindCustodyTAB(&#10;    p_first_name          OFFENDER.first_name%TYPE  DEFAULT NULL,&#10;    p_middle_name         OFFENDER.second_name%TYPE DEFAULT NULL,&#10;    p_last_name           OFFENDER.surname%TYPE     DEFAULT NULL,&#10;    --&#10;    p_crn                 OFFENDER.CRN%TYPE         DEFAULT NULL,&#10;    p_noms_number         OFFENDER.noms_number%TYPE DEFAULT NULL,&#10;    p_date_of_birth       DATE                      DEFAULT NULL,&#10;    p_institution_id      NUMBER                    DEFAULT NULL )&#10;RETURN PKG_OFF_NAT_SEARCH.ttabOffenders PIPELINED&#10;IS&#10;    l_rec PKG_OFF_NAT_SEARCH.trecOffender;&#10;    l_tab PKG_OFF_NAT_SEARCH.ttabOffenders;&#10;BEGIN&#10;    SELECT *&#10;    BULK COLLECT INTO l_tab&#10;    FROM&#10;      TABLE(&#10;          PKG_OFF_NAT_SEARCH.funcFindOffendersTAB(&#10;              p_national_search       &#61;&gt; &#39;Y&#39;,&#10;              p_custodial_search      &#61;&gt; &#39;Y&#39;,&#10;              p_include_preferred_name&#61;&gt; &#39;Y&#39;,&#10;              --&#10;              p_first_name            &#61;&gt; p_first_name,&#10;              p_middle_name           &#61;&gt; p_middle_name,&#10;              p_last_name             &#61;&gt; p_last_name,&#10;              --&#10;              p_crn                   &#61;&gt; p_crn,&#10;              p_noms_number           &#61;&gt; p_noms_number,&#10;              p_institution_id        &#61;&gt; p_institution_id,&#10;              p_date_of_birth         &#61;&gt; p_date_of_birth,&#10;              --&#10;              p_alias_first_name      &#61;&gt; &#39;Y&#39;,&#10;              p_alias_second_name     &#61;&gt; NULL,&#10;              p_alias_third_name      &#61;&gt; NULL,&#10;              p_alias_surname         &#61;&gt; NULL,&#10;              p_gender                &#61;&gt; NULL,&#10;              --&#10;              p_other_identifier_type &#61;&gt; NULL,&#10;              p_other_identifier      &#61;&gt; NULL,&#10;              --&#10;              p_trust                 &#61;&gt; NULL,&#10;              --&#10;              p_max_rows &#61;&gt; 10000 ) );&#10;    --&#10;    FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;        PIPE ROW (l_tab(l_idx));&#10;    END LOOP;&#10;    --&#10;END funcFindCustodyTAB;&#10;--&#10;PROCEDURE procfindCustody(&#10;    p_first_name          OFFENDER.first_name%TYPE  DEFAULT NULL,&#10;    p_middle_name         OFFENDER.second_name%TYPE DEFAULT NULL,&#10;    p_last_name           OFFENDER.surname%TYPE     DEFAULT NULL,&#10;    --&#10;    p_crn                 OFFENDER.CRN%TYPE         DEFAULT NULL,&#10;    p_noms_number         OFFENDER.noms_number%TYPE DEFAULT NULL,&#10;    p_date_of_birth       DATE                      DEFAULT NULL,&#10;    p_institution_id      NUMBER                    DEFAULT NULL,&#10;    --&#10;    p_outcursor           OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT *&#10;      FROM&#10;        TABLE(&#10;            PKG_SEARCH.funcFindCustodyTAB(&#10;                p_first_name            &#61;&gt; p_first_name,&#10;                p_middle_name           &#61;&gt; p_middle_name,&#10;                p_last_name             &#61;&gt; p_last_name,&#10;                --&#10;                p_crn                   &#61;&gt; p_crn,&#10;                p_noms_number           &#61;&gt; p_noms_number,&#10;                p_date_of_birth         &#61;&gt; p_date_of_birth,&#10;                p_institution_id        &#61;&gt; p_institution_id ) );&#10;END procfindCustody;&#10;&#10;--&#10;--&#10;-- Description: A procedure for finding offender summary detail feeding a SearchDTO via refcursor&#10;-- Input Paramaters : Passed in from java in the format below&#10;-- Output Parameters : A refcursor with variables names as expected by Java&#10;-- Author : Gordon Stutchbury&#10;-- ----------------------------------------------------------------------------------&#10;FUNCTION funcGetOffenderSummaryTAB(&#10;    p_offender_id       IN NUMBER,&#10;    p_nationalsearch    IN VARCHAR2 )&#10;RETURN PKG_OFF_NAT_SEARCH.ttabOffenderSummary PIPELINED&#10;IS&#10;    l_tab          PKG_OFF_NAT_SEARCH.ttabOffenderSummary;&#10;    --&#10;BEGIN&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_OFF_NAT_SEARCH.funcGetOffenderSummaryTAB(p_offender_id &#61;&gt; p_offender_id, p_national_search &#61;&gt; p_nationalsearch) );&#10;    --&#10;    FOR l_idx IN 1..l_tab.COUNT LOOP&#10;        PIPE ROW( l_tab(l_idx) );&#10;    END LOOP;&#10;    --&#10;END funcGetOffenderSummaryTAB;&#10;--&#10;PROCEDURE procgetOffenderSummary(&#10;    p_offenderID        IN NUMBER,&#10;    p_nationalsearch    VARCHAR2,&#10;    -- Returns&#10;    p_outcursor         IN OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    --&#10;    OPEN p_outcursor FOR&#10;      SELECT * FROM TABLE( PKG_OFF_NAT_SEARCH.funcGetOffenderSummaryTAB(p_offender_id &#61;&gt; p_offenderID, p_national_search &#61;&gt; p_nationalsearch) );&#10;    --&#10;END procgetOffenderSummary;&#10;--&#10;&#10;--&#10;-- Offender Search Helper Functions&#10;--&#10;FUNCTION  funcIsTransferInProgress(p_offenderID IN NUMBER) RETURN CHAR&#10;IS&#10;BEGIN&#10;    RETURN PKG_OFF_NAT_SEARCH.funcIsTransferInProgress(p_offenderID);&#10;END funcIsTransferInProgress;&#10;&#10;FUNCTION funcFindEthnicity(p_offenderID IN NUMBER)&#10;RETURN r_standard_reference_list.code_description%TYPE&#10;IS&#10;BEGIN&#10;    RETURN PKG_OFF_NAT_SEARCH.funcFindEthnicity(p_offenderID);&#10;END funcFindEthnicity;&#10;&#10;FUNCTION funcFindNationality(p_offenderID IN NUMBER) return r_standard_reference_list.code_description%TYPE&#10;IS&#10;BEGIN&#10;    RETURN PKG_OFF_NAT_SEARCH.funcFindNationality(p_offenderID);&#10;END funcFindNationality;&#10;&#10;FUNCTION funcFindLanguage(p_offenderID IN NUMBER) return r_standard_reference_list.code_description%TYPE&#10;IS&#10;BEGIN&#10;    RETURN PKG_OFF_NAT_SEARCH.funcFindLanguage(p_offenderID);&#10;END funcFindLanguage;&#10;&#10;PROCEDURE procCurrentlyDisabled(p_offenderID IN NUMBER, p_disabilityDesc IN OUT NOCOPY NUMBER, p_isDisabled IN OUT NOCOPY CHAR)&#10;IS&#10;BEGIN&#10;    PKG_OFF_NAT_SEARCH.procCurrentlyDisabled(p_offenderID, p_disabilityDesc, p_isDisabled);&#10;END procCurrentlyDisabled;&#10;&#10;PROCEDURE procWildCardFindOffenders(&#10;    p_firstname       IN offender.FIRST_NAME%TYPE,&#10;    p_middlename      IN offender.SECOND_NAME%TYPE,&#10;    p_lastname        IN offender.SURNAME%TYPE,&#10;    p_aliasfirstname  IN alias.FIRST_NAME%TYPE,&#10;    p_aliassecondname IN alias.SECOND_NAME%TYPE,&#10;    p_aliasthirdname  IN alias.THIRD_NAME%TYPE,&#10;    p_aliassurname    IN alias.SURNAME%TYPE,&#10;    p_outcursor       IN OUT SYS_REFCURSOR)&#10;IS&#10;BEGIN&#10;    PKG_OFF_NAT_SEARCH.procWildCardFindOffenders(&#10;        p_firstname,&#10;        p_middlename,&#10;        p_lastname,&#10;        p_aliasfirstname,&#10;        p_aliassecondname,&#10;        p_aliasthirdname,&#10;        p_aliassurname,&#10;        p_outcursor );&#10;END procWildCardFindOffenders;&#10;&#10;FUNCTION  funcUserInitialSurname(userid IN NUMBER) RETURN VARCHAR2&#10;IS&#10;BEGIN&#10;    RETURN PKG_OFF_NAT_SEARCH.funcUserInitialSurname(userid);&#10;END funcUserInitialSurname;&#10;&#10;PROCEDURE procFindMainAddress(&#10;    p_offenderID      IN NUMBER,&#10;    p_building_name   IN OUT offender_address.building_name%TYPE,&#10;    p_address_number  IN OUT offender_address.address_number%TYPE,&#10;    p_street_name     IN OUT offender_address.street_name%TYPE,&#10;    p_district        IN OUT offender_address.district%TYPE,&#10;    p_town_city       IN OUT offender_address.town_city%TYPE,&#10;    p_county          IN OUT offender_address.county%TYPE,&#10;    p_postcode        IN OUT offender_address.postcode%TYPE)&#10;IS&#10;BEGIN&#10;    PKG_OFF_NAT_SEARCH.procFindMainAddress(&#10;        p_offenderID,&#10;        p_building_name,&#10;        p_address_number,&#10;        p_street_name,&#10;        p_district,&#10;        p_town_city,&#10;        p_county,&#10;        p_postcode );&#10;END procFindMainAddress;&#10;&#10;&#10;--&#10;-- Events List Search procedure&#10;--&#10;FUNCTION procGetEventsTAB(p_offenderID NUMBER, p_max_rows INTEGER DEFAULT 100000)&#10;RETURN ttabEvents PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    l_SQL VARCHAR2(8192);&#10;    --&#10;    lc_delim        CONSTANT VARCHAR2(3) :&#61; &#39;#|#&#39;;&#10;    --&#10;    l_rows NUMBER :&#61; 0;&#10;    l_tab ttabEvents;&#10;    l_rec trecEvents;&#10;    --&#10;    l_sc_type_id   NUMBER :&#61; PKG_Lookups.funcgetStdRefListID(p_code_set&#61;&gt;&#39;COURT APPEARANCE TYPE&#39;, p_code&#61;&gt;&#39;S&#39;);&#10;    l_court_id     NUMBER;&#10;    l_court        VARCHAR2(1024);&#10;    l_outcome_id   NUMBER;&#10;    l_outcome      VARCHAR2(1024);&#10;    --&#10;    l_sc_app_found BOOLEAN :&#61; FALSE;&#10;    l_lc_app_found BOOLEAN :&#61; FALSE;&#10;    --&#10;BEGIN&#10;    l_SQL :&#61;&#10;&#39;SELECT&#10;  /*00*/ E.event_id,&#10;  /*01*/ E.event_number,&#10;  /*02*/ O.description                   offence_desc,&#10;  /*03*/ DT.disposal_type_id,&#10;  /*04*/ DT.disposal_type_code,&#10;  /*05*/ DT.description                  disposal_type_desc,&#10;  /*06*/ DT.sentence_type,&#10;  /*07*/ DT.cja2003,&#10;  /*08*/ DT.pre_cja2003,&#10;  /*09*/ D.disposal_id,&#10;  /*10*/ D.termination_date,&#10;  /*11*/ D.length                        disposal_length,&#10;  /*12*/ D.upw                           disposal_upw,&#10;  /*13*/ DTU.standard_reference_list_id  disposal_type_units_id,&#10;  /*14*/ DTU.code_value                  disposal_type_units_desc,&#10;  /*15*/ DTU.code_description            disposal_type_units_code,&#10;  --&#10;  -- courtAppearanceDAO.getSentencingCourtForEventList&#10;  /*16*/ NULL sc_court_code,&#10;  /*17*/ NULL sc_court_name,&#10;  /*18*/ NULL sc_locality,&#10;  /*19*/ NULL sc_appearance_date,&#10;  /*20*/ NULL sc_court_app_outcome_code,&#10;  /*21*/ NULL sc_court_app_outcome_desc,&#10;  --&#10;  -- courtAppearanceDAO.getLatestCourtAppearanceWithOutcomeForEventList&#10;  /*22*/ NULL lc_court_code,&#10;  /*23*/ NULL lc_court_name,&#10;  /*24*/ NULL lc_appearance_date,&#10;  /*25*/ NULL lc_court_app_outcome_code,&#10;  /*26*/ NULL lc_court_app_outcome_desc,&#10;  --&#10;  /*27*/ E.referral_date,&#10;  --&#10;  /*28*/ DT.auto_terminate,&#10;  /*29*/ D.effective_length,&#10;  /*30*/ E.CONCURRENT_WITH_EVENT_ID,&#10;  /*31*/ E.CONSECUTIVE_TO_EVENT_ID,&#10;  /*32*/ D.DISPOSAL_DATE                SENTENCE_DATE,&#10;  /*33*/ E.BREACH_END                   BREACH_END_DATE,&#10;  /*34*/ E.FTC_COUNT,&#10;  /*35*/ E.IN_BREACH,&#10;  /*36*/ cs.CODE_VALUE                  CUSTODIAL_STATUS_CODE_VALUE,&#10;  /*37*/ E.PSS_RQMNT_FLAG               PSS_RQMNT_FLAG,&#10;  /*38*/ D.ENTRY_LENGTH                 entry_length,&#10;  /*39*/ ELU.CODE_DESCRIPTION           ENTRY_LENGTH_UNITS_DESC,&#10;  /*40*/ CA.case_allocation_id          CASE_ALLOCATION_ID,&#10;  /*41*/ TA.ALLOCATION_DECISION_ID      TIER_ALLOCATION_DECISION_ID&#10;  --&#10;FROM&#10;  event                     E,&#10;  main_offence              MO,&#10;  r_offence                 O,&#10;  disposal                  D,&#10;  custody                   C,&#10;  r_disposal_type           DT,&#10;  r_standard_reference_list DTU,&#10;  r_standard_reference_list CS,&#10;  r_standard_reference_list ELU,&#10;  case_allocation           CA,&#10;  tier_allocation           TA&#10;WHERE E.offender_id                     &#61; :p_offender_id&#10;  AND E.soft_deleted                    &#61; 0&#10;  AND MO.event_id(+)                    &#61; E.event_id&#10;  AND O.offence_id(+)                   &#61; MO.offence_id&#10;  AND D.event_id(+)                     &#61; E.event_id&#10;  AND C.disposal_id(+)                  &#61; D.disposal_id&#10;  AND DT.disposal_type_id(+)            &#61; D.disposal_type_id&#10;  AND DTU.standard_reference_list_id(+) &#61; DT.units_id&#10;  AND CS.standard_reference_list_id(+)  &#61; C.custodial_status_id&#10;  AND ELU.standard_reference_list_id(+) &#61; D.ENTRY_LENGTH_UNITS_ID&#10;  AND CA.event_id(+)                    &#61; E.event_id&#10;  AND TA.event_id(+)                    &#61; E.event_id&#39;;&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --procDebug(&#39;procGetEventsTAB START: &#39; || &#39;(p_offenderID&#61;&#39;  || p_offenderID || &#39;)&#39; || CHR(10) || l_SQL);&#10;    --&#10;    OPEN l_cur FOR l_SQL USING p_offenderID;&#10;    FETCH l_cur BULK COLLECT INTO l_tab LIMIT p_max_rows;&#10;    CLOSE l_cur;&#10;    --&#10;    --procDebug(&#39;procfindUPWDetailsTAB (v_tab_UPW.COUNT&#61;&#39; || v_tab_UPW.COUNT  || &#39;)&#39;);&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_rows :&#61; l_rows + 1;&#10;        EXIT WHEN l_rows &gt; p_max_rows;&#10;        --&#10;        l_rec :&#61; l_tab(l_i);&#10;        --&#10;        OPEN l_cur FOR&#10;          SELECT&#10;            court_id,&#10;            outcome_id,&#10;            /*16*/ NULL court_code,&#10;            /*17*/ NULL court_name,&#10;            /*18*/ NULL locality,&#10;            /*19*/ appearance_date,&#10;            /*20*/ NULL court_app_outcome_code,&#10;            /*21*/ NULL court_app_outcome_description&#10;          FROM court_appearance&#10;          WHERE event_id           &#61; l_rec.event_id&#10;            AND appearance_type_id &#61; l_sc_type_id&#10;          ORDER BY&#10;            appearance_date ASC,&#10;            created_datetime DESC;&#10;        --&#10;        FETCH l_cur INTO&#10;            l_court_id,&#10;            l_outcome_id,&#10;            /*16*/ l_rec.sc_court_code,&#10;            /*17*/ l_rec.sc_court_name,&#10;            /*18*/ l_rec.sc_locality,&#10;            /*19*/ l_rec.sc_appearance_date,&#10;            /*20*/ l_rec.sc_court_app_outcome_code,&#10;            /*21*/ l_rec.sc_court_app_outcome_desc;&#10;        l_sc_app_found :&#61; l_cur%FOUND;&#10;        CLOSE l_cur;&#10;        --&#10;        IF l_sc_app_found THEN&#10;            IF l_court_id IS NOT NULL THEN&#10;                l_court :&#61; PKG_Lookups.get_court_data(l_court_id, &#39;PKG_LstUtl.concat(CODE, COURT_NAME, LOCALITY, p_delim &#61;&gt; &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39;)&#39;);&#10;                /*16*/ l_rec.sc_court_code :&#61; PKG_LstUtl.list_next_elem(l_court, lc_delim);&#10;                /*17*/ l_rec.sc_court_name :&#61; PKG_LstUtl.list_next_elem(l_court, lc_delim);&#10;                /*18*/ l_rec.sc_locality   :&#61; l_court;&#10;            END IF;&#10;            --&#10;            IF l_outcome_id IS NOT NULL THEN&#10;                l_outcome :&#61; PKG_Lookups.funcgetStdRefListCodeAndDesc(l_outcome_id, p_delim&#61;&gt;lc_delim);&#10;                /*20*/ l_rec.sc_court_app_outcome_code :&#61; PKG_LstUtl.list_next_elem(l_outcome, lc_delim);&#10;                /*21*/ l_rec.sc_court_app_outcome_desc :&#61; l_outcome;&#10;            END IF;&#10;        END IF;&#10;        --&#10;        IF (NOT l_sc_app_found) OR l_outcome_id IS NULL THEN&#10;            OPEN l_cur FOR&#10;                SELECT&#10;                  court_id,&#10;                  outcome_id,&#10;                  NULL court_code,&#10;                  NULL court_name,&#10;                  appearance_date,&#10;                  NULL court_app_outcome_code,&#10;                  NULL court_app_outcome_description&#10;                FROM court_appearance&#10;                WHERE event_id &#61; l_rec.event_id&#10;                  AND outcome_id IS NOT NULL&#10;                ORDER BY&#10;                  appearance_date DESC,&#10;                  created_datetime DESC;&#10;            --&#10;            FETCH l_cur INTO&#10;                l_court_id,&#10;                l_outcome_id,&#10;                /*22*/ l_rec.lc_court_code,&#10;                /*23*/ l_rec.lc_court_name,&#10;                /*24*/ l_rec.lc_appearance_date,&#10;                /*25*/ l_rec.lc_court_app_outcome_code,&#10;                /*26*/ l_rec.lc_court_app_outcome_desc;&#10;            l_lc_app_found :&#61; l_cur%FOUND;&#10;            CLOSE l_cur;&#10;            --&#10;            IF l_lc_app_found THEN&#10;                IF l_court_id IS NOT NULL THEN&#10;                    l_court :&#61; PKG_Lookups.get_court_data(l_court_id, &#39;PKG_LstUtl.concat(CODE, COURT_NAME, p_delim &#61;&gt; &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39;)&#39;);&#10;                    /*22*/ l_rec.lc_court_code :&#61; PKG_LstUtl.list_next_elem(l_court, lc_delim);&#10;                    /*23*/ l_rec.lc_court_name :&#61; l_court;&#10;                END IF;&#10;                --&#10;                IF l_outcome_id IS NOT NULL THEN&#10;                    l_outcome :&#61; PKG_Lookups.funcgetStdRefListCodeAndDesc(l_outcome_id, p_delim&#61;&gt;lc_delim);&#10;                    /*20*/ l_rec.lc_court_app_outcome_code :&#61; PKG_LstUtl.list_next_elem(l_outcome, lc_delim);&#10;                    /*21*/ l_rec.lc_court_app_outcome_desc :&#61; l_outcome;&#10;                END IF;&#10;            END IF;&#10;        END IF;&#10;        --&#10;        PIPE ROW ( l_rec );&#10;    END LOOP;&#10;    --&#10;    procDebug(&#39;procGetEventsTAB (rows&#61;&#39; || l_rows  || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): (p_offenderID&#61;&#39;  || p_offenderID   || &#39;)&#39; || CHR(10) || l_SQL);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(&#39;procGetEventsTAB ERROR: &#39; || SQLERRM || &#39; (p_offenderID&#61;&#39;  || p_offenderID   || &#39;)&#39; || CHR(10) || l_SQL);&#10;    RAISE;&#10;END procGetEventsTAB;&#10;&#10;PROCEDURE procGetEvents(p_offenderID NUMBER, p_outcursor OUT SYS_REFCURSOR) IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ event_id,&#10;        /*01*/ event_number,&#10;        /*02*/ offence_desc,&#10;        /*03*/ disposal_type_id,&#10;        /*04*/ disposal_type_code,&#10;        /*05*/ disposal_type_desc,&#10;        /*06*/ sentence_type,&#10;        /*07*/ cja2003,&#10;        /*08*/ pre_cja2003,&#10;        /*09*/ disposal_id,&#10;        /*10*/ disposal_termination_date,&#10;        /*11*/ disposal_length,&#10;        /*12*/ disposal_upw_flag,&#10;        /*13*/ disposal_type_units_id,&#10;        /*14*/ disposal_type_units_code,&#10;        /*15*/ disposal_type_units_desc,&#10;        --&#10;        -- courtAppearanceDAO.getSentencingCourtForEventList&#10;        /*16*/ sc_court_code,&#10;        /*17*/ sc_court_name,&#10;        /*18*/ sc_locality,&#10;        /*19*/ sc_appearance_date,&#10;        /*20*/ sc_court_app_outcome_code,&#10;        /*21*/ sc_court_app_outcome_desc,&#10;        --&#10;        -- courtAppearanceDAO.getLatestCourtAppearanceWithOutcomeForEventList&#10;        /*22*/ lc_court_code,&#10;        /*23*/ lc_court_name,&#10;        /*24*/ lc_appearance_date,&#10;        /*25*/ lc_court_app_outcome_code,&#10;        /*26*/ lc_court_app_outcome_desc,&#10;        --&#10;        /*27*/ referral_date,&#10;        /*28*/ auto_terminate,&#10;        /*29*/ effective_length,&#10;        /*30*/ CONCURRENT_WITH_EVENT_ID,&#10;        /*31*/ CONSECUTIVE_TO_EVENT_ID,&#10;        /*32*/ SENTENCE_DATE,&#10;        /*33*/ BREACH_END_DATE,&#10;        /*34*/ FTC_COUNT,&#10;        /*35*/ IN_BREACH,&#10;        /*36*/ CUSTODIAL_STATUS_CODE_VALUE,&#10;        /*37*/ PSS_RQMNT_FLAG,&#10;        /*38*/ ENTRY_LENGTH,&#10;        /*39*/ ENTRY_LENGTH_UNITS_DESC,&#10;        /*40*/ CASE_ALLOCATION_ID,&#10;        /*41*/ TIER_ALLOCATION_DECISION_ID&#10;      FROM TABLE( PKG_SEARCH.procGetEventsTAB(p_offenderID &#61;&gt; p_offenderID /*,p_max_rows &#61;&gt; 5*/) );&#10;--EXCEPTION WHEN NO_DATA_FOUND THEN&#10;--    NULL;&#10;END procGetEvents;&#10;--&#10;--&#10;&#10;FUNCTION get_sql_xplain_plan(p_SQL VARCHAR2) RETURN CLOB&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    l_ret CLOB;&#10;BEGIN&#10;    EXECUTE IMMEDIATE &#39;EXPLAIN PLAN FOR &#39; || p_SQL;&#10;    l_ret :&#61; DBMS_XPLAN.DISPLAY_PLAN;&#10;    COMMIT;&#10;    RETURN l_ret;&#10;END get_sql_xplain_plan;&#10;&#10;--&#10;-- CONTACT Log List Search procedure&#10;--&#10;FUNCTION procGetContactsTAB(&#10;    p_offenderID          NUMBER,&#10;    p_eventID             NUMBER,&#10;    p_licconID            NUMBER,&#10;    p_rqmntID             NUMBER,&#10;    p_StartDate           DATE,&#10;    p_EndDate             DATE,&#10;    p_filter_type         VARCHAR2,&#10;    p_category            NUMBER,&#10;    p_offenderNsiID       NUMBER,&#10;    p_allOffenderNsi      NUMBER,&#10;    p_eventNsiID          NUMBER,&#10;    p_allEventNsi         NUMBER,&#10;    p_pssRqmntID          NUMBER,&#10;    p_exact_match_flag    VARCHAR2,&#10;    p_exclude_sgc_flag    VARCHAR2,&#10;    --&#10;    p_sgc_flag             VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_attended_flag        VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_complied_flag        VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_outcome_overdue_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_drug_test_view_flag  VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_max_rows             INTEGER DEFAULT 100000,&#10;    p_limit_rows_flag       VARCHAR2 DEFAULT &#39;Y&#39; )&#10;RETURN PKG_CONTACTLOG.ttabContacts PIPELINED&#10;IS&#10;    --&#10;    l_tab PKG_ContactLog.ttabContacts;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_CONTACTLOG.procGetContactsTAB(&#10;                    p_offenderID       &#61;&gt; p_offenderID,&#10;                    p_eventID          &#61;&gt; p_eventID,&#10;                    p_licconID         &#61;&gt; p_licconID,&#10;                    p_rqmntID          &#61;&gt; p_rqmntID,&#10;                    p_StartDate        &#61;&gt; p_StartDate,&#10;                    p_EndDate          &#61;&gt; p_EndDate,&#10;                    --&#10;                    p_filter_type      &#61;&gt; p_filter_type,&#10;                    p_category         &#61;&gt; p_category,&#10;                    --&#10;                    p_offenderNsiID    &#61;&gt; p_offenderNsiID,&#10;                    p_allOffenderNsi   &#61;&gt; p_allOffenderNsi,&#10;                    p_eventNsiID       &#61;&gt; p_eventNsiID,&#10;                    p_allEventNsi      &#61;&gt; p_allEventNsi,&#10;                    p_pssRqmntID       &#61;&gt; p_pssRqmntID,&#10;                    p_exact_match_flag &#61;&gt; p_exact_match_flag,&#10;                    p_exclude_sgc_flag &#61;&gt; p_exclude_sgc_flag,&#10;                    --&#10;                    p_sgc_flag             &#61;&gt; p_sgc_flag,&#10;                    p_attended_flag        &#61;&gt; p_attended_flag,&#10;                    p_complied_flag        &#61;&gt; p_complied_flag,&#10;                    p_outcome_overdue_flag &#61;&gt; p_outcome_overdue_flag,&#10;                    --&#10;                    p_drug_test_view_flag  &#61;&gt; p_drug_test_view_flag,&#10;                    p_max_rows             &#61;&gt; p_max_rows,&#10;                    p_limit_rows_flag      &#61;&gt; p_limit_rows_flag ) );&#10;    --&#10;    FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;        PIPE ROW (l_tab(l_idx));&#10;    END LOOP;&#10;    --&#10;END procGetContactsTAB;&#10;--&#10;PROCEDURE procGetContacts(&#10;    p_offenderID           NUMBER,&#10;    p_eventID              NUMBER,&#10;    p_licconID             NUMBER,&#10;    p_rqmntID              NUMBER,&#10;    p_StartDate            DATE,&#10;    p_EndDate              DATE,&#10;    p_filter_type          VARCHAR2,&#10;    p_category             NUMBER,&#10;    p_offenderNsiID        NUMBER,&#10;    p_allOffenderNsi       NUMBER,&#10;    p_eventNsiID           NUMBER,&#10;    p_allEventNsi          NUMBER,&#10;    p_pssRqmntID           NUMBER,&#10;    p_exact_match_flag     VARCHAR2,&#10;    p_exclude_sgc_flag     VARCHAR2,&#10;    --&#10;    p_sgc_flag             VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_attended_flag        VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_complied_flag        VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_outcome_overdue_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_drug_test_view_flag  VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_limit_rows_flag      VARCHAR2 DEFAULT &#39;Y&#39;,&#10;    --&#10;    p_outcursor            OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ offender_id,&#10;        /*01*/ row_version,&#10;        /*02*/ linked_contact_id,&#10;        /*03*/ contact_id,&#10;        /*04*/ contact_date,&#10;        /*05*/ contact_start_time,&#10;        /*06*/ contact_end_time,&#10;        /*07*/ contact_type_id,&#10;        /*08*/ contact_type_code,&#10;        /*09*/ contact_type_desc,&#10;        /*10*/ contact_outcome_desc,&#10;        /*11*/ contact_outcome_type_id,&#10;        /*12*/ staff_id,&#10;        /*13*/ officer_code,&#10;        /*14*/ staff_forename,&#10;        /*15*/ staff_forename2,&#10;        /*16*/ staff_surname,&#10;        /*17*/ provider_employee_id,&#10;        /*18*/ provider_emp_code,&#10;        /*19*/ provider_emp_forename,&#10;        /*20*/ provider_emp_forename2,&#10;        /*21*/ provider_emp_surname,&#10;        /*22*/ event_id,&#10;        /*23*/ event_number,&#10;        /*24*/ disposal_type,&#10;        /*25*/ lic_condition_id,&#10;        /*26*/ rqmnt_id,&#10;        /*27*/ comp_main_cat_id,&#10;        /*28*/ comp_main_cat_desc,&#10;        /*29*/ comp_unit_desc,&#10;        /*30*/ comp_sub_id,&#10;        /*31*/ comp_sub_desc,&#10;        /*32*/ comp_length,&#10;        /*33*/ ad_main_cat_id,&#10;        /*34*/ ad_main_cat_desc,&#10;        /*35*/ ad_unit_desc,&#10;        /*36*/ ad_sub_id,&#10;        /*37*/ ad_sub_desc,&#10;        /*38*/ attended,&#10;        /*39*/ complied,&#10;        /*40*/ document_linked,&#10;        /*41*/ user_editable,&#10;        /*42*/ nsi_id,&#10;        /*43*/ nsi_type_id,&#10;        /*44*/ nsi_type_desc,&#10;        /*45*/ nsi_sub_type_id,&#10;        /*46*/ nsi_sub_type_desc,&#10;        /*47*/ nsi_length,&#10;        /*48*/ nsi_length_unit_desc,&#10;        /*49*/ pss_rqmnt_id,&#10;        /*50*/ pss_rqmnt_type_id,&#10;        /*51*/ pss_rqmnt_type_desc,&#10;        /*52*/ pss_rqmnt_sub_type_id,&#10;        /*53*/ pss_rqmnt_sub_type_desc,&#10;        /*54*/ pss_rqmnt_length,&#10;        /*55*/ pss_rqmnt_length_unit_desc,&#10;        --&#10;        /*56*/ sgc_flag,&#10;        --&#10;        /*57*/ disposal_date,&#10;        /*58*/ latest_court_appearance_date,&#10;        /*59*/ contact_description,&#10;        /*60*/ drug_test_view,&#10;        /*61*/ drug_view_type,&#10;        /*62*/ document_linked_entity&#10;        --&#10;      FROM TABLE( PKG_CONTACTLOG.procGetContactsTAB(&#10;                      p_offenderID       &#61;&gt; p_offenderID,&#10;                      p_eventID          &#61;&gt; p_eventID,&#10;                      p_licconID         &#61;&gt; p_licconID,&#10;                      p_rqmntID          &#61;&gt; p_rqmntID,&#10;                      p_StartDate        &#61;&gt; p_StartDate,&#10;                      p_EndDate          &#61;&gt; p_EndDate,&#10;                      --&#10;                      p_filter_type      &#61;&gt; p_filter_type,&#10;                      p_category         &#61;&gt; p_category,&#10;                      --&#10;                      p_offenderNsiID    &#61;&gt; p_offenderNsiID,&#10;                      p_allOffenderNsi   &#61;&gt; p_allOffenderNsi,&#10;                      p_eventNsiID       &#61;&gt; p_eventNsiID,&#10;                      p_allEventNsi      &#61;&gt; p_allEventNsi,&#10;                      p_pssRqmntID       &#61;&gt; p_pssRqmntID,&#10;                      p_exact_match_flag &#61;&gt; p_exact_match_flag,&#10;                      p_exclude_sgc_flag &#61;&gt; p_exclude_sgc_flag,&#10;                      --&#10;                      p_sgc_flag             &#61;&gt; p_sgc_flag,&#10;                      p_attended_flag        &#61;&gt; p_attended_flag,&#10;                      p_complied_flag        &#61;&gt; p_complied_flag,&#10;                      p_outcome_overdue_flag &#61;&gt; p_outcome_overdue_flag,&#10;                      --&#10;                      p_drug_test_view_flag  &#61;&gt; p_drug_test_view_flag,&#10;                      p_max_rows             &#61;&gt; PKG_Lookups.funcgetNDParameterValue( p_par_name &#61;&gt; &#39;REPORT_SEARCH_MAX_RESULTS&#39;, p_default_value &#61;&gt; 10000 ),&#10;                      p_limit_rows_flag      &#61;&gt; p_limit_rows_flag )&#10;                );&#10;--EXCEPTION WHEN NO_DATA_FOUND THEN&#10;--    NULL;&#10;END procGetContacts;&#10;--&#10;FUNCTION procFindAlertContactsTAB(&#10;    p_date                 DATE,&#10;    p_team_id              NUMBER,&#10;    p_provider_team_id     NUMBER,&#10;    p_staff_id             NUMBER,&#10;    p_provider_employee_id NUMBER,&#10;    p_max_rows             INTEGER DEFAULT 100000)&#10;RETURN PKG_CONTACTLOG.ttabOfficerDiary PIPELINED&#10;IS&#10;    --&#10;    l_tab PKG_CONTACTLOG.ttabOfficerDiary;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_CONTACTLOG.procFindAlertContactsTAB(&#10;                    p_date                 &#61;&gt; p_date,&#10;                    p_team_id              &#61;&gt; p_team_id,&#10;                    p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                    p_staff_id             &#61;&gt; p_staff_id,&#10;                    p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                    --&#10;                    p_max_rows &#61;&gt; p_max_rows ) );&#10;    --&#10;    FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;        PIPE ROW (l_tab(l_idx));&#10;    END LOOP;&#10;    --&#10;END procFindAlertContactsTAB;&#10;--&#10;PROCEDURE procFindAlertContacts(&#10;    p_date              DATE,&#10;    p_team_id           NUMBER,&#10;    p_provider_team_id  NUMBER,&#10;    p_staff_id           NUMBER,&#10;    p_provider_employee_id  NUMBER,&#10;    p_outcursor             OUT SYS_REFCURSOR )&#10;AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ C.offender_id,&#10;        /*01*/ crn,&#10;        /*02*/ first_name,&#10;        /*03*/ second_name,&#10;        /*04*/ third_name,&#10;        /*05*/ surname,&#10;        /*06*/ current_highest_risk_colour,&#10;        /*07*/ current_restriction,&#10;        /*08*/ current_exclusion,&#10;        /*09*/ restriction_message,&#10;        /*10*/ exclusion_message,&#10;        /*11*/ contact_id,&#10;        /*12*/ contact_date,&#10;        /*13*/ contact_start_time,&#10;        /*14*/ contact_type_id,&#10;        /*15*/ contact_type_code,&#10;        /*16*/ contact_type_desc,&#10;        /*17*/ contact_outcome_type_id,&#10;        /*18*/ contact_outcome_type_desc,&#10;        /*19*/ tier_description,&#10;        /*20*/ user_editable,&#10;        --&#10;        /*21*/ L1,&#10;        /*22*/ L2,&#10;        /*23*/ L3,&#10;        /*24*/ contact_description&#10;        --&#10;      FROM TABLE( PKG_CONTACTLOG.procFindAlertContactsTAB(&#10;                      p_date                 &#61;&gt; p_date,&#10;                      p_team_id              &#61;&gt; p_team_id,&#10;                      p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                      p_staff_id             &#61;&gt; p_staff_id,&#10;                      p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                      p_max_rows             &#61;&gt; pkg_lookups.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;REPORT_SEARCH_MAX_RESULTS&#39;, p_default_value &#61;&gt; 10000)) ) C;&#10;    --&#10;END procFindAlertContacts;&#10;&#10;--&#10;FUNCTION funcGetBreachDate(p_event_id NUMBER) RETURN DATE IS&#10;BEGIN&#10;    --&#10;    RETURN PKG_CONTACTLOG.funcGetBreachDate(p_event_id);&#10;    --&#10;END funcGetBreachDate;&#10;--&#10;FUNCTION funcGetBreachDateEnd(p_event_id NUMBER) RETURN DATE IS&#10;BEGIN&#10;    --&#10;    RETURN PKG_CONTACTLOG.funcGetBreachDateEnd(p_event_id);&#10;    --&#10;END funcGetBreachDateEnd;&#10;--&#10;FUNCTION procFindEnforcementContactsTAB(&#10;    p_date                 DATE,&#10;    p_team_id              NUMBER,&#10;    p_provider_team_id     NUMBER,&#10;    p_staff_id             NUMBER,&#10;    p_provider_employee_id NUMBER,&#10;    p_filter               INTEGER,&#10;    p_max_rows             INTEGER DEFAULT 100000)&#10;RETURN PKG_CONTACTLOG.ttabOfficerDiary PIPELINED&#10;IS&#10;    --&#10;    l_tab PKG_CONTACTLOG.ttabOfficerDiary;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_CONTACTLOG.procFindEnforcementContactsTAB(&#10;                    p_date                 &#61;&gt; p_date,&#10;                    p_team_id              &#61;&gt; p_team_id,&#10;                    p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                    p_staff_id             &#61;&gt; p_staff_id,&#10;                    p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                    p_filter               &#61;&gt; p_filter,&#10;                    --&#10;                    p_max_rows &#61;&gt; p_max_rows ) );&#10;    --&#10;    FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;        PIPE ROW (l_tab(l_idx));&#10;    END LOOP;&#10;    --&#10;END procFindEnforcementContactsTAB;&#10;--&#10;PROCEDURE procFindEnforcementContacts(&#10;    p_date                  DATE,&#10;    p_team_id               NUMBER,&#10;    p_provider_team_id      NUMBER,&#10;    p_staff_id              NUMBER,&#10;    p_provider_employee_id  NUMBER,&#10;    p_filter                NUMBER,&#10;    p_outcursor             OUT SYS_REFCURSOR ) AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT DISTINCT&#10;        /*00*/ offender_id,&#10;        /*01*/ crn,&#10;        /*02*/ first_name,&#10;        /*03*/ second_name,&#10;        /*04*/ third_name,&#10;        /*05*/ surname,&#10;        /*06*/ current_highest_risk_colour,&#10;        /*07*/ current_restriction,&#10;        /*08*/ current_exclusion,&#10;        /*09*/ restriction_message,&#10;        /*10*/ exclusion_message,&#10;        /*11*/ contact_id,&#10;        /*12*/ contact_date,&#10;        /*13*/ contact_start_time,&#10;        /*14*/ contact_type_id,&#10;        /*15*/ contact_type_code,&#10;        /*16*/ contact_type_desc,&#10;        /*17*/ contact_outcome_type_id,&#10;        /*18*/ contact_outcome_type_desc,&#10;        /*19*/ tier_description,&#10;        /*20*/ current_tier,&#10;        /*21*/ ea_desc,&#10;        /*22*/ user_editable,&#10;        /*23*/ L1,&#10;        /*24*/ L2,&#10;        /*25*/ L3,&#10;        --&#10;        /*26*/ date_of_birth,&#10;        /*27*/ contact_description,&#10;        --&#10;        /*28*/ staff_id,&#10;        /*29*/ staff_code,&#10;        /*30*/ staff_desc&#10;      FROM TABLE( PKG_CONTACTLOG.procFindEnforcementContactsTAB(&#10;                      p_date                 &#61;&gt; p_date,&#10;                      p_team_id              &#61;&gt; p_team_id,&#10;                      p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                      p_staff_id             &#61;&gt; p_staff_id,&#10;                      p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                      p_filter               &#61;&gt; p_filter,&#10;                      p_max_rows             &#61;&gt; PKG_LOOKUPS.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;REPORT_SEARCH_MAX_RESULTS&#39;, p_default_value &#61;&gt; 10000) )&#10;                )&#10;      ORDER BY contact_date, contact_start_time;&#10;--EXCEPTION WHEN NO_DATA_FOUND THEN&#10;--    NULL; -- let the app handle it from a NULL cursor RAISE_APPLICATION_ERROR(-20008,&#39;No offender found &#39;);&#10;END procFindEnforcementContacts;&#10;--&#10;--&#10;FUNCTION procFindVisorContactTAB(&#10;    p_probation_area_id    NUMBER,&#10;    p_date_from            DATE,&#10;    p_date_to              DATE,&#10;    p_copy_to_visor        VARCHAR2,&#10;    p_exported_to_visor    VARCHAR2,&#10;    p_team_id              NUMBER   DEFAULT NULL,&#10;    p_staff_id             NUMBER   DEFAULT NULL,&#10;    p_offender_id          NUMBER   DEFAULT NULL,&#10;    p_borough_id           NUMBER   DEFAULT NULL,&#10;    p_district_id          NUMBER   DEFAULT NULL,&#10;    p_order_by             VARCHAR2 DEFAULT NULL,&#10;    p_max_rows             INTEGER  DEFAULT 100000 )&#10;RETURN PKG_CONTACTLOG.ttabVisorContact PIPELINED&#10;IS&#10;    --&#10;    l_tab PKG_CONTACTLOG.ttabVisorContact;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_CONTACTLOG.procFindVisorContactTAB(&#10;                    p_probation_area_id &#61;&gt; p_probation_area_id,&#10;                    p_date_from         &#61;&gt; p_date_from,&#10;                    p_date_to           &#61;&gt; p_date_to,&#10;                    p_copy_to_visor     &#61;&gt; p_copy_to_visor,&#10;                    p_exported_to_visor &#61;&gt; p_exported_to_visor,&#10;                    p_team_id           &#61;&gt; p_team_id,&#10;                    p_staff_id          &#61;&gt; p_staff_id,&#10;                    p_offender_id       &#61;&gt; p_offender_id,&#10;                    p_borough_id        &#61;&gt; p_borough_id,&#10;                    p_district_id       &#61;&gt; p_district_id,&#10;                    --&#10;                    p_order_by &#61;&gt; p_order_by,&#10;                    p_max_rows &#61;&gt; p_max_rows ) );&#10;    --&#10;    FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;        PIPE ROW (l_tab(l_idx));&#10;    END LOOP;&#10;    --&#10;END procFindVisorContactTAB;&#10;&#10;PROCEDURE procFindVisorContact(&#10;    p_probation_area_id    NUMBER,&#10;    p_date_from            DATE,&#10;    p_date_to              DATE,&#10;    p_copy_to_visor        VARCHAR2,&#10;    p_exported_to_visor    VARCHAR2,&#10;    p_team_id              NUMBER  DEFAULT NULL,&#10;    p_staff_id             NUMBER  DEFAULT NULL,&#10;    p_offender_id          NUMBER  DEFAULT NULL,&#10;    p_borough_id           NUMBER DEFAULT NULL,&#10;    p_district_id          NUMBER DEFAULT NULL,&#10;    p_outcursor             OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    --&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ contact_id,&#10;        --&#10;        /*01*/ offender_id,&#10;        /*02*/ crn,&#10;        /*03*/ surname,&#10;        /*04*/ forename,&#10;        /*05*/ forename2,&#10;        --&#10;        /*06*/ event_id,&#10;        --&#10;        /*07*/ probation_area_id,&#10;        /*08*/ probation_area_code,&#10;        /*09*/ probation_area_desc,&#10;        --&#10;        /*10*/ om_probation_area_id,&#10;        /*11*/ om_probation_area_code,&#10;        /*12*/ om_probation_area_desc,&#10;        --&#10;        /*13*/ team_id,&#10;        /*14*/ team_code,&#10;        /*15*/ team_desc,&#10;        /*16*/ staff_id,&#10;        /*17*/ staff_code,&#10;        /*18*/ staff_desc,&#10;        --&#10;        /*19*/ om_team_id,&#10;        /*20*/ om_team_code,&#10;        /*21*/ om_team_desc,&#10;        /*22*/ om_staff_id,&#10;        /*23*/ om_staff_code,&#10;        /*24*/ om_staff_desc,&#10;        --&#10;        /*25*/ provider_team_id,&#10;        /*26*/ provider_employee_id,&#10;        --&#10;        /*27*/ provider_location_id,&#10;        /*28*/ provider_location_code,&#10;        /*29*/ provider_location_desc,&#10;        --&#10;        /*30*/ office_location_id,&#10;        /*31*/ office_location_code,&#10;        /*32*/ office_location_desc,&#10;        --&#10;        /*33*/ contact_outcome_type_id,&#10;        /*34*/ contact_outcome_type_code,&#10;        /*35*/ contact_outcome_type_desc,&#10;        --&#10;        /*36*/ contact_type_id,&#10;        /*37*/ contact_type_code,&#10;        /*38*/ contact_type_desc,&#10;        --&#10;        /*39*/ visor_contact,&#10;        /*40*/ visor_exported,&#10;        --&#10;        /*41*/ sensitive,&#10;        /*42*/ attended,&#10;        /*43*/ complied,&#10;        /*44*/ contact_date,&#10;        /*45*/ contact_start_time,&#10;        /*46*/ contact_end_time,&#10;        /*47*/ notes,&#10;        --&#10;        /*48*/ soft_deleted,&#10;        /*49*/ date_of_birth,&#10;        /*50*/ staff_forename,&#10;        /*51*/ staff_forename2,&#10;        /*52*/ staff_surname,&#10;        /*53*/ staff_grade,&#10;        /*54*/ officer_code,&#10;        /*55*/ team_probation_area_desc,&#10;        /*56*/ CURRENT_RESTRICTION,&#10;        /*57*/ CURRENT_EXCLUSION,&#10;        /*58*/ RESTRICTION_MESSAGE,&#10;        /*59*/ EXCLUSION_MESSAGE,&#10;        /*60*/ VISOR,&#10;        /*61*/ contact_description&#10;      FROM TABLE( PKG_CONTACTLOG.procFindVisorContactTAB(&#10;                      p_probation_area_id &#61;&gt; p_probation_area_id,&#10;                      p_date_from         &#61;&gt; p_date_from,&#10;                      p_date_to           &#61;&gt; p_date_to,&#10;                      p_copy_to_visor     &#61;&gt; p_copy_to_visor,&#10;                      p_exported_to_visor &#61;&gt; p_exported_to_visor,&#10;                      p_team_id           &#61;&gt; p_team_id,&#10;                      p_staff_id          &#61;&gt; p_staff_id,&#10;                      p_offender_id       &#61;&gt; p_offender_id,&#10;                      p_borough_id        &#61;&gt; p_borough_id,&#10;                      p_district_id       &#61;&gt; p_district_id,&#10;                      --&#10;                      p_max_rows          &#61;&gt; PKG_Lookups.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;REPORT_SEARCH_MAX_RESULTS&#39;, p_default_value &#61;&gt; 10000),&#10;                      p_order_by          &#61;&gt; &#39;contact_date, contact_start_time&#39; )&#10;                )&#10;      ;&#10;END procFindVisorContact;&#10;&#10;--&#10;-- Pipelined PROCEDURES are being used here in an attempt to improve the Search procedure&#39;s performance&#10;--&#10;FUNCTION procfindUPWDiaryTAB(&#10;    p_team_id           NUMBER,&#10;    p_provider_team_id  NUMBER,&#10;    p_appointment_start_date  DATE,&#10;    p_appointment_end_date  DATE,&#10;    p_max_rows          INTEGER DEFAULT 10000 )&#10;RETURN ttabUpwDiary PIPELINED&#10;IS&#10;    TYPE v_cur_TYP IS REF CURSOR;&#10;    v_cur          v_cur_TYP;&#10;    v_SQL          VARCHAR2(4000);&#10;    --&#10;    v_tab            ttabUpwDiary;&#10;    v_i              INTEGER;&#10;    v_i_1            INTEGER;&#10;    v_rows           INTEGER :&#61; 0;&#10;    --&#10;    v_buffer_gets_1  INTEGER;&#10;    v_buffer_gets_2  INTEGER;&#10;    --&#10;BEGIN&#10;    --&#10;    IF (p_team_id IS NULL AND p_provider_team_id IS NULL) OR p_appointment_start_date IS NULL OR p_appointment_end_date IS NULL THEN&#10;        raise_application_error(-20001, &#39;Error in procfindUPWDiaryTAB: insufficient number of parameters specified: &#39; ||&#10;            &#39;[p_team_id&#61;&#39;          || p_team_id           || &#39;]&#39; ||&#10;            &#39;[p_provider_team_id&#61;&#39; || p_provider_team_id  || &#39;]&#39; ||&#10;            &#39;[p_appointment_start_date&#61;&#39; || p_appointment_start_date  || &#39;]&#39; ||&#10;            &#39;[p_appointment_end_date&#61;&#39; || p_appointment_end_date  || &#39;]&#39;);&#10;    END IF;&#10;    --&#10;    PKG_Debug.procrecordDbStats(v_buffer_gets_1);&#10;    --&#10;    /*&#10;      SELECT&#10;        NEW uk.co.bconline.ndelius.dto.unpaidwork.UPWProjectDiarySearchResult(&#10;            uwp.unpaidWorkProjectId, uwp.name, uwp.code, uwa.startTime,uwa.endTime, COUNT(DISTINCT uwa.unpaidWorkDetails))&#10;      FROM&#10;        UnpaidWorkAppointment uwa&#10;          JOIN uwa.unpaidWorkProject uwp&#10;            LEFT JOIN&#10;              uwp.upwProjectAvailabilityList availabilityList&#10;      WHERE uwp.teamId &#61; :teamID&#10;        AND uwa.appointmentDate &#61; :appointmentDate&#10;        AND UPPER(availabilityList.upwDay.weekDay) &#61; :dayOfWeek&#10;        AND uwa.softDeleted &#61; false&#10;        AND uwa.unpaidWorkDetails.disposal.softDeleted &#61; false&#10;      GROUP BY uwp.unpaidWorkProjectId, uwp.name, uwp.code, uwa.startTime, uwa.endTime ORDER BY uwp.name&#10;    */&#10;&#10;    v_SQL :&#61;&#10;&#39;WITH UWP AS (&#10;  SELECT&#10;    UWP1.upw_project_id,&#10;    UWP1.name upw_project_name,&#10;    UWP1.code upw_project_code&#10;  FROM&#10;    upw_project              UWP1,&#10;    upw_project_availability UWPAV&#10;  WHERE 1&#61;1&#10;    AND &#39; || CASE WHEN p_team_id &gt; 0 THEN &#39;UWP1.team_id &#61; :p_team_id&#39; ELSE &#39;UWP1.provider_team_id &#61; :p_provider_team_id&#39; END || &#39;&#10;    AND UWPAV.upw_project_id &#61; UWP1.upw_project_id&#10;),&#10;UWA AS (&#10;  SELECT&#10;    UWA1.upw_appointment_id,&#10;    UWA1.upw_details_id,&#10;    UWA1.upw_project_id,&#10;    UWA1.start_time,&#10;    UWA1.end_time,&#10;    UWA1.appointment_date,&#10;    UWA1.contact_id,&#10;    UWA1.contact_outcome_type_id&#10;  FROM&#10;    upw_appointment UWA1&#10;  WHERE 1&#61;1&#10;    AND UWA1.appointment_date BETWEEN TRUNC(:p_appointment_start_date) AND TRUNC(:p_appointment_end_date) + (1 - 1/24/60/60)&#10;    AND UWA1.soft_deleted &#61; 0&#10;)&#10;  --&#10;SELECT&#10;  UWP.upw_project_id,&#10;  UWP.upw_project_name,&#10;  UWP.upw_project_code,&#10;  UWA.start_time,&#10;  UWA.end_time,&#10;  COUNT(DISTINCT UWA.upw_details_id),&#10;  UWA.appointment_date,&#10;  COUNT(DISTINCT CASE WHEN UWA.contact_outcome_type_id IS NOT NULL THEN UWA.upw_appointment_id END) AS outcome_count,&#10;  COUNT(DISTINCT CASE WHEN ENF.outstanding_contact_action &#61; &#39;&#39;Y&#39;&#39; THEN UWA.upw_appointment_id END) AS enforcement_action_count&#10;FROM&#10;  UWP,&#10;  UWA,&#10;  upw_details UWD,&#10;  disposal D,&#10;  contact C,&#10;  r_enforcement_action ENF&#10;WHERE 1&#61;1&#10;  AND UWA.upw_project_id &#61; UWP.upw_project_id&#10;  AND UWD.upw_details_id &#61; UWA.upw_details_id&#10;  AND D.disposal_id &#61; UWD.disposal_id&#10;  AND D.soft_deleted &#61; 0&#10;  AND (C.contact_id(+) &#61; UWA.contact_id)&#10;  AND (ENF.enforcement_action_id(+) &#61; C.latest_enforcement_action_id)&#10;  GROUP BY&#10;  UWP.upw_project_id,&#10;  UWP.upw_project_name,&#10;  UWP.upw_project_code,&#10;  UWA.start_time,&#10;  UWA.end_time,&#10;  UWA.appointment_date&#10;  ORDER BY uwa.appointment_date ASC, uwp.upw_project_name&#39;;&#10;    --&#10;    OPEN v_cur FOR v_SQL&#10;    USING&#10;      NVL(p_team_id, p_provider_team_id),&#10;      p_appointment_start_date,&#10;      p_appointment_end_date&#10;    ;&#10;    FETCH v_cur BULK COLLECT INTO v_tab LIMIT NVL(p_max_rows, 10000);&#10;    CLOSE v_cur;&#10;    --&#10;    --procDebug(&#39;procfindUPWDiaryTAB (v_tab_UPW.COUNT&#61;&#39; || v_tab_UPW.COUNT  || &#39;)&#39;);&#10;    --&#10;    FOR v_i IN 1..v_tab.COUNT LOOP&#10;        v_rows :&#61; v_rows + 1;&#10;        PIPE ROW (v_tab(v_i));&#10;    END LOOP;&#10;    --&#10;    PKG_Debug.procrecordDbStats(v_buffer_gets_2);&#10;    --&#10;    procDebug(&#39;procfindUPWDiaryTAB (rows&#61;&#39; || v_rows  || &#39;)(&#39; || PKG_Debug.funcgetDbStats(v_buffer_gets_2 - v_buffer_gets_1) || &#39;): &#39; ||&#10;        &#39;(p_team_id&#61;&gt;&#39;          || p_team_id           || &#39;)&#39; ||&#10;        &#39;(p_provider_team_id&#61;&gt;&#39; || p_provider_team_id  || &#39;)&#39; ||&#10;        &#39;(p_appointment_start_date&#61;&#39;  || p_appointment_start_date  || &#39;)&#39; ||&#10;        &#39;(p_appointment_end_date&#61;&#39;  || p_appointment_end_date  || &#39;)&#39; ||&#10;        &#39;(CLIENT_IDENTIFIER&#61;&#39; || SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;) || CHR(10) ||&#10;        v_SQL );&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;        &#39;procfindUPWDiaryTAB: &#39; ||&#10;        &#39;(p_team_id&#61;&gt;&#39;          || p_team_id           || &#39;)&#39; ||&#10;        &#39;(p_provider_team_id&#61;&gt;&#39; || p_provider_team_id  || &#39;)&#39; ||&#10;        &#39;(p_appointment_start_date&#61;&#39;  || p_appointment_start_date  || &#39;)&#39; ||&#10;        &#39;(p_appointment_end_date&#61;&#39;  || p_appointment_end_date  || &#39;)&#39; ||&#10;        &#39;(CLIENT_IDENTIFIER&#61;&#39; || SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;) || CHR(10) ||&#10;        v_SQL );&#10;    RAISE;&#10;END procfindUPWDiaryTAB;&#10;&#10;PROCEDURE procfindUPWDiary(&#10;    p_team_id           NUMBER,&#10;    p_provider_team_id  NUMBER,&#10;    p_appointment_start_date  DATE,&#10;    p_appointment_end_date  DATE,&#10;    p_outcursor         OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ upw_project_id,&#10;        /*01*/ upw_project_name,&#10;        /*02*/ upw_project_code,&#10;        /*03*/ start_time,&#10;        /*04*/ end_time,&#10;        /*05*/ upw_details_cnt,&#10;        /*06*/ appointment_date,&#10;        /*07*/ outcome_count,&#10;        /*08*/ enforcement_action_count&#10;&#10;FROM TABLE( PKG_SEARCH.procfindUPWDiaryTAB(&#10;                      p_team_id                 &#61;&gt; p_team_id,&#10;                      p_provider_team_id        &#61;&gt; p_provider_team_id,&#10;                      p_appointment_start_date  &#61;&gt; p_appointment_start_date,&#10;                      p_appointment_end_date    &#61;&gt; p_appointment_end_date,&#10;                      p_max_rows                &#61;&gt; 10000 )&#10;                );&#10;END procfindUPWDiary;&#10;--&#10;FUNCTION procfindUPWDetailsTAB(&#10;    p_team_id           NUMBER,&#10;    p_provider_team_id  NUMBER,&#10;    p_upw_status        NUMBER)&#10;RETURN ttabUpwDetails PIPELINED&#10;IS&#10;    TYPE v_cur_TYP IS REF CURSOR;&#10;    v_cur          v_cur_TYP;&#10;    v_SQL          VARCHAR2(4000);&#10;    --&#10;    v_tab            ttabUpwDetails;&#10;    v_i              INTEGER;&#10;    v_i_1            INTEGER;&#10;    v_rows           INTEGER :&#61; 0;&#10;    --&#10;    v_buffer_gets_1  NUMBER;&#10;    v_buffer_gets_2  NUMBER;&#10;    --&#10;BEGIN&#10;    --&#10;    IF (p_team_id IS NULL AND p_provider_team_id IS NULL) OR p_upw_status IS NULL THEN&#10;        raise_application_error(-20001, &#39;Error in procfindUPWDetailsTAB: insufficient number of parameters specified: &#39; ||&#10;            &#39;[p_team_id&#61;&#39;          || p_team_id           || &#39;]&#39; ||&#10;            &#39;[p_provider_team_id&#61;&#39; || p_provider_team_id  || &#39;]&#39; ||&#10;            &#39;[p_upw_status&#61;&#39;       || p_upw_status        || &#39;]&#39;);&#10;    END IF;&#10;    --&#10;    PKG_Debug.procrecordDbStats(v_buffer_gets_1);&#10;    --&#10;    v_SQL :&#61;&#10;&#39;SELECT /*+ ORDERED USE_NL(disposal) */&#10;    /*00*/ UPW_DETAILS.upw_details_id,&#10;    /*01*/ UPW_DETAILS.disposal_id,&#10;    /*02*/ NULL rqmnt_id,&#10;    /*03*/ DISPOSAL.event_id,&#10;    /*04*/ UPW_DETAILS.offender_id,&#10;    /*05*/ UPW_DETAILS.upw_status_id,&#10;    /*06*/ UPW_DETAILS.staff_id,&#10;    /*07*/ UPW_DETAILS.provider_employee_id,&#10;    /*08*/ PKG_Lookups.funcgetDisposalTypePreCJA2003(DISPOSAL.disposal_type_id) pre_cja_flag,&#10;    /*09*/ PKG_Lookups.funcgetDisposalTypeCJA2003(DISPOSAL.disposal_type_id)    post_cja_flag,&#10;    /*10*/ DISPOSAL.disposal_date,&#10;    /*11*/ UPW_DETAILS.upw_length_minutes&#10;  FROM&#10;    upw_details,&#10;    disposal&#10;  WHERE UPW_DETAILS.soft_deleted &#61; 0&#10;    AND DISPOSAL.disposal_id &#61; UPW_DETAILS.disposal_id&#10;    AND UPW_DETAILS.upw_status_id &#61;  :p_upw_status&#39;;&#10;    --&#10;    IF p_team_id IS NOT NULL THEN&#10;        v_SQL :&#61; v_SQL || CHR(10) || &#39;    AND UPW_DETAILS.team_id &#61; :p_team_id&#39;;&#10;    ELSE&#10;        v_SQL :&#61; v_SQL || CHR(10) || &#39;    AND UPW_DETAILS.provider_team_id &#61; :p_provider_team_id&#39;;&#10;    END IF;&#10;    --&#10;    OPEN v_cur FOR v_SQL  USING p_upw_status, NVL(p_team_id, p_provider_team_id);&#10;    FETCH v_cur BULK COLLECT INTO v_tab;&#10;    CLOSE v_cur;&#10;    --&#10;    --procDebug(&#39;procfindUPWDetailsTAB (v_tab_UPW.COUNT&#61;&#39; || v_tab_UPW.COUNT  || &#39;)&#39;);&#10;    --&#10;    FOR v_i IN 1..v_tab.COUNT LOOP&#10;        v_rows :&#61; v_rows + 1;&#10;        PIPE ROW (v_tab(v_i));&#10;    END LOOP;&#10;    --&#10;    PKG_Debug.procrecordDbStats(v_buffer_gets_2);&#10;    --&#10;    procDebug(&#39;procfindUPWDetailsTAB (rows&#61;&#39; || v_rows  || &#39;)(&#39; || PKG_Debug.funcgetDbStats(v_buffer_gets_2 - v_buffer_gets_1) || &#39;): &#39; ||&#10;        &#39;p_team_id&#61;&gt;&#39;          || p_team_id           || &#39;, &#39; ||&#10;        &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id  || &#39;, &#39; ||&#10;        &#39;p_upw_status&#61;&gt;&#39;       || p_upw_status        || CHR(10) ||&#10;        v_SQL);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;        &#39;procfindUPWDetailsTAB: &#39; ||&#10;        &#39;p_team_id&#61;&gt;&#39;          || p_team_id           || &#39;, &#39; ||&#10;        &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id  || &#39;, &#39; ||&#10;        &#39;p_upw_status&#61;&gt;&#39;       || p_upw_status        || CHR(10) ||&#10;    v_SQL);&#10;    RAISE;&#10;END procfindUPWDetailsTAB;&#10;&#10;FUNCTION procfindUPWOffendersTAB(&#10;    p_team_id           NUMBER,&#10;    p_provider_team_id  NUMBER,&#10;    p_upw_status        NUMBER,&#10;    p_max_rows          INTEGER DEFAULT 100000)&#10;RETURN ttabUpwOffenders PIPELINED&#10;IS&#10;    TYPE v_cur_TYP IS REF CURSOR;&#10;    v_cur          v_cur_TYP;&#10;    v_SQL          VARCHAR2(4000);&#10;    --&#10;    c_upws CONSTANT VARCHAR2(10) :&#61; &#39;UPW STATUS&#39;;&#10;    --&#10;    v_tab ttabUpwOffenders;&#10;    v_rec trecUpwOffenders;&#10;    --&#10;    v_row INTEGER :&#61; 0;&#10;    --&#10;BEGIN&#10;    --&#10;    IF (p_team_id IS NULL AND p_provider_team_id IS NULL) OR p_upw_status IS NULL THEN&#10;        raise_application_error(-20001, &#39;Error in procfindUPWOffendersTAB: insufficient number of parameters specified: &#39; ||&#10;            &#39;[p_team_id&#61;&#39;          || p_team_id           || &#39;]&#39; ||&#10;            &#39;[p_provider_team_id&#61;&#39; || p_provider_team_id  || &#39;]&#39; ||&#10;            &#39;[p_upw_status&#61;&#39;       || p_upw_status        || &#39;]&#39; );&#10;    END IF;&#10;    --&#10;    --&#10;    v_SQL :&#61;&#10;    --&#10;&#39;WITH UWD AS (&#10;  SELECT DISTINCT *&#10;  FROM TABLE( PKG_Search.procfindUPWDetailsTAB(&#10;                p_team_id          &#61;&gt; :p_team_id,&#10;                p_provider_team_id &#61;&gt; :p_provider_team_id,&#10;                p_upw_status       &#61;&gt; :p_upw_status) )&#10;  )&#10;SELECT&#10;  -- SQL optimiser hints&#10;  /*+ ORDERED USE_NL(O) USE_NL(S) */&#10;  --&#10;  /*01*/ UWD.upw_details_id,&#10;  /*02*/ UWD.event_id,&#10;  /*03*/ O.offender_id,&#10;  /*04*/ O.crn,&#10;  /*05*/ O.surname OFFENDER_SURNAME,&#10;  /*06*/ O.first_name OFFENDER_FIRST_NAME,&#10;  /*07*/ O.second_name OFFENDER_SECOND_NAME,&#10;  /*08*/ O.date_of_birth_date,&#10;  /*09*/ UWD.upw_length_minutes,&#10;  /*10*/ /*SUM(AL.minutes_credited)*/0 AL_MINUTES_CREDITED,&#10;  /*11*/ UWD.disposal_date,&#10;  /*12*/ /*UPWS.code_description*/ PKG_Lookups.funcgetStdRefListCodeDesc(&#39;&#39;&#39; || c_upws || &#39;&#39;&#39;, UWD.upw_status_id) UPW_STATUS_DESCRIPTION,&#10;  /*13*/ S.surname STAFF_SURNAME,&#10;  /*14*/ S.forename STAFF_FORENAME,&#10;  /*15*/ S.forename2 STAFF_FORENAME2,&#10;  /*16*/ O.restriction_message,&#10;  /*17*/ O.exclusion_message,&#10;  /*18*/ O.current_restriction,&#10;  /*19*/ O.current_exclusion,&#10;  --&#10;  /*20*/ NULL L1,&#10;  /*21*/ NULL L2,&#10;  /*22*/ NULL L3&#10;FROM&#10;  UWD,&#10;  offender O,&#10;  officer S&#10;WHERE 1&#61;1&#10;  -- Join criteria&#10;  AND O.offender_id &#61; UWD.offender_id&#10;  AND S.trust_provider_flag &#61; (CASE WHEN UWD.staff_id IS NOT NULL THEN 0 ELSE 1 END)&#10;  AND S.staff_employee_id &#61; (CASE WHEN UWD.staff_id IS NOT NULL THEN UWD.STAFF_ID ELSE UWD.provider_employee_id END)&#39;;&#10;    --&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    OPEN v_cur FOR v_SQL&#10;    USING&#10;      -- PKG_Search.procfindUPWDetailsTAB Pilelined proc parameters&#10;      p_team_id, p_provider_team_id,&#10;      p_upw_status;&#10;    --&#10;    FETCH v_cur BULK COLLECT INTO v_tab LIMIT p_max_rows;&#10;    CLOSE v_cur;&#10;    --&#10;    FOR v_row IN 1..v_tab.COUNT LOOP&#10;        v_rec :&#61; v_tab(v_row);&#10;        v_rec.AL_MINUTES_CREDITED :&#61; PKG_Lookups.funcgetTabRecord(p_table &#61;&gt; &#39;UPW_APPOINTMENT&#39;,&#10;                                         p_ref_col     &#61;&gt; &#39;UPW_DETAILS_ID&#39;,&#10;                                         p_ref_val     &#61;&gt; TO_CHAR(v_rec.UPW_DETAILS_ID),&#10;                                         p_data_fld    &#61;&gt; &#39;SUM(minutes_credited)&#39;,&#10;                                         p_default_val &#61;&gt; &#39;0&#39;,&#10;                                         p_where       &#61;&gt; &#39;SOFT_DELETED &#61; 0 AND attended &#61; &#39;&#39;Y&#39;&#39;&#39;);&#10;        --&#10;        PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;v_rec.offender_id, p_L1&#61;&gt;v_rec.L1, p_L2&#61;&gt;v_rec.L2, p_L3&#61;&gt;v_rec.L3);&#10;        --&#10;        PIPE ROW (v_rec);&#10;    END LOOP;&#10;    --&#10;    procDebug(&#39;procFindUPWOffendersTAB (rows&#61;&#39; || LEAST(v_tab.COUNT, p_max_rows)  || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;        &#39;p_team_id&#61;&gt;&#39;          || p_team_id           || &#39;, &#39; ||&#10;        &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id  || &#39;, &#39; ||&#10;        &#39;p_upw_status&#61;&gt;&#39;       || p_upw_status        || CHR(10) ||&#10;        v_SQL);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;        &#39;procFindUPWOffendersTAB: &#39; ||&#10;        &#39;p_team_id&#61;&gt;&#39;          || p_team_id           || &#39;, &#39; ||&#10;        &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id  || &#39;, &#39; ||&#10;        &#39;p_upw_status&#61;&gt;&#39;       || p_upw_status         || CHR(10) ||&#10;        v_SQL);&#10;    RAISE;&#10;END procfindUPWOffendersTAB;&#10;&#10;PROCEDURE procfindUPWOffenders(&#10;    p_team_id           NUMBER,&#10;    p_provider_team_id  NUMBER,&#10;    p_upw_status        NUMBER,&#10;    p_outcursor         OUT SYS_REFCURSOR)&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT *&#10;      FROM TABLE( PKG_SEARCH.procfindUPWOffendersTAB(&#10;                      p_team_id           &#61;&gt; p_team_id,&#10;                      p_provider_team_id  &#61;&gt; p_provider_team_id,&#10;                      p_upw_status        &#61;&gt; p_upw_status,&#10;                      p_max_rows          &#61;&gt; 10000) );&#10;END procfindUPWOffenders;&#10;&#10;----------------------------------CASE LOAD -----------------------------------&#10;FUNCTION procFindCaseLoadTAB(&#10;    p_team_id              NUMBER  DEFAULT NULL,&#10;    p_provider_team_id     NUMBER  DEFAULT NULL,&#10;    p_staff_id             NUMBER  DEFAULT NULL,&#10;    p_provider_employee_id NUMBER  DEFAULT NULL,&#10;    p_offender_id          NUMBER  DEFAULT NULL,&#10;    p_components           VARCHAR2 DEFAULT &#39;Y&#39;,&#10;    p_filter               VARCHAR2 DEFAULT NULL,&#10;    p_date                 DATE DEFAULT NULL,&#10;    p_borough_id           NUMBER DEFAULT NULL,&#10;    p_district_id          NUMBER DEFAULT NULL,&#10;    p_use_caseload_table   VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_max_rows             INTEGER  DEFAULT 100000)&#10;RETURN PKG_CASELOAD.ttabCaseLoad PIPELINED&#10;IS&#10;    l_tab PKG_CASELOAD.ttabCaseLoad;&#10;BEGIN&#10;      SELECT * BULK COLLECT INTO l_tab&#10;      FROM TABLE( PKG_CASELOAD.procFindCaseLoadTAB(&#10;                      p_offender_id          &#61;&gt; p_offender_id,&#10;                      p_team_id              &#61;&gt; p_team_id,&#10;                      p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                      p_staff_id             &#61;&gt; p_staff_id,&#10;                      p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                      p_components           &#61;&gt; p_components,&#10;                      p_filter               &#61;&gt; p_filter,&#10;                      p_date                 &#61;&gt; p_date,&#10;                      p_borough_id           &#61;&gt; p_borough_id,&#10;                      p_district_id          &#61;&gt; p_district_id,&#10;                      p_use_caseload_table   &#61;&gt; p_use_caseload_table,&#10;                      p_max_rows             &#61;&gt; p_max_rows ) );&#10;      FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;          PIPE ROW (l_tab(l_idx));&#10;      END LOOP;&#10;END procFindCaseLoadTAB;&#10;--&#10;PROCEDURE procFindCaseLoad(&#10;    p_team_id               NUMBER,&#10;    p_provider_team_id      NUMBER,&#10;    p_staff_id              NUMBER,&#10;    p_provider_employee_id  NUMBER,&#10;    p_components            VARCHAR2,&#10;    p_filter               VARCHAR2,&#10;    p_date                 DATE DEFAULT NULL,&#10;    p_borough_id            NUMBER DEFAULT NULL,&#10;    p_district_id           NUMBER DEFAULT NULL,&#10;    p_outcursor             OUT SYS_REFCURSOR )&#10;AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ record_type,&#10;        /*01*/ offender_id,&#10;        --&#10;        /*02*/ crn,&#10;        /*03*/ gender,&#10;        /*04*/ first_name,&#10;        /*05*/ second_name,&#10;        /*06*/ third_name,&#10;        /*07*/ surname,&#10;        --&#10;        /*08*/ current_highest_risk_colour,&#10;        /*09*/ current_restriction,&#10;        /*10*/ current_exclusion,&#10;        --&#10;        /*11*/ restriction_message,&#10;        /*12*/ exclusion_message,&#10;        --&#10;        /*13*/ tier_description,&#10;        /*14*/ team,&#10;        -- ID values&#10;        /*15*/ offender_manager_id,&#10;        /*16*/ event_id,&#10;        /*17*/ order_manager_id,&#10;        /*18*/ disposal_id,&#10;        /*19*/ lic_condition_id,&#10;        /*20*/ lic_condition_manager_id,&#10;        /*21*/ rqmnt_id,&#10;        /*22*/ rqmnt_manager_id,&#10;        /*23*/ pss_rqmnt_id,&#10;        /*24*/ pss_rqmnt_manager_id,        --&#10;        /*25*/ sentence_description,&#10;        /*26*/ length_value,&#10;        /*27*/ component_description,&#10;        /*28*/ role_code,&#10;        /*29*/ length_units,&#10;        /*30*/ date_of_birth,&#10;        /*31*/ start_date,&#10;        -- NEW fields&#10;        /*32*/ trust_provider_flag,&#10;        /*33*/ trust_provider_team_id,&#10;        /*34*/ staff_employee_id,&#10;        -- LUP ID values&#10;        /*35*/ gender_id,&#10;        /*36*/ current_tier,&#10;        /*37*/ disposal_type_id,&#10;        /*38*/ lic_cond_type_main_cat_id,&#10;        /*39*/ rqmnt_type_main_category_id,&#10;        /*40*/ ad_rqmnt_type_main_category_id,&#10;        /*41*/ pss_rqmnt_type_main_cat_id,&#10;        /*42*/ allocation_date,&#10;        -- PTR1 start&#10;        /*43*/ notional_end_date,&#10;        /*44*/ entry_length,&#10;        /*45*/ length_in_days,&#10;        /*46*/ entry_length_units_id,&#10;        /*47*/ entry_length_units_code,&#10;        /*48*/ entry_length_units_desc,&#10;        -- PTR1 end&#10;        --&#10;        /*49*/ nsi_id,&#10;        /*50*/ nsi_manager_id,&#10;        /*51*/ prison_offender_manager_id,&#10;        --&#10;        /*52*/ court_report_id,&#10;        /*53*/ institutional_report_id,&#10;        /*54*/ report_manager_id,&#10;        --&#10;        /*55*/ cdc_custody_start_date,&#10;        /*56*/ ro_year,&#10;        /*57*/ ro_count,&#10;        --&#10;        /*58*/ L1,&#10;        /*59*/ L2,&#10;        /*60*/ L3&#10;        --&#10;      FROM TABLE( PKG_CASELOAD.procFindCaseLoadTAB(&#10;                      p_team_id              &#61;&gt; p_team_id,&#10;                      p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                      p_staff_id             &#61;&gt; p_staff_id,&#10;                      p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                      p_components           &#61;&gt; p_components,&#10;                      p_filter               &#61;&gt; p_filter,&#10;                      p_date                 &#61;&gt; p_date,&#10;                      p_borough_id           &#61;&gt; p_borough_id,&#10;                      p_district_id          &#61;&gt; p_district_id,&#10;                      p_use_caseload_table   &#61;&gt; &#39;Y&#39;,&#10;                      p_max_rows             &#61;&gt; 10000 )&#10;                );&#10;END procFindCaseLoad;&#10;--&#10;---&#10;----------------------------------end of CASE LOAD -----------------------------&#10;&#10;FUNCTION procFindStaffTeamTAB(&#10;    p_team_id  NUMBER,&#10;    p_max_rows INTEGER  DEFAULT 10000)&#10;RETURN ttabStaff PIPELINED&#10;IS&#10;    v_row INTEGER :&#61; 0;&#10;    --&#10;    v_code_desc VARCHAR2(1024);&#10;    --&#10;    v_rec     trecStaff;&#10;    v_tab     ttabStaff;&#10;    v_tab_idx INTEGER;&#10;    --&#10;    CURSOR cs IS&#10;      WITH ST AS (&#10;        SELECT TO_NUMBER(column_value) AS staff_id&#10;        FROM TABLE( PKG_LstUtl.get_list_2_array( PKG_Lookups.funcgetStaffTeamLst(p_team_id) ) )&#10;        )&#10;      SELECT /*+ORDERED FULL(ST) USE_NL(S) */&#10;        /*00*/ S.staff_id,&#10;        /*01*/ S.staff_grade_id,&#10;        /*02*/ NULL staff_grade_code,&#10;        /*03*/ NULL staff_grade_desc,&#10;        /*04*/ S.officer_code,&#10;        /*05*/ S.forename,&#10;        /*06*/ S.forename2,&#10;        /*07*/ S.surname&#10;--        S.*&#10;      FROM ST, staff S&#10;      WHERE S.staff_id &#61; ST.staff_id&#10;        AND S.start_date &lt;&#61; SYSDATE&#10;        AND NVL(s.end_date, SYSDATE) &gt;&#61; SYSDATE&#10;      --ORDER BY S.surname, S.forename&#10;      ;&#10;      --&#10;BEGIN&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    OPEN cs;&#10;    FETCH cs BULK COLLECT INTO v_tab LIMIT p_max_rows;&#10;    CLOSE cs;&#10;    --&#10;    -- Fetch through the result set of records&#10;    FOR v_tab_idx IN 1..v_tab.COUNT LOOP&#10;        --&#10;        v_rec :&#61; v_tab(v_tab_idx);&#10;        IF v_rec.staff_grade_id IS NOT NULL THEN&#10;            v_code_desc :&#61; PKG_Lookups.funcgetStdRefListCodeAndDesc(p_ID&#61;&gt;v_rec.staff_grade_id, p_delim&#61;&gt;&#39;|&#39;);&#10;            v_rec.staff_grade_code :&#61; PKG_LstUtl.list_next_elem(v_code_desc, &#39;|&#39;);&#10;            v_rec.staff_grade_desc :&#61; v_code_desc;&#10;        END IF;&#10;        --&#10;        PIPE ROW (v_rec);&#10;        v_row :&#61; v_row + 1;&#10;    END LOOP;&#10;    --&#10;    procDebug(&#39;procFindStaffTeamTAB (rows&#61;&#39; || v_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): p_team_id&#61;&gt;&#39; || p_team_id);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) || &#39;procFindStaffTeamTAB (rows&#61;&#39; || v_row || &#39;): p_team_id&#61;&gt;&#39; || p_team_id);&#10;    RAISE;&#10;END procFindStaffTeamTAB;&#10;--&#10;--&#10;PROCEDURE procFindStaffTeam(&#10;    p_team_id   NUMBER,&#10;    p_outcursor OUT SYS_REFCURSOR)&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ staff_id,&#10;        /*01*/ staff_grade_id,&#10;        /*02*/ staff_grade_code,&#10;        /*03*/ staff_grade_desc,&#10;        /*04*/ officer_code,&#10;        /*05*/ forename,&#10;        /*06*/ forename2,&#10;        /*07*/ surname&#10;      FROM TABLE( PKG_SEARCH.procFindStaffteamTAB(p_team_id&#61;&gt;p_team_id, p_max_rows&#61;&gt;10000) );&#10;END procFindStaffTeam;&#10;--&#10;--&#10;--&#10;FUNCTION procGetPendingTransfersTAB(&#10;    p_probation_area_to   NUMBER,&#10;    p_probation_area_from NUMBER,&#10;    p_filter              VARCHAR2,&#10;    --&#10;    p_max_rows            INTEGER  DEFAULT 10000,&#10;    p_borough_to          NUMBER DEFAULT NULL,&#10;    p_borough_from        NUMBER DEFAULT NULL,&#10;    p_district_to         NUMBER DEFAULT NULL,&#10;    p_district_from       NUMBER DEFAULT NULL,&#10;    p_ldu_to              NUMBER DEFAULT NULL,&#10;    p_ldu_from            NUMBER DEFAULT NULL,&#10;    p_staff_to            NUMBER DEFAULT NULL,&#10;    p_staff_from          NUMBER DEFAULT NULL,&#10;    p_team_to             NUMBER DEFAULT NULL,&#10;    p_team_from           NUMBER DEFAULT NULL,&#10;    p_nsi_type            NUMBER DEFAULT NULL)&#10;RETURN ttabPendingTransfers PIPELINED&#10;IS&#10;    --&#10;    lc_proc CONSTANT VARCHAR2(30) :&#61; &#39;procGetPendingTransfersTAB&#39;;&#10;    --&#10;    TYPE v_cur_TYP IS REF CURSOR;&#10;    v_cur v_cur_TYP;&#10;    v_SQL CLOB;&#10;    --&#10;    v_rec trecPendingTransfers;&#10;    v_row INTEGER :&#61; 0;&#10;    --&#10;    v_tab     ttabPendingTransfers;&#10;    v_tab_idx INTEGER;&#10;    --&#10;    l_offender_id        NUMBER;&#10;    --&#10;BEGIN&#10;    IF (p_probation_area_to IS NULL AND p_probation_area_from IS NULL AND NVLSTR(p_filter, &#39;ALL&#39;) IS NULL )&#10;    THEN&#10;        --raise_application_error(-20001,&#10;        procDebug(&#39;ERRORin &#39; || lc_proc || &#39;: unexpected combination of the parameter values: (&#39; ||&#10;            &#39;probation_area_from&#61;&#39; || p_probation_area_from || &#39;,&#39; ||&#10;            &#39;probation_area_to&#61;&#39;   || p_probation_area_to   || &#39;,&#39; ||&#10;            &#39;filter&#61;&#39;              || p_filter              || &#39;)&#39; );&#10;        RETURN/* ttabPendingTransfers()*/;&#10;    END IF;&#10;    --&#10;    -- REPORT LEVELS                REPORT GROUP&#10;    -- OM &#61; Offender&#10;    -- OS &#61; Order&#10;    -- RM &#61; Rqmnt                   CT &#61; Component Transfers&#10;    -- LM &#61; Licence Condition       CT &#61; Component Transfers&#10;    -- NI &#61; NSI&#10;    -- PM &#61; PSS                     CT &#61; Component Transfers&#10;    -- IR &#61; Institutional Report&#10;    -- CR &#61; Court Report&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    --&#10;    -- Dynamic SQL&#10;    --&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;OM&#39;, &#39;ALL&#39;) THEN&#10;        v_SQL :&#61; v_SQL ||&#10;&#39;SELECT&#10;  &#39;&#39;OM&#39;&#39;                          /*00*/    rpt_level,&#10;  OT.offender_transfer_id         /*01*/    transfer_id,&#10;  O.offender_id                   /*02*/    offender_id,&#10;  OT.REQUEST_DATE                 /*03*/    request_date,&#10;  RT.probation_area_id            /*04*/    tgt_probation_area_id,&#10;  RTPA.description                /*05*/    tgt_probation_area_desc,&#10;  FT.probation_area_id            /*06*/    src_probation_area_id,&#10;  FTPA.description                /*07*/    src_probation_area_desc,&#10;  RPT.probation_area_id           /*08*/    tgt_probation_area_id_1,&#10;  RPTPA.description               /*09*/    tgt_probation_area_desc_1,&#10;  FPT.probation_area_id           /*10*/    src_probation_area_id_1,&#10;  FPTPA.description               /*11*/    src_probation_area_desc_1,&#10;  S.forename                      /*12*/    staff_forename,&#10;  S.surname                       /*13*/    staff_surname,&#10;  S.officer_code                  /*14*/    officer_code,&#10;  PE.forename                     /*15*/    provider_employee_forename,&#10;  PE.surname                      /*16*/    provider_employee_surname,&#10;  PE.code                         /*17*/    provider_employee_code,&#10;  O.crn                           /*18*/    crn,&#10;  O.first_name                    /*19*/    first_name,&#10;  O.second_name                   /*20*/    second_name,&#10;  O.third_name                    /*21*/    third_name,&#10;  O.surname                       /*22*/    surname,&#10;  O.date_of_birth_date            /*23*/    date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR   /*24*/    CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION           /*25*/    CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION             /*26*/    CURRENT_EXCLUSION,&#10;  NULL                            /*27*/    event_id,&#10;  NULL                            /*28*/    referral_date,&#10;  NULL                            /*29*/    disposal_id,&#10;  NULL                            /*30*/    disposal_termination_date,&#10;  NULL                            /*31*/    disposal_upw,&#10;  NULL                            /*32*/    disposal_sentence_type,&#10;  NULL                            /*33*/    disposal_cja2003,&#10;  NULL                            /*34*/    disposal_PRE_CJA2003,&#10;  NULL                            /*35*/    rqmnt_id,&#10;  NULL                            /*36*/    lic_condition_id,&#10;  NULL                            /*37*/    nsi_id,&#10;  RT.description                  /*38*/    tgt_team_description,&#10;  FT.description                  /*39*/    src_team_description,&#10;  RPT.name                        /*40*/    tgt_provider_team_name,&#10;  FPT.name                        /*41*/    src_provider_team_name,&#10;  NULL                            /*42*/    disposal_type_description,&#10;  NULL                            /*43*/    rqmnt_main_cat_descrition,&#10;  NULL                            /*44*/    rqmnt_ad_cat_descrition,&#10;  NULL                            /*45*/    lc_main_cat_descrition,&#10;  NULL                            /*46*/    nsi_type_descrition,&#10;  NULL                            /*47*/    pss_id,&#10;  NULL                            /*48*/    pss_type_description,&#10;  --&#10;  RD.description                  /*49*/  tgt_district_description,&#10;  FD.description                  /*50*/  src_district_description,&#10;  --&#10;  NULL                            /*51*/  institutional_report_id,&#10;  NULL                            /*52*/    ireport_type_description,&#10;   --&#10;  NULL                            /*53*/    court_report_id,&#10;  NULL                            /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment              /*55*/    establishment_flag,&#10;  RPTPA.establishment             /*56*/    establishment_provider_flag&#10;  --&#10;FROM offender_transfer ot&#10;  JOIN offender o ON O.offender_id &#61; OT.offender_id&#10;  JOIN offender_manager om ON OM.offender_id  &#61; O.offender_id AND OM.active_flag &#61; 1&#10;    LEFT OUTER JOIN staff s ON OM.ALLOCATION_STAFF_ID &#61; S.staff_id&#10;    LEFT OUTER JOIN provider_employee pe ON PE.provider_employee_id  &#61; OM.provider_employee_id&#10;  --&#10;  LEFT OUTER JOIN team rt ON RT.team_id &#61; OT.RECEIVING_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    LEFT OUTER JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  LEFT OUTER JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    LEFT OUTER JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    LEFT OUTER JOIN district fd ON FT.district_id &#61; FD.district_id&#10;  LEFT OUTER JOIN provider_team rpt ON RPT.provider_team_id &#61; OT.RECEIVING_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rptpa ON RPT.PROBATION_AREA_ID &#61; RPTPA.probation_area_id&#10;  LEFT OUTER JOIN provider_team fpt ON FPT.provider_team_id &#61; OT.ORIGIN_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area fptpa ON FPT.PROBATION_AREA_ID &#61; FPTPA.probation_area_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted          &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from IN (ft.probation_area_id, FPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   IN (rt.probation_area_id, RPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.receiving_staff_id &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.receiving_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || &#39; :p_nsi_type IS NULL &#39; || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;OS&#39;, &#39;ALL&#39;) THEN&#10;        v_SQL :&#61; v_SQL || &#39;&#10;&#39; || CASE WHEN NVLSTR(p_filter, &#39;ALL&#39;) &#61; &#39;ALL&#39; THEN &#39;UNION&#39; END || &#39;&#10;--&#10;SELECT&#10;  &#39;&#39;OS&#39;&#39;                          /*00*/  rpt_level,&#10;  OT.order_transfer_id            /*01*/  transfer_id,&#10;  O.offender_id                   /*02*/  offender_id,&#10;  OT.REQUEST_DATE                 /*03*/  request_date,&#10;  RT.probation_area_id            /*04*/  tgt_probation_area_id,&#10;  RTPA.description                /*05*/  tgt_probation_area_desc,&#10;  FT.probation_area_id            /*06*/  src_probation_area_id,&#10;  FTPA.description                /*07*/  src_probation_area_desc,&#10;  RPT.probation_area_id           /*08*/  tgt_probation_area_id_1,&#10;  RPTPA.description               /*09*/  tgt_probation_area_desc_1,&#10;  FPT.probation_area_id           /*10*/  src_probation_area_id_1,&#10;  FPTPA.description               /*11*/  src_probation_area_desc_1,&#10;  S.forename                      /*12*/  staff_forename,&#10;  S.surname                       /*13*/  staff_surname,&#10;  S.officer_code                  /*14*/  officer_code,&#10;  PE.forename                     /*15*/  provider_employee_forename,&#10;  PE.surname                      /*16*/  provider_employee_surname,&#10;  PE.code                         /*17*/  provider_employee_code,&#10;  O.crn                           /*18*/  crn,&#10;  O.first_name                    /*19*/  first_name,&#10;  O.second_name                   /*20*/  second_name,&#10;  O.third_name                    /*21*/  third_name,&#10;  O.surname                       /*22*/  surname,&#10;  O.date_of_birth_date            /*23*/  date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR   /*24*/  CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION           /*25*/  CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION             /*26*/  CURRENT_EXCLUSION,&#10;  E.event_id                      /*27*/  event_id,&#10;  E.referral_date                 /*28*/  referral_date,&#10;  D.disposal_id                   /*29*/  disposal_id,&#10;  D.termination_date              /*30*/  disposal_termination_date,&#10;  D.upw                           /*31*/  disposal_upw,&#10;  DT.sentence_type                /*32*/  disposal_sentence_type,&#10;  DT.cja2003                      /*33*/  disposal_cja2003,&#10;  DT.PRE_CJA2003                  /*34*/  disposal_PRE_CJA2003,&#10;  NULL                            /*35*/  rqmnt_id,&#10;  NULL                            /*36*/  lic_condition_id,&#10;  NULL                            /*37*/  nsi_id,&#10;  RT.description                  /*38*/  tgt_team_description,&#10;  FT.description                  /*39*/  src_team_description,&#10;  RPT.name                        /*40*/  tgt_provider_team_name,&#10;  FPT.name                        /*41*/  src_provider_team_name,&#10;  DT.description                  /*42*/  disposal_type_description,&#10;  NULL                            /*43*/  rqmnt_main_cat_descrition,&#10;  NULL                            /*44*/  rqmnt_ad_cat_descrition,&#10;  NULL                            /*45*/  lc_main_cat_descrition,&#10;  NULL                            /*46*/  nsi_type_descrition,&#10;  NULL                            /*47*/  pss_id,&#10;  NULL                            /*48*/  pss_type_description,&#10;  --&#10;  RD.description                  /*49*/  tgt_district_description,&#10;  FD.description                  /*50*/  src_district_description,&#10;  --&#10;  NULL                            /*51*/  institutional_report_id,&#10;  NULL                            /*52*/  ireport_type_description,&#10;  --&#10;  NULL                            /*53*/  court_report_id,&#10;  NULL                            /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment              /*55*/    establishment_flag,&#10;  RPTPA.establishment             /*56*/    establishment_provider_flag&#10;  --&#10;FROM order_transfer ot&#10;  --JOIN r_standard_reference_list ts ON ts.standard_reference_list_id &#61; OT.transfer_status_id&#10;  JOIN event e ON E.event_id &#61; OT.event_id&#10;    LEFT OUTER JOIN disposal d ON D.event_id &#61; E.event_id /*AND D.termination_date IS NULL AND D.soft_deleted &#61; 0*/&#10;      LEFT OUTER JOIN r_disposal_type dt ON DT.disposal_type_id &#61; D.disposal_type_id&#10;  JOIN offender o ON O.offender_id &#61; E.offender_id&#10;  JOIN order_manager om ON OM.event_id     &#61; OT.event_id AND OM.active_flag &#61; 1&#10;    LEFT OUTER JOIN staff s ON OM.ALLOCATION_STAFF_ID &#61; S.staff_id&#10;    LEFT OUTER JOIN provider_employee pe ON PE.provider_employee_id  &#61; OM.provider_employee_id&#10;  --&#10;  LEFT OUTER JOIN team rt ON RT.team_id &#61; OT.RECEIVING_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    LEFT OUTER JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  LEFT OUTER JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    LEFT OUTER JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    LEFT OUTER JOIN district fd ON FT.district_id &#61; FD.district_id&#10;  LEFT OUTER JOIN provider_team rpt ON RPT.provider_team_id &#61; OT.RECEIVING_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rptpa ON RPT.PROBATION_AREA_ID &#61; RPTPA.probation_area_id&#10;  LEFT OUTER JOIN provider_team fpt ON FPT.provider_team_id &#61; OT.ORIGIN_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area fptpa ON FPT.PROBATION_AREA_ID &#61; FPTPA.probation_area_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted          &#61; 0&#10;  AND E.soft_deleted          &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from IN (ft.probation_area_id, FPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   IN (rt.probation_area_id, RPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.receiving_staff_id &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.receiving_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || &#39; :p_nsi_type IS NULL &#39; || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;RM&#39;, &#39;ALL&#39;, &#39;CT&#39;) THEN&#10;        v_SQL :&#61; v_SQL || &#39;&#10;&#39; || CASE WHEN NVLSTR(p_filter, &#39;ALL&#39;) &#61; &#39;ALL&#39; THEN &#39;UNION&#39; END || &#39;&#10;--&#10;SELECT&#10;  &#39;&#39;RM&#39;&#39;                          /*00*/  rpt_level,&#10;  OT.rqmnt_transfer_id            /*01*/  transfer_id,&#10;  O.offender_id                   /*02*/  offender_id,&#10;  OT.REQUEST_DATE                 /*03*/  request_date,&#10;  RT.probation_area_id            /*04*/  tgt_probation_area_id,&#10;  RTPA.description                /*05*/  tgt_probation_area_desc,&#10;  FT.probation_area_id            /*06*/  src_probation_area_id,&#10;  FTPA.description                /*07*/  src_probation_area_desc,&#10;  RPT.probation_area_id           /*08*/  tgt_probation_area_id_1,&#10;  RPTPA.description               /*09*/  tgt_probation_area_desc_1,&#10;  FPT.probation_area_id           /*10*/  src_probation_area_id_1,&#10;  FPTPA.description               /*11*/  src_probation_area_desc_1,&#10;  S.forename                      /*12*/  staff_forename,&#10;  S.surname                       /*13*/  staff_surname,&#10;  S.officer_code                  /*14*/  officer_code,&#10;  PE.forename                     /*15*/  provider_employee_forename,&#10;  PE.surname                      /*16*/  provider_employee_surname,&#10;  PE.code                         /*17*/  provider_employee_code,&#10;  O.crn                           /*18*/  crn,&#10;  O.first_name                    /*19*/  first_name,&#10;  O.second_name                   /*20*/  second_name,&#10;  O.third_name                    /*21*/  third_name,&#10;  O.surname                       /*22*/  surname,&#10;  O.date_of_birth_date            /*23*/  date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR   /*24*/  CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION           /*25*/  CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION             /*26*/  CURRENT_EXCLUSION,&#10;  E.event_id                      /*27*/  event_id,&#10;  E.referral_date                 /*28*/  referral_date,&#10;  D.disposal_id                   /*29*/  disposal_id,&#10;  D.termination_date              /*30*/  disposal_termination_date,&#10;  D.upw                           /*31*/  disposal_upw,&#10;  DT.sentence_type                /*32*/  disposal_sentence_type,&#10;  DT.cja2003                      /*33*/  disposal_cja2003,&#10;  DT.PRE_CJA2003                  /*34*/  disposal_PRE_CJA2003,&#10;  R.rqmnt_id                      /*35*/  rqmnt_id,&#10;  NULL                            /*36*/  lic_condition_id,&#10;  NULL                            /*37*/  nsi_id,&#10;  RT.description                  /*38*/  tgt_team_description,&#10;  FT.description                  /*39*/  src_team_description,&#10;  RPT.name                        /*40*/  tgt_provider_team_name,&#10;  FPT.name                        /*41*/  src_provider_team_name,&#10;  NULL                            /*42*/  disposal_type_description,&#10;  rmc.description                 /*43*/  rqmnt_main_cat_descrition,&#10;  armc.description                /*44*/  rqmnt_ad_cat_descrition,&#10;  NULL                            /*45*/  lc_main_cat_descrition,&#10;  NULL                            /*46*/  nsi_type_descrition,&#10;  NULL                            /*47*/  pss_id,&#10;  NULL                            /*48*/  pss_type_description,&#10;  --&#10;  RD.description                  /*49*/  tgt_district_description,&#10;  FD.description                  /*50*/  src_district_description,&#10;  --&#10;  NULL                            /*51*/  institutional_report_id,&#10;  NULL                            /*52*/  ireport_type_description,&#10;  --&#10;  NULL                            /*53*/    court_report_id,&#10;  NULL                            /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment              /*55*/    establishment_flag,&#10;  RPTPA.establishment             /*56*/    establishment_provider_flag&#10;  --&#10;FROM rqmnt_transfer ot&#10;  --JOIN r_standard_reference_list ts ON ts.standard_reference_list_id &#61; OT.transfer_status_id&#10;  JOIN rqmnt r ON R.rqmnt_id &#61; OT.rqmnt_id&#10;    LEFT OUTER JOIN R_RQMNT_TYPE_MAIN_CATEGORY rmc ON rmc.rqmnt_type_main_category_id &#61; R.rqmnt_type_main_category_id&#10;    LEFT OUTER JOIN R_AD_RQMNT_TYPE_MAIN_CATEGORY armc ON armc.ad_rqmnt_type_main_category_id &#61; R.ad_rqmnt_type_main_category_id&#10;  JOIN disposal d ON D.disposal_id &#61; R.disposal_id&#10;    JOIN r_disposal_type dt ON DT.disposal_type_id &#61; D.disposal_type_id&#10;  JOIN event e ON E.event_id &#61; D.event_id&#10;  JOIN offender o ON O.offender_id &#61; E.offender_id&#10;  JOIN rqmnt_manager om ON OM.rqmnt_id &#61; OT.rqmnt_id AND OM.active_flag &#61; 1&#10;    LEFT OUTER JOIN staff s ON OM.ALLOCATED_STAFF_ID &#61; S.staff_id&#10;    LEFT OUTER JOIN provider_employee pe ON PE.provider_employee_id &#61; OM.provider_employee_id&#10;  --&#10;  LEFT OUTER JOIN team rt ON RT.team_id &#61; OT.RECEIVING_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    LEFT OUTER JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  LEFT OUTER JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    LEFT OUTER JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    LEFT OUTER JOIN district fd ON FT.district_id &#61; FD.district_id&#10;  LEFT OUTER JOIN provider_team rpt ON RPT.provider_team_id &#61; OT.RECEIVING_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rptpa ON RPT.PROBATION_AREA_ID &#61; RPTPA.probation_area_id&#10;  LEFT OUTER JOIN provider_team fpt ON FPT.provider_team_id &#61; OT.ORIGIN_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area fptpa ON FPT.PROBATION_AREA_ID &#61; FPTPA.probation_area_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted                     &#61; 0&#10;  AND R.soft_deleted                     &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from IN (ft.probation_area_id, FPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   IN (rt.probation_area_id, RPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.receiving_staff_id &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.receiving_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || &#39; :p_nsi_type IS NULL &#39; || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;LM&#39;, &#39;ALL&#39;, &#39;CT&#39;) THEN&#10;        v_SQL :&#61; v_SQL || &#39;&#10;&#39; || CASE WHEN NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;ALL&#39;, &#39;CT&#39;) THEN &#39;UNION&#39; END || &#39;&#10;--&#10;SELECT&#10;  &#39;&#39;LM&#39;&#39;                          /*00*/  rpt_level,&#10;  OT.lic_condition_transfer_id    /*01*/  transfer_id,&#10;  O.offender_id                   /*02*/  offender_id,&#10;  OT.REQUEST_DATE                 /*03*/  request_date,&#10;  RT.probation_area_id            /*04*/  tgt_probation_area_id,&#10;  RTPA.description                /*05*/  tgt_probation_area_desc,&#10;  FT.probation_area_id            /*06*/  src_probation_area_id,&#10;  FTPA.description                /*07*/  src_probation_area_desc,&#10;  RPT.probation_area_id           /*08*/  tgt_probation_area_id_1,&#10;  RPTPA.description               /*09*/  tgt_probation_area_desc_1,&#10;  FPT.probation_area_id           /*10*/  src_probation_area_id_1,&#10;  FPTPA.description               /*11*/  src_probation_area_desc_1,&#10;  S.forename                      /*12*/  staff_forename,&#10;  S.surname                       /*13*/  staff_surname,&#10;  S.officer_code                  /*14*/  officer_code,&#10;  PE.forename                     /*15*/  provider_employee_forename,&#10;  PE.surname                      /*16*/  provider_employee_surname,&#10;  PE.code                         /*17*/  provider_employee_code,&#10;  O.crn                           /*18*/  crn,&#10;  O.first_name                    /*19*/  first_name,&#10;  O.second_name                   /*20*/  second_name,&#10;  O.third_name                    /*21*/  third_name,&#10;  O.surname                       /*22*/  surname,&#10;  O.date_of_birth_date            /*23*/  date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR   /*24*/  CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION           /*25*/  CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION             /*26*/  CURRENT_EXCLUSION,&#10;  E.event_id                      /*27*/  event_id,&#10;  E.referral_date                 /*28*/  referral_date,&#10;  D.disposal_id                   /*29*/  disposal_id,&#10;  D.termination_date              /*30*/  disposal_termination_date,&#10;  D.upw                           /*31*/  disposal_upw,&#10;  DT.sentence_type                /*32*/  disposal_sentence_type,&#10;  DT.cja2003                      /*33*/  disposal_cja2003,&#10;  DT.PRE_CJA2003                  /*34*/  disposal_PRE_CJA2003,&#10;  NULL                            /*35*/  rqmnt_id,&#10;  R.lic_condition_id              /*36*/  lic_condition_id,&#10;  NULL                            /*37*/  nsi_id,&#10;  RT.description                  /*38*/  tgt_team_description,&#10;  FT.description                  /*39*/  src_team_description,&#10;  RPT.name                        /*40*/  tgt_provider_team_name,&#10;  FPT.name                        /*41*/  src_provider_team_name,&#10;  NULL                            /*42*/  disposal_type_description,&#10;  NULL                            /*43*/  rqmnt_main_cat_descrition,&#10;  NULL                            /*44*/  rqmnt_ad_cat_descrition,&#10;  lmc.description                 /*45*/  lc_main_cat_descrition,&#10;  NULL                            /*46*/  nsi_type_descrition,&#10;  NULL                            /*47*/  pss_id,&#10;  NULL                            /*48*/  pss_type_description,&#10;  --&#10;  RD.description                  /*49*/  tgt_district_description,&#10;  FD.description                  /*50*/  src_district_description,&#10;  --&#10;  NULL                            /*51*/  institutional_report_id,&#10;  NULL                            /*52*/  ireport_type_description,&#10;  --&#10;  NULL                            /*53*/    court_report_id,&#10;  NULL                            /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment              /*55*/    establishment_flag,&#10;  RPTPA.establishment             /*56*/    establishment_provider_flag&#10;  --&#10;FROM lic_condition_transfer ot&#10;  --JOIN r_standard_reference_list ts ON ts.standard_reference_list_id &#61; OT.transfer_status_id&#10;  JOIN lic_condition r ON R.lic_condition_id &#61; OT.lic_condition_id&#10;    JOIN R_LIC_COND_TYPE_MAIN_CAT lmc ON lmc.lic_cond_type_main_cat_id &#61; R.lic_cond_type_main_cat_id&#10;  JOIN disposal d ON D.disposal_id &#61; R.disposal_id&#10;    JOIN r_disposal_type dt ON DT.disposal_type_id &#61; D.disposal_type_id&#10;  JOIN event e ON E.event_id &#61; D.event_id&#10;  JOIN offender o ON O.offender_id &#61; E.offender_id&#10;  JOIN lic_condition_manager om ON OM.lic_condition_id &#61; OT.lic_condition_id AND OM.active_flag &#61; 1&#10;    LEFT OUTER JOIN staff s ON OM.STAFF_ID &#61; S.staff_id&#10;    LEFT OUTER JOIN provider_employee pe ON PE.provider_employee_id &#61; OM.provider_employee_id&#10;  --&#10;  LEFT OUTER JOIN team rt ON RT.team_id &#61; OT.RECEIVING_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    LEFT OUTER JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  LEFT OUTER JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    LEFT OUTER JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    LEFT OUTER JOIN district fd ON FT.district_id &#61; FD.district_id&#10;  LEFT OUTER JOIN provider_team rpt ON RPT.provider_team_id &#61; OT.RECEIVING_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area rptpa ON RPT.PROBATION_AREA_ID &#61; RPTPA.probation_area_id&#10;  LEFT OUTER JOIN provider_team fpt ON FPT.provider_team_id &#61; OT.ORIGIN_PROVIDER_TEAM_ID&#10;    LEFT OUTER JOIN probation_area fptpa ON FPT.PROBATION_AREA_ID &#61; FPTPA.probation_area_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted               &#61; 0&#10;  AND R.soft_deleted               &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from IN (ft.probation_area_id, FPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   IN (rt.probation_area_id, RPT.probation_area_id)&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.receiving_staff_id &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.receiving_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || &#39; :p_nsi_type IS NULL &#39; || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;NI&#39;, &#39;ALL&#39;) THEN&#10;        v_SQL :&#61; v_SQL || &#39;&#10;&#39; || CASE WHEN NVLSTR(p_filter, &#39;ALL&#39;) &#61; &#39;ALL&#39; THEN &#39;UNION&#39; END || &#39;&#10;SELECT&#10;  &#39;&#39;NI&#39;&#39;                          /*00*/  rpt_level,&#10;  OT.nsi_transfer_id              /*01*/  transfer_id,&#10;  O.offender_id                   /*02*/  offender_id,&#10;  OT.REQUEST_DATE                 /*03*/  request_date,&#10;  RT.probation_area_id            /*04*/  tgt_probation_area_id,&#10;  RTPA.description                /*05*/  tgt_probation_area_desc,&#10;  FT.probation_area_id            /*06*/  src_probation_area_id,&#10;  FTPA.description                /*07*/  src_probation_area_desc,&#10;  NULL                            /*08*/  tgt_probation_area_id_1,&#10;  NULL                            /*09*/  tgt_probation_area_desc_1,&#10;  NULL                            /*10*/  src_probation_area_id_1,&#10;  NULL                            /*11*/  src_probation_area_desc_1,&#10;  S.forename                      /*12*/  staff_forename,&#10;  S.surname                       /*13*/  staff_surname,&#10;  S.officer_code                  /*14*/  officer_code,&#10;  NULL                            /*15*/  provider_employee_forename,&#10;  NULL                            /*16*/  provider_employee_surname,&#10;  NULL                            /*17*/  provider_employee_code,&#10;  O.crn                           /*18*/  crn,&#10;  O.first_name                    /*19*/  first_name,&#10;  O.second_name                   /*20*/  second_name,&#10;  O.third_name                    /*21*/  third_name,&#10;  O.surname                       /*22*/  surname,&#10;  O.date_of_birth_date            /*23*/  date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR   /*24*/  CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION           /*25*/  CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION             /*26*/  CURRENT_EXCLUSION,&#10;  E.event_id                      /*27*/  event_id,&#10;  E.referral_date                 /*28*/  referral_date,&#10;  D.disposal_id                   /*29*/  disposal_id,&#10;  D.termination_date              /*30*/  disposal_termination_date,&#10;  D.upw                           /*31*/  disposal_upw,&#10;  DT.sentence_type                /*32*/  disposal_sentence_type,&#10;  DT.cja2003                      /*33*/  disposal_cja2003,&#10;  DT.PRE_CJA2003                  /*34*/  disposal_PRE_CJA2003,&#10;  NULL                            /*35*/  rqmnt_id,&#10;  NULL                            /*36*/  lic_condition_id,&#10;  R.nsi_id                        /*37*/  nsi_id,&#10;  RT.description                  /*38*/  tgt_team_description,&#10;  FT.description                  /*39*/  src_team_description,&#10;  NULL                            /*40*/  tgt_provider_team_name,&#10;  NULL                            /*41*/  src_provider_team_name,&#10;  NULL                            /*42*/  disposal_type_description,&#10;  NULL                            /*43*/  rqmnt_main_cat_descrition,&#10;  NULL                            /*44*/  rqmnt_ad_cat_descrition,&#10;  NULL                            /*45*/  lc_main_cat_descrition,&#10;  NSIT.description                /*46*/  nsi_type_descrition,&#10;  NULL                            /*47*/  pss_id,&#10;  NULL                            /*48*/  pss_type_description,&#10;  --&#10;  RD.description                  /*49*/  tgt_district_description,&#10;  FD.description                  /*50*/  src_district_description,&#10;  --&#10;  NULL                            /*51*/  institutional_report_id,&#10;  NULL                            /*52*/  ireport_type_description,&#10;  --&#10;  NULL                            /*53*/    court_report_id,&#10;  NULL                            /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment              /*55*/    establishment_flag,&#10;  NULL                            /*56*/    establishment_provider_flag&#10;  --&#10;FROM nsi_transfer ot&#10;  --JOIN r_standard_reference_list ts ON ts.standard_reference_list_id &#61; OT.transfer_status_id&#10;  JOIN nsi r ON R.nsi_id &#61; OT.nsi_id&#10;    JOIN r_nsi_type nsit ON R.nsi_type_id &#61; NSIT.nsi_type_id&#10;    LEFT OUTER JOIN event e ON E.event_id &#61; R.event_id&#10;      LEFT OUTER JOIN disposal D ON D.event_id &#61; R.event_id /*AND D.termination_date IS NULL AND D.soft_deleted &#61; 0*/&#10;        LEFT OUTER JOIN r_disposal_type dt ON DT.disposal_type_id &#61; D.disposal_type_id&#10;    JOIN offender o ON O.offender_id &#61; R.offender_id&#10;  JOIN nsi_manager om ON OM.nsi_id &#61; OT.nsi_id AND OM.active_flag &#61; 1&#10;    JOIN staff s ON OM.STAFF_ID &#61; S.staff_id&#10;  --&#10;  JOIN team rt ON RT.team_id &#61; OT.TARGET_TEAM_ID&#10;    JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    JOIN district fd ON FT.district_id &#61; FD.district_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted          &#61; 0&#10;  AND R.soft_deleted          &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from &#61; FT.probation_area_id&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   &#61; RT.probation_area_id&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.TARGET_STAFF_ID &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.target_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_nsi_type IS NOT NULL THEN &#39;r.nsi_type_id &#61; :p_nsi_type &#39; ELSE &#39;:p_nsi_type IS NULL &#39;  END || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;PM&#39;, &#39;ALL&#39;, &#39;CT&#39;) THEN&#10;        v_SQL :&#61; v_SQL || &#39;&#10;&#39; || CASE WHEN NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;ALL&#39;, &#39;CT&#39;) THEN &#39;UNION&#39; END || &#39;&#10;SELECT&#10;  &#39;&#39;PM&#39;&#39;                          /*00*/  rpt_level,&#10;  OT.pss_rqmnt_transfer_id        /*01*/  transfer_id,&#10;  O.offender_id                   /*02*/    offender_id,&#10;  OT.REQUEST_DATE                 /*03*/  request_date,&#10;  RT.probation_area_id            /*04*/    tgt_probation_area_id,&#10;  RTPA.description                /*05*/    tgt_probation_area_desc,&#10;  FT.probation_area_id            /*06*/    src_probation_area_id,&#10;  FTPA.description                /*07*/    src_probation_area_desc,&#10;  NULL                            /*08*/    tgt_probation_area_id_1,&#10;  NULL                            /*09*/    tgt_probation_area_desc_1,&#10;  NULL                            /*10*/    src_probation_area_id_1,&#10;  NULL                            /*11*/    src_probation_area_desc_1,&#10;  S.forename                      /*12*/  staff_forename,&#10;  S.surname                       /*13*/    staff_surname,&#10;  S.officer_code                  /*14*/  officer_code,&#10;  NULL                            /*15*/    provider_employee_forename,&#10;  NULL                            /*16*/    provider_employee_surname,&#10;  NULL                            /*17*/    provider_employee_code,&#10;  O.crn                           /*18*/    crn,&#10;  O.first_name                    /*19*/    first_name,&#10;  O.second_name                   /*20*/    second_name,&#10;  O.third_name                    /*21*/    third_name,&#10;  O.surname                       /*22*/    surname,&#10;  O.date_of_birth_date            /*23*/    date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR   /*24*/    CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION           /*25*/    CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION             /*26*/  CURRENT_EXCLUSION,&#10;  E.event_id                      /*27*/  event_id,&#10;  E.referral_date                 /*28*/  referral_date,&#10;  D.disposal_id                   /*29*/    disposal_id,&#10;  D.termination_date              /*30*/  disposal_termination_date,&#10;  D.upw                           /*31*/    disposal_upw,&#10;  DT.sentence_type                /*32*/    disposal_sentence_type,&#10;  DT.cja2003                      /*33*/  disposal_cja2003,&#10;  DT.PRE_CJA2003                  /*34*/  disposal_PRE_CJA2003,&#10;  NULL                            /*35*/    rqmnt_id,&#10;  NULL                            /*36*/    lic_condition_id,&#10;  NULL                            /*37*/    nsi_id,&#10;  RT.description                  /*38*/  tgt_team_description,&#10;  FT.description                  /*39*/  src_team_description,&#10;  NULL                            /*40*/    tgt_provider_team_name,&#10;  NULL                            /*41*/    src_provider_team_name,&#10;  NULL                            /*42*/    disposal_type_description,&#10;  NULL                            /*43*/    rqmnt_main_cat_descrition,&#10;  NULL                            /*44*/    rqmnt_ad_cat_descrition,&#10;  NULL                            /*45*/    lc_main_cat_descrition,&#10;  NULL                            /*46*/    nsi_type_descrition,&#10;  OT.PSS_RQMNT_ID                 /*47*/    pss_id,&#10;  NSIT.description                /*48*/    pss_type_description,&#10;  --&#10;  RD.description                  /*49*/  tgt_district_description,&#10;  FD.description                  /*50*/  src_district_description,&#10;  --&#10;  NULL                            /*51*/  institutional_report_id,&#10;  NULL                            /*52*/    ireport_type_description,&#10;  --&#10;  NULL                            /*53*/    court_report_id,&#10;  NULL                            /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment              /*55*/    establishment_flag,&#10;  NULL                            /*56*/    establishment_provider_flag&#10;  --&#10;FROM pss_rqmnt_transfer ot&#10;  --JOIN r_standard_reference_list ts ON ts.standard_reference_list_id &#61; OT.transfer_status_id&#10;  JOIN pss_rqmnt r ON R.pss_rqmnt_id &#61; OT.pss_rqmnt_id&#10;    JOIN r_pss_rqmnt_type_main_category nsit ON R.pss_rqmnt_type_main_cat_id &#61; NSIT.pss_rqmnt_type_main_cat_id&#10;    JOIN custody c ON C.custody_id &#61; R.custody_id&#10;      JOIN disposal d ON D.disposal_id &#61; C.disposal_id&#10;        JOIN r_disposal_type dt ON DT.disposal_type_id &#61; D.disposal_type_id&#10;        JOIN event e ON E.event_id &#61; D.event_id&#10;          JOIN offender o ON O.offender_id &#61; E.offender_id&#10;  JOIN pss_rqmnt_manager om ON OM.pss_rqmnt_id &#61; OT.pss_rqmnt_id AND OM.active_flag &#61; 1&#10;    JOIN staff s ON OM.STAFF_ID &#61; S.staff_id&#10;  --&#10;  JOIN team rt ON RT.team_id &#61; OT.RECEIVING_TEAM_ID&#10;    JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    JOIN district fd ON FT.district_id &#61; FD.district_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted          &#61; 0&#10;  AND R.soft_deleted          &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from &#61; FT.probation_area_id&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   &#61; RT.probation_area_id&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.receiving_staff_id &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.receiving_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || &#39; :p_nsi_type IS NULL &#39; || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;    --&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;IR&#39;, &#39;ALL&#39;) THEN&#10;        v_SQL :&#61; v_SQL || &#39;&#10;&#39; || CASE WHEN NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;ALL&#39;) THEN &#39;UNION&#39; END || &#39;&#10;SELECT&#10;  &#39;&#39;IR&#39;&#39;                            /*00*/  rpt_level,&#10;  OT.institutional_rep_transfer_id  /*01*/  transfer_id,&#10;  O.offender_id                     /*02*/  offender_id,&#10;  OT.REQUEST_DATE                   /*03*/  request_date,&#10;  RT.probation_area_id              /*04*/  tgt_probation_area_id,&#10;  RTPA.description                  /*05*/  tgt_probation_area_desc,&#10;  FT.probation_area_id              /*06*/  src_probation_area_id,&#10;  FTPA.description                  /*07*/  src_probation_area_desc,&#10;  NULL                              /*08*/  tgt_probation_area_id_1,&#10;  NULL                              /*09*/  tgt_probation_area_desc_1,&#10;  NULL                              /*10*/  src_probation_area_id_1,&#10;  NULL                              /*11*/  src_probation_area_desc_1,&#10;  S.forename                        /*12*/  staff_forename,&#10;  S.surname                         /*13*/  staff_surname,&#10;  S.officer_code                    /*14*/  officer_code,&#10;  NULL                              /*15*/  provider_employee_forename,&#10;  NULL                              /*16*/  provider_employee_surname,&#10;  NULL                              /*17*/  provider_employee_code,&#10;  O.crn                             /*18*/  crn,&#10;  O.first_name                      /*19*/  first_name,&#10;  O.second_name                     /*20*/  second_name,&#10;  O.third_name                      /*21*/  third_name,&#10;  O.surname                         /*22*/  surname,&#10;  O.date_of_birth_date              /*23*/  date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR     /*24*/  CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION             /*25*/  CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION               /*26*/  CURRENT_EXCLUSION,&#10;  E.event_id                        /*27*/  event_id,&#10;  E.referral_date                   /*28*/  referral_date,&#10;  D.disposal_id                     /*29*/  disposal_id,&#10;  D.termination_date                /*30*/  disposal_termination_date,&#10;  D.upw                             /*31*/  disposal_upw,&#10;  DT.sentence_type                  /*32*/  disposal_sentence_type,&#10;  DT.cja2003                        /*33*/  disposal_cja2003,&#10;  DT.PRE_CJA2003                    /*34*/  disposal_PRE_CJA2003,&#10;  NULL                              /*35*/  rqmnt_id,&#10;  NULL                              /*36*/  lic_condition_id,&#10;  NULL                              /*37*/  nsi_id,&#10;  RT.description                    /*38*/  tgt_team_description,&#10;  FT.description                    /*39*/  src_team_description,&#10;  NULL                              /*40*/  tgt_provider_team_name,&#10;  NULL                              /*41*/  src_provider_team_name,&#10;  NULL                              /*42*/  disposal_type_description,&#10;  NULL                              /*43*/  rqmnt_main_cat_descrition,&#10;  NULL                              /*44*/  rqmnt_ad_cat_descrition,&#10;  NULL                              /*45*/  lc_main_cat_descrition,&#10;  NULL                              /*46*/  nsi_type_descrition,&#10;  NULL                              /*47*/  pss_id,&#10;  NULL                              /*48*/  pss_type_description,&#10;  --&#10;  RD.description                    /*49*/  tgt_district_description,&#10;  FD.description                    /*50*/  src_district_description,&#10;  --&#10;  R.institutional_report_id         /*51*/  institutional_report_id,&#10;  IRT.code_description              /*52*/  ireport_type_description,&#10;  --&#10;  NULL                              /*53*/  court_report_id,&#10;  NULL                              /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment                /*55*/    establishment_flag,&#10;  NULL                              /*56*/    establishment_provider_flag&#10;  --&#10; FROM institutional_report_transfer ot&#10;  --JOIN r_standard_reference_list ts ON ts.standard_reference_list_id &#61; OT.transfer_status_id&#10;  JOIN institutional_report r ON R.institutional_report_id &#61; OT.institutional_report_id&#10;    JOIN r_standard_reference_list irt ON IRT.standard_reference_list_id &#61; R.INSTITUTION_REPORT_TYPE_ID&#10;    JOIN custody c ON R.custody_id &#61; C.custody_id&#10;      JOIN disposal d ON D.disposal_id &#61; C.disposal_id&#10;        JOIN r_disposal_type dt ON DT.disposal_type_id &#61; D.disposal_type_id&#10;        JOIN event e ON E.event_id &#61; D.event_id&#10;          JOIN offender o ON O.offender_id &#61; E.offender_id&#10;  JOIN report_manager om ON OM.institutional_report_id &#61; OT.institutional_report_id AND OM.active_flag &#61; 1&#10;    JOIN staff s ON OM.STAFF_ID &#61; S.staff_id&#10;  --&#10;  JOIN team rt ON RT.team_id &#61; OT.RECEIVING_TEAM_ID&#10;    JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    JOIN district fd ON FT.district_id &#61; FD.district_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted          &#61; 0&#10;  AND R.soft_deleted          &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from &#61; FT.probation_area_id&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   &#61; RT.probation_area_id&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.receiving_staff_id &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.receiving_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || &#39; :p_nsi_type IS NULL &#39; || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;    --&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;CR&#39;, &#39;ALL&#39;) THEN&#10;        v_SQL :&#61; v_SQL || &#39;&#10;&#39; || CASE WHEN NVLSTR(p_filter, &#39;ALL&#39;) IN (&#39;ALL&#39;) THEN &#39;UNION&#39; END || &#39;&#10;SELECT&#10;  &#39;&#39;CR&#39;&#39;                            /*00*/  rpt_level,&#10;  OT.court_report_transfer_id          /*01*/  transfer_id,&#10;  O.offender_id                     /*02*/  offender_id,&#10;  OT.REQUEST_DATE                   /*03*/  request_date,&#10;  RT.probation_area_id              /*04*/  tgt_probation_area_id,&#10;  RTPA.description                  /*05*/  tgt_probation_area_desc,&#10;  FT.probation_area_id              /*06*/  src_probation_area_id,&#10;  FTPA.description                  /*07*/  src_probation_area_desc,&#10;  NULL                              /*08*/  tgt_probation_area_id_1,&#10;  NULL                              /*09*/  tgt_probation_area_desc_1,&#10;  NULL                              /*10*/  src_probation_area_id_1,&#10;  NULL                              /*11*/  src_probation_area_desc_1,&#10;  S.forename                        /*12*/  staff_forename,&#10;  S.surname                         /*13*/  staff_surname,&#10;  S.officer_code                    /*14*/  officer_code,&#10;  NULL                              /*15*/  provider_employee_forename,&#10;  NULL                              /*16*/  provider_employee_surname,&#10;  NULL                              /*17*/  provider_employee_code,&#10;  O.crn                             /*18*/  crn,&#10;  O.first_name                      /*19*/  first_name,&#10;  O.second_name                     /*20*/  second_name,&#10;  O.third_name                      /*21*/  third_name,&#10;  O.surname                         /*22*/  surname,&#10;  O.date_of_birth_date              /*23*/  date_of_birth_date,&#10;  O.CURRENT_HIGHEST_RISK_COLOUR     /*24*/  CURRENT_HIGHEST_RISK_COLOUR,&#10;  O.CURRENT_RESTRICTION             /*25*/  CURRENT_RESTRICTION,&#10;  O.CURRENT_EXCLUSION               /*26*/  CURRENT_EXCLUSION,&#10;  E.event_id                        /*27*/  event_id,&#10;  E.referral_date                   /*28*/  referral_date,&#10;  D.disposal_id                     /*29*/  disposal_id,&#10;  D.termination_date                /*30*/  disposal_termination_date,&#10;  D.upw                             /*31*/  disposal_upw,&#10;  DT.sentence_type                  /*32*/  disposal_sentence_type,&#10;  DT.cja2003                        /*33*/  disposal_cja2003,&#10;  DT.PRE_CJA2003                    /*34*/  disposal_PRE_CJA2003,&#10;  NULL                              /*35*/  rqmnt_id,&#10;  NULL                              /*36*/  lic_condition_id,&#10;  NULL                              /*37*/  nsi_id,&#10;  RT.description                    /*38*/  tgt_team_description,&#10;  FT.description                    /*39*/  src_team_description,&#10;  NULL                              /*40*/  tgt_provider_team_name,&#10;  NULL                              /*41*/  src_provider_team_name,&#10;  NULL                              /*42*/  disposal_type_description,&#10;  NULL                              /*43*/  rqmnt_main_cat_descrition,&#10;  NULL                              /*44*/  rqmnt_ad_cat_descrition,&#10;  NULL                              /*45*/  lc_main_cat_descrition,&#10;  NULL                              /*46*/  nsi_type_descrition,&#10;  NULL                              /*47*/  pss_id,&#10;  NULL                              /*48*/  pss_type_description,&#10;  --&#10;  RD.description                    /*49*/  tgt_district_description,&#10;  FD.description                    /*50*/  src_district_description,&#10;  --&#10;  NULL                              /*51*/  institutional_report_id,&#10;  NULL                              /*52*/  ireport_type_description,&#10;  --&#10;  R.court_report_id                 /*53*/  court_report_id,&#10;  IRT.description                   /*54*/  court_report_type_description,&#10;  --&#10;  RTPA.establishment              /*55*/    establishment_flag,&#10;  NULL                            /*56*/    establishment_provider_flag&#10;  --&#10; FROM court_report_transfer ot&#10;  --JOIN r_standard_reference_list ts ON ts.standard_reference_list_id &#61; OT.transfer_status_id&#10;  JOIN court_report r ON R.court_report_id &#61; OT.court_report_id&#10;       JOIN r_court_report_type irt ON IRT.court_report_type_id &#61; R.COURT_REPORT_TYPE_ID&#10;    JOIN court_appearance c ON R.court_appearance_id &#61; C.court_appearance_id&#10;        JOIN event e ON E.event_id &#61; C.event_id&#10;          LEFT OUTER JOIN disposal d ON D.event_id &#61; E.event_id /*AND D.termination_date IS NULL AND D.soft_deleted &#61; 0*/&#10;        LEFT OUTER JOIN r_disposal_type dt ON DT.disposal_type_id &#61; D.disposal_type_id&#10;          JOIN offender o ON O.offender_id &#61; E.offender_id&#10;  JOIN report_manager om ON OM.court_report_id &#61; OT.court_report_id AND OM.active_flag &#61; 1&#10;    JOIN staff s ON OM.STAFF_ID &#61; S.staff_id&#10;  --&#10;  JOIN team rt ON RT.team_id &#61; OT.RECEIVING_TEAM_ID&#10;    JOIN probation_area rtpa ON RT.PROBATION_AREA_ID &#61; RTPA.probation_area_id&#10;    JOIN district rd ON RT.district_id &#61; RD.district_id&#10;  JOIN team ft ON FT.team_id &#61; OT.ORIGIN_TEAM_ID&#10;    JOIN probation_area ftpa ON FT.PROBATION_AREA_ID &#61; FTPA.probation_area_id&#10;    JOIN district fd ON FT.district_id &#61; FD.district_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted          &#61; 0&#10;  AND R.soft_deleted          &#61; 0&#10;  AND OT.transfer_status_id   &#61; :p_pending_status_id&#10;  AND &#39; || CASE WHEN p_probation_area_from IS NOT NULL THEN &#39;:p_probation_area_from &#61; FT.probation_area_id&#39; ELSE &#39;:p_probation_area_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_to   IS NOT NULL THEN &#39;:p_probation_area_to   &#61; RT.probation_area_id&#39; ELSE &#39;:p_probation_area_to   IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_from IS NOT NULL THEN &#39;fd.borough_id &#61; :borough_id_from &#39; ELSE &#39;:borough_id_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_borough_to IS NOT NULL THEN &#39;rd.borough_id &#61; :borough_id_to &#39; ELSE &#39;:borough_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_from IS NOT NULL THEN &#39;fd.district_id &#61; :district_id_from &#39; ELSE &#39;:district_id_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_district_to IS NOT NULL THEN &#39;rd.district_id &#61; :district_id_to &#39; ELSE &#39;:district_id_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_from IS NOT NULL THEN &#39;ft.local_delivery_unit_id &#61; :p_ldu_from &#39; ELSE &#39;:p_ldu_from IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_ldu_to IS NOT NULL THEN &#39;rt.local_delivery_unit_id &#61; :p_ldu_to &#39; ELSE &#39;:p_ldu_to IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_from IS NOT NULL THEN &#39;ot.ORIGIN_STAFF_ID &#61; :p_staff_from &#39; ELSE &#39;:p_staff_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_to IS NOT NULL THEN &#39;ot.receiving_staff_id &#61; :p_staff_to &#39; ELSE &#39;:p_staff_to IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_from IS NOT NULL THEN &#39;ot.origin_team_id &#61; :p_team_from &#39; ELSE &#39;:p_team_from IS NULL &#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_team_to IS NOT NULL THEN &#39;ot.receiving_team_id &#61; :p_team_to &#39; ELSE &#39;:p_team_to IS NULL &#39; END || &#39;&#10;  AND &#39; || &#39; :p_nsi_type IS NULL &#39; || &#39;&#10;--&#39;;&#10;--&#10;    END IF;&#10;    --&#10;    -- Now Open dynamic PLSQL cursor&#10;    --&#10;    IF NVLSTR(p_filter, &#39;ALL&#39;) &#61; (&#39;ALL&#39;) THEN&#10;        OPEN v_cur FOR v_SQL&#10;        USING&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- OM level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- OS level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- RM level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- LM level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- NI level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- PSS level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- IR level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type; -- CR level&#10;    ELSIF p_filter &#61; &#39;CT&#39; THEN&#10;        OPEN v_cur FOR v_SQL&#10;        USING&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- RM level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type, -- LS level&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type;  -- PSS level&#10;    ELSE&#10;        OPEN v_cur FOR v_SQL&#10;        USING&#10;          g_transfer_pending_id, p_probation_area_from, p_probation_area_to, p_borough_from, p_borough_to, p_district_from, p_district_to, p_ldu_from, p_ldu_to, p_staff_from, p_staff_to, p_team_from, p_team_to, p_nsi_type;  --[XX] level&#10;    END IF;&#10;    --&#10;    -- Fetch through the result set of records; if P_OFFENDER_ID parameter is not set then set LOOKUP DESCRIPTION values&#10;    --&#10;    LOOP&#10;        FETCH v_cur BULK COLLECT INTO v_tab LIMIT 1000;&#10;        FOR v_tab_idx IN 1..v_tab.COUNT LOOP&#10;            --&#10;            v_rec :&#61; v_tab(v_tab_idx);&#10;            --&#10;            --PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;v_rec.offender_id, p_L1&#61;&gt;v_rec.L1, p_L2&#61;&gt;v_rec.L2, p_L3&#61;&gt;v_rec.L3);&#10;            --&#10;            PIPE ROW (v_rec);&#10;            v_row :&#61; v_row + 1;&#10;        END LOOP;&#10;        --&#10;        EXIT WHEN v_cur%NOTFOUND;&#10;        --&#10;        EXIT WHEN v_row &gt;&#61; NVL(p_max_rows, 100000);&#10;    END LOOP;&#10;    CLOSE v_cur;&#10;    --&#10;    procDebug(lc_proc || &#39;(rows&#61;&#39; || v_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;g_transfer_pending_id&#61;&gt;&#39; || g_transfer_pending_id || &#39;, &#39; ||&#10;              &#39;p_probation_area_from&#61;&gt;&#39; || p_probation_area_from || &#39;, &#39; ||&#10;              &#39;p_probation_area_to&#61;&gt;&#39;   || p_probation_area_to   || &#39;, &#39; ||&#10;              &#39;p_filter&#61;&gt;&#39;              || p_filter              ||  CHR(10) ||&#10;              v_SQL );&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;        lc_proc || &#39;(rows&#61;&#39; || v_row || &#39;): &#39; ||&#10;        &#39;p_probation_area_from&#61;&gt;&#39; || p_probation_area_from || &#39;, &#39; ||&#10;        &#39;p_probation_area_to&#61;&gt;&#39;   || p_probation_area_to   || &#39;, &#39; ||&#10;        &#39;p_filter&#61;&gt;&#39;              || p_filter              ||  CHR(10) ||&#10;        v_SQL );&#10;    RAISE;&#10;END procGetPendingTransfersTAB;&#10;--&#10;PROCEDURE procGetPendingTransfers(&#10;    p_probation_area_to   NUMBER,&#10;    p_probation_area_from NUMBER,&#10;    p_filter              VARCHAR2,&#10;    p_outcursor           OUT SYS_REFCURSOR,&#10;    p_borough_to          IN NUMBER DEFAULT NULL,&#10;    p_borough_from        IN NUMBER DEFAULT NULL,&#10;    p_district_to         IN NUMBER DEFAULT NULL,&#10;    p_district_from       IN NUMBER DEFAULT NULL,&#10;    p_ldu_to              IN NUMBER DEFAULT NULL,&#10;    p_ldu_from            IN NUMBER DEFAULT NULL,&#10;    p_staff_to            IN NUMBER DEFAULT NULL,&#10;    p_staff_from          IN NUMBER DEFAULT NULL,&#10;    p_team_to             IN NUMBER DEFAULT NULL,&#10;    p_team_from           IN NUMBER DEFAULT NULL,&#10;    p_nsi_type            IN NUMBER DEFAULT NULL)&#10;AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/  rpt_level,&#10;        /*01*/  transfer_id,&#10;        /*02*/  offender_id,&#10;        /*03*/  request_date,&#10;        /*04*/  tgt_probation_area_id,&#10;        /*05*/  tgt_probation_area_desc,&#10;        /*06*/  src_probation_area_id,&#10;        /*07*/  src_probation_area_desc,&#10;        /*08*/  tgt_probation_area_id_1,&#10;        /*09*/  tgt_probation_area_desc_1,&#10;        /*10*/  src_probation_area_id_1,&#10;        /*11*/  src_probation_area_desc_1,&#10;        /*12*/  staff_forename,&#10;        /*13*/  staff_surname,&#10;        /*14*/  officer_code,&#10;        /*15*/  provider_employee_forename,&#10;        /*16*/  provider_employee_surname,&#10;        /*17*/  provider_employee_code,&#10;        /*18*/  crn,&#10;        /*19*/  first_name,&#10;        /*20*/  second_name,&#10;        /*21*/  third_name,&#10;        /*22*/  surname,&#10;        /*23*/  date_of_birth_date,&#10;        /*24*/  CURRENT_HIGHEST_RISK_COLOUR,&#10;        /*25*/  CURRENT_RESTRICTION,&#10;        /*26*/  CURRENT_EXCLUSION,&#10;        /*27*/  event_id,&#10;        /*28*/  referral_date,&#10;        /*29*/  disposal_id,&#10;        /*30*/  disposal_termination_date,&#10;        /*31*/  disposal_upw,&#10;        /*32*/  disposal_sentence_type,&#10;        /*33*/  disposal_cja2003,&#10;        /*34*/  disposal_PRE_CJA2003,&#10;        /*35*/  rqmnt_id,&#10;        /*36*/  lic_condition_id,&#10;        /*37*/  nsi_id,&#10;        /*38*/  tgt_team_description,&#10;        /*39*/  src_team_description,&#10;        /*40*/  tgt_provider_team_name,&#10;        /*41*/  src_provider_team_name,&#10;        /*42*/  disposal_type_description,&#10;        /*43*/  rqmnt_main_cat_descrition,&#10;        /*44*/  rqmnt_ad_cat_descrition,&#10;        /*45*/  lc_main_cat_descrition,&#10;        /*46*/  nsi_type_descrition,&#10;        /*47*/  pss_id,&#10;        /*48*/  pss_type_description,&#10;        /*49*/  tgt_district_description,&#10;        /*50*/  src_district_description,&#10;        /*51*/  institutional_report_id,&#10;        /*52*/  ireport_type_description,&#10;        /*53*/  court_report_id,&#10;        /*54*/  court_report_type_description,&#10;        /*55*/  establishment_flag,&#10;        /*56*/  establishment_provider_flag&#10;      FROM TABLE( PKG_Search.procGetPendingTransfersTAB(&#10;                      p_probation_area_to   &#61;&gt; p_probation_area_to,&#10;                      p_probation_area_from &#61;&gt; p_probation_area_from,&#10;                      p_filter              &#61;&gt; p_filter,&#10;                      --&#10;                      p_max_rows            &#61;&gt; 10000,&#10;                      p_borough_to          &#61;&gt; p_borough_to,&#10;                      p_borough_from        &#61;&gt; p_borough_from,&#10;                      p_district_to         &#61;&gt; p_district_to,&#10;                      p_district_from       &#61;&gt; p_district_from,&#10;                      p_ldu_to              &#61;&gt; p_ldu_to,&#10;                      p_ldu_from            &#61;&gt; p_ldu_from,&#10;                      p_staff_to            &#61;&gt; p_staff_to,&#10;                      p_staff_from          &#61;&gt; p_staff_from,&#10;                      p_team_to             &#61;&gt; p_team_to,&#10;                      p_team_from           &#61;&gt; p_team_from,&#10;                      p_nsi_type            &#61;&gt; p_nsi_type )&#10;                 );&#10;    --&#10;END procGetPendingTransfers;&#10;--&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;-- NDelius Offender Tables Hierarchy helper subroutine&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;FUNCTION get_tab_list(p_reverse_order_flag VARCHAR2 DEFAULT &#39;N&#39;)&#10;RETURN PKG_DynSQL.ttabTablesHierarchy PIPELINED&#10;IS&#10;    l_proc CONSTANT VARCHAR2(30) :&#61; &#39;PKG_Search.get_tab_list&#39;;&#10;    --&#10;    l_TAB     PKG_DynSQL.ttabTablesHierarchy :&#61; PKG_DynSQL.ttabTablesHierarchy();&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT * BULK COLLECT INTO l_TAB&#10;    FROM TABLE( PKG_DynSQL.get_tab_list(p_reverse_order_flag) )&#10;    WHERE table_type IN (&#39;O&#39;,&#39;R&#39;);&#10;    --&#10;    FOR l_i IN 1 .. l_TAB.COUNT LOOP&#10;        PIPE ROW(l_TAB(l_i));&#10;    END LOOP;&#10;    --&#10;END get_tab_list;&#10;--&#10;--&#10;--&#10;FUNCTION procFindOfficeContactsTAB(&#10;    p_date                 DATE,&#10;    p_location_id          NUMBER,&#10;    p_linked_locations     VARCHAR2,&#10;    p_username             VARCHAR2,&#10;    p_max_rows             INTEGER DEFAULT 100000)&#10;RETURN ttabOfficeContact PIPELINED&#10;IS&#10;    --&#10;    TYPE v_cur_TYP IS REF CURSOR;&#10;    v_cur v_cur_TYP;&#10;    v_SQL VARCHAR2(10000);&#10;    --&#10;    v_rec trecOfficeContact;&#10;    v_tab ttabOfficeContact;&#10;    v_row INTEGER :&#61; 0;&#10;    v_i   INTEGER;&#10;    --&#10;BEGIN&#10;    IF NOT (p_date IS NOT NULL OR p_location_id IS NOT NULL OR empty2null(p_linked_locations) IS NOT NULL) THEN&#10;        raise_application_error(-20001, &#39;Error in procFindOfficeContactsTAB: insufficient number of parameters specified&#39;);&#10;    END IF;&#10;    --&#10;    v_SQL :&#61;&#10;&#39;WITH OFL AS (&#10;    SELECT :p_location_id             AS office_location_id&#10;    FROM dual&#10;&#39; || CASE WHEN p_linked_locations &#61; &#39;Y&#39; THEN&#10;   &#39;UNION&#10;    SELECT link_to_office_location_id AS office_location_id&#10;    FROM R_OFFICE_LOCATION_LINK&#10;    WHERE LINK_FROM_OFFICE_LOCATION_ID &#61; :p_location_id&#39;&#10;    END || &#39;&#10;)&#10;--&#10;SELECT DISTINCT&#10;  /*00*/ O.offender_id,&#10;  /*01*/ O.crn,&#10;  /*02*/ O.first_name,&#10;  /*03*/ O.second_name,&#10;  /*04*/ O.third_name,&#10;  /*05*/ O.surname,&#10;  /*06*/ O.current_highest_risk_colour,&#10;  /*07*/ O.current_restriction,&#10;  /*08*/ O.current_exclusion,&#10;  /*09*/ C.contact_id,&#10;  /*10*/ C.contact_date,&#10;  /*11*/ C.contact_start_time,&#10;  /*12*/ CT.contact_type_id,&#10;  /*13*/ CT.code                    AS contact_type_code,&#10;  /*14*/ CT.description             AS contact_type_desc,&#10;  /*15*/ TIER.code_description      AS tier_description,&#10;  /*16*/ O.current_tier,&#10;  /*17*/ CT.EDITABLE                AS user_editable,&#10;  /*18*/ S.forename                 AS staff_forename,&#10;  /*19*/ S.surname                  AS staff_surname,&#10;  /*20*/ S.officer_code             AS officer_code,&#10;  /*21*/ T.telephone                AS telephone,&#10;  /*22*/ OL.description             AS office_location_desc,&#10;  --&#10;  /*23*/ NULL AS L1,&#10;  /*24*/ NULL AS L2,&#10;  /*25*/ NULL AS L3,&#10;  /*26*/ NULL AS AUTHORISED&#10;  --&#10;FROM&#10;  contact C&#10;  JOIN r_contact_type CT ON CT.contact_type_id &#61; C.contact_type_id&#10;  JOIN team T ON C.team_id &#61; T.team_id&#10;  JOIN staff S ON C.staff_id &#61; S.staff_id&#10;  JOIN offender O ON C.offender_id &#61; O.offender_id&#10;    LEFT OUTER JOIN r_standard_reference_list TIER ON TIER.standard_reference_list_id &#61; O.current_tier&#10;  JOIN office_location OL ON C.office_location_id &#61; OL.office_location_id&#10;  JOIN OFL ON OFL.office_location_id &#61; C.office_location_id&#10;WHERE 1&#61;1&#10;  AND C.soft_deleted &#61; 0&#10;  AND ct.attendance_contact &#61; &#39;&#39;Y&#39;&#39;&#10;  AND C.contact_date &#61; :p_date&#39;;&#10;    --&#10;    -- YF: QC defect #15287 - the below dynamic SQl has been moved into the &quot;WITH OFL AS (...)&quot; inline view&#10;--    IF p_linked_locations &#61; &#39;Y&#39; THEN&#10;--        v_SQL :&#61; v_SQL || CHR(10) || &#39;  AND (c.OFFICE_LOCATION_ID &#61; :p_location_id OR C.OFFICE_LOCATION_ID in (select LINK_TO_OFFICE_LOCATION_ID from R_OFFICE_LOCATION_LINK where LINK_FROM_OFFICE_LOCATION_ID &#61; :p_location_id))&#39;;&#10;--    ELSE&#10;--        v_SQL :&#61; v_SQL || CHR(10) || &#39;  AND C.OFFICE_LOCATION_ID &#61; :p_location_id&#39;;&#10;--    END IF;&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    IF p_linked_locations &#61; &#39;Y&#39; THEN&#10;        OPEN v_cur FOR v_SQL&#10;        USING&#10;          p_location_id,&#10;          p_location_id,&#10;          p_date;&#10;    ELSE&#10;        OPEN v_cur FOR v_SQL&#10;        USING&#10;          p_location_id,&#10;          p_date;&#10;    END IF;&#10;    --&#10;    FETCH v_cur BULK COLLECT INTO v_tab LIMIT p_max_rows;&#10;    CLOSE v_cur;&#10;    --&#10;    FOR v_i IN 1..v_tab.COUNT LOOP&#10;        v_row :&#61; v_row + 1;&#10;        --EXIT WHEN v_row &gt; NVL(p_max_rows, 100000);&#10;        --&#10;        PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;v_tab(v_i).offender_id, p_L1&#61;&gt;v_tab(v_i).L1, p_L2&#61;&gt;v_tab(v_i).L2, p_L3&#61;&gt;v_tab(v_i).L3, p_username &#61;&gt; p_username);&#10;        --&#10;        SELECT&#10;          CASE WHEN CAST(ORGANISATIONS AS t_tab_ORGANISATIONS) MULTISET INTERSECT&#10;                    PKG_VpdSupport.funcGetUserProbAreas(p_user_name&#61;&gt;p_username, p_NPS_flag&#61;&gt;&#39;Y&#39;) IS NOT EMPTY&#10;              THEN &#39;1&#39;&#10;              ELSE &#39;0&#39;&#10;          END&#10;        INTO v_tab(v_i).AUTHORISED&#10;        FROM offender&#10;        WHERE offender_id &#61; v_tab(v_i).offender_id;&#10;        --&#10;        PIPE ROW (v_tab(v_i));&#10;    END LOOP;&#10;    --&#10;    procDebug(&#39;procFindOfficeContactsTAB (rows&#61;&#39; || v_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;(num_of_rows&#61;&#39;         || v_row              || &#39;)&#39; ||&#10;              &#39;(p_date&#61;&gt;&#39;             || p_date             || &#39;)&#39; ||&#10;              &#39;(p_location_id&#61;&gt;&#39;      || p_location_id      || &#39;)&#39; ||&#10;              &#39;(p_linked_locations&#61;&gt;&#39; || p_linked_locations || &#39;)&#39; ||&#10;              &#39;(p_username&#61;&gt;&#39;         || p_username         || &#39;)&#39; ||&#10;              &#39;(off_cache_HITS&#61;&#39;|| PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;              &#39;(off_cache_MISS&#61;&#39;|| PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39; || CHR(10) ||&#10;              v_SQL);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;              &#39;procFindOfficeContactsTAB: &#39; ||&#10;              &#39;(num_of_rows&#61;&#39;         || v_row              || &#39;)&#39; ||&#10;              &#39;(p_date&#61;&gt;&#39;             || p_date             || &#39;)&#39; ||&#10;              &#39;(p_location_id&#61;&gt;&#39;      || p_location_id      || &#39;)&#39; ||&#10;              &#39;(p_linked_locations&#61;&gt;&#39; || p_linked_locations || &#39;)&#39; ||&#10;              &#39;(p_username&#61;&gt;&#39;         || p_username         || &#39;)&#39; || CHR(10) ||&#10;              v_SQL );&#10;    RAISE;&#10;END procFindOfficeContactsTAB;&#10;--&#10;PROCEDURE procFindOfficeContacts(&#10;    p_date                 DATE,&#10;    p_location_id          NUMBER,&#10;    p_linked_locations     VARCHAR2,&#10;    p_username             VARCHAR2,&#10;    p_outcursor             OUT SYS_REFCURSOR )&#10;AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ offender_id,&#10;        /*01*/ crn,&#10;        /*02*/ first_name,&#10;        /*03*/ second_name,&#10;        /*04*/ third_name,&#10;        /*05*/ surname,&#10;        /*06*/ current_highest_risk_colour,&#10;        /*07*/ current_restriction,&#10;        /*08*/ current_exclusion,&#10;        /*09*/ contact_id,&#10;        /*10*/ contact_date,&#10;        /*11*/ contact_start_time,&#10;        /*12*/ contact_type_id,&#10;        /*13*/ CONTACT_TYPE_CODE,&#10;        /*14*/ CONTACT_TYPE_DESC,&#10;        /*15*/ TIER_DESCRIPTION,&#10;        /*16*/ current_tier,&#10;        /*17*/ USER_EDITABLE,&#10;        /*18*/ staff_forename,&#10;        /*19*/ staff_surname,&#10;        /*20*/ officer_code,&#10;        /*21*/ TELEPHONE,&#10;        /*22*/ OFFICE_LOCATION_DESC,&#10;      --&#10;        /*23*/ L1,&#10;        /*24*/ L2,&#10;        /*25*/ L3,&#10;        /*26*/ AUTHORISED&#10;        --&#10;      FROM TABLE( PKG_SEARCH.procFindOfficeContactsTAB(&#10;                      p_date                 &#61;&gt; p_date,&#10;                      p_location_id          &#61;&gt; p_location_id,&#10;                      p_linked_locations     &#61;&gt; p_linked_locations,&#10;                      p_username             &#61;&gt; p_username,&#10;                      p_max_rows             &#61;&gt; 10000 )) C&#10;      ;&#10;END procFindOfficeContacts;&#10;&#10;--&#10;-- Cohort Diary wrappers&#10;--&#10;FUNCTION procFindCohortDiaryTAB(&#10;    p_probation_area_ID   NUMBER DEFAULT NULL,&#10;    p_sentence_date       DATE                DEFAULT NULL,&#10;    p_release_date        DATE                DEFAULT NULL,&#10;    p_offence_date        DATE                DEFAULT NULL,&#10;    p_team_id             NUMBER   DEFAULT NULL,&#10;    p_staff_id            NUMBER DEFAULT NULL,&#10;    --&#10;    p_offender_id         NUMBER DEFAULT NULL,&#10;    p_use_cohort_table    VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_max_rows             INTEGER DEFAULT 100000 )&#10;RETURN PKG_CASELOAD.ttabCohortDiary PIPELINED&#10;IS&#10;    l_tab PKG_CASELOAD.ttabCohortDiary;&#10;BEGIN&#10;      SELECT * BULK COLLECT INTO l_tab&#10;      FROM TABLE( PKG_CASELOAD.procFindCohortDiaryTAB(&#10;                      p_probation_area_ID &#61;&gt; p_probation_area_ID,&#10;                      p_sentence_date     &#61;&gt; p_sentence_date,&#10;                      p_release_date      &#61;&gt; p_release_date,&#10;                      p_offence_date      &#61;&gt; p_offence_date,&#10;                      p_team_id           &#61;&gt; p_team_id,&#10;                      p_staff_id          &#61;&gt; p_staff_id,&#10;                      --&#10;                      p_use_cohort_table  &#61;&gt; p_use_cohort_table,&#10;                      --&#10;                      p_max_rows          &#61;&gt; p_max_rows ) );&#10;      --&#10;      FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;          PIPE ROW (l_tab(l_idx));&#10;      END LOOP;&#10;END procFindCohortDiaryTAB;&#10;--&#10;PROCEDURE procFindCohortDiary(&#10;    p_probation_area_ID   NUMBER,&#10;    p_sentence_date       DATE,&#10;    p_release_date        DATE,&#10;    p_offence_date        DATE,&#10;    p_team_id             NUMBER   DEFAULT NULL,&#10;    p_staff_id            NUMBER DEFAULT NULL,&#10;    --&#10;    p_max_rows             INTEGER DEFAULT 100000,&#10;    --&#10;    p_outcursor             OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ offender_ID,&#10;        /*01*/ first_name,&#10;        /*02*/ surname,&#10;        /*03*/ third_name,&#10;        /*04*/ current_highest_risk_colour,&#10;        /*05*/ current_exclusion,&#10;        /*06*/ current_restriction,&#10;        /*07*/ crn,&#10;        --&#10;        /*08*/ event_ID,&#10;        --&#10;        /*09*/ disposal_ID,&#10;        /*10*/ disposal_date,&#10;        /*11*/ termination_date,&#10;        --&#10;        /*12*/ first_release_date,&#10;        --&#10;        /*13*/ upw,&#10;        /*14*/ sentence_type,&#10;        /*15*/ cja2003,&#10;        /*16*/ pre_cja2003,&#10;        /*17*/ cohort,&#10;        --&#10;        /*18*/ probation_area_desc,&#10;        --&#10;        /*19*/ L1,&#10;        /*20*/ L2,&#10;        /*21*/ L3,&#10;        --&#10;        /*22*/ offender_manager_id,&#10;        /*23*/ main_offence_id,&#10;        /*24*/ probation_area_id,&#10;        /*25*/ trust_provider_flag,&#10;        /*26*/ trust_provider_team_id,&#10;        /*27*/ staff_employee_id,&#10;        /*28*/ disposal_type_id,&#10;        /*29*/ offence_date&#10;      FROM TABLE( PKG_CASELOAD.procFindCohortDiaryTAB(&#10;                      p_probation_area_ID &#61;&gt; p_probation_area_ID,&#10;                      p_sentence_date     &#61;&gt; p_sentence_date,&#10;                      p_release_date      &#61;&gt; p_release_date,&#10;                      p_offence_date      &#61;&gt; p_offence_date,&#10;                      p_team_id           &#61;&gt; p_team_id,&#10;                      p_staff_id          &#61;&gt; p_staff_id,&#10;                      --&#10;                      p_use_cohort_table  &#61;&gt; &#39;Y&#39;,&#10;                      --&#10;                      p_max_rows          &#61;&gt; p_max_rows ) )&#10;    ;&#10;    --&#10;END procFindCohortDiary;&#10;&#10;--&#10;-- Court Appearance Diary wrappers&#10;--&#10;FUNCTION procCourtAppDiaryTAB(&#10;    p_date                DATE,&#10;    p_appearance_type_id  NUMBER,&#10;    p_probation_area_ID   NUMBER   DEFAULT NULL,&#10;    p_court_id            NUMBER   DEFAULT NULL,&#10;    p_soft_deleted        SMALLINT DEFAULT 0,&#10;    --&#10;    p_max_rows            INTEGER DEFAULT 100000 )&#10;RETURN PKG_CASELOAD.ttabCourtAppDiary PIPELINED&#10;IS&#10;    l_tab PKG_CASELOAD.ttabCourtAppDiary;&#10;BEGIN&#10;      SELECT * BULK COLLECT INTO l_tab&#10;      FROM TABLE( PKG_CASELOAD.procCourtAppDiaryTAB(&#10;                      p_date               &#61;&gt; p_date,&#10;                      p_appearance_type_id &#61;&gt; p_appearance_type_id,&#10;                      p_probation_area_ID  &#61;&gt; p_probation_area_ID,&#10;                      p_court_id           &#61;&gt; p_court_id,&#10;                      p_soft_deleted       &#61;&gt; p_soft_deleted,&#10;                      --&#10;                      p_max_rows          &#61;&gt; p_max_rows ) );&#10;      --&#10;      FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;          PIPE ROW (l_tab(l_idx));&#10;      END LOOP;&#10;END procCourtAppDiaryTAB;&#10;&#10;PROCEDURE procCourtAppDiary(&#10;    p_date                DATE,&#10;    p_appearance_type_id  NUMBER,&#10;    p_probation_area_ID   NUMBER   DEFAULT NULL,&#10;    p_court_id            NUMBER   DEFAULT NULL,&#10;    p_soft_deleted        SMALLINT DEFAULT 0,&#10;    --&#10;    p_max_rows            INTEGER DEFAULT 100000,&#10;    --&#10;    p_outcursor        OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ court_appearance_id,&#10;        /*01*/ appearance_date,&#10;        /*02*/ court_name,&#10;        /*03*/ outcome_desc,&#10;        --&#10;        /*04*/ offender_id,&#10;        /*05*/ crn,&#10;        /*06*/ first_name,&#10;        /*07*/ second_name,&#10;        /*08*/ third_name,&#10;        /*09*/ surname,&#10;        /*10*/ date_of_birth,&#10;        --&#10;        /*11*/ current_highest_risk_colour,&#10;        /*12*/ current_exclusion,&#10;        /*13*/ current_restriction,&#10;        /*14*/ gender_desc,&#10;        /*15*/ current_tier_desc,&#10;        --&#10;        /*16*/ event_ID,&#10;        --&#10;        /*17*/ disposal_ID,&#10;        /*18*/ termination_date,&#10;        /*19*/ upw,&#10;        /*20*/ disposal_type_id,&#10;        /*21*/ sentence_type,&#10;        /*22*/ cja2003,&#10;        /*23*/ pre_cja2003&#10;      FROM TABLE( PKG_CASELOAD.procCourtAppDiaryTAB(&#10;                      p_date               &#61;&gt; p_date,&#10;                      p_appearance_type_id &#61;&gt; p_appearance_type_id,&#10;                      p_probation_area_ID  &#61;&gt; p_probation_area_ID,&#10;                      p_court_id           &#61;&gt; p_court_id,&#10;                      p_soft_deleted       &#61;&gt; p_soft_deleted,&#10;                      --&#10;                      p_max_rows          &#61;&gt; p_max_rows ) );&#10;    --&#10;END procCourtAppDiary;&#10;&#10;--&#10;-- Release Diary wrappers&#10;--&#10;FUNCTION procReleaseDiaryTAB(&#10;    p_team_id              NUMBER,&#10;    p_provider_team_id     NUMBER,&#10;    p_staff_id             NUMBER,&#10;    p_provider_employee_id NUMBER,&#10;    p_from_date            DATE,&#10;    p_to_date              DATE,&#10;    p_key_date_type_code   R_STANDARD_REFERENCE_LIST.code_value%TYPE,&#10;    p_max_rows             INTEGER DEFAULT 100000 )&#10;RETURN PKG_CASELOAD.ttabReleaseDiary PIPELINED&#10;IS&#10;    --&#10;    l_tab PKG_CASELOAD.ttabReleaseDiary;&#10;BEGIN&#10;      SELECT * BULK COLLECT INTO l_tab&#10;      FROM TABLE( PKG_CASELOAD.procReleaseDiaryTAB(&#10;                      p_team_id              &#61;&gt; p_team_id,&#10;                      p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                      p_staff_id             &#61;&gt; p_staff_id,&#10;                      p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                      p_from_date            &#61;&gt; p_from_date,&#10;                      p_to_date              &#61;&gt; p_to_date,&#10;                      p_key_date_type_code   &#61;&gt; p_key_date_type_code,&#10;                      --&#10;                      p_max_rows             &#61;&gt; p_max_rows ) );&#10;      --&#10;      FOR l_idx IN 1 .. l_tab.COUNT LOOP&#10;          PIPE ROW (l_tab(l_idx));&#10;      END LOOP;&#10;END procReleaseDiaryTAB;&#10;--&#10;PROCEDURE procReleaseDiary(&#10;    p_team_id              NUMBER,&#10;    p_provider_team_id     NUMBER,&#10;    p_staff_id             NUMBER,&#10;    p_provider_employee_id NUMBER,&#10;    p_from_date            DATE,&#10;    p_to_date              DATE,&#10;    p_key_date_type_code   R_STANDARD_REFERENCE_LIST.code_value%TYPE,&#10;    p_max_rows             INTEGER DEFAULT 100000,&#10;    p_outcursor        OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ offender_id,&#10;        /*01*/ key_date,&#10;        /*02*/ prisoner_number,&#10;        /*03*/ custody_id,&#10;        /*04*/ institution_name,&#10;        /*05*/ disposal_id,&#10;        /*06*/ disposal_date,&#10;        /*07*/ termination_date,&#10;        /*08*/ upw_order,&#10;        /*09*/ first_name,&#10;        /*10*/ surname,&#10;        /*11*/ third_name,&#10;        /*12*/ crn,&#10;        /*13*/ current_highest_risk_colour,&#10;        /*14*/ current_exclusion,&#10;        /*15*/ current_restriction,&#10;        /*16*/ event_id&#10;      FROM TABLE( PKG_CASELOAD.procReleaseDiaryTAB(&#10;                      p_team_id              &#61;&gt; p_team_id,&#10;                      p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                      p_staff_id             &#61;&gt; p_staff_id,&#10;                      p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                      p_from_date            &#61;&gt; p_from_date,&#10;                      p_to_date              &#61;&gt; p_to_date,&#10;                      p_key_date_type_code   &#61;&gt; p_key_date_type_code,&#10;                      p_max_rows             &#61;&gt; p_max_rows )&#10;                );&#10;    --&#10;END procReleaseDiary;&#10;&#10;--&#10;-- RAR Counts&#10;--&#10;PROCEDURE procTotalRARCount(&#10;    p_rar_code           R_RQMNT_TYPE_MAIN_CATEGORY.CODE%TYPE,&#10;    p_rqmnt_id           NUMBER,&#10;    p_outcursor           OUT SYS_REFCURSOR)&#10;AS&#10;BEGIN&#10;   OPEN p_outcursor FOR&#10;&#10;WITH R AS (&#10;      SELECT rqmnt_id&#10;      FROM rqmnt R1&#10;      WHERE R1.rqmnt_id &#61; p_rqmnt_id&#10;        AND R1.soft_deleted &#61; 0&#10;        AND EXISTS(&#10;            SELECT 1&#10;            FROM r_rqmnt_type_main_category&#10;            WHERE rqmnt_type_main_category_id &#61; R1.rqmnt_type_main_category_id&#10;              AND code &#61; p_rar_code )&#10;    ),&#10;    C AS (&#10;      SELECT DISTINCT (C1.contact_date)&#10;      FROM R, contact C1&#10;      WHERE 1&#61;1&#10;        AND C1.SOFT_DELETED &#61; 0&#10;        AND C1.rqmnt_id &#61; R.rqmnt_id&#10;        AND C1.rar_activity &#61; &#39;Y&#39;&#10;        AND (C1.attended &#61; &#39;Y&#39; OR C1.attended IS NULL)&#10;      UNION&#10;      SELECT DISTINCT (C1.contact_date)&#10;      FROM R, nsi N1, contact C1&#10;      WHERE 1&#61;1&#10;        AND C1.SOFT_DELETED &#61; 0&#10;        AND N1.rqmnt_id &#61; R.rqmnt_id&#10;        AND C1.nsi_id &#61; N1.nsi_id&#10;        AND C1.rar_activity &#61; &#39;Y&#39;&#10;        AND (C1.attended &#61; &#39;Y&#39; OR C1.attended IS NULL)&#10;    )&#10;    SELECT COUNT(DISTINCT contact_date)&#10;    FROM C;&#10;&#10;END procTotalRARCount;&#10;--&#10;--&#10;--&#10;FUNCTION procOffTransferRequestsTAB( p_offender_id NUMBER, p_establishment NUMBER DEFAULT 0 )&#10;RETURN ttabOffenderTransferRequest PIPELINED&#10;IS&#10;    --&#10;    lc_proc CONSTANT VARCHAR2(30) :&#61; &#39;procOffTransferRequestsTAB&#39;;&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    --&#10;    l_rec trecOffenderTransferRequest;&#10;    l_tab ttabOffenderTransferRequest;&#10;    --&#10;    l_user_name USER_.distinguished_name%TYPE;&#10;    --&#10;    l_SQL     CLOB;&#10;    l_cnt     INTEGER :&#61; 0;&#10;    --&#10;BEGIN&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    l_SQL :&#61;&#10;&#39;WITH L_OM AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;OM&#39;&#39;                 AS rec_level,  --OFFENDER&#10;    /*01*/ NULL                   AS start_date,&#10;    /*02*/ T1.description         AS team_desc,&#10;    /*03*/ S1.forename            AS staff_forename,&#10;    /*04*/ S1.surname             AS staff_surname,&#10;    /*05*/ PT1.name               AS provider_team_name,&#10;    /*06*/ PE1.forename           AS provider_employee_forename,&#10;    /*07*/ PE1.surname            AS provider_employee_surname,&#10;    /*08*/ P1.description         AS team_probation_area_desc,&#10;    /*19*/ PP1.description        AS provider_probation_area_desc,&#10;    /*10*/ NULL                   AS main_type_desc,&#10;    /*11*/ NULL                   AS sub_type_desc,&#10;    /*12*/ O.pending_transfer     AS pending_transfer,&#10;    /*13*/ NULL                   AS main_type_id,&#10;    /*14*/ NULL                   AS add_main_type_id,&#10;    /*15*/ NULL                   AS add_main_type_desc,&#10;    /*16*/ NULL                   AS add_sub_type_desc,&#10;    /*17*/ P1.probation_area_id   AS probation_area_id,&#10;    /*18*/ NULL                   AS provider_probation_area_id,&#10;    /*19*/ T1.team_id             AS team_id,&#10;    /*20*/ S1.staff_id            AS staff_id,&#10;    /*21*/ PT1.provider_team_id   AS provider_team_id,&#10;    /*22*/ PE1.provider_employee_id AS provider_employee_id,&#10;    --&#10;    /*23*/ O.offender_id          AS offender_id,&#10;    --&#10;    /*24*/ NULL                   AS nsi_id,&#10;    /*25*/ NULL                   AS nsi_event_id,&#10;    /*26*/ NULL                   AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                   AS event_id,&#10;    /*28*/ NULL                   AS event_number,&#10;    /*29*/ NULL                   AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                   AS rqmnt_id,&#10;    /*31*/ NULL                   AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                   AS lic_condition_id,&#10;    /*33*/ NULL                   AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                   AS pss_rqmnt_id,&#10;    /*35*/ NULL                   AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                   AS institutional_report_id,&#10;    /*37*/ NULL                   AS inst_rpt_custody_id,&#10;    /*38*/ NULL                   AS inst_rpt_date_completed,&#10;    /*39*/ NULL                   AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                   AS court_report_id,&#10;    /*41*/ NULL                   AS court_rep_completed_date,&#10;    /*42*/ NULL                   AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                   AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                   AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P1.SELECTABLE          AS source_probation_selectable&#10;  FROM&#10;    offender O&#10;      INNER JOIN offender_manager OM1 ON O.offender_id &#61; OM1.offender_id&#10;        LEFT OUTER JOIN team T1 ON OM1.team_id &#61; T1.team_id&#10;          LEFT OUTER JOIN probation_area P1 ON T1.probation_area_id &#61; P1.probation_area_id&#10;        LEFT OUTER JOIN staff S1 ON OM1.allocation_staff_id &#61; S1.staff_id&#10;        LEFT OUTER JOIN provider_team PT1 ON OM1.provider_team_id &#61; PT1.provider_team_id&#10;          LEFT OUTER JOIN probation_area PP1 ON PT1.probation_area_id &#61; PP1.probation_area_id&#10;        LEFT OUTER JOIN provider_employee PE1 ON OM1.provider_employee_id &#61; PE1.provider_employee_id&#10;  WHERE O.offender_id &#61; :p_offender_id&#10;    AND OM1.active_flag &#61; 1&#10;    AND O.soft_deleted &#61; 0&#10;    AND OM1.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0&#10;    ),&#10;--&#39; || &#39;&#10;L_NSI AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;NSI&#39;&#39;                    AS rec_level, -- OFFENDER NSI&#10;    /*01*/ N.referral_date            AS start_date,&#10;    /*02*/ T2.description             AS team_desc,&#10;    /*03*/ S2.forename                AS staff_forename,&#10;    /*04*/ S2.surname                 AS staff_surname,&#10;    /*05*/ NULL                       AS provider_team_name,&#10;    /*06*/ NULL                       AS provider_employee_forename,&#10;    /*07*/ NULL                       AS provider_employee_surname,&#10;    /*08*/ P2.description             AS team_probation_area_desc,&#10;    /*09*/ NULL                       AS provider_probation_area_desc,&#10;    /*10*/ NT.description             AS main_type_desc,&#10;    /*11*/ SR2.code_description       AS sub_type_desc,&#10;    /*12*/ N.pending_transfer,&#10;    /*13*/ N.nsi_type_id              AS main_type_id,&#10;    /*14*/ NULL                       AS add_main_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ P2.probation_area_id       AS probation_area_id,&#10;    /*18*/ NULL                       AS provider_probation_area_id,&#10;    /*19*/ T2.team_id                 AS team_id,&#10;    /*20*/ S2.staff_id                AS staff_id,&#10;    /*21*/ NULL                       AS provider_team_id,&#10;    /*22*/ NULL                       AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ N.nsi_id                   AS nsi_id,&#10;    /*25*/ N.event_id                 AS nsi_event_id,&#10;    /*26*/ N.actual_end_date          AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ NULL                       AS event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                       AS court_report_id,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NT.RATE_CARD_FLAG          AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P2.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    nsi N&#10;      INNER JOIN nsi_manager NM ON N.nsi_id &#61; NM.nsi_id&#10;        INNER JOIN team T2 ON NM.team_id &#61; T2.team_id&#10;          INNER JOIN probation_area P2 ON T2.probation_area_id &#61; P2.probation_area_id&#10;        INNER JOIN STAFF S2 ON NM.STAFF_ID &#61; S2.staff_id&#10;      INNER JOIN R_NSI_TYPE NT ON N.NSI_TYPE_ID &#61; NT.nsi_type_id&#10;      LEFT OUTER JOIN r_standard_reference_list SR2 ON N.nsi_sub_type_id &#61; SR2.standard_reference_list_id&#10;  WHERE N.offender_id &#61; :p_offender_id&#10;    AND NM.active_flag &#61; 1&#10;    AND N.event_id IS NULL&#10;    AND N.actual_end_date IS NULL&#10;    AND N.soft_deleted &#61; 0&#10;    AND NM.soft_deleted &#61; 0 ),&#10;--&#39; || &#39;&#10;L_EVENT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;EVENT&#39;&#39;                  AS rec_level, -- EVENT&#10;    /*01*/ D.disposal_date            AS start_date,&#10;    /*02*/ T3.description             AS team_desc,&#10;    /*03*/ S3.forename                AS staff_forename,&#10;    /*04*/ S3.surname                 AS staff_surname,&#10;    /*05*/ NULL                       AS provider_team_name,&#10;    /*06*/ NULL                       AS provider_employee_forename,&#10;    /*07*/ NULL                       AS provider_employee_surname,&#10;    /*08*/ P3.description             AS team_probation_area_desc,&#10;    /*09*/ NULL                       AS provider_probation_area_desc,&#10;    /*10*/ DT.description             AS main_type_desc,&#10;    /*11*/ NULL                       AS sub_type_desc,&#10;    /*12*/ E.pending_transfer,&#10;    /*13*/ D.disposal_type_id         AS main_type_id,&#10;    /*14*/ NULL                       AS add_main_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ P3.probation_area_id       AS probation_area_id,&#10;    /*18*/ NULL                       AS provider_probation_area_id,&#10;    /*19*/ T3.team_id                 AS team_id,&#10;    /*20*/ S3.staff_id                AS staff_id,&#10;    /*21*/ NULL                       AS provider_team_id,&#10;    /*22*/ NULL                       AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ NULL                       AS nsi_id,&#10;    /*25*/ NULL                       AS nsi_event_id,&#10;    /*26*/ NULL                       AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ E.event_id,&#10;    /*28*/ E.event_number,&#10;    /*29*/ D.termination_date         AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                       AS court_rep_id,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ SRL.code_description       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                       AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P3.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    event E&#10;      LEFT OUTER JOIN disposal D ON E.event_id &#61; D.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;      LEFT OUTER JOIN court_appearance CA ON CA.event_id &#61; E.event_id&#10;        AND CA.court_appearance_id &#61; PKG_Lookups.funcgetTabRecord(&#10;                                         p_table    &#61;&gt; &#39;&#39;COURT_APPEARANCE&#39;&#39;,&#10;                                         p_data_fld &#61;&gt; &#39;&#39;court_appearance_id&#39;&#39;,&#10;                                         p_ref_col  &#61;&gt; &#39;&#39;event_id&#39;&#39;,&#10;                                         p_ref_val  &#61;&gt;  TO_CHAR(E.event_id),&#10;                                         p_where    &#61;&gt; &#39;&#39;soft_deleted &#61; 0&#39;&#39;,&#10;                                         p_order_by &#61;&gt; &#39;&#39;appearance_date DESC, created_datetime DESC, court_appearance_id DESC&#39;&#39; )&#10;        --&#10;        LEFT OUTER JOIN r_standard_reference_list SRL ON SRL.standard_reference_list_id &#61; CA.appearance_type_id&#10;      INNER JOIN order_manager OM2 ON E.event_id &#61; OM2.event_id&#10;        INNER JOIN team T3 ON OM2.allocation_team_id &#61; T3.team_id&#10;          INNER JOIN probation_area P3 ON T3.probation_area_id &#61; P3.probation_area_id&#10;        INNER JOIN staff S3 ON OM2.allocation_staff_id &#61; S3.staff_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND OM2.active_flag &#61; 1&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND OM2.soft_deleted &#61; 0&#10;    AND E.active_flag &#61; 1&#10;    AND :p_establishment &#61; 0&#10;    ),&#10;--&#39; || &#39;&#10;L_RQMNT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;RQMNT&#39;&#39;                  AS rec_level, -- RQMNT&#10;    /*01*/ R.start_date               AS start_date,&#10;    /*02*/ T4.description             AS team_desc,&#10;    /*03*/ S4.forename                AS staff_forename,&#10;    /*04*/ S4.surname                 AS staff_surname,&#10;    /*05*/ PT4.name                   AS provider_team_name,&#10;    /*06*/ PE4.forename               AS provider_employee_forename,&#10;    /*07*/ PE4.surname                AS provider_employee_surname,&#10;    /*08*/ P4.description             AS team_probation_area_desc,&#10;    /*09*/ PP4.description            AS provider_probation_area_desc,&#10;    /*10*/ RT.description             AS main_type_desc,&#10;    /*11*/ SR4.code_description       AS sub_type_desc,&#10;    /*12*/ R.pending_transfer,&#10;    /*13*/ R.rqmnt_type_main_category_id      AS main_type_id,&#10;    /*14*/ ART.ad_rqmnt_type_main_category_id AS add_main_type_id,&#10;    /*15*/ ART.description                    AS add_main_type_desc,&#10;    /*16*/ ASR4.code_description              AS add_sub_type_desc,&#10;    /*17*/ P4.probation_area_id       AS probation_area_id,&#10;    /*18*/ PP4.probation_area_id      AS provider_probation_area_id,&#10;    /*19*/ T4.team_id                 AS team_id,&#10;    /*20*/ S4.staff_id                AS staff_id,&#10;    /*21*/ PT4.provider_team_id       AS provider_team_id,&#10;    /*22*/ PE4.provider_employee_id   AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ NULL                       AS nsi_id,&#10;    /*25*/ NULL                       AS nsi_event_id,&#10;    /*26*/ NULL                       AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ E.event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ R.rqmnt_id,&#10;    /*31*/ R.termination_date         AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                       AS court_rep_id,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                       AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P4.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        INNER JOIN rqmnt R ON R.disposal_id &#61; D.disposal_id&#10;          LEFT OUTER JOIN r_rqmnt_type_main_category RT ON R.rqmnt_type_main_category_id &#61; RT.rqmnt_type_main_category_id&#10;          LEFT OUTER JOIN r_standard_reference_list SR4 ON R.rqmnt_type_sub_category_id &#61; SR4.standard_reference_list_id&#10;          LEFT OUTER JOIN r_ad_rqmnt_type_main_category ART ON R.ad_rqmnt_type_main_category_id &#61; ART.ad_rqmnt_type_main_category_id&#10;          LEFT OUTER JOIN r_standard_reference_list ASR4 ON R.ad_rqmnt_type_sub_category_id &#61; ASR4.standard_reference_list_id&#10;          INNER JOIN rqmnt_manager RM ON R.rqmnt_id &#61; RM.rqmnt_id&#10;            LEFT OUTER JOIN team T4 ON RM.allocated_team_id &#61; T4.team_id&#10;              LEFT OUTER JOIN probation_area P4 ON T4.probation_area_id &#61; P4.probation_area_id&#10;            LEFT OUTER JOIN staff S4 ON RM.allocated_staff_id &#61; S4.staff_id&#10;            LEFT OUTER JOIN provider_team PT4 ON RM.provider_team_id &#61; PT4.provider_team_id&#10;              LEFT OUTER JOIN probation_area PP4 ON PT4.probation_area_id &#61; PP4.probation_area_id&#10;            LEFT OUTER JOIN provider_employee PE4 ON RM.provider_employee_id &#61; PE4.provider_employee_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND RM.active_flag &#61; 1&#10;    AND R.active_flag &#61; 1&#10;    AND E.soft_deleted &#61; 0&#10;    AND R.soft_deleted &#61; 0&#10;    AND RM.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0&#10;    ),&#10;--&#39; || &#39;&#10;L_LC AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;LC&#39;&#39;                      AS rec_level, -- LIC_CONDITION&#10;    /*01*/ lc.start_date               AS start_date,&#10;    /*02*/ t5.description              AS team_desc,&#10;    /*03*/ s5.forename                 AS staff_forename,&#10;    /*04*/ s5.surname                  AS staff_surname,&#10;    /*05*/ pt5.name                    AS provider_team_name,&#10;    /*06*/ pe5.forename                AS provider_employee_forename,&#10;    /*07*/ pe5.surname                 AS provider_employee_surname,&#10;    /*08*/ p5.description              AS team_probation_area_desc,&#10;    /*09*/ pp5.description             AS providerprobation_area_desc,&#10;    /*10*/ lt.description              AS main_type_desc,&#10;    /*11*/ sr5.code_description        AS sub_type_desc,&#10;    /*12*/ lc.pending_transfer,&#10;    /*13*/ lc.lic_cond_type_main_cat_id AS main_type_id,&#10;    /*14*/ NULL                       AS add_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ p5.probation_area_id       AS probation_area_id,&#10;    /*18*/ pp5.probation_area_id      AS provider_probation_area_id,&#10;    /*19*/ t5.team_id                 AS team_id,&#10;    /*20*/ s5.staff_id                AS staff_id,&#10;    /*21*/ pt5.provider_team_id       AS provider_team_id,&#10;    /*22*/ pe5.provider_employee_id   AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ NULL                       AS nsi_id,&#10;    /*25*/ NULL                       AS nsi_event_id,&#10;    /*26*/ NULL                       AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ E.event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ lc.lic_condition_id,&#10;    /*33*/ lc.termination_date        AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                       AS court_rep_id,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                       AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P5.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON E.event_id &#61; D.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;      INNER JOIN lic_condition LC ON LC.disposal_id &#61; D.disposal_id&#10;        LEFT OUTER JOIN r_lic_cond_type_main_cat LT ON LC.lic_cond_type_main_cat_id &#61; LT.lic_cond_type_main_cat_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR5 ON LC.lic_cond_type_sub_cat_id &#61; SR5.standard_reference_list_id&#10;        INNER JOIN lic_condition_manager LM ON LC.lic_condition_id &#61; LM.lic_condition_id&#10;          LEFT OUTER JOIN team T5 ON LM.team_id &#61; T5.team_id&#10;            LEFT OUTER JOIN probation_area P5 ON T5.probation_area_id &#61; P5.probation_area_id&#10;          LEFT OUTER JOIN staff S5 ON LM.staff_id &#61; S5.staff_id&#10;          LEFT OUTER JOIN provider_team PT5 ON LM.provider_team_id &#61; PT5.provider_team_id&#10;            LEFT OUTER JOIN probation_area PP5 ON PT5.probation_area_id &#61; PP5.probation_area_id&#10;          LEFT OUTER JOIN provider_employee PE5 ON LM.provider_employee_id &#61; PE5.provider_employee_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND LM.active_flag &#61; 1&#10;    AND LC.active_flag &#61; 1&#10;    AND E.soft_deleted &#61; 0&#10;    AND LC.soft_deleted &#61; 0&#10;    AND LM.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0&#10;    ),&#10;--&#39; || &#39;&#10;L_PSS_RQMNT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;PSS_RQMNT&#39;&#39;              AS rec_level, -- PSS_RQMNT&#10;    /*01*/ pss.imposed_date           AS start_date,&#10;    /*02*/ t6.description             AS team_desc,&#10;    /*03*/ s6.forename                AS staff_forename,&#10;    /*04*/ s6.surname                 AS staff_surname,&#10;    /*05*/ NULL                       AS provider_team_name,&#10;    /*06*/ NULL                       AS provider_employee_forename,&#10;    /*07*/ NULL                       AS provider_employee_surname,&#10;    /*08*/ p6.description             AS team_probation_area_desc,&#10;    /*09*/ NULL                       AS provider_probation_area_desc,&#10;    /*10*/ psst.description           AS main_type_desc,&#10;    /*11*/ st6.description            AS sub_type_desc,&#10;    /*12*/ pss.pending_transfer,&#10;    /*13*/ pss.pss_rqmnt_type_main_cat_id AS main_type_id,&#10;    /*14*/ NULL                       AS add_main_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ p6.probation_area_id       AS probation_area_id,&#10;    /*18*/ NULL                       AS provider_probation_area_id,&#10;    /*19*/ t6.team_id                 AS team_id,&#10;    /*20*/ s6.staff_id                AS staff_id,&#10;    /*21*/ NULL                       AS provider_team_id,&#10;    /*22*/ NULL                       AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ NULL                       AS nsi_id,&#10;    /*25*/ NULL                       AS nsi_event_id,&#10;    /*26*/ NULL                       AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ E.event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ pss.pss_rqmnt_id,&#10;    /*35*/ pss.termination_date       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                       AS court_rep_id,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                       AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P6.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON E.event_id &#61; D.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        INNER JOIN custody C ON C.disposal_id &#61; D.disposal_id&#10;          INNER JOIN pss_rqmnt PSS ON PSS.custody_id &#61; C.custody_id&#10;            LEFT OUTER JOIN r_pss_rqmnt_type_main_category PSST ON PSS.pss_rqmnt_type_main_cat_id &#61; PSST.pss_rqmnt_type_main_cat_id&#10;            LEFT OUTER JOIN r_pss_rqmnt_type_sub_category ST6 ON PSS.pss_rqmnt_type_sub_cat_id &#61; ST6.pss_rqmnt_type_sub_cat_id&#10;            INNER JOIN pss_rqmnt_manager PSSM ON PSS.pss_rqmnt_id &#61; PSSM.pss_rqmnt_id&#10;              LEFT OUTER JOIN team T6 ON PSSM.team_id &#61; T6.team_id&#10;                LEFT OUTER JOIN probation_area P6 ON T6.probation_area_id &#61; P6.probation_area_id&#10;              LEFT OUTER JOIN staff S6 ON PSSM.staff_id &#61; S6.staff_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND PSSM.active_flag &#61; 1&#10;    AND PSS.active_flag &#61; 1&#10;    AND E.soft_deleted &#61; 0&#10;    AND C.soft_deleted &#61; 0&#10;    AND PSS.soft_deleted &#61; 0&#10;    AND PSSM.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0&#10;    ),&#10;--&#39; || &#39;&#10;L_EVENT_NSI AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;NSI_EVENT&#39;&#39;              AS rec_level, -- EVENT NSI&#10;    /*01*/ n.referral_date            AS start_date,&#10;    /*02*/ t7.description             AS team_desc,&#10;    /*03*/ s7.forename                AS staff_forename,&#10;    /*04*/ s7.surname                 AS staff_surname,&#10;    /*05*/ NULL                       AS provider_team_name,&#10;    /*06*/ NULL                       AS provider_employee_forename,&#10;    /*07*/ NULL                       AS provider_employee_surname,&#10;    /*08*/ p7.description             AS team_probation_area_desc,&#10;    /*09*/ NULL                       AS provider_probation_area_desc,&#10;    /*10*/ nt.description             AS main_type_desc,&#10;    /*11*/ sr7.code_description       AS sub_type_desc,&#10;    /*12*/ n.pending_transfer,&#10;    /*13*/ n.nsi_type_id              AS main_type_id,&#10;    /*14*/ NULL                       AS add_main_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ p7.probation_area_id       AS probation_area_id,&#10;    /*18*/ NULL                       AS provider_probation_area_id,&#10;    /*19*/ t7.team_id                 AS team_id,&#10;    /*20*/ s7.staff_id                AS staff_id,&#10;    /*21*/ NULL                       AS provider_team_id,&#10;    /*22*/ NULL                       AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ n.nsi_id,&#10;    /*25*/ n.event_id                 AS nsi_event_id,&#10;    /*26*/ n.actual_end_date          AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ E.event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                       AS court_rep_id,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NT.RATE_CARD_FLAG          AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P7.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    event E&#10;      INNER JOIN nsi N ON N.event_id &#61; E.event_id&#10;        INNER JOIN r_nsi_type NT ON N.nsi_type_id &#61; NT.nsi_type_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR7 ON N.nsi_sub_type_id &#61; SR7.standard_reference_list_id&#10;        INNER JOIN nsi_manager NM ON N.nsi_id &#61; NM.nsi_id&#10;          INNER JOIN team T7 ON NM.team_id &#61; T7.team_id&#10;            INNER JOIN probation_area P7 ON T7.probation_area_id &#61; P7.probation_area_id&#10;          INNER JOIN staff S7 ON NM.staff_id &#61; S7.staff_id&#10;  WHERE N.offender_id &#61; :p_offender_id&#10;    AND NM.active_flag &#61; 1&#10;    AND N.actual_end_date IS NULL&#10;    AND E.soft_deleted &#61; 0&#10;    AND N.soft_deleted &#61; 0&#10;    AND NM.soft_deleted &#61; 0 ),&#10;--&#39; || &#39;&#10;L_INST_REP AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;INST_RPT&#39;&#39;               AS rec_level, -- INSTITUTIONAL REPORT&#10;    /*01*/ ir.date_requested          AS start_date,&#10;    /*02*/ t8.description             AS team_desc,&#10;    /*03*/ s8.forename                AS staff_forename,&#10;    /*04*/ s8.surname                 AS staff_surname,&#10;    /*05*/ pt8.name                   AS provider_team_name,&#10;    /*06*/ pe8.forename               AS provider_employee_forename,&#10;    /*07*/ pe8.surname                AS provider_employee_surname,&#10;    /*08*/ p8.description             AS team_probation_area_desc,&#10;    /*09*/ pp8.description            AS provider_probation_area_desc,&#10;    /*10*/ sr8.code_description       AS main_type_desc,&#10;    /*11*/ NULL                       AS sub_type_desc,&#10;    /*12*/ ir.pending_transfer,&#10;    /*13*/ ir.institution_report_type_id,&#10;    /*14*/ NULL                       AS add_main_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ p8.probation_area_id       AS probation_area_id,&#10;    /*18*/ pp8.probation_area_id      AS provider_probation_area_id,&#10;    /*19*/ t8.team_id                 AS team_id,&#10;    /*20*/ s8.staff_id                AS staff_id,&#10;    /*21*/ pt8.provider_team_id       AS provider_team_id,&#10;    /*22*/ pe8.provider_employee_id   AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ NULL                       AS nsi_id,&#10;    /*25*/ NULL                       AS nsi_event_id,&#10;    /*26*/ NULL                       AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ E.event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ ir.institutional_report_id,&#10;    /*37*/ ir.custody_id              AS inst_rpt_custody_id,&#10;    /*38*/ ir.date_completed          AS inst_rpt_date_completed,&#10;    /*39*/ ir.date_abandoned          AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL                       AS court_rep_id,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                       AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P8.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        INNER JOIN custody C ON C.disposal_id &#61; D.disposal_id&#10;          INNER JOIN institutional_report IR ON IR.custody_id &#61; C.custody_id&#10;            INNER JOIN r_standard_reference_list SR8 ON IR.institution_report_type_id &#61; SR8.standard_reference_list_id&#10;            INNER JOIN report_manager IRM ON IR.institutional_report_id &#61; IRM.institutional_report_id&#10;              LEFT OUTER JOIN team T8 ON IRM.team_id &#61; T8.team_id&#10;                LEFT OUTER JOIN probation_area P8 ON T8.probation_area_id &#61; P8.probation_area_id&#10;              LEFT OUTER JOIN staff S8 ON IRM.staff_id &#61; S8.staff_id&#10;            LEFT OUTER JOIN provider_team PT8 ON IRM.provider_team_id &#61; PT8.provider_team_id&#10;              LEFT OUTER JOIN probation_area PP8 ON PT8.probation_area_id &#61; PP8.probation_area_id&#10;            LEFT OUTER JOIN provider_employee PE8 ON IRM.provider_employee_id &#61; PE8.provider_employee_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    -- IR check&#10;    AND IR.date_sent IS NULL&#10;    AND IR.date_abandoned IS NULL&#10;    --&#10;    AND IRM.active_flag &#61; 1&#10;    AND E.soft_deleted &#61; 0&#10;    AND C.soft_deleted &#61; 0&#10;    AND IR.soft_deleted &#61; 0&#10;    AND E.active_flag &#61; 1&#10;    AND IRM.soft_deleted &#61; 0 ),&#10;--&#39; || &#39;&#10;L_COURT_REPORT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;COURT_RPT&#39;&#39;              AS rec_level, -- COURT REPORT&#10;    /*01*/ cr.date_requested          AS start_date,&#10;    /*02*/ t9.description             AS team_desc,&#10;    /*03*/ s9.forename                AS staff_forename,&#10;    /*04*/ s9.surname                 AS staff_surname,&#10;    /*05*/ pt9.name                   AS provider_team_name,&#10;    /*06*/ pe9.forename               AS provider_employee_forename,&#10;    /*07*/ pe9.surname                AS provider_employee_surname,&#10;    /*08*/ p9.description             AS team_probation_area_desc,&#10;    /*09*/ pp9.description            AS provider_probation_area_desc,&#10;    /*10*/ crr.description            AS main_type_desc,&#10;    /*11*/ NULL                       AS sub_type_desc,&#10;    /*12*/ cr.pending_transfer,&#10;    /*13*/ cr.court_report_type_id    AS main_type_id,&#10;    /*14*/ NULL                       AS add_main_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ p9.probation_area_id       AS probation_area_id,&#10;    /*18*/ pp9.probation_area_id      AS provider_probation_area_id,&#10;    /*19*/ t9.team_id                 AS team_id,&#10;    /*20*/ s9.staff_id                AS staff_id,&#10;    /*21*/ pt9.provider_team_id       AS provider_team_id,&#10;    /*22*/ pe9.provider_employee_id   AS provider_employee_id,&#10;    --&#10;    /*23*/ NULL                       AS offender_id,&#10;    --&#10;    /*24*/ NULL                       AS nsi_id,&#10;    /*25*/ NULL                       AS nsi_event_id,&#10;    /*26*/ NULL                       AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ E.event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ cr.court_report_id,&#10;    /*41*/ cr.completed_date          AS court_rep_completed_date,&#10;    /*42*/ cr.received_by_court_date  AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                       AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P9.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    event E&#10;        INNER JOIN court_appearance CA ON CA.event_id &#61; E.event_id&#10;          INNER JOIN court_report CR ON CR.court_appearance_id &#61; CA.court_appearance_id&#10;            LEFT OUTER JOIN r_court_report_type CRR ON CR.court_report_type_id &#61; CRR.court_report_type_id&#10;          INNER JOIN report_manager CRM ON CR.court_report_id &#61; CRM.court_report_id&#10;            LEFT OUTER JOIN team T9 ON CRM.team_id &#61; T9.team_id&#10;              LEFT OUTER JOIN probation_area P9 ON T9.probation_area_id &#61; P9.probation_area_id&#10;            LEFT OUTER JOIN staff S9 ON CRM.staff_id &#61; S9.staff_id&#10;            LEFT OUTER JOIN provider_team PT9 ON CRM.provider_team_id &#61; PT9.provider_team_id&#10;              LEFT OUTER JOIN probation_area PP9 ON PT9.probation_area_id &#61; PP9.probation_area_id&#10;            LEFT OUTER JOIN provider_employee PE9 ON CRM.provider_employee_id &#61; PE9.provider_employee_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND CR.sent_to_court_date IS NULL&#10;    AND ( CR.delivered_court_report_type_id IS NULL&#10;          OR&#10;          CR.delivered_court_report_type_id !&#61; (SELECT CRT.court_report_type_id FROM r_court_report_type CRT WHERE CRT.code &#61; &#39;&#39;NIL&#39;&#39;) )&#10;    AND CRM.active_flag &#61; 1&#10;    AND E.soft_deleted &#61; 0&#10;    AND CA.soft_deleted &#61; 0&#10;    AND CR.soft_deleted &#61; 0&#10;    AND CRM.soft_deleted &#61; 0&#10;    AND E.active_flag &#61; 1&#10;    AND :p_establishment &#61; 0&#10;  ),&#10;--&#39; ||&#10;&#39;&#10;L_POM AS (&#10;SELECT&#10;    /*00*/ &#39;&#39;POM&#39;&#39;                    AS rec_level, -- POM&#10;    /*01*/ pom.ALLOCATION_DATE        AS start_date,&#10;    /*02*/ t9.description             AS team_desc,&#10;    /*03*/ s9.forename                AS staff_forename,&#10;    /*04*/ s9.surname                 AS staff_surname,&#10;    /*05*/ NULL                       AS provider_team_name,&#10;    /*06*/ NULL                       AS provider_employee_forename,&#10;    /*07*/ NULL                       AS provider_employee_surname,&#10;    /*08*/ p9.description             AS team_probation_area_desc,&#10;    /*09*/ NULL                       AS provider_probation_area_desc,&#10;    /*10*/ NULL                       AS main_type_desc,&#10;    /*11*/ NULL                       AS sub_type_desc,&#10;    /*12*/ 0                          as pending_transfer,&#10;    /*13*/ NULL                       AS main_type_id,&#10;    /*14*/ NULL                       AS add_main_type_id,&#10;    /*15*/ NULL                       AS add_main_type_desc,&#10;    /*16*/ NULL                       AS add_sub_type_desc,&#10;    /*17*/ p9.probation_area_id       AS probation_area_id,&#10;    /*18*/ NULL                       AS provider_probation_area_id,&#10;    /*19*/ t9.team_id                 AS team_id,&#10;    /*20*/ s9.staff_id                AS staff_id,&#10;    /*21*/ NULL                       AS provider_team_id,&#10;    /*22*/ NULL                       AS provider_employee_id,&#10;    --&#10;    /*23*/ O.offender_id              AS offender_id,&#10;    --&#10;    /*24*/ NULL                       AS nsi_id,&#10;    /*25*/ NULL                       AS nsi_event_id,&#10;    /*26*/ NULL                       AS nsi_actual_end_date,&#10;    --&#10;    /*27*/ NULL                       AS event_id,&#10;    /*28*/ NULL                       as event_number,&#10;    /*29*/ NULL                       AS event_termination_date,&#10;    --&#10;    /*30*/ NULL                       AS rqmnt_id,&#10;    /*31*/ NULL                       AS rqmnt_termination_date,&#10;    --&#10;    /*32*/ NULL                       AS lic_condition_id,&#10;    /*33*/ NULL                       AS lic_termination_date,&#10;    --&#10;    /*34*/ NULL                       AS pss_rqmnt_id,&#10;    /*35*/ NULL                       AS pss_termination_date,&#10;    --&#10;    /*36*/ NULL                       AS institutional_report_id,&#10;    /*37*/ NULL                       AS inst_rpt_custody_id,&#10;    /*38*/ NULL                       AS inst_rpt_date_completed,&#10;    /*39*/ NULL                       AS inst_rpt_date_abandoned,&#10;    --&#10;    /*40*/ NULL,&#10;    /*41*/ NULL                       AS court_rep_completed_date,&#10;    /*42*/ NULL                       AS court_rep_received_by_date,&#10;    --&#10;    /*43*/ NULL                       AS court_app_type_desc,&#10;    --&#10;    /*44*/ NULL                       AS nsi_rate_card_flag,&#10;    --&#10;    /*45*/ P9.SELECTABLE              AS source_probation_selectable&#10;  FROM&#10;    prison_offender_manager POM&#10;      INNER JOIN offender O on O.offender_id &#61; POM.offender_id&#10;      LEFT OUTER JOIN team T9 ON T9.team_id &#61; POM.allocation_team_id&#10;        LEFT OUTER JOIN probation_area P9 ON P9.probation_area_id &#61; T9.probation_area_id&#10;      LEFT OUTER JOIN staff S9 ON S9.staff_id &#61; POM.allocation_staff_id&#10;  WHERE POM.offender_id &#61; :p_offender_id&#10;    AND POM.end_date IS NULL&#10;    AND POM.active_flag &#61; 1&#10;    AND POM.soft_deleted &#61; 0&#10;    AND O.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 1&#10;    AND EXISTS(&#10;        SELECT 1&#10;        FROM&#10;          event E&#10;            INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1&#10;              INNER JOIN custody CUS ON CUS.disposal_id &#61; D.disposal_id&#10;                INNER JOIN r_standard_reference_list CUSS ON CUSS.standard_reference_list_id &#61; CUS.custodial_status_id&#10;        WHERE 1&#61;1&#10;          AND E.offender_id &#61; POM.offender_id&#10;          AND CUSS.code_value NOT IN ( &#39;&#39;P&#39;&#39; /*Post Sentence Supervision*/ )&#10;          AND E.soft_deleted &#61; 0 )&#10;    ),&#10;--&#39;&#10;|| &#39;&#10;T AS (&#10;  SELECT * FROM L_OM          UNION ALL&#10;  SELECT * FROM L_NSI         UNION ALL&#10;  SELECT * FROM L_EVENT       UNION ALL&#10;  SELECT * FROM L_RQMNT       UNION ALL&#10;  SELECT * FROM L_LC          UNION ALL&#10;  SELECT * FROM L_PSS_RQMNT   UNION ALL&#10;  SELECT * FROM L_EVENT_NSI   UNION ALL&#10;  SELECT * FROM L_INST_REP    UNION ALL&#10;  SELECT * FROM L_COURT_REPORT UNION ALL&#10;  SELECT * FROM L_POM)&#10;--&#10;SELECT *&#10;FROM T&#10;ORDER BY&#10;  LPAD(NVL(T.event_number, &#39;&#39;0&#39;&#39;), 3),&#10;  DECODE( T.rec_level,&#10;      &#39;&#39;OM&#39;&#39;       , 1,&#10;      &#39;&#39;NSI&#39;&#39;      , 2,&#10;      &#39;&#39;EVENT&#39;&#39;    , 3,&#10;      &#39;&#39;RQMNT&#39;&#39;    , 4,&#10;      &#39;&#39;LC&#39;&#39;       , 5,&#10;      &#39;&#39;PSS_RQMNT&#39;&#39;, 6,&#10;      &#39;&#39;NSI_EVENT&#39;&#39;, 7,&#10;      &#39;&#39;INST_RPT&#39;&#39; , 8,&#10;      &#39;&#39;COURT_RPT&#39;&#39;, 9,&#10;      &#39;&#39;POM&#39;&#39;      , 10,&#10;      11 ),&#10;  T.start_date&#39;;&#10;    --&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      p_offender_id, p_establishment, p_offender_id, p_offender_id, p_establishment,&#10;      p_offender_id, p_establishment, p_offender_id, p_establishment, p_offender_id, p_establishment,&#10;      p_offender_id, p_offender_id, p_offender_id, p_establishment, p_offender_id, p_establishment&#10;    ;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab;&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_cnt :&#61; l_cnt + 1;&#10;        PIPE ROW ( l_tab(l_i) );&#10;    END LOOP;&#10;    --&#10;    procDebug( lc_proc || &#39; (rows&#61;&#39; || l_tab.COUNT  || &#39;)&#39;   ||&#10;        &#39;(&#39; || PKG_Debug.funcgetDbStats       || &#39;): &#39; ||&#10;        &#39;(p_offender_id&#61;&#39; || p_offender_id    || &#39;)&#39;   ||&#10;        l_SQL );&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_NEEDED THEN&#10;        procDebug( lc_proc || &#39; (&#39; || l_cnt || &#39; of &#39; || l_tab.COUNT || &#39; rows called from the cursor)&#39; ||&#10;            &#39;(&#39; || PKG_Debug.funcgetDbStats       || &#39;): &#39; ||&#10;            &#39;(p_offender_id&#61;&#39; || p_offender_id    || &#39;)&#39;   ||&#10;            l_SQL );&#10;    WHEN OTHERS THEN&#10;        procDebug( lc_proc || &#39; ERROR: &#39; || SQLERRM || &#39; &#39; ||&#10;            &#39;(p_offender_id&#61;&#39; || p_offender_id    || &#39;)&#39;   ||&#10;            l_SQL );&#10;        RAISE;&#10;END procOffTransferRequestsTAB;&#10;--&#10;PROCEDURE procOffenderTransferRequests(&#10;    p_offender_id   NUMBER,&#10;    p_establishment NUMBER DEFAULT 0,&#10;    p_outcursor     OUT SYS_REFCURSOR)&#10;AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ rec_level,&#10;        /*01*/ start_date,&#10;        /*02*/ team_desc,&#10;        /*03*/ staff_forename,&#10;        /*04*/ staff_surname,&#10;        /*05*/ provider_team_name,&#10;        /*06*/ provider_employee_forename,&#10;        /*07*/ provider_employee_surname,&#10;        /*08*/ team_probation_area_desc,&#10;        /*19*/ provider_probation_area_desc,&#10;        /*10*/ main_type_desc,&#10;        /*11*/ sub_type_desc,&#10;        /*12*/ pending_transfer,&#10;        /*13*/ main_type_id,&#10;        /*14*/ add_main_type_id,&#10;        /*15*/ add_main_type_desc,&#10;        /*16*/ add_sub_type_desc,&#10;        /*17*/ probation_area_id,&#10;        /*18*/ provider_probation_area_id,&#10;        /*19*/ team_id,&#10;        /*20*/ staff_id,&#10;        /*21*/ provider_team_id,&#10;        /*22*/ provider_employee_id,&#10;        --&#10;        /*23*/ offender_id,&#10;        --&#10;        /*24*/ nsi_id,&#10;        /*25*/ nsi_event_id,&#10;        /*26*/ nsi_actual_end_date,&#10;        --&#10;        /*27*/ event_id,&#10;        /*28*/ event_number,&#10;        /*29*/ event_termination_date,&#10;        --&#10;        /*30*/ rqmnt_id,&#10;        /*31*/ rqmnt_termination_date,&#10;        --&#10;        /*32*/ lic_condition_id,&#10;        /*33*/ lic_cond_termination_date,&#10;        --&#10;        /*34*/ pss_rqmnt_id,&#10;        /*35*/ pss_termination_date,&#10;        --&#10;        /*36*/ institutional_report_id,&#10;        /*37*/ inst_rpt_custody_id,&#10;        /*38*/ inst_rpt_date_completed,&#10;        /*39*/ inst_rpt_date_abandoned,&#10;        --&#10;        /*40*/ court_report_id,&#10;        /*41*/ court_rep_completed_date,&#10;        /*42*/ court_rep_received_by_date,&#10;        /*43*/ court_app_type_desc,&#10;        /*44*/ nsi_rate_card_flag,&#10;        /*45*/ source_probation_selectable&#10;      FROM TABLE( PKG_Search.procOffTransferRequestsTAB( p_offender_id&#61;&gt;p_offender_id, p_establishment&#61;&gt;p_establishment ) );&#10;    --&#10;END procOffenderTransferRequests;&#10;--&#10;--&#10;FUNCTION procOffTransferReviewsTAB( p_offender_id NUMBER, p_establishment number default 0 )&#10;RETURN ttabOffenderTransferReview PIPELINED&#10;IS&#10;    --&#10;    lc_proc CONSTANT VARCHAR2(30) :&#61; &#39;procOffTransferReviewsTAB&#39;;&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    --&#10;    l_rec trecOffenderTransferReview;&#10;    l_tab ttabOffenderTransferReview;&#10;    --&#10;    l_user_name USER_.distinguished_name%TYPE;&#10;    --&#10;    l_SQL     CLOB;&#10;    l_cnt     INTEGER :&#61; 0;&#10;    --&#10;BEGIN&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    l_SQL :&#61;&#10;&#39;WITH L_OM AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;OM&#39;&#39;                               AS rec_level,  --OFFENDER&#10;    /*01*/ OT.request_date                      AS request_date,&#10;    /*02*/ T1.description                       AS team_desc,&#10;    /*03*/ S1.forename                          AS staff_forename,&#10;    /*04*/ S1.surname                           AS staff_surname,&#10;    /*05*/ PT1.name                             AS provider_team_name,&#10;    /*06*/ PE1.forename                         AS provider_employee_forename,&#10;    /*07*/ PE1.surname                          AS provider_employee_surname,&#10;    /*08*/ P1.description                       AS team_probation_area_desc,&#10;    /*09*/ PP1.description                      AS provider_probation_area_desc,&#10;    /*10*/ NULL                                 AS main_type_desc,&#10;    /*11*/ NULL                                 AS sub_type_desc,&#10;    /*12*/ NULL                                 AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P1.probation_area_id                 AS probation_area_id,&#10;    /*17*/ NULL                                 AS provider_probation_area_id,&#10;    /*18*/ T1.team_id                           AS team_id,&#10;    /*19*/ S1.staff_id                          AS staff_id,&#10;    /*20*/ PT1.provider_team_id                 AS provider_team_id,&#10;    /*21*/ PE1.provider_employee_id             AS provider_employee_id,&#10;    /*22*/ OT.offender_transfer_id              AS transfer_id,&#10;    /*23*/ OT.allocation_reason_id              AS allocation_reason_id,&#10;    /*24*/ SRTR1.code_description               AS allocation_reason_desc,&#10;    --&#10;    /*25*/ OT.receiving_team_id                 AS receiving_team_id,&#10;    /*26*/ RECT1.description                    AS receiving_team_desc,&#10;    /*27*/ OT.receiving_staff_id                AS receiving_staff_id,&#10;    /*28*/ RECS1.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS1.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP1.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP1.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ O.offender_id                        AS offender_id,&#10;    --&#10;    /*33*/ NULL                                 AS nsi_id,&#10;    /*34*/ NULL                                 AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ NULL                                 AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ NULL                                 AS disposal_id,&#10;    /*44*/ NULL                                 AS termination_date,&#10;    /*45*/ NULL                                 AS upw,&#10;    /*46*/ NULL                                 AS sentence_type,&#10;    /*47*/ NULL                                 AS cja2003,&#10;    /*48*/ NULL                                 AS pre_cja2003,&#10;    /*49*/ NULL                                 AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NULL                                 AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ OT.NOTES                             AS transfer_notes,&#10;    /*53*/ RECPSA1.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    offender O&#10;      INNER JOIN offender_manager OM1 ON O.offender_id &#61; OM1.offender_id AND OM1.active_flag &#61; 1&#10;        LEFT OUTER JOIN team T1 ON OM1.team_id &#61; T1.team_id&#10;          LEFT OUTER JOIN probation_area P1 ON T1.probation_area_id &#61; P1.probation_area_id&#10;        LEFT OUTER JOIN staff S1 ON OM1.allocation_staff_id &#61; S1.staff_id&#10;        LEFT OUTER JOIN provider_team PT1 ON OM1.provider_team_id &#61; PT1.provider_team_id&#10;          LEFT OUTER JOIN probation_area PP1 ON PT1.probation_area_id &#61; PP1.probation_area_id&#10;        LEFT OUTER JOIN provider_employee PE1 ON OM1.provider_employee_id &#61; PE1.provider_employee_id&#10;      INNER JOIN offender_transfer OT ON O.offender_id &#61; OT.offender_id&#10;        LEFT OUTER JOIN r_standard_reference_list SRTR1 ON OT.allocation_reason_id &#61; SRTR1.standard_reference_list_id&#10;        LEFT OUTER JOIN team RECT1 ON OT.receiving_team_id &#61; RECT1.team_id&#10;          LEFT OUTER JOIN probation_area RECP1 ON RECT1.probation_area_id &#61; RECP1.probation_area_id&#10;        LEFT OUTER JOIN staff RECS1 ON OT.receiving_staff_id &#61; RECS1.staff_id&#10;        LEFT OUTER JOIN r_standard_reference_list RECPSA1 ON RECP1.SPG_ACTIVE_ID &#61; RECPSA1.standard_reference_list_id&#10;    WHERE O.offender_id &#61; :p_offender_id&#10;      AND O.pending_transfer &#61; 1&#10;      AND OT.accepted_decision_id IS NULL&#10;      AND OT.rejection_reason_id IS NULL&#10;      AND OT.withdrawal_reason_id IS NULL&#10;      --&#10;      AND O.soft_deleted &#61; 0&#10;      AND OM1.soft_deleted &#61; 0&#10;      AND OT.soft_deleted &#61; 0&#10;      AND :p_establishment &#61; 0 ),&#10;--&#39; || &#39;&#10;L_NSI AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;NSI&#39;&#39;                              AS rec_level, -- OFFENDER NSI&#10;    /*01*/ NSIT.request_date                    AS request_date,&#10;    /*02*/ T2.description                       AS team_desc,&#10;    /*03*/ S2.forename                          AS staff_forename,&#10;    /*04*/ S2.surname                           AS staff_surname,&#10;    /*05*/ NULL                                 AS provider_team_name,&#10;    /*06*/ NULL                                 AS provider_employee_forename,&#10;    /*07*/ NULL                                 AS provider_employee_surname,&#10;    /*08*/ P2.description                       AS team_probation_area_desc,&#10;    /*09*/ NULL                                 AS provider_probation_area_desc,&#10;    /*10*/ NT.description                       AS main_type_desc,&#10;    /*11*/ SR2.code_description                 AS sub_type_desc,&#10;    /*12*/ N.nsi_type_id                        AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P2.probation_area_id                 AS probation_area_id,&#10;    /*17*/ NULL                                 AS provider_probation_area_id,&#10;    /*18*/ T2.team_id                           AS team_id,&#10;    /*19*/ S2.staff_id                          AS staff_id,&#10;    /*20*/ NULL                                 AS provider_team_id,&#10;    /*21*/ NULL                                 AS provider_employee_id,&#10;    /*22*/ NSIT.nsi_transfer_id                 AS transfer_id,&#10;    /*23*/ NSIT.allocation_reason_id            AS allocation_reason_id,&#10;    /*24*/ SRTR2.code_description               AS allocation_reason_desc,&#10;    /*25*/ NSIT.target_team_id                  AS receiving_team_id,&#10;    /*26*/ RECT2.description                    AS receiving_team_desc,&#10;    /*27*/ NSIT.target_staff_id                 AS receiving_staff_id,&#10;    /*28*/ RECS2.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS2.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP2.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP2.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ N.nsi_id                             AS nsi_id,&#10;    /*34*/ N.event_id                           AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ NULL                                 AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ NULL                                 AS disposal_id,&#10;    /*44*/ NULL                                 AS termination_date,&#10;    /*45*/ NULL                                 AS upw,&#10;    /*46*/ NULL                                 AS sentence_type,&#10;    /*47*/ NULL                                 AS cja2003,&#10;    /*48*/ NULL                                 AS pre_cja2003,&#10;    /*49*/ NULL                                 AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NT.RATE_CARD_FLAG                    AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ NSIT.NOTES                           AS transfer_notes,&#10;    /*53*/ RECPSA2.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    nsi N&#10;      INNER JOIN r_nsi_type NT ON N.nsi_type_id &#61; NT.nsi_type_id&#10;      LEFT OUTER JOIN r_standard_reference_list SR2 ON N.nsi_sub_type_id &#61; SR2.standard_reference_list_id&#10;      INNER JOIN nsi_manager NM ON N.nsi_id &#61; NM.nsi_id AND NM.active_flag &#61; 1&#10;        INNER JOIN team T2 ON NM.team_id &#61; T2.team_id&#10;          INNER JOIN probation_area P2 ON T2.probation_area_id &#61; P2.probation_area_id&#10;        INNER JOIN staff S2 ON NM.staff_id &#61; S2.staff_id&#10;      INNER JOIN nsi_transfer NSIT ON N.nsi_id &#61; NSIT.nsi_id&#10;        LEFT OUTER JOIN r_standard_reference_list SRTR2 ON NSIT.allocation_reason_id &#61; SRTR2.standard_reference_list_id&#10;        INNER JOIN team RECT2 ON NSIT.target_team_id &#61; RECT2.team_id&#10;        INNER JOIN staff RECS2 ON NSIT.target_staff_id &#61; RECS2.staff_id&#10;          INNER JOIN probation_area RECP2 ON RECT2.probation_area_id &#61; RECP2.probation_area_id&#10;          LEFT OUTER JOIN r_standard_reference_list RECPSA2 ON RECP2.SPG_ACTIVE_ID &#61; RECPSA2.standard_reference_list_id&#10;  WHERE N.offender_id &#61; :p_offender_id&#10;    AND N.event_id IS NULL&#10;    AND N.actual_end_date IS NULL&#10;    AND N.pending_transfer &#61; 1&#10;    AND NSIT.accepted_decision_id IS NULL&#10;    AND NSIT.rejection_reason_id IS NULL&#10;    AND NSIT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND N.soft_deleted &#61; 0&#10;    AND NM.soft_deleted &#61; 0&#10;    AND NSIT.soft_deleted &#61; 0&#10;    AND ((:p_establishment &#61; 0 AND RECP2.institution_id IS NULL) OR (:p_establishment &#61; 1 AND RECP2.institution_id IS NOT NULL))),&#10;--&#39; || &#39;&#10;L_EVENT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;EVENT&#39;&#39;                            AS rec_level, -- event&#10;    /*01*/ ORT.request_date                     AS request_date,&#10;    /*02*/ T3.description                       AS team_desc,&#10;    /*03*/ S3.forename                          AS staff_forename,&#10;    /*04*/ S3.surname                           AS staff_surname,&#10;    /*05*/ NULL                                 AS provider_team_name,&#10;    /*06*/ NULL                                 AS provider_employee_forename,&#10;    /*07*/ NULL                                 AS provider_employee_surname,&#10;    /*08*/ P3.description                       AS team_probation_area_desc,&#10;    /*09*/ NULL                                 AS provider_probation_area_desc,&#10;    /*10*/ DT.description                       AS main_type_desc,&#10;    /*11*/ NULL                                 AS sub_type_desc,&#10;    /*12*/ D.disposal_type_id                   AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P3.probation_area_id                 AS probation_area_id,&#10;    /*17*/ NULL                                 AS provider_probation_area_id,&#10;    /*18*/ T3.team_id                           AS team_id,&#10;    /*19*/ S3.staff_id                          AS staff_id,&#10;    /*20*/ NULL                                 AS provider_team_id,&#10;    /*21*/ NULL                                 AS provider_employee_id,&#10;    /*22*/ ORT.order_transfer_id                AS transfer_id,&#10;    /*23*/ ORT.allocation_reason_id             AS allocation_reason_id,&#10;    /*24*/ SRTR3.code_description               AS allocation_reason_desc,&#10;    /*25*/ ORT.receiving_team_id                AS receiving_team_id,&#10;    /*26*/ RECT3.description                    AS receiving_team_desc,&#10;    /*27*/ ORT.receiving_staff_id               AS receiving_staff_id,&#10;    /*28*/ RECS3.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS3.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP3.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP3.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ NULL                                 AS nsi_id,&#10;    /*34*/ NULL                                 AS nsi_event_id,&#10;    --&#10;    /*35*/ E.event_id                           AS event_id,&#10;    /*36*/ E.event_number                       AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ D.disposal_id                        AS disposal_id,&#10;    /*44*/ D.termination_date                   AS termination_date,&#10;    /*45*/ D.upw                                AS upw,&#10;    /*46*/ DT.sentence_type                     AS sentence_type,&#10;    /*47*/ DT.cja2003                           AS cja2003,&#10;    /*48*/ DT.pre_cja2003                       AS pre_cja2003,&#10;    /*49*/ E.event_id                           AS disposal_event_id,&#10;    --&#10;    /*50*/ SRL.code_description                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NULL                                 AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ ORT.NOTES                            AS transfer_notes,&#10;    /*53*/ RECPSA3.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    event E&#10;      LEFT OUTER JOIN disposal D ON E.event_id &#61; D.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;      LEFT OUTER JOIN court_appearance CA ON CA.event_id &#61; E.event_id&#10;        AND CA.court_appearance_id &#61; PKG_Lookups.funcgetTabRecord(&#10;                                         p_table    &#61;&gt; &#39;&#39;COURT_APPEARANCE&#39;&#39;,&#10;                                         p_data_fld &#61;&gt; &#39;&#39;court_appearance_id&#39;&#39;,&#10;                                         p_ref_col  &#61;&gt; &#39;&#39;event_id&#39;&#39;,&#10;                                         p_ref_val  &#61;&gt;  TO_CHAR(E.event_id),&#10;                                         p_where    &#61;&gt; &#39;&#39;soft_deleted &#61; 0&#39;&#39;,&#10;                                         p_order_by &#61;&gt; &#39;&#39;appearance_date DESC, created_datetime DESC, court_appearance_id DESC&#39;&#39; )&#10;        --&#10;        LEFT OUTER JOIN r_standard_reference_list SRL ON SRL.standard_reference_list_id &#61; CA.appearance_type_id&#10;      INNER JOIN order_manager OM2 ON E.event_id &#61; OM2.event_id AND OM2.active_flag &#61; 1&#10;        INNER JOIN team T3 ON OM2.allocation_team_id &#61; T3.team_id&#10;          INNER JOIN probation_area P3 ON T3.probation_area_id &#61; P3.probation_area_id&#10;        INNER JOIN staff S3 ON OM2.allocation_staff_id &#61; S3.staff_id&#10;      INNER JOIN order_transfer ORT ON E.event_id &#61; ORT.event_id&#10;        LEFT OUTER JOIN r_standard_reference_list SRTR3 ON ORT.allocation_reason_id &#61; SRTR3.standard_reference_list_id&#10;        INNER JOIN team RECT3 ON ORT.receiving_team_id &#61; RECT3.team_id&#10;          INNER JOIN probation_area RECP3 ON RECT3.probation_area_id &#61; RECP3.probation_area_id&#10;        INNER JOIN staff RECS3 ON ORT.receiving_staff_id &#61; RECS3.staff_id&#10;         LEFT OUTER JOIN r_standard_reference_list RECPSA3 ON RECP3.SPG_ACTIVE_ID &#61; RECPSA3.standard_reference_list_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND E.pending_transfer &#61; 1&#10;    AND ORT.accepted_decision_id IS NULL&#10;    AND ORT.rejection_reason_id IS NULL&#10;    AND ORT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND OM2.soft_deleted &#61; 0&#10;    AND ORT.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0),&#10;--&#39; || &#39;&#10;L_RQMNT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;RQMNT&#39;&#39;                            AS rec_level, -- RQMNT&#10;    /*01*/ RQMNTT.request_date                  AS request_date,&#10;    /*02*/ T4.description                       AS team_desc,&#10;    /*03*/ S4.forename                          AS staff_forename,&#10;    /*04*/ S4.surname                           AS staff_surname,&#10;    /*05*/ PT4.name                             AS provider_team_name,&#10;    /*06*/ PE4.forename                         AS provider_employee_forename,&#10;    /*07*/ PE4.surname                          AS provider_employee_surname,&#10;    /*08*/ P4.description                       AS team_probation_area_desc,&#10;    /*09*/ PP4.description                      AS provider_probation_area_desc,&#10;    /*10*/ RT.description                       AS main_type_desc,&#10;    /*11*/ SR4.code_description                 AS sub_type_desc,&#10;    /*12*/ R.rqmnt_type_main_category_id        AS main_type_id,&#10;    /*13*/ ART.ad_rqmnt_type_main_category_id   AS add_main_type_id,&#10;    /*14*/ ART.description                      AS add_main_type_desc,&#10;    /*15*/ ASR4.code_description                AS add_sub_type_desc,&#10;    /*16*/ P4.probation_area_id                 AS probation_area_id,&#10;    /*17*/ PP4.probation_area_id                AS provider_probation_area_id,&#10;    /*18*/ T4.team_id                           AS team_id,&#10;    /*19*/ S4.staff_id                          AS staff_id,&#10;    /*20*/ PT4.provider_team_id                 AS provider_team_id,&#10;    /*21*/ PE4.provider_employee_id             AS provider_employee_id,&#10;    /*22*/ RQMNTT.rqmnt_transfer_id             AS transfer_id,&#10;    /*23*/ RQMNTT.allocation_reason_id          AS allocation_reason_id,&#10;    /*24*/ SRTR4.code_description               AS allocation_reason_desc,&#10;    --&#10;    /*25*/ RQMNTT.receiving_team_id             AS receiving_team_id,&#10;    /*26*/ RECT4.description                    AS receiving_team_desc,&#10;    /*27*/ RQMNTT.receiving_staff_id            AS receiving_staff_id,&#10;    /*28*/ RECS4.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS4.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP4.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP4.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ NULL                                 AS nsi_id,&#10;    /*34*/ NULL                                 AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ E.event_number                       AS event_number,&#10;    --&#10;    /*37*/ R.rqmnt_id                           AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ D.disposal_id                        AS disposal_id,&#10;    /*44*/ D.termination_date                   AS termination_date,&#10;    /*45*/ D.upw                                AS upw,&#10;    /*46*/ DT.sentence_type                     AS sentence_type,&#10;    /*47*/ DT.cja2003                           AS cja2003,&#10;    /*48*/ DT.pre_cja2003                       AS pre_cja2003,&#10;    /*49*/ E.event_id                           AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NULL                                 AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ RQMNTT.NOTES                         AS transfer_notes,&#10;    /*53*/ RECPSA4.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        INNER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;        INNER JOIN rqmnt R ON R.disposal_id &#61; D.disposal_id&#10;          LEFT OUTER JOIN r_rqmnt_type_main_category RT ON R.rqmnt_type_main_category_id &#61; RT.rqmnt_type_main_category_id&#10;          LEFT OUTER JOIN r_standard_reference_list SR4 ON R.rqmnt_type_sub_category_id &#61; SR4.standard_reference_list_id&#10;          LEFT OUTER JOIN r_ad_rqmnt_type_main_category ART ON R.ad_rqmnt_type_main_category_id &#61; ART.ad_rqmnt_type_main_category_id&#10;          LEFT OUTER JOIN r_standard_reference_list ASR4 ON R.ad_rqmnt_type_sub_category_id &#61; ASR4.standard_reference_list_id&#10;          INNER JOIN rqmnt_manager RM ON R.rqmnt_id &#61; RM.rqmnt_id AND RM.active_flag &#61; 1&#10;            LEFT OUTER JOIN team T4 ON RM.allocated_team_id &#61; T4.team_id&#10;              LEFT OUTER JOIN probation_area P4 ON T4.probation_area_id &#61; P4.probation_area_id&#10;            LEFT OUTER JOIN staff S4 ON RM.allocated_staff_id &#61; S4.staff_id&#10;            LEFT OUTER JOIN provider_team PT4 ON RM.provider_team_id &#61; PT4.provider_team_id&#10;              LEFT OUTER JOIN probation_area PP4 ON PT4.probation_area_id &#61; PP4.probation_area_id&#10;            LEFT OUTER JOIN provider_employee PE4 ON RM.provider_employee_id &#61; PE4.provider_employee_id&#10;          INNER JOIN rqmnt_transfer RQMNTT ON R.rqmnt_id &#61; RQMNTT.rqmnt_id&#10;            LEFT OUTER JOIN r_standard_reference_list SRTR4 ON RQMNTT.allocation_reason_id &#61; SRTR4.standard_reference_list_id&#10;            LEFT OUTER JOIN team RECT4 ON RQMNTT.receiving_team_id &#61; RECT4.team_id&#10;              LEFT OUTER JOIN probation_area RECP4 ON RECT4.probation_area_id &#61; RECP4.probation_area_id&#10;            LEFT OUTER JOIN staff RECS4 ON RQMNTT.receiving_staff_id &#61; RECS4.staff_id&#10;            LEFT OUTER JOIN r_standard_reference_list RECPSA4 ON RECP4.SPG_ACTIVE_ID &#61; RECPSA4.standard_reference_list_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND R.pending_transfer &#61; 1&#10;    AND RQMNTT.accepted_decision_id IS NULL&#10;    AND RQMNTT.rejection_reason_id IS NULL&#10;    AND RQMNTT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND R.soft_deleted &#61; 0&#10;    AND RM.soft_deleted &#61; 0&#10;    AND RQMNTT.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0),&#10;--&#39; || &#39;&#10;L_LC AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;LC&#39;&#39;                               AS rec_level, -- LIC_CONDITION&#10;    /*01*/ LICT.request_date                    AS request_date,&#10;    /*02*/ T5.description                       AS team_desc,&#10;    /*03*/ S5.forename                          AS staff_forename,&#10;    /*04*/ S5.surname                           AS staff_surname,&#10;    /*05*/ PT5.name                             AS provider_team_name,&#10;    /*06*/ PE5.forename                         AS provider_employee_forename,&#10;    /*07*/ PE5.surname                          AS provider_employee_surname,&#10;    /*08*/ P5.description                       AS team_probation_area_desc,&#10;    /*09*/ PP5.description                      AS provider_probation_area_desc,&#10;    /*10*/ LT.description                       AS main_type_desc,&#10;    /*11*/ SR5.code_description                 AS sub_type_desc,&#10;    /*12*/ LC.lic_cond_type_main_cat_id         AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P5.probation_area_id                 AS probation_area_id,&#10;    /*17*/ PP5.probation_area_id                AS provider_probation_area_id,&#10;    /*18*/ T5.team_id                           AS team_id,&#10;    /*19*/ S5.staff_id                          AS staff_id,&#10;    /*20*/ PT5.provider_team_id                 AS provider_team_id,&#10;    /*21*/ PE5.provider_employee_id             AS provider_employee_id,&#10;    /*22*/ LICT.lic_condition_transfer_id       AS transfer_id,&#10;    /*23*/ LICT.allocation_reason_id            AS allocation_reason_id,&#10;    /*24*/ SRTR5.code_description               AS allocation_reason_desc,&#10;    --&#10;    /*25*/ LICT.receiving_team_id               AS receiving_team_id,&#10;    /*26*/ RECT5.description                    AS receiving_team_desc,&#10;    /*27*/ LICT.receiving_staff_id              AS receiving_staff_id,&#10;    /*28*/ RECS5.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS5.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP5.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP5.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ NULL                                 AS nsi_id,&#10;    /*34*/ NULL                                 AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ E.event_number                       AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ LC.lic_condition_id                  AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ D.disposal_id                        AS disposal_id,&#10;    /*44*/ D.termination_date                   AS termination_date,&#10;    /*45*/ D.upw                                AS upw,&#10;    /*46*/ DT.sentence_type                     AS sentence_type,&#10;    /*47*/ DT.cja2003                           AS cja2003,&#10;    /*48*/ DT.pre_cja2003                       AS pre_cja2003,&#10;    /*49*/ E.event_id                           AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NULL                                 AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ LICT.NOTES                           AS transfer_notes,&#10;    /*53*/ RECPSA5.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        INNER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;        INNER JOIN lic_condition LC ON LC.disposal_id &#61; D.disposal_id&#10;          LEFT OUTER JOIN r_lic_cond_type_main_cat LT ON LC.lic_cond_type_main_cat_id &#61; LT.lic_cond_type_main_cat_id&#10;          LEFT OUTER JOIN r_standard_reference_list SR5 ON LC.lic_cond_type_sub_cat_id &#61; SR5.standard_reference_list_id&#10;          INNER JOIN lic_condition_manager LM ON LC.lic_condition_id &#61; LM.lic_condition_id AND LM.active_flag &#61; 1&#10;            LEFT OUTER JOIN team T5 ON LM.team_id &#61; T5.team_id&#10;              LEFT OUTER JOIN probation_area P5 ON T5.probation_area_id &#61; P5.probation_area_id&#10;            LEFT OUTER JOIN staff S5 ON LM.staff_id &#61; S5.staff_id&#10;            LEFT OUTER JOIN provider_team PT5 ON LM.provider_team_id &#61; PT5.provider_team_id&#10;              LEFT OUTER JOIN probation_area PP5 ON PT5.probation_area_id &#61; PP5.probation_area_id&#10;            LEFT OUTER JOIN provider_employee PE5 ON LM.provider_employee_id &#61; PE5.provider_employee_id&#10;          INNER JOIN lic_condition_transfer LICT ON LC.lic_condition_id &#61; LICT.lic_condition_id&#10;            LEFT OUTER JOIN r_standard_reference_list SRTR5 ON LICT.allocation_reason_id &#61; SRTR5.standard_reference_list_id&#10;            LEFT OUTER JOIN team RECT5 ON LICT.receiving_team_id &#61; RECT5.team_id&#10;              LEFT OUTER JOIN probation_area RECP5 ON RECT5.probation_area_id &#61; RECP5.probation_area_id&#10;            LEFT OUTER JOIN staff RECS5 ON LICT.receiving_staff_id &#61; RECS5.staff_id&#10;            LEFT OUTER JOIN r_standard_reference_list RECPSA5 ON RECP5.SPG_ACTIVE_ID &#61; RECPSA5.standard_reference_list_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND LC.pending_transfer &#61; 1&#10;    AND LICT.accepted_decision_id IS NULL&#10;    AND LICT.rejection_reason_id IS NULL&#10;    AND LICT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND LC.soft_deleted &#61; 0&#10;    AND LM.soft_deleted &#61; 0&#10;    AND LICT.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0),&#10;--&#39; || &#39;&#10;L_PSS_RQMNT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;PSS_RQMNT&#39;&#39;                        AS rec_level, -- PSS_RQMNT&#10;    /*01*/ PSSRT.request_date                   AS request_date,&#10;    /*02*/ T6.description                       AS team_desc,&#10;    /*03*/ S6.forename                          AS staff_forename,&#10;    /*04*/ S6.surname                           AS staff_surname,&#10;    /*05*/ NULL                                 AS provider_team_name,&#10;    /*06*/ NULL                                 AS provider_employee_forename,&#10;    /*07*/ NULL                                 AS provider_employee_surname,&#10;    /*08*/ P6.description                       AS team_probation_area_desc,&#10;    /*09*/ NULL                                 AS provider_probation_area_desc,&#10;    /*10*/ PSST.description                     AS main_type_desc,&#10;    /*11*/ ST6.description                      AS sub_type_desc,&#10;    /*12*/ PSS.pss_rqmnt_type_main_cat_id       AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P6.probation_area_id                 AS probation_area_id,&#10;    /*17*/ NULL                                 AS provider_probation_area_id,&#10;    /*18*/ T6.team_id                           AS team_id,&#10;    /*19*/ S6.staff_id                          AS staff_id,&#10;    /*20*/ NULL                                 AS provider_team_id,&#10;    /*21*/ NULL                                 AS provider_employee_id,&#10;    /*22*/ PSSRT.pss_rqmnt_transfer_id          AS transfer_id,&#10;    /*23*/ PSSRT.allocation_reason_id           AS allocation_reason_id,&#10;    /*24*/ SRTR6.code_description               AS allocation_reason_desc,&#10;    --&#10;    /*25*/ PSSRT.receiving_team_id              AS receiving_team_id,&#10;    /*26*/ RECT6.description                    AS receiving_team_desc,&#10;    /*27*/ PSSRT.receiving_staff_id             AS receiving_staff_id,&#10;    /*28*/ RECS6.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS6.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP6.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP6.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ NULL                                 AS nsi_id,&#10;    /*34*/ NULL                                 AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ E.event_number                       AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ PSS.pss_rqmnt_id                     AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ D.disposal_id                        AS disposal_id,&#10;    /*44*/ D.termination_date                   AS termination_date,&#10;    /*45*/ D.upw                                AS upw,&#10;    /*46*/ DT.sentence_type                     AS sentence_type,&#10;    /*47*/ DT.cja2003                           AS cja2003,&#10;    /*48*/ DT.pre_cja2003                       AS pre_cja2003,&#10;    /*49*/ E.event_id                           AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NULL                                 AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ PSSRT.NOTES                          AS transfer_notes,&#10;    /*53*/ RECPSA6.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        INNER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;        INNER JOIN custody C ON C.disposal_id &#61; D.disposal_id&#10;          INNER JOIN pss_rqmnt PSS ON PSS.custody_id &#61; C.custody_id&#10;            LEFT OUTER JOIN r_pss_rqmnt_type_main_category PSST ON PSS.pss_rqmnt_type_main_cat_id &#61; PSST.pss_rqmnt_type_main_cat_id&#10;            LEFT OUTER JOIN r_pss_rqmnt_type_sub_category ST6 ON PSS.pss_rqmnt_type_sub_cat_id &#61; ST6.pss_rqmnt_type_sub_cat_id&#10;            INNER JOIN pss_rqmnt_manager PSSM ON PSS.pss_rqmnt_id &#61; PSSM.pss_rqmnt_id AND PSSM.active_flag &#61; 1&#10;              LEFT OUTER JOIN team T6 ON PSSM.team_id &#61; T6.team_id&#10;                LEFT OUTER JOIN probation_area P6 ON T6.probation_area_id &#61; P6.probation_area_id&#10;              LEFT OUTER JOIN staff S6 ON PSSM.staff_id &#61; S6.staff_id&#10;            INNER JOIN pss_rqmnt_transfer PSSRT ON PSS.pss_rqmnt_id &#61; PSSRT.pss_rqmnt_id&#10;              INNER JOIN r_standard_reference_list SRTR6 ON PSSRT.allocation_reason_id &#61; SRTR6.standard_reference_list_id&#10;              INNER JOIN team RECT6 ON PSSRT.receiving_team_id &#61; RECT6.team_id&#10;                INNER JOIN probation_area RECP6 ON RECT6.probation_area_id &#61; RECP6.probation_area_id&#10;              INNER JOIN staff RECS6 ON PSSRT.receiving_staff_id &#61; RECS6.staff_id&#10;              LEFT OUTER JOIN r_standard_reference_list RECPSA6 ON RECP6.SPG_ACTIVE_ID &#61; RECPSA6.standard_reference_list_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND PSS.pending_transfer &#61; 1&#10;    AND PSSRT.accepted_decision_id IS NULL&#10;    AND PSSRT.rejection_reason_id IS NULL&#10;    AND PSSRT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND C.soft_deleted &#61; 0&#10;    AND PSS.soft_deleted &#61; 0&#10;    AND PSSRT.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0),&#10;--&#39; || &#39;&#10;L_EVENT_NSI AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;NSI_EVENT&#39;&#39;                        AS rec_level, -- EVENT NSI&#10;    /*01*/ NSIT.request_date                    AS request_date,&#10;    /*02*/ T7.description                       AS team_desc,&#10;    /*03*/ S7.forename                          AS staff_forename,&#10;    /*04*/ S7.surname                           AS staff_surname,&#10;    /*05*/ NULL                                 AS provider_team_name,&#10;    /*06*/ NULL                                 AS provider_employee_forename,&#10;    /*07*/ NULL                                 AS provider_employee_surname,&#10;    /*08*/ P7.description                       AS team_probation_area_desc,&#10;    /*09*/ NULL                                 AS provider_probation_area_desc,&#10;    /*10*/ NT.description                       AS main_type_desc,&#10;    /*11*/ SR7.code_description                 AS sub_type_desc,&#10;    /*12*/ N.nsi_type_id                        AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P7.probation_area_id                 AS probation_area_id,&#10;    /*17*/ NULL                                 AS provider_probation_area_id,&#10;    /*18*/ T7.team_id                           AS team_id,&#10;    /*19*/ S7.staff_id                          AS staff_id,&#10;    /*20*/ NULL                                 AS provider_team_id,&#10;    /*21*/ NULL                                 AS provider_employee_id,&#10;    /*22*/ NSIT.nsi_transfer_id                 AS transfer_id,&#10;    /*23*/ NSIT.allocation_reason_id            AS allocation_reason_id,&#10;    /*24*/ SRTR7.code_description               AS allocation_reason_desc,&#10;    --&#10;    /*25*/ NSIT.target_team_id                  AS receiving_team_id,&#10;    /*26*/ RECT7.description                    AS receiving_team_desc,&#10;    /*27*/ NSIT.target_staff_id                 AS receiving_staff_id,&#10;    /*28*/ RECS7.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS7.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP7.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP7.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ N.nsi_id                             AS nsi_id,&#10;    /*34*/ N.event_id                           AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ E.event_number                       AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ D.disposal_id                        AS disposal_id,&#10;    /*44*/ D.termination_date                   AS termination_date,&#10;    /*45*/ D.upw                                AS upw,&#10;    /*46*/ DT.sentence_type                     AS sentence_type,&#10;    /*47*/ DT.cja2003                           AS cja2003,&#10;    /*48*/ DT.pre_cja2003                       AS pre_cja2003,&#10;    /*49*/ E.event_id                           AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NT.RATE_CARD_FLAG                    AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ NSIT.NOTES                           AS transfer_notes,&#10;    /*53*/ RECPSA7.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    event E&#10;      LEFT OUTER JOIN disposal D ON D.event_id &#61; E.event_id AND D.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;      INNER JOIN nsi N ON N.event_id &#61; E.event_id&#10;        INNER JOIN r_nsi_type NT ON N.nsi_type_id &#61; NT.nsi_type_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR7 ON N.nsi_sub_type_id &#61; SR7.standard_reference_list_id&#10;        INNER JOIN nsi_manager NM ON N.nsi_id &#61; NM.nsi_id AND NM.active_flag &#61; 1&#10;          INNER JOIN team T7 ON NM.team_id &#61; T7.team_id&#10;            INNER JOIN probation_area P7 ON T7.probation_area_id &#61; P7.probation_area_id&#10;          INNER JOIN staff S7 ON NM.staff_id &#61; S7.staff_id&#10;        INNER JOIN nsi_transfer NSIT ON N.nsi_id &#61; NSIT.nsi_id&#10;          LEFT OUTER JOIN r_standard_reference_list SRTR7 ON NSIT.allocation_reason_id &#61; SRTR7.standard_reference_list_id&#10;          INNER JOIN team RECT7 ON NSIT.target_team_id &#61; RECT7.team_id&#10;            INNER JOIN probation_area RECP7 ON RECT7.probation_area_id &#61; RECP7.probation_area_id&#10;          INNER JOIN staff RECS7 ON NSIT.target_staff_id &#61; RECS7.staff_id&#10;          LEFT OUTER JOIN r_standard_reference_list RECPSA7 ON RECP7.SPG_ACTIVE_ID &#61; RECPSA7.standard_reference_list_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND N.pending_transfer &#61; 1&#10;    AND N.actual_end_date IS NULL&#10;    AND NSIT.accepted_decision_id IS NULL&#10;    AND NSIT.rejection_reason_id IS NULL&#10;    AND NSIT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND N.soft_deleted &#61; 0&#10;    AND NM.soft_deleted &#61; 0&#10;    AND NSIT.soft_deleted &#61; 0&#10;    AND ((:p_establishment &#61; 0 AND RECP7.institution_id IS NULL) OR (:p_establishment &#61; 1 AND RECP7.institution_id IS NOT NULL)) ),&#10;--&#39; || &#39;&#10;L_INST_REP AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;INST_RPT&#39;&#39;                         AS rec_level, -- INSTITUTIONAL REPORT&#10;    /*01*/ IRT.request_date                     AS request_date,&#10;    /*02*/ T8.description                       AS team_desc,&#10;    /*03*/ S8.forename                          AS staff_forename,&#10;    /*04*/ S8.surname                           AS staff_surname,&#10;    /*05*/ PT8.name                             AS provider_team_name,&#10;    /*06*/ PE8.forename                         AS provider_employee_forename,&#10;    /*07*/ PE8.surname                          AS provider_employee_surname,&#10;    /*08*/ P8.description                       AS team_probation_area_desc,&#10;    /*09*/ PP8.description                      AS provider_probation_area_desc,&#10;    /*10*/ SR8.code_description                 AS main_type_desc,&#10;    /*11*/ NULL                                 AS sub_type_desc,&#10;    /*12*/ IR.institution_report_type_id        AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P8.probation_area_id                 AS probation_area_id,&#10;    /*17*/ PP8.probation_area_id                AS provider_probation_area_id,&#10;    /*18*/ T8.team_id                           AS team_id,&#10;    /*19*/ S8.staff_id                          AS staff_id,&#10;    /*20*/ PT8.provider_team_id                 AS provider_team_id,&#10;    /*21*/ PE8.provider_employee_id             AS provider_employee_id,&#10;    /*22*/ IRT.institutional_rep_transfer_id    AS transfer_id,&#10;    /*23*/ IRT.allocation_reason_id             AS allocation_reason_id,&#10;    /*24*/ SRTR8.code_description               AS allocation_reason_desc,&#10;    --&#10;    /*25*/ IRT.receiving_team_id                AS receiving_team_id,&#10;    /*26*/ RECT8.description                    AS receiving_team_desc,&#10;    /*27*/ IRT.receiving_staff_id               AS receiving_staff_id,&#10;    /*28*/ RECS8.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS8.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP8.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP8.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ NULL                                 AS nsi_id,&#10;    /*34*/ NULL                                 AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ E.event_number                       AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ IR.institutional_report_id           AS institutional_report_id,&#10;    /*41*/ IR.custody_id                        AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ NULL                                 AS court_report_id,&#10;    --&#10;    /*43*/ D.disposal_id                        AS disposal_id,&#10;    /*44*/ D.termination_date                   AS termination_date,&#10;    /*45*/ D.upw                                AS upw,&#10;    /*46*/ DT.sentence_type                     AS sentence_type,&#10;    /*47*/ DT.cja2003                           AS cja2003,&#10;    /*48*/ DT.pre_cja2003                       AS pre_cja2003,&#10;    /*49*/ E.event_id                           AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NULL                                 AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ IRT.NOTES                            AS transfer_notes,&#10;    /*53*/ RECPSA8.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    event E&#10;      INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;          INNER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;        INNER JOIN custody C ON C.disposal_id &#61; D.disposal_id&#10;          INNER JOIN institutional_report IR ON IR.custody_id &#61; C.custody_id&#10;            INNER JOIN r_standard_reference_list SR8 ON IR.institution_report_type_id &#61; SR8.standard_reference_list_id&#10;            INNER JOIN report_manager IRM ON IR.institutional_report_id &#61; IRM.institutional_report_id AND IRM.active_flag &#61; 1&#10;              LEFT OUTER JOIN team T8 ON IRM.team_id &#61; T8.team_id&#10;                LEFT OUTER JOIN probation_area P8 ON T8.probation_area_id &#61; P8.probation_area_id&#10;              LEFT OUTER JOIN staff S8 ON IRM.staff_id &#61; S8.staff_id&#10;              LEFT OUTER JOIN provider_team PT8 ON IRM.provider_team_id &#61; PT8.provider_team_id&#10;                LEFT OUTER JOIN probation_area PP8 ON PT8.probation_area_id &#61; PP8.probation_area_id&#10;              LEFT OUTER JOIN provider_employee PE8 ON IRM.provider_employee_id &#61; PE8.provider_employee_id&#10;            INNER JOIN institutional_report_transfer IRT ON IR.institutional_report_id &#61; IRT.institutional_report_id&#10;              LEFT OUTER JOIN r_standard_reference_list SRTR8 ON IRT.allocation_reason_id &#61; SRTR8.standard_reference_list_id&#10;              LEFT OUTER JOIN team RECT8 ON IRT.receiving_team_id &#61; RECT8.team_id&#10;                LEFT OUTER JOIN probation_area RECP8 ON RECT8.probation_area_id &#61; RECP8.probation_area_id&#10;              LEFT OUTER JOIN staff RECS8 ON IRT.receiving_staff_id &#61; RECS8.staff_id&#10;              LEFT OUTER JOIN r_standard_reference_list RECPSA8 ON RECP8.SPG_ACTIVE_ID &#61; RECPSA8.standard_reference_list_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND IR.date_sent IS NULL&#10;    AND IR.date_abandoned IS NULL&#10;    AND IR.pending_transfer &#61; 1&#10;    AND IRT.accepted_decision_id IS NULL&#10;    AND IRT.rejection_reason_id IS NULL&#10;    AND IRT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND C.soft_deleted &#61; 0&#10;    AND IR.soft_deleted &#61; 0&#10;    AND IRM.soft_deleted &#61; 0&#10;    AND IRT.soft_deleted &#61; 0&#10;    AND ((:p_establishment &#61; 0 AND RECP8.institution_id IS NULL) OR (:p_establishment &#61; 1 AND RECP8.institution_id IS NOT NULL)) ),&#10;--&#39; || &#39;&#10;L_COURT_REPORT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;COURT_RPT&#39;&#39;                        AS rec_level, -- COURT REPORT&#10;    /*01*/ CRT.request_date                     AS request_date,&#10;    /*02*/ T9.description                       AS team_desc,&#10;    /*03*/ S9.forename                          AS staff_forename,&#10;    /*04*/ S9.surname                           AS staff_surname,&#10;    /*05*/ PT9.name                             AS provider_team_name,&#10;    /*06*/ PE9.forename                         AS provider_employee_forename,&#10;    /*07*/ PE9.surname                          AS provider_employee_surname,&#10;    /*08*/ P9.description                       AS team_probation_area_desc,&#10;    /*09*/ PP9.description                      AS provider_probation_area_desc,&#10;    /*10*/ CRR.description                      AS main_type_desc,&#10;    /*11*/ NULL                                 AS sub_type_desc,&#10;    /*12*/ CR.court_report_type_id              AS main_type_id,&#10;    /*13*/ NULL                                 AS add_main_type_id,&#10;    /*14*/ NULL                                 AS add_main_type_desc,&#10;    /*15*/ NULL                                 AS add_sub_type_desc,&#10;    /*16*/ P9.probation_area_id                 AS probation_area_id,&#10;    /*17*/ PP9.probation_area_id                AS provider_probation_area_id,&#10;    /*18*/ T9.team_id                           AS team_id,&#10;    /*19*/ S9.staff_id                          AS staff_id,&#10;    /*20*/ PT9.provider_team_id                 AS provider_team_id,&#10;    /*21*/ PE9.provider_employee_id             AS provider_employee_id,&#10;    /*22*/ CRT.court_report_transfer_id         AS transfer_id,&#10;    /*23*/ CRT.allocation_reason_id             AS allocation_reason_id,&#10;    /*24*/ SRTR9.code_description               AS allocation_reason_desc,&#10;    --&#10;    /*25*/ CRT.receiving_team_id                AS receiving_team_id,&#10;    /*26*/ RECT9.description                    AS receiving_team_desc,&#10;    /*27*/ CRT.receiving_staff_id               AS receiving_staff_id,&#10;    /*28*/ RECS9.forename                       AS receiving_staff_forename,&#10;    /*29*/ RECS9.surname                        AS receiving_staff_surname,&#10;    /*30*/ RECP9.probation_area_id              AS receiving_probation_area_id,&#10;    /*31*/ RECP9.description                    AS receiving_probation_area_desc,&#10;    --&#10;    /*32*/ NULL                                 AS offender_id,&#10;    --&#10;    /*33*/ NULL                                 AS nsi_id,&#10;    /*34*/ NULL                                 AS nsi_event_id,&#10;    --&#10;    /*35*/ NULL                                 AS event_id,&#10;    /*36*/ E.event_number                       AS event_number,&#10;    --&#10;    /*37*/ NULL                                 AS rqmnt_id,&#10;    --&#10;    /*38*/ NULL                                 AS lic_condition_id,&#10;    --&#10;    /*39*/ NULL                                 AS pss_rqmnt_id,&#10;    --&#10;    /*40*/ NULL                                 AS institutional_report_id,&#10;    /*41*/ NULL                                 AS inst_rpt_custody_id,&#10;    --&#10;    /*42*/ CR.court_report_id                   AS court_report_id,&#10;    --&#10;    /*43*/ D.disposal_id                        AS disposal_id,&#10;    /*44*/ D.termination_date                   AS termination_date,&#10;    /*45*/ D.upw                                AS upw,&#10;    /*46*/ DT.sentence_type                     AS sentence_type,&#10;    /*47*/ DT.cja2003                           AS cja2003,&#10;    /*48*/ DT.pre_cja2003                       AS pre_cja2003,&#10;    /*49*/ E.event_id                           AS disposal_event_id,&#10;    --&#10;    /*50*/ NULL                                 AS court_app_type_desc,&#10;    --&#10;    /*51*/ NULL                                 AS nsi_rate_card_flag,&#10;    --&#10;    /*52*/ CRT.NOTES                            AS transfer_notes,&#10;    /*53*/ RECPSA9.CODE_VALUE                           AS receiving_area_spg_active&#10;  FROM&#10;    event E&#10;      LEFT OUTER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;      INNER JOIN court_appearance CA ON CA.event_id &#61; E.event_id&#10;        INNER JOIN court_report CR ON CR.court_appearance_id &#61; CA.court_appearance_id&#10;          LEFT OUTER JOIN r_court_report_type CRR ON CR.court_report_type_id &#61; CRR.court_report_type_id&#10;          INNER JOIN report_manager CRM ON CR.court_report_id &#61; CRM.court_report_id AND CRM.active_flag &#61; 1&#10;            LEFT OUTER JOIN team T9 ON CRM.team_id &#61; T9.team_id&#10;              LEFT OUTER JOIN probation_area P9 ON T9.probation_area_id &#61; P9.probation_area_id&#10;            LEFT OUTER JOIN staff S9 ON CRM.staff_id &#61; S9.staff_id&#10;            LEFT OUTER JOIN provider_team PT9 ON CRM.provider_team_id &#61; PT9.provider_team_id&#10;              LEFT OUTER JOIN probation_area PP9 ON PT9.probation_area_id &#61; PP9.probation_area_id&#10;            LEFT OUTER JOIN provider_employee PE9 ON CRM.provider_employee_id &#61; PE9.provider_employee_id&#10;          INNER JOIN court_report_transfer CRT ON CR.court_report_id &#61; CRT.court_report_id&#10;            LEFT OUTER JOIN r_standard_reference_list SRTR9 ON CRT.allocation_reason_id &#61; SRTR9.standard_reference_list_id&#10;            LEFT OUTER JOIN team RECT9 ON CRT.receiving_team_id &#61; RECT9.team_id&#10;              LEFT OUTER JOIN probation_area RECP9 ON RECT9.probation_area_id &#61; RECP9.probation_area_id&#10;            LEFT OUTER JOIN staff RECS9 ON CRT.receiving_staff_id &#61; RECS9.staff_id&#10;            LEFT OUTER JOIN r_standard_reference_list RECPSA9 ON RECP9.SPG_ACTIVE_ID &#61; RECPSA9.standard_reference_list_id&#10;  WHERE E.offender_id &#61; :p_offender_id&#10;    AND CR.sent_to_court_date IS NULL&#10;    AND ( CR.delivered_court_report_type_id IS NULL&#10;          OR&#10;          CR.delivered_court_report_type_id !&#61; (SELECT CRT.court_report_type_id FROM r_court_report_type CRT WHERE CRT.code &#61; &#39;&#39;NIL&#39;&#39;) )&#10;    AND CR.pending_transfer &#61; 1&#10;    AND CRT.accepted_decision_id IS NULL&#10;    AND CRT.rejected_reason_id IS NULL&#10;    AND CRT.withdrawal_reason_id IS NULL&#10;    --&#10;    AND E.soft_deleted &#61; 0&#10;    AND CA.soft_deleted &#61; 0&#10;    AND CR.soft_deleted &#61; 0&#10;    AND CRM.soft_deleted &#61; 0&#10;    AND CRT.soft_deleted &#61; 0&#10;    AND :p_establishment &#61; 0&#10;  ),&#10;--&#39; || &#39;&#10;T AS (&#10;  SELECT * FROM L_OM          UNION ALL&#10;  SELECT * FROM L_NSI         UNION ALL&#10;  SELECT * FROM L_EVENT       UNION ALL&#10;  SELECT * FROM L_RQMNT       UNION ALL&#10;  SELECT * FROM L_LC          UNION ALL&#10;  SELECT * FROM L_PSS_RQMNT   UNION ALL&#10;  SELECT * FROM L_EVENT_NSI   UNION ALL&#10;  SELECT * FROM L_INST_REP    UNION ALL&#10;  SELECT * FROM L_COURT_REPORT )&#10;--&#10;SELECT *&#10;FROM T&#10;ORDER BY&#10;  LPAD(NVL(T.event_number, &#39;&#39;0&#39;&#39;), 3),&#10;  DECODE( T.rec_level,&#10;      &#39;&#39;OM&#39;&#39;       , 1,&#10;      &#39;&#39;NSI&#39;&#39;      , 2,&#10;      &#39;&#39;EVENT&#39;&#39;    , 3,&#10;      &#39;&#39;RQMNT&#39;&#39;    , 4,&#10;      &#39;&#39;LC&#39;&#39;       , 5,&#10;      &#39;&#39;PSS_RQMNT&#39;&#39;, 6,&#10;      &#39;&#39;NSI_EVENT&#39;&#39;, 7,&#10;      &#39;&#39;INST_RPT&#39;&#39; , 8,&#10;      &#39;&#39;COURT_RPT&#39;&#39;, 9,&#10;      10),&#10;  T.request_date&#39;;&#10;    --&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      p_offender_id, p_establishment, p_offender_id, p_establishment, p_establishment, p_offender_id, p_establishment,&#10;      p_offender_id, p_establishment, p_offender_id, p_establishment, p_offender_id, p_establishment,&#10;      p_offender_id, p_establishment, p_establishment, p_offender_id, p_establishment, p_establishment, p_offender_id, p_establishment&#10;    ;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab;&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_cnt :&#61; l_cnt + 1;&#10;        PIPE ROW ( l_tab(l_i) );&#10;    END LOOP;&#10;    --&#10;    procDebug( lc_proc || &#39; (rows&#61;&#39; || l_tab.COUNT  || &#39;)&#39;   ||&#10;        &#39;(&#39; || PKG_Debug.funcgetDbStats       || &#39;): &#39; ||&#10;        &#39;(p_offender_id&#61;&#39; || p_offender_id    || &#39;)&#39;   ||&#10;        l_SQL );&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_NEEDED THEN&#10;        procDebug( lc_proc || &#39; (&#39; || l_cnt || &#39; of &#39; || l_tab.COUNT || &#39; rows called from the cursor)&#39; ||&#10;            &#39;(&#39; || PKG_Debug.funcgetDbStats       || &#39;): &#39; ||&#10;            &#39;(p_offender_id&#61;&#39; || p_offender_id    || &#39;)&#39;   ||&#10;            l_SQL );&#10;    WHEN OTHERS THEN&#10;        procDebug( lc_proc || &#39; ERROR: &#39; || SQLERRM || &#39; &#39; ||&#10;            &#39;(p_offender_id&#61;&#39; || p_offender_id    || &#39;)&#39;   ||&#10;            l_SQL );&#10;        RAISE;&#10;END procOffTransferReviewsTAB;&#10;--&#10;PROCEDURE procOffenderTransferReviews(&#10;    p_offender_id         NUMBER,&#10;    p_establishment number default 0,&#10;    p_outcursor           OUT SYS_REFCURSOR)&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ rec_level,&#10;        /*01*/ request_date,&#10;        /*02*/ team_desc,&#10;        /*03*/ staff_forename,&#10;        /*04*/ staff_surname,&#10;        /*05*/ provider_team_name,&#10;        /*06*/ provider_employee_forename,&#10;        /*07*/ provider_employee_surname,&#10;        /*08*/ team_probation_area_desc,&#10;        /*09*/ provider_probation_area_desc,&#10;        /*10*/ main_type_desc,&#10;        /*11*/ sub_type_desc,&#10;        /*12*/ main_type_id,&#10;        /*13*/ add_main_type_id,&#10;        /*14*/ add_main_type_desc,&#10;        /*15*/ add_sub_type_desc,&#10;        /*16*/ probation_area_id,&#10;        /*17*/ provider_probation_area_id,&#10;        /*18*/ team_id,&#10;        /*19*/ staff_id,&#10;        /*20*/ provider_team_id,&#10;        /*21*/ provider_employee_id,&#10;        /*22*/ transfer_id,&#10;        /*23*/ allocation_reason_id,&#10;        /*24*/ allocation_reason_desc,&#10;        --&#10;        /*25*/ receiving_team_id,&#10;        /*26*/ receiving_team_desc,&#10;        /*27*/ receiving_staff_id,&#10;        /*28*/ receiving_staff_forename,&#10;        /*29*/ receiving_staff_surname,&#10;        /*30*/ receiving_probation_area_id,&#10;        /*31*/ receiving_probation_area_desc,&#10;      --&#10;        /*32*/ offender_id,&#10;        --&#10;        /*33*/ nsi_id,&#10;        /*34*/ nsi_event_id,&#10;        --&#10;        /*35*/ event_id,&#10;        /*36*/ event_number,&#10;        --&#10;        /*37*/ rqmnt_id,&#10;        --&#10;        /*38*/ lic_condition_id,&#10;        --&#10;        /*39*/ pss_rqmnt_id,&#10;        --&#10;        /*40*/ institutional_report_id,&#10;        /*41*/ inst_rpt_custody_id,&#10;        --&#10;        /*[42]*/ court_report_id,&#10;        --&#10;        /*[43]*/ disposal_id,&#10;        /*[44]*/ termination_date,&#10;        /*[45]*/ upw,&#10;        /*[46]*/ sentence_type,&#10;        /*[47]*/ cja2003,&#10;        /*[48]*/ pre_cja2003,&#10;        /*[49]*/ disposal_event_id,&#10;        /*[50]*/ court_app_type_desc,&#10;        --&#10;        /*[51]*/ nsi_rate_card_flag,&#10;        --&#10;        /*[52]*/ transfer_notes,&#10;        --&#10;        /*[53]*/ receiving_area_spg_active&#10;        --&#10;      FROM TABLE( PKG_Search.procOffTransferReviewsTAB(p_offender_id &#61;&gt; p_offender_id, p_establishment &#61;&gt; p_establishment) );&#10;    --&#10;END procOffenderTransferReviews;&#10;--&#10;--&#10;FUNCTION procOffTransferRejectsTAB(&#10;    p_origin_team_id              NUMBER DEFAULT NULL,&#10;    p_origin_staff_id             NUMBER DEFAULT NULL,&#10;    p_start_date                  DATE,&#10;    p_end_date                    DATE,&#10;    p_target_team_id              NUMBER DEFAULT NULL,&#10;    p_target_staff_id             NUMBER DEFAULT NULL,&#10;    p_target_probation_area_id    NUMBER DEFAULT NULL,&#10;    p_origin_probation_area_id    NUMBER DEFAULT NULL,&#10;    --&#10;    p_offender_id                 NUMBER DEFAULT NULL,&#10;    --&#10;    p_use_live_query_flag         VARCHAR2 DEFAULT &#39;N&#39;&#10;    )&#10;RETURN ttabOffenderTransferReject PIPELINED&#10;IS&#10;    --&#10;    lc_proc CONSTANT VARCHAR2(30) :&#61; &#39;procOffTransferRejectsTAB&#39;;&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    --&#10;    l_rec trecOffenderTransferReject;&#10;    l_tab ttabOffenderTransferReject;&#10;    --&#10;    l_user_name USER_.distinguished_name%TYPE;&#10;    --&#10;    l_SQL     CLOB;&#10;    l_cnt     INTEGER :&#61; 0;&#10;    --&#10;BEGIN&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    IF NVLSTR(p_use_live_query_flag, &#39;N&#39;) &#61; &#39;N&#39; THEN&#10;        l_SQL :&#61;&#10;&#39;WITH T AS (&#10;  SELECT&#10;    /*00*/ CASE&#10;             WHEN RTD.offender_transfer_id          IS NOT NULL THEN &#39;&#39;OM&#39;&#39;&#10;             WHEN RTD.nsi_transfer_id               IS NOT NULL THEN &#39;&#39;NSI&#39;&#39;&#10;             WHEN RTD.order_transfer_id             IS NOT NULL THEN &#39;&#39;EVENT&#39;&#39;&#10;             WHEN RTD.rqmnt_transfer_id             IS NOT NULL THEN &#39;&#39;RQMNT&#39;&#39;&#10;             WHEN RTD.lic_condition_transfer_id     IS NOT NULL THEN &#39;&#39;LC&#39;&#39;&#10;             WHEN RTD.pss_rqmnt_transfer_id         IS NOT NULL THEN &#39;&#39;PSS_RQMNT&#39;&#39;&#10;             WHEN RTD.institutional_rep_transfer_id IS NOT NULL THEN &#39;&#39;INST_RPT&#39;&#39;&#10;             WHEN RTD.court_report_transfer_id      IS NOT NULL THEN &#39;&#39;COURT_RPT&#39;&#39;&#10;           END                          AS rec_level,&#10;    /*01*/ RTD.transfer_request_date    AS request_date,&#10;    /*02*/ T1.description               AS tgt_team_desc,&#10;    /*03*/ S1.forename                  AS tgt_staff_forename,&#10;    /*04*/ S1.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP1.description              AS tgt_team_probation_area_desc,&#10;    /*06*/ PKG_Common.NVL2(&#10;               NT.description,&#10;               DT.description,&#10;               RT.description,&#10;               LT.description,&#10;               PSST.description,&#10;               SR8.code_description,&#10;               CRR.description )        AS main_type_desc,&#10;    /*07*/ PKG_Common.NVL2(&#10;               SR2.code_description,&#10;               SR4.code_description,&#10;               SR5.code_description,&#10;               ST6.description )        AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ PKG_Common.NVL2(&#10;              ART.description,&#10;              NULL )                    AS add_main_type_desc,&#10;    /*11*/ PKG_Common.NVL2(&#10;               ASR4.code_description,&#10;               NULL )                   AS add_sub_type_desc,&#10;    /*12*/ SRTR1.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ RTD.offender_transfer_id     AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ RTD.nsi_transfer_id          AS nsi_transfer_id,&#10;    /*17*/ N.event_id                   AS nsi_event_id,&#10;    /*18*/ N.nsi_id                     AS nsi_id,&#10;    --&#10;    /*19*/ RTD.order_transfer_id        AS event_transfer_id,&#10;    /*20*/ RTD.event_id                 AS event_id,&#10;    /*21*/ E.event_number               AS event_number,&#10;    --&#10;    /*22*/ RTD.rqmnt_transfer_id        AS rqmnt_transfer_id,&#10;    /*23*/ RTD.rqmnt_id                 AS rqmnt_id,&#10;    --&#10;    /*24*/ RTD.lic_condition_transfer_id  AS lic_condition_transfer_id,&#10;    /*25*/ RTD.lic_condition_id           AS lic_condition_id,&#10;    --&#10;    /*26*/ RTD.pss_rqmnt_transfer_id    AS pss_rqmnt_transfer_id,&#10;    /*27*/ RTD.pss_rqmnt_id             AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ RTD.institutional_rep_transfer_id AS inst_rpt_transfer_id,&#10;    /*29*/ RTD.institutional_report_id       AS inst_rpt_id,&#10;    /*30*/ IR.custody_id                     AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ RTD.court_report_transfer_id  AS court_report_transfer_id,&#10;    /*32*/ RTD.court_report_id           AS court_report_id,&#10;    --&#10;    /*33*/ RTD.transfer_status_date     AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    /*35*/ O.current_exclusion          AS current_exclusion,&#10;    /*36*/ CASE WHEN O.current_restriction&lt;&gt;0 THEN O.restriction_message ELSE NULL END AS restriction_message,&#10;    /*37*/ CASE WHEN O.current_exclusion&lt;&gt;0 THEN O.exclusion_message ELSE NULL END AS exclusion_message,&#10;    --&#10;    /*38*/ RTD.target_team_id           AS tgt_team_id,&#10;    /*39*/ RTD.target_staff_id          AS tgt_staff_id,&#10;    /*40*/ RTD.target_provider_id       AS tgt_probation_area_id,&#10;    /*41*/ RTD.origin_team_id           AS orig_team_id,&#10;    /*42*/ RTD.origin_staff_id          AS orig_staff_id,&#10;    /*43*/ RTD.origin_provider_id       AS orig_probation_area_id,&#10;    /*44*/ RTD.rejection_reason_id      AS rejection_reason_id,&#10;    /*45*/ RTD.NOTE_FLAG                AS NOTE_FLAG,&#10;    /*46*/ TP1.establishment            AS establishment_flag&#10;    --&#10;  FROM&#10;    rejected_transfer_diary RTD&#10;      INNER JOIN probation_area TP1 ON RTD.target_provider_id &#61; TP1.probation_area_id&#10;      INNER JOIN probation_area OP1 ON RTD.origin_provider_id &#61; OP1.probation_area_id&#10;      INNER JOIN team T1 ON RTD.target_team_id &#61; T1.team_id&#10;      INNER JOIN team ORIGINT1 ON RTD.origin_team_id &#61; ORIGINT1.team_id&#10;      INNER JOIN staff S1 ON RTD.target_staff_id &#61; S1.staff_id&#10;      INNER JOIN r_standard_reference_list SRTR1 ON RTD.rejection_reason_id &#61; SRTR1.standard_reference_list_id&#10;      --&#10;      INNER JOIN offender O ON RTD.offender_id &#61; O.offender_id AND O.soft_deleted &#61; 0&#10;      --&#10;      LEFT OUTER JOIN offender_transfer OT ON RTD.offender_transfer_id &#61; OT.offender_transfer_id AND OT.soft_deleted &#61; 0&#10;      --&#10;      LEFT OUTER JOIN nsi N ON N.nsi_id &#61; RTD.nsi_id AND N.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN R_NSI_TYPE NT ON N.nsi_type_id &#61; NT.nsi_type_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR2 ON N.nsi_sub_type_id &#61; SR2.standard_reference_list_id&#10;      --&#10;      LEFT OUTER JOIN event E ON E.event_id &#61; RTD.event_id AND E.active_flag &#61; 1 AND E.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN disposal D ON E.event_id &#61; D.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;          LEFT OUTER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;      --&#10;      LEFT OUTER JOIN rqmnt R ON RTD.rqmnt_id &#61; R.rqmnt_id AND R.active_flag &#61; 1 AND R.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_rqmnt_type_main_category RT ON R.rqmnt_type_main_category_id &#61; RT.rqmnt_type_main_category_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR4 ON R.rqmnt_type_sub_category_id &#61; SR4.standard_reference_list_id&#10;        LEFT OUTER JOIN r_ad_rqmnt_type_main_category ART ON R.ad_rqmnt_type_main_category_id &#61; ART.ad_rqmnt_type_main_category_id&#10;        LEFT OUTER JOIN r_standard_reference_list ASR4 ON R.ad_rqmnt_type_sub_category_id &#61; ASR4.standard_reference_list_id&#10;      --&#10;      LEFT OUTER JOIN lic_condition LC ON RTD.lic_condition_id &#61; LC.lic_condition_id AND LC.active_flag &#61; 1 AND LC.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_lic_cond_type_main_cat LT ON LC.lic_cond_type_main_cat_id &#61; LT.lic_cond_type_main_cat_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR5 ON LC.lic_cond_type_sub_cat_id &#61; SR5.standard_reference_list_id&#10;      --&#10;      LEFT OUTER JOIN pss_rqmnt PSS ON PSS.pss_rqmnt_id &#61; RTD.pss_rqmnt_id AND PSS.active_flag &#61; 1 AND PSS.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_pss_rqmnt_type_main_category PSST ON PSS.pss_rqmnt_type_main_cat_id &#61; PSST.pss_rqmnt_type_main_cat_id&#10;        LEFT OUTER JOIN r_pss_rqmnt_type_sub_category ST6 ON PSS.pss_rqmnt_type_sub_cat_id &#61; ST6.pss_rqmnt_type_sub_cat_id&#10;      --&#10;      LEFT OUTER JOIN institutional_report IR ON IR.institutional_report_id &#61; RTD.institutional_report_id AND IR.date_sent IS NULL AND IR.date_abandoned IS NULL AND IR.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_standard_reference_list SR8 ON IR.institution_report_type_id &#61; SR8.standard_reference_list_id&#10;      --&#10;      LEFT OUTER JOIN court_report CR ON CR.court_report_id &#61; RTD.court_report_id AND CR.sent_to_court_date IS NULL&#10;                                         AND ( CR.delivered_court_report_type_id IS NULL&#10;                                               OR&#10;                                               CR.delivered_court_report_type_id !&#61; PKG_Lookups.funcgetTabRecord_CACHED(&#10;                                                                                        p_table   &#61;&gt; &#39;&#39;r_court_report_type&#39;&#39;,&#10;                                                                                        p_ref_col &#61;&gt; &#39;&#39;code&#39;&#39;,&#10;                                                                                        p_ref_val &#61;&gt; &#39;&#39;NIL&#39;&#39;,&#10;                                                                                        p_data_fld&#61;&gt; &#39;&#39;court_report_type_id&#39;&#39;) )&#10;                                         AND CR.soft_deleted &#61; 0&#10;        LEFT OUTER JOIN r_court_report_type CRR ON CR.court_report_type_id &#61; CRR.court_report_type_id&#10;      --&#10;  WHERE 1&#61;1&#10;    AND O.soft_deleted &#61; 0&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL  THEN &#39;RTD.origin_team_id &#61; :p_origin_team_id&#39;   ELSE &#39;:p_origin_team_id IS NULL&#39;  END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL  THEN &#39;RTD.target_team_id &#61; :p_target_team_id&#39;   ELSE &#39;:p_target_team_id IS NULL&#39;  END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;RTD.origin_staff_id &#61; :p_origin_staff_id&#39; ELSE &#39;:p_origin_staff_id IS NULL&#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;RTD.target_staff_id &#61; :p_target_staff_id&#39; ELSE &#39;:p_target_staff_id IS NULL&#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;RTD.target_provider_id &#61; :p_target_probation_area_id&#39; ELSE &#39;:p_target_probation_area_id IS NULL&#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;RTD.origin_provider_id &#61; :p_origin_probation_area_id&#39; ELSE &#39;:p_origin_probation_area_id IS NULL&#39; END || &#39;&#10;    AND RTD.transfer_request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;RTD.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;)&#10;--&#10;SELECT *&#10;FROM T&#10;ORDER BY&#10;  T.offender_id,&#10;  LPAD(NVL(T.event_number, &#39;&#39;0&#39;&#39;), 3),&#10;  DECODE( T.rec_level,&#10;      &#39;&#39;OM&#39;&#39;       , 1,&#10;      &#39;&#39;NSI&#39;&#39;      , 2,&#10;      &#39;&#39;EVENT&#39;&#39;    , 3,&#10;      &#39;&#39;RQMNT&#39;&#39;    , 4,&#10;      &#39;&#39;LC&#39;&#39;       , 5,&#10;      &#39;&#39;PSS_RQMNT&#39;&#39;, 6,&#10;      --&#39;&#39;NSI_EVENT&#39;&#39;, 7,&#10;      &#39;&#39;INST_RPT&#39;&#39; , 8,&#10;      &#39;&#39;COURT_RPT&#39;&#39;, 9,&#10;      10),&#10;  T.request_date&#39;;&#10;    --&#10;    ELSE&#10;        l_SQL :&#61;&#10;        --&#10;&#39;WITH L_OM AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;OM&#39;&#39;                       AS rec_level,&#10;    /*01*/ OT.request_date              AS request_date,&#10;    /*02*/ T1.description               AS tgt_team_desc,&#10;    /*03*/ S1.forename                  AS tgt_staff_forename,&#10;    /*04*/ S1.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP1.description              AS tgt_team_probation_area_desc,&#10;    /*06*/ NULL                         AS main_type_desc,&#10;    /*07*/ NULL                         AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ NULL                         AS add_main_type_desc,&#10;    /*11*/ NULL                         AS add_sub_type_desc,&#10;    /*12*/ SRTR1.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ OT.offender_transfer_id      AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NULL                         AS NSI_TRANSFER_ID,&#10;    /*17*/ NULL                         AS nsi_event_id,&#10;    /*18*/ NULL                         AS nsi_id,&#10;    --&#10;    /*19*/ NULL                         AS event_transfer_id,&#10;    /*20*/ NULL                         AS event_id,&#10;    /*21*/ NULL                         AS event_number,&#10;    --&#10;    /*22*/ NULL                         AS rqmnt_transfer_id,&#10;    /*23*/ NULL                         AS rqmnt_id,&#10;    --&#10;    /*24*/ NULL                         AS lic_condition_transfer_id,&#10;    /*25*/ NULL                         AS lic_condition_id,&#10;    --&#10;    /*26*/ NULL                         AS pss_rqmnt_transfer_id,&#10;    /*27*/ NULL                         AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ NULL                         AS inst_rpt_transfer_id,&#10;    /*29*/ NULL                         AS inst_rpt_id,&#10;    /*30*/ NULL                         AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ NULL                         AS court_report_transfer_id,&#10;    /*32*/ NULL                         AS court_report_id,&#10;    --&#10;    /*33*/ OT.transfer_status_date      AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ OT.receiving_team_id         AS tgt_team_id,&#10;    /*36*/ OT.receiving_staff_id        AS tgt_staff_id,&#10;    /*37*/ T1.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ OT.origin_team_id            AS orig_team_id,&#10;    /*39*/ OT.origin_staff_id           AS orig_staff_id,&#10;    /*40*/ ORIGINT1.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ OT.rejection_reason_id       AS rejection_reason_id&#10;    --&#10;  FROM&#10;    offender_transfer OT&#10;      INNER JOIN offender O ON OT.offender_id &#61; O.offender_id&#10;        INNER JOIN team T1 ON OT.receiving_team_id &#61; T1.team_id&#10;          INNER JOIN probation_area TP1 ON T1.probation_area_id &#61; TP1.probation_area_id&#10;        INNER JOIN team ORIGINT1 ON OT.origin_team_id &#61; ORIGINT1.team_id&#10;          INNER JOIN probation_area OP1 ON ORIGINT1.probation_area_id &#61; OP1.probation_area_id&#10;        INNER JOIN staff S1 ON OT.receiving_staff_id &#61; S1.staff_id&#10;      LEFT OUTER JOIN r_standard_reference_list SRTR1 ON OT.rejection_reason_id &#61; SRTR1.standard_reference_list_id&#10;  WHERE OT.soft_deleted &#61; 0&#10;    AND O.soft_deleted &#61; 0&#10;    AND OT.rejection_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; OT.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; OT.receiving_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;OT.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;OT.receiving_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP1.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP1.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND OT.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;OT.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM offender_transfer WHERE offender_id &#61; OT.offender_id AND CREATED_DATETIME &gt; OT.CREATED_DATETIME )&#10;),&#10;--&#10;L_NSI AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;NSI&#39;&#39;                      AS rec_level,&#10;    /*01*/ NTran.request_date           AS request_date,&#10;    /*02*/ T2.description               AS tgt_team_desc,&#10;    /*03*/ S2.forename                  AS tgt_staff_forename,&#10;    /*04*/ S2.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP2.description              AS tgt_team_probation_area_desc,&#10;    /*06*/ NT.description               AS main_type_desc,&#10;    /*07*/ SR2.code_description         AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ NULL                         AS add_main_type_desc,&#10;    /*11*/ NULL                         AS add_sub_type_desc,&#10;    /*12*/ SRTR2.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ NULL                         AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NTran.nsi_transfer_id        AS nsi_transfer_id,&#10;    /*17*/ N.EVENT_ID                   AS nsi_event_id,&#10;    /*18*/ N.NSI_ID                     AS nsi_id,&#10;    --&#10;    /*19*/ NULL                         AS event_transfer_id,&#10;    /*20*/ NULL                         AS event_id,&#10;    /*21*/ NULL                         AS event_number,&#10;    --&#10;    /*22*/ NULL                         AS rqmnt_transfer_id,&#10;    /*23*/ NULL                         AS rqmnt_id,&#10;    --&#10;    /*24*/ NULL                         AS lic_condition_transfer_id,&#10;    /*25*/ NULL                         AS lic_condition_id,&#10;    --&#10;    /*26*/ NULL                         AS pss_rqmnt_transfer_id,&#10;    /*27*/ NULL                         AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ NULL                         AS inst_rpt_transfer_id,&#10;    /*29*/ NULL                         AS inst_rpt_id,&#10;    /*30*/ NULL                         AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ NULL                         AS court_report_transfer_id,&#10;    /*32*/ NULL                         AS court_report_id,&#10;    --&#10;    /*33*/ NTran.transfer_status_date   AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ NTRAN.target_team_id         AS tgt_team_id,&#10;    /*36*/ NTRAN.target_staff_id        AS tgt_staff_id,&#10;    /*37*/ T2.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ NTRAN.origin_team_id         AS orig_team_id,&#10;    /*39*/ NTRAN.origin_staff_id        AS orig_staff_id,&#10;    /*40*/ ORIGINT2.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ NTRAN.rejection_reason_id    AS rejection_reason_id&#10;    --&#10;  FROM&#10;    nsi_transfer NTran&#10;    INNER JOIN offender O ON NTran.offender_id &#61; O.offender_id&#10;    INNER JOIN nsi N ON N.nsi_id &#61; NTran.nsi_id&#10;      INNER JOIN R_NSI_TYPE NT ON N.nsi_type_id &#61; NT.nsi_type_id&#10;      LEFT OUTER JOIN r_standard_reference_list SR2 ON N.nsi_sub_type_id &#61; SR2.standard_reference_list_id&#10;    INNER JOIN team T2 ON NTran.target_team_id &#61; T2.team_id&#10;      INNER JOIN probation_area TP2 ON T2.probation_area_id &#61; TP2.probation_area_id&#10;    INNER JOIN team ORIGINT2 ON NTran.origin_team_id &#61; ORIGINT2.team_id&#10;      INNER JOIN probation_area OP2 ON ORIGINT2.probation_area_id &#61; OP2.probation_area_id&#10;    INNER JOIN STAFF S2 ON NTran.target_staff_id &#61; S2.staff_id&#10;    LEFT OUTER JOIN r_standard_reference_list SRTR2 ON NTran.rejection_reason_id &#61; SRTR2.standard_reference_list_id&#10;  WHERE NTran.soft_deleted &#61; 0&#10;    AND n.active_flag &#61; 1&#10;    AND NTran.rejection_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; NTran.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; NTran.target_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;NTran.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;NTran.target_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP2.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP2.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND NTran.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;NTran.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM nsi_transfer WHERE nsi_id &#61; NTran.nsi_id AND CREATED_DATETIME &gt; NTran.CREATED_DATETIME )&#10;),&#10;--&#10;L_EVENT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;EVENT&#39;&#39;                    AS rec_level,&#10;    /*01*/ OT.request_date              AS request_date,&#10;    /*02*/ T3.description               AS tgt_team_desc,&#10;    /*03*/ S3.forename                  AS tgt_staff_forename,&#10;    /*04*/ S3.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP3.description               AS tgt_team_probation_area_desc,&#10;    /*06*/ DT.description               AS main_type_desc,&#10;    /*07*/ NULL                         AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ NULL                         AS add_main_type_desc,&#10;    /*11*/ NULL                         AS add_sub_type_desc,&#10;    /*12*/ SRTR3.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ NULL                         AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NULL                         AS nsi_transfer_id,&#10;    /*17*/ NULL                         AS nsi_event_id,&#10;    /*18*/ NULL                         AS nsi_id,&#10;    --&#10;    /*19*/ OT.order_transfer_id         AS event_transfer_id,&#10;    /*20*/ OT.event_id                  AS event_id,&#10;    /*21*/ E.event_number               AS event_number,&#10;    --&#10;    /*22*/ NULL                         AS rqmnt_transfer_id,&#10;    /*23*/ NULL                         AS rqmnt_id,&#10;    --&#10;    /*24*/ NULL                         AS lic_condition_transfer_id,&#10;    /*25*/ NULL                         AS lic_condition_id,&#10;    --&#10;    /*26*/ NULL                         AS pss_rqmnt_transfer_id,&#10;    /*27*/ NULL                         AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ NULL                         AS inst_rpt_transfer_id,&#10;    /*29*/ NULL                         AS inst_rpt_id,&#10;    /*30*/ NULL                         AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ NULL                         AS court_report_transfer_id,&#10;    /*32*/ NULL                         AS court_report_id,&#10;    --&#10;    /*33*/ OT.transfer_status_date      AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ OT.receiving_team_id         AS tgt_team_id,&#10;    /*36*/ OT.receiving_staff_id        AS tgt_staff_id,&#10;    /*37*/ T3.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ OT.origin_team_id            AS orig_team_id,&#10;    /*39*/ OT.origin_staff_id           AS orig_staff_id,&#10;    /*40*/ ORIGINT3.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ OT.rejection_reason_id       AS rejection_reason_id&#10;    --&#10;  FROM&#10;    order_transfer OT&#10;      INNER JOIN offender O ON OT.offender_id &#61; O.offender_id&#10;      INNER JOIN event E ON E.event_id &#61; OT.event_id&#10;        LEFT OUTER JOIN disposal D ON E.event_id &#61; D.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;          LEFT OUTER JOIN r_disposal_type DT ON D.disposal_type_id &#61; DT.disposal_type_id&#10;      INNER JOIN team T3 ON OT.receiving_team_id &#61; T3.team_id&#10;        INNER JOIN probation_area TP3 ON T3.probation_area_id &#61; TP3.probation_area_id&#10;      LEFT OUTER JOIN team ORIGINT3 ON OT.origin_team_id &#61; ORIGINT3.team_id&#10;        INNER JOIN probation_area OP3 ON ORIGINT3.probation_area_id &#61; OP3.probation_area_id&#10;      INNER JOIN staff S3 ON OT.receiving_staff_id &#61; S3.staff_id&#10;      LEFT OUTER JOIN r_standard_reference_list SRTR3 ON OT.rejection_reason_id &#61; SRTR3.standard_reference_list_id&#10;  WHERE OT.soft_deleted &#61; 0&#10;    AND E.active_flag &#61; 1&#10;    AND OT.rejection_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; OT.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; OT.receiving_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;OT.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;OT.receiving_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP3.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP3.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND OT.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;OT.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM order_transfer WHERE event_id &#61; OT.event_id AND CREATED_DATETIME &gt; OT.CREATED_DATETIME )&#10;),&#10;--&#10;L_RQMNT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;RQMNT&#39;&#39;                    AS rec_level,&#10;    /*01*/ RTRAN.request_date           AS request_date,&#10;    /*02*/ T4.description               AS tgt_team_desc,&#10;    /*03*/ S4.forename                  AS tgt_staff_forename,&#10;    /*04*/ S4.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP4.description              AS tgt_team_probation_area_desc,&#10;    /*06*/ RT.description               AS main_type_desc,&#10;    /*07*/ SR4.code_description         AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ ART.description              AS add_main_type_desc,&#10;    /*11*/ ASR4.code_description        AS add_sub_type_desc,&#10;    /*12*/ SRTR4.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ NULL                         AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NULL                         AS NSI_TRANSFER_ID,&#10;    /*17*/ NULL                         AS nsi_event_id,&#10;    /*18*/ NULL                         AS nsi_id,&#10;    --&#10;    /*19*/ NULL                         AS event_transfer_id,&#10;    /*20*/ NULL                         AS event_id,&#10;    /*21*/ NULL                         AS event_number,&#10;    --&#10;    /*22*/ RTRAN.rqmnt_transfer_id      AS rqmnt_transfer_id,&#10;    /*23*/ RTRAN.rqmnt_id               AS rqmnt_id,&#10;    --&#10;    /*24*/ NULL                         AS lic_condition_transfer_id,&#10;    /*25*/ NULL                         AS lic_condition_id,&#10;    --&#10;    /*26*/ NULL                         AS pss_rqmnt_transfer_id,&#10;    /*27*/ NULL                         AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ NULL                         AS inst_rpt_transfer_id,&#10;    /*29*/ NULL                         AS inst_rpt_id,&#10;    /*30*/ NULL                         AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ NULL                         AS court_report_transfer_id,&#10;    /*32*/ NULL                         AS court_report_id,&#10;    --&#10;    /*33*/ RTRAN.transfer_status_date   AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ RTRAN.receiving_team_id      AS tgt_team_id,&#10;    /*36*/ RTRAN.receiving_staff_id     AS tgt_staff_id,&#10;    /*37*/ T4.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ RTRAN.origin_team_id         AS orig_team_id,&#10;    /*39*/ RTRAN.origin_staff_id        AS orig_staff_id,&#10;    /*40*/ ORIGINT4.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ RTRAN.rejection_reason_id    AS rejection_reason_id&#10;    --&#10;  FROM&#10;    rqmnt_transfer RTRAN&#10;      INNER JOIN offender O ON RTRAN.offender_id &#61; O.offender_id&#10;      INNER JOIN rqmnt R ON RTRAN.rqmnt_id &#61; R.rqmnt_id&#10;        LEFT OUTER JOIN r_rqmnt_type_main_category RT ON R.rqmnt_type_main_category_id &#61; RT.rqmnt_type_main_category_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR4 ON R.rqmnt_type_sub_category_id &#61; SR4.standard_reference_list_id&#10;        LEFT OUTER JOIN r_ad_rqmnt_type_main_category ART ON R.ad_rqmnt_type_main_category_id &#61; ART.ad_rqmnt_type_main_category_id&#10;        LEFT OUTER JOIN r_standard_reference_list ASR4 ON R.ad_rqmnt_type_sub_category_id &#61; ASR4.standard_reference_list_id&#10;      LEFT OUTER JOIN team T4 ON RTRAN.receiving_team_id &#61; T4.team_id&#10;        LEFT OUTER JOIN probation_area TP4 ON T4.probation_area_id &#61; TP4.probation_area_id&#10;      LEFT OUTER JOIN team ORIGINT4 ON RTRAN.origin_team_id &#61; ORIGINT4.team_id&#10;        LEFT OUTER JOIN probation_area OP4 ON ORIGINT4.probation_area_id &#61; OP4.probation_area_id&#10;      LEFT OUTER JOIN staff S4 ON RTRAN.receiving_staff_id &#61; S4.staff_id&#10;      LEFT OUTER JOIN r_standard_reference_list SRTR4 ON RTRAN.rejection_reason_id &#61; SRTR4.standard_reference_list_id&#10;  WHERE RTRAN.soft_deleted &#61; 0&#10;    AND R.active_flag &#61; 1&#10;    AND RTRAN.rejection_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; RTRAN.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; RTRAN.receiving_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;RTRAN.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;RTRAN.receiving_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP4.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP4.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND RTRAN.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;RTRAN.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM rqmnt_transfer WHERE rqmnt_id &#61; RTRAN.rqmnt_id AND CREATED_DATETIME &gt; RTRAN.CREATED_DATETIME )&#10;),&#10;--&#10;L_LC AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;LC&#39;&#39;                       AS rec_level,&#10;    /*01*/ LTRAN.request_date           AS request_date,&#10;    /*02*/ T5.description               AS tgt_team_desc,&#10;    /*03*/ S5.forename                  AS tgt_staff_forename,&#10;    /*04*/ S5.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP5.description              AS tgt_team_probation_area_desc,&#10;    /*06*/ LT.description               AS main_type_desc,&#10;    /*07*/ SR5.code_description         AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ NULL                         AS add_main_type_desc,&#10;    /*11*/ NULL                         AS add_sub_type_desc,&#10;    /*12*/ SRTR5.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ NULL                         AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NULL                         AS nsi_transfer_id,&#10;    /*17*/ NULL                         AS nsi_event_id,&#10;    /*18*/ NULL                         AS nsi_id,&#10;    --&#10;    /*19*/ NULL                         AS event_transfer_id,&#10;    /*20*/ NULL                         AS event_id,&#10;    /*21*/ NULL                         AS event_number,&#10;    --&#10;    /*22*/ NULL                         AS rqmnt_transfer_id,&#10;    /*23*/ NULL                         AS rqmnt_id,&#10;    --&#10;    /*24*/ LTRAN.lic_condition_transfer_id  AS lic_condition_transfer_id,&#10;    /*25*/ LTRAN.lic_condition_id           AS lic_condition_id,&#10;    --&#10;    /*26*/ NULL                         AS pss_rqmnt_transfer_id,&#10;    /*27*/ NULL                         AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ NULL                         AS inst_rpt_transfer_id,&#10;    /*29*/ NULL                         AS inst_rpt_id,&#10;    /*30*/ NULL                         AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ NULL                         AS court_report_transfer_id,&#10;    /*32*/ NULL                         AS court_report_id,&#10;    --&#10;    /*33*/ LTRAN.transfer_status_date   AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ LTRAN.receiving_team_id      AS tgt_team_id,&#10;    /*36*/ LTRAN.receiving_staff_id     AS tgt_staff_id,&#10;    /*37*/ T5.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ LTRAN.origin_team_id         AS orig_team_id,&#10;    /*39*/ LTRAN.origin_staff_id        AS orig_staff_id,&#10;    /*40*/ ORIGINT5.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ LTRAN.rejection_reason_id    AS rejection_reason_id&#10;    --&#10;  FROM&#10;    lic_condition_transfer LTRAN&#10;      INNER JOIN offender O ON LTRAN.offender_id &#61; O.offender_id&#10;      INNER JOIN lic_condition LC ON LTRAN.lic_condition_id &#61; LC.lic_condition_id&#10;        LEFT OUTER JOIN r_lic_cond_type_main_cat LT ON LC.lic_cond_type_main_cat_id &#61; LT.lic_cond_type_main_cat_id&#10;        LEFT OUTER JOIN r_standard_reference_list SR5 ON LC.lic_cond_type_sub_cat_id &#61; SR5.standard_reference_list_id&#10;      LEFT OUTER JOIN team T5 ON LTRAN.receiving_team_id &#61; T5.team_id&#10;        LEFT OUTER JOIN probation_area TP5 ON T5.probation_area_id &#61; TP5.probation_area_id&#10;      LEFT OUTER JOIN team ORIGINT5 ON LTRAN.origin_team_id &#61; ORIGINT5.team_id&#10;        LEFT OUTER JOIN probation_area OP5 ON ORIGINT5.probation_area_id &#61; OP5.probation_area_id&#10;      LEFT OUTER JOIN staff S5 ON LTRAN.receiving_staff_id &#61; S5.staff_id&#10;      LEFT OUTER JOIN r_standard_reference_list SRTR5 ON LTRAN.rejection_reason_id &#61; SRTR5.standard_reference_list_id&#10;  WHERE LTRAN.soft_deleted &#61; 0&#10;    AND LC.active_flag &#61; 1&#10;    AND LTRAN.rejection_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; LTRAN.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; LTRAN.receiving_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;LTRAN.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;LTRAN.receiving_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP5.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP5.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND LTRAN.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;LTRAN.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM lic_condition_transfer WHERE lic_condition_id &#61; LTRAN.lic_condition_id AND CREATED_DATETIME &gt; LTRAN.CREATED_DATETIME )&#10;),&#10;--&#10;L_PSS_RQMNT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;PSS_RQMNT&#39;&#39;                AS rec_level,&#10;    /*01*/ PTRAN.request_date           AS request_date,&#10;    /*02*/ T6.description               AS tgt_team_desc,&#10;    /*03*/ S6.forename                  AS tgt_staff_forename,&#10;    /*04*/ S6.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP6.description               AS tgt_team_probation_area_desc,&#10;    /*06*/ psst.description             AS main_type_desc,&#10;    /*07*/ st6.description              AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ NULL                         AS add_main_type_desc,&#10;    /*11*/ NULL                         AS add_sub_type_desc,&#10;    /*12*/ SRTR6.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ NULL                         AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NULL                         AS nsi_transfer_id,&#10;    /*17*/ NULL                         AS nsi_event_id,&#10;    /*18*/ NULL                         AS nsi_id,&#10;    --&#10;    /*19*/ NULL                         AS event_transfer_id,&#10;    /*20*/ NULL                         AS event_id,&#10;    /*21*/ NULL                         AS event_number,&#10;    --&#10;    /*22*/ NULL                         AS rqmnt_transfer_id,&#10;    /*23*/ NULL                         AS rqmnt_id,&#10;    --&#10;    /*24*/ NULL                         AS lic_condition_transfer_id,&#10;    /*25*/ NULL                         AS lic_condition_id,&#10;    --&#10;    /*26*/ PTRAN.pss_rqmnt_transfer_id  AS pss_rqmnt_transfer_id,&#10;    /*27*/ PTRAN.pss_rqmnt_id           AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ NULL                         AS inst_rpt_transfer_id,&#10;    /*29*/ NULL                         AS inst_rpt_id,&#10;    /*30*/ NULL                         AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ NULL                         AS court_report_transfer_id,&#10;    /*32*/ NULL                         AS court_report_id,&#10;    --&#10;    /*33*/ PTRAN.transfer_status_date   AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ PTRAN.receiving_team_id      AS tgt_team_id,&#10;    /*36*/ PTRAN.receiving_staff_id     AS tgt_staff_id,&#10;    /*37*/ T6.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ PTRAN.origin_team_id         AS orig_team_id,&#10;    /*39*/ PTRAN.origin_staff_id        AS orig_staff_id,&#10;    /*40*/ ORIGINT6.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ PTRAN.rejection_reason_id    AS rejection_reason_id&#10;    --&#10;  FROM&#10;    pss_rqmnt_transfer PTRAN&#10;      INNER JOIN offender O ON PTRAN.offender_id &#61; O.offender_id&#10;      INNER JOIN pss_rqmnt PSS ON PSS.pss_rqmnt_id &#61; PTRAN.pss_rqmnt_id&#10;        LEFT OUTER JOIN r_pss_rqmnt_type_main_category PSST ON PSS.pss_rqmnt_type_main_cat_id &#61; PSST.pss_rqmnt_type_main_cat_id&#10;        LEFT OUTER JOIN r_pss_rqmnt_type_sub_category ST6 ON PSS.pss_rqmnt_type_sub_cat_id &#61; ST6.pss_rqmnt_type_sub_cat_id&#10;      LEFT OUTER JOIN team T6 ON PTRAN.receiving_team_id &#61; T6.team_id&#10;        LEFT OUTER JOIN probation_area TP6 ON T6.probation_area_id &#61; TP6.probation_area_id&#10;      LEFT OUTER JOIN team ORIGINT6 ON PTRAN.origin_team_id &#61; ORIGINT6.team_id&#10;        INNER JOIN probation_area OP6 ON ORIGINT6.probation_area_id &#61; OP6.probation_area_id&#10;      LEFT OUTER JOIN staff S6 ON PTRAN.receiving_staff_id &#61; S6.staff_id&#10;      INNER JOIN r_standard_reference_list SRTR6 ON PTRAN.rejection_reason_id &#61; SRTR6.standard_reference_list_id&#10;  WHERE PTRAN.soft_deleted &#61; 0&#10;    AND PSS.active_flag &#61; 1&#10;    AND PTRAN.rejection_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; PTRAN.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; PTRAN.receiving_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;PTRAN.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;PTRAN.receiving_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP6.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP6.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND PTRAN.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;PTRAN.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM pss_rqmnt_transfer WHERE pss_rqmnt_id &#61; PTRAN.pss_rqmnt_id AND CREATED_DATETIME &gt; PTRAN.CREATED_DATETIME )&#10;),&#10;--&#10;L_INST_REP AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;INST_RPT&#39;&#39;                 AS rec_level,&#10;    /*01*/ IRTRAN.request_date          AS request_date,&#10;    /*02*/ T8.description               AS tgt_team_desc,&#10;    /*03*/ S8.forename                  AS tgt_staff_forename,&#10;    /*04*/ S8.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP8.description              AS tgt_team_probation_area_desc,&#10;    /*06*/ sr8.code_description         AS main_type_desc,&#10;    /*07*/ NULL                         AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ NULL                         AS add_main_type_desc,&#10;    /*11*/ NULL                         AS add_sub_type_desc,&#10;    /*12*/ SRTR8.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ NULL                         AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NULL                         AS nsi_transfer_id,&#10;    /*17*/ NULL                         AS nsi_event_id,&#10;    /*18*/ NULL                         AS nsi_id,&#10;    --&#10;    /*19*/ NULL                         AS event_transfer_id,&#10;    /*20*/ NULL                         AS event_id,&#10;    /*21*/ NULL                         AS event_number,&#10;    --&#10;    /*22*/ NULL                         AS rqmnt_transfer_id,&#10;    /*23*/ NULL                         AS rqmnt_id,&#10;    --&#10;    /*24*/ NULL                         AS lic_condition_transfer_id,&#10;    /*25*/ NULL                         AS lic_condition_id,&#10;    --&#10;    /*26*/ NULL                         AS pss_rqmnt_transfer_id,&#10;    /*27*/ NULL                         AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ IRTRAN.institutional_rep_transfer_id AS inst_rpt_transfer_id,&#10;    /*29*/ IRTRAN.institutional_report_id       AS inst_rpt_id,&#10;    /*30*/ IR.custody_id                        AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ NULL                         AS court_report_transfer_id,&#10;    /*32*/ NULL                         AS court_report_id,&#10;    --&#10;    /*33*/ IRTRAN.transfer_status_date  AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ IRTRAN.receiving_team_id     AS tgt_team_id,&#10;    /*36*/ IRTRAN.receiving_staff_id    AS tgt_staff_id,&#10;    /*37*/ T8.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ IRTRAN.origin_team_id        AS orig_team_id,&#10;    /*39*/ IRTRAN.origin_staff_id       AS orig_staff_id,&#10;    /*40*/ ORIGINT8.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ IRTRAN.rejection_reason_id   AS rejection_reason_id&#10;    --&#10;  FROM&#10;    institutional_report_transfer IRTRAN&#10;      INNER JOIN offender O ON IRTRAN.offender_id &#61; O.offender_id&#10;      INNER JOIN institutional_report IR ON IR.institutional_report_id &#61; IRTRAN.institutional_report_id&#10;        INNER JOIN r_standard_reference_list SR8 ON IR.institution_report_type_id &#61; SR8.standard_reference_list_id&#10;      LEFT OUTER JOIN team T8 ON IRTRAN.receiving_team_id &#61; T8.team_id&#10;        LEFT OUTER JOIN probation_area TP8 ON T8.probation_area_id &#61; TP8.probation_area_id&#10;      LEFT OUTER JOIN team ORIGINT8 ON IRTRAN.origin_team_id &#61; ORIGINT8.team_id&#10;        INNER JOIN probation_area OP8 ON ORIGINT8.probation_area_id &#61; OP8.probation_area_id&#10;      LEFT OUTER JOIN staff S8 ON IRTRAN.receiving_staff_id &#61; S8.staff_id&#10;      LEFT OUTER JOIN r_standard_reference_list SRTR8 ON IRTRAN.rejection_reason_id &#61; SRTR8.standard_reference_list_id&#10;  WHERE IRTRAN.soft_deleted &#61; 0&#10;    AND IR.date_sent IS NULL&#10;    AND IR.date_abandoned IS NULL&#10;    AND IRTRAN.rejection_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; IRTRAN.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; IRTRAN.receiving_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;IRTRAN.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;IRTRAN.receiving_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP8.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP8.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND IRTRAN.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;IRTRAN.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM institutional_report_transfer WHERE institutional_report_id &#61; IRTRAN.institutional_report_id AND CREATED_DATETIME &gt; IRTRAN.CREATED_DATETIME )&#10;),&#10;--&#10;L_COURT_REPORT AS (&#10;  SELECT&#10;    /*00*/ &#39;&#39;COURT_RPT&#39;&#39;                AS rec_level,&#10;    /*01*/ CRTRAN.request_date          AS request_date,&#10;    /*02*/ T9.description               AS tgt_team_desc,&#10;    /*03*/ S9.forename                  AS tgt_staff_forename,&#10;    /*04*/ S9.surname                   AS tgt_staff_surname,&#10;    /*05*/ TP9.description              AS tgt_team_probation_area_desc,&#10;    /*06*/ crr.description              AS main_type_desc,&#10;    /*07*/ NULL                         AS sub_type_desc,&#10;    /*08*/ NULL                         AS main_type_id,&#10;    /*09*/ NULL                         AS add_main_type_id,&#10;    /*10*/ NULL                         AS add_main_type_desc,&#10;    /*11*/ NULL                         AS add_sub_type_desc,&#10;    /*12*/ SRTR9.code_description       AS rejection_reason_desc,&#10;    --&#10;    /*13*/ NULL                         AS offender_transfer_id,&#10;    /*14*/ O.offender_id                AS offender_id,&#10;    /*15*/ O.crn                        AS crn,&#10;    --&#10;    /*16*/ NULL                         AS nsi_transfer_id,&#10;    /*17*/ NULL                         AS nsi_event_id,&#10;    /*18*/ NULL                         AS nsi_id,&#10;    --&#10;    /*19*/ NULL                         AS event_transfer_id,&#10;    /*20*/ NULL                         AS event_id,&#10;    /*21*/ NULL                         AS event_number,&#10;    --&#10;    /*22*/ NULL                         AS rqmnt_transfer_id,&#10;    /*23*/ NULL                         AS rqmnt_id,&#10;    --&#10;    /*24*/ NULL                         AS lic_condition_transfer_id,&#10;    /*25*/ NULL                         AS lic_condition_id,&#10;    --&#10;    /*26*/ NULL                         AS pss_rqmnt_transfer_id,&#10;    /*27*/ NULL                         AS pss_rqmnt_id,&#10;    --&#10;    /*28*/ NULL                         AS inst_rpt_transfer_id,&#10;    /*29*/ NULL                         AS inst_rpt_id,&#10;    /*30*/ NULL                         AS inst_rpt_custody_id,&#10;    --&#10;    /*31*/ CRTRAN.court_report_transfer_id  AS court_report_transfer_id,&#10;    /*32*/ CRTRAN.court_report_id           AS court_report_id,&#10;    --&#10;    /*33*/ CRTRAN.transfer_status_date  AS transfer_status_date,&#10;    /*34*/ O.current_restriction        AS current_restriction,&#10;    --&#10;    /*35*/ CRTRAN.receiving_team_id     AS tgt_team_id,&#10;    /*36*/ CRTRAN.receiving_staff_id    AS tgt_staff_id,&#10;    /*37*/ T9.probation_area_id         AS tgt_probation_area_id,&#10;    /*38*/ CRTRAN.origin_team_id        AS orig_team_id,&#10;    /*39*/ CRTRAN.origin_staff_id       AS orig_staff_id,&#10;    /*40*/ ORIGINT9.probation_area_id   AS orig_probation_area_id,&#10;    /*41*/ CRTRAN.rejected_reason_id    AS rejection_reason_id&#10;    --&#10;  FROM&#10;    court_report_transfer CRTRAN&#10;      INNER JOIN offender O ON CRTRAN.offender_id &#61; O.offender_id&#10;      INNER JOIN court_report CR ON CR.court_report_id &#61; CRTRAN.court_report_id&#10;        LEFT OUTER JOIN r_court_report_type CRR ON CR.court_report_type_id &#61; CRR.court_report_type_id&#10;      LEFT OUTER JOIN team T9 ON CRTRAN.receiving_team_id &#61; T9.team_id&#10;        LEFT OUTER JOIN probation_area TP9 ON T9.probation_area_id &#61; TP9.probation_area_id&#10;      LEFT OUTER JOIN team ORIGINT9 ON CRTRAN.origin_team_id &#61; ORIGINT9.team_id&#10;        LEFT OUTER JOIN probation_area OP9 ON ORIGINT9.probation_area_id &#61; OP9.probation_area_id&#10;      LEFT OUTER JOIN staff S9 ON CRTRAN.receiving_staff_id &#61; S9.staff_id&#10;      LEFT OUTER JOIN r_standard_reference_list SRTR9 ON CRTRAN.REJECTED_REASON_ID &#61; SRTR9.standard_reference_list_id&#10;  WHERE CRTRAN.soft_deleted &#61; 0&#10;    AND CR.sent_to_court_date IS NULL&#10;    AND ( CR.delivered_court_report_type_id IS NULL&#10;          OR&#10;          CR.delivered_court_report_type_id !&#61; (SELECT CRT.court_report_type_id FROM r_court_report_type crt WHERE CRT.code &#61; &#39;&#39;NIL&#39;&#39;) )&#10;    AND CRTRAN.rejected_reason_id IS NOT NULL&#10;    AND &#39; || CASE WHEN p_origin_team_id IS NOT NULL THEN &#39; CRTRAN.origin_team_id &#61; :p_origin_team_id &#39; ELSE &#39;:p_origin_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_team_id IS NOT NULL THEN &#39; CRTRAN.receiving_team_id &#61; :p_target_team_id &#39; ELSE &#39;:p_target_team_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_staff_id IS NOT NULL THEN &#39;CRTRAN.origin_staff_id &#61; :p_origin_staff_id &#39; ELSE &#39;:p_origin_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_staff_id IS NOT NULL THEN &#39;CRTRAN.receiving_staff_id &#61; :p_target_staff_id &#39; ELSE &#39;:p_target_staff_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_target_probation_area_id IS NOT NULL THEN &#39;TP9.PROBATION_AREA_ID &#61; :p_target_probation_area_id &#39; ELSE &#39;:p_target_probation_area_id IS NULL &#39; END || &#39;&#10;    AND &#39; || CASE WHEN p_origin_probation_area_id IS NOT NULL THEN &#39;OP9.PROBATION_AREA_ID &#61; :p_origin_probation_area_id &#39; ELSE &#39;:p_origin_probation_area_id IS NULL &#39; END || &#39;&#10;    AND CRTRAN.request_date BETWEEN :p_start_date AND NVL(:p_end_date, SYSDATE+1)&#10;    AND &#39; || CASE WHEN p_offender_id IS NOT NULL THEN &#39;CRTRAN.offender_id &#61; :p_offender_id&#39; ELSE &#39;:p_offender_id IS NULL&#39; END || &#39;&#10;    AND NOT EXISTS( SELECT 1 FROM court_report_transfer WHERE court_report_id &#61; CRTRAN.court_report_id AND CREATED_DATETIME &gt; CRTRAN.CREATED_DATETIME )&#10;),&#10;--&#10;T AS (&#10;  SELECT * FROM L_OM          UNION ALL&#10;  SELECT * FROM L_NSI         UNION ALL&#10;  SELECT * FROM L_EVENT       UNION ALL&#10;  SELECT * FROM L_RQMNT       UNION ALL&#10;  SELECT * FROM L_LC          UNION ALL&#10;  SELECT * FROM L_PSS_RQMNT   UNION ALL&#10;  SELECT * FROM L_INST_REP    UNION ALL&#10;  SELECT * FROM L_COURT_REPORT )&#10;--&#10;SELECT *&#10;FROM T&#10;ORDER BY&#10;  T.offender_id,&#10;  LPAD(NVL(T.event_number, &#39;&#39;0&#39;&#39;), 3),&#10;  DECODE( T.rec_level,&#10;      &#39;&#39;OM&#39;&#39;       , 1,&#10;      &#39;&#39;NSI&#39;&#39;      , 2,&#10;      &#39;&#39;EVENT&#39;&#39;    , 3,&#10;      &#39;&#39;RQMNT&#39;&#39;    , 4,&#10;      &#39;&#39;LC&#39;&#39;       , 5,&#10;      &#39;&#39;PSS_RQMNT&#39;&#39;, 6,&#10;      --&#39;&#39;NSI_EVENT&#39;&#39;, 7,&#10;      &#39;&#39;INST_RPT&#39;&#39; , 8,&#10;      &#39;&#39;COURT_RPT&#39;&#39;, 9,&#10;      10),&#10;  T.request_date&#39;;&#10;        --&#10;    END IF;&#10;    --&#10;    IF NVLSTR(p_use_live_query_flag, &#39;N&#39;) &#61; &#39;N&#39; THEN&#10;        OPEN l_cur FOR l_SQL&#10;        USING&#10;          p_origin_team_id,&#10;          p_target_team_id,&#10;          p_origin_staff_id,&#10;          p_target_staff_id,&#10;          p_target_probation_area_id,&#10;          p_origin_probation_area_id,&#10;          p_start_date, p_end_date,&#10;          p_offender_id;&#10;    ELSE&#10;        OPEN l_cur FOR l_SQL&#10;        USING&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id,&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id,&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id,&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id,&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id,&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id,&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id,&#10;          p_origin_team_id, p_target_team_id, p_origin_staff_id, p_target_staff_id, p_target_probation_area_id, p_origin_probation_area_id, p_start_date, p_end_date, p_offender_id&#10;        ;&#10;    END IF;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab;&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_cnt :&#61; l_cnt + 1;&#10;        PIPE ROW ( l_tab(l_i) );&#10;    END LOOP;&#10;    --&#10;    procDebug( lc_proc || &#39; (rows&#61;&#39; || l_tab.COUNT  || &#39;)&#39;   ||&#10;        &#39;(&#39; || PKG_Debug.funcgetDbStats  || &#39;): &#39; ||&#10;        &#39;(p_use_live_query_flag&#61;&#39;       || p_use_live_query_flag      || &#39;)&#39; ||&#10;        &#39;(p_offender_id&#61;&#39;               || p_offender_id              || &#39;)&#39; ||&#10;        &#39;(p_origin_team_id&#61;&#39;            || p_origin_team_id           || &#39;)&#39; ||&#10;        &#39;(p_origin_staff_id&#61;&#39;           || p_origin_staff_id          || &#39;)&#39; ||&#10;        &#39;(p_start_date&#61;&#39;                || p_start_date               || &#39;)&#39; ||&#10;        &#39;(p_end_date&#61;&#39;                  || p_end_date                 || &#39;)&#39; ||&#10;        &#39;(p_target_team_id&#61;&#39;            || p_target_team_id           || &#39;)&#39; ||&#10;        &#39;(p_target_staff_id&#61;&#39;           || p_target_staff_id          || &#39;)&#39; ||&#10;        &#39;(p_target_probation_area_id&#61;&#39;  || p_target_probation_area_id || &#39;)&#39; ||&#10;        &#39;(p_origin_probation_area_id&#61;&#39;  || p_origin_probation_area_id || &#39;)&#39; ||&#10;        l_SQL );&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_NEEDED THEN&#10;        procDebug( lc_proc || &#39; (&#39; || l_cnt || &#39; of &#39; || l_tab.COUNT || &#39; rows called from the cursor)&#39; ||&#10;            &#39;(&#39; || PKG_Debug.funcgetDbStats       || &#39;): &#39; ||&#10;            &#39;(p_use_live_query_flag&#61;&#39;       || p_use_live_query_flag      || &#39;)&#39; ||&#10;            &#39;(p_offender_id&#61;&#39;               || p_offender_id              || &#39;)&#39; ||&#10;            &#39;(p_origin_team_id&#61;&#39;            || p_origin_team_id           || &#39;)&#39; ||&#10;            &#39;(p_origin_staff_id&#61;&#39;           || p_origin_staff_id          || &#39;)&#39; ||&#10;            &#39;(p_start_date&#61;&#39;                || p_start_date               || &#39;)&#39; ||&#10;            &#39;(p_end_date&#61;&#39;                  || p_end_date                 || &#39;)&#39; ||&#10;            &#39;(p_target_team_id&#61;&#39;            || p_target_team_id           || &#39;)&#39; ||&#10;            &#39;(p_target_staff_id&#61;&#39;           || p_target_staff_id          || &#39;)&#39; ||&#10;            &#39;(p_target_probation_area_id&#61;&#39;  || p_target_probation_area_id || &#39;)&#39; ||&#10;            &#39;(p_origin_probation_area_id&#61;&#39;  || p_origin_probation_area_id || &#39;)&#39; ||&#10;            l_SQL );&#10;    WHEN OTHERS THEN&#10;        procDebug( lc_proc || &#39; ERROR: &#39; || SQLERRM || &#39; &#39; ||&#10;            &#39;(p_use_live_query_flag&#61;&#39;       || p_use_live_query_flag      || &#39;)&#39; ||&#10;            &#39;(p_offender_id&#61;&#39;               || p_offender_id              || &#39;)&#39; ||&#10;            &#39;(p_origin_team_id&#61;&#39;            || p_origin_team_id           || &#39;)&#39; ||&#10;            &#39;(p_origin_staff_id&#61;&#39;           || p_origin_staff_id          || &#39;)&#39; ||&#10;            &#39;(p_start_date&#61;&#39;                || p_start_date               || &#39;)&#39; ||&#10;            &#39;(p_end_date&#61;&#39;                  || p_end_date                 || &#39;)&#39; ||&#10;            &#39;(p_target_team_id&#61;&#39;            || p_target_team_id           || &#39;)&#39; ||&#10;            &#39;(p_target_staff_id&#61;&#39;           || p_target_staff_id          || &#39;)&#39; ||&#10;            &#39;(p_target_probation_area_id&#61;&#39;  || p_target_probation_area_id || &#39;)&#39; ||&#10;            &#39;(p_origin_probation_area_id&#61;&#39;  || p_origin_probation_area_id || &#39;)&#39; ||&#10;            l_SQL );&#10;        RAISE;&#10;END procOffTransferRejectsTAB;&#10;&#10;PROCEDURE procOffenderTransferRejects(&#10;    p_origin_team_id              NUMBER DEFAULT NULL,&#10;    p_origin_staff_id             NUMBER DEFAULT NULL,&#10;    p_start_date                  DATE,&#10;    p_end_date                    DATE,&#10;    p_target_team_id              NUMBER DEFAULT NULL,&#10;    p_target_staff_id             NUMBER DEFAULT NULL,&#10;    p_target_probation_area_id    NUMBER DEFAULT NULL,&#10;    p_origin_probation_area_id    NUMBER DEFAULT NULL,&#10;    p_outcursor               OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ rec_level,&#10;        /*01*/ request_date,&#10;        /*02*/ tgt_team_desc,&#10;        /*03*/ tgt_staff_forename,&#10;        /*04*/ tgt_staff_surname,&#10;        /*05*/ tgt_team_probation_area_desc,&#10;        /*06*/ main_type_desc,&#10;        /*07*/ sub_type_desc,&#10;        /*08*/ main_type_id,&#10;        /*09*/ add_main_type_id,&#10;        /*10*/ add_main_type_desc,&#10;        /*11*/ add_sub_type_desc,&#10;        /*12*/ rejection_reason_desc,&#10;        --&#10;        /*13*/ offender_transfer_id,&#10;        /*14*/ offender_id,&#10;        /*15*/ crn,&#10;        --&#10;        /*16*/ nsi_transfer_id,&#10;        /*17*/ nsi_event_id,&#10;        /*18*/ nsi_id,&#10;        --&#10;        /*19*/ event_transfer_id,&#10;        /*20*/ event_id,&#10;        /*21*/ event_number,&#10;        --&#10;        /*22*/ rqmnt_transfer_id,&#10;        /*23*/ rqmnt_id,&#10;        --&#10;        /*24*/ lic_condition_transfer_id,&#10;        /*25*/ lic_condition_id,&#10;        --&#10;        /*26*/ pss_rqmnt_transfer_id,&#10;        /*27*/ pss_rqmnt_id,&#10;        --&#10;        /*28*/ inst_rpt_transfer_id,&#10;        /*29*/ institutional_report_id,&#10;        /*30*/ inst_rpt_custody_id,&#10;        --&#10;        /*31*/ court_report_transfer_id,&#10;        /*32*/ court_report_id,&#10;        --&#10;        /*33*/ transfer_status_date,&#10;        /*34*/ current_restriction,&#10;        /*35*/ current_exclusion,&#10;        /*36*/ restriction_message,&#10;        /*37*/ exclusion_message,&#10;        /*38*/ NOTE_FLAG,&#10;        /*39*/ establishment_flag&#10;      FROM TABLE( PKG_Search.procOffTransferRejectsTAB(&#10;                      p_origin_team_id    &#61;&gt; p_origin_team_id,&#10;                      p_origin_staff_id   &#61;&gt; p_origin_staff_id,&#10;                      p_start_date        &#61;&gt; p_start_date,&#10;                      p_end_date          &#61;&gt; p_end_date,&#10;                      p_target_team_id    &#61;&gt; p_target_team_id,&#10;                      p_target_staff_id   &#61;&gt; p_target_staff_id,&#10;                      p_target_probation_area_id &#61;&gt; p_target_probation_area_id,&#10;                      p_origin_probation_area_id &#61;&gt; p_origin_probation_area_id) );&#10;    --&#10;END procOffenderTransferRejects;&#10;--&#10;--&#10;--&#10;FUNCTION procMasterTranPenTranTAB(p_master_transfer_id NUMBER) RETURN ttabMasterTranPenTran PIPELINED&#10;IS&#10;    --&#10;    lc_proc CONSTANT VARCHAR2(30) :&#61; &#39;procMasterTranPenTranTAB&#39;;&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    --&#10;    l_rec trecMasterTranPenTran;&#10;    l_tab ttabMasterTranPenTran;&#10;    --&#10;    l_SQL     CLOB;&#10;    l_cnt     INTEGER :&#61; 0;&#10;    --&#10;BEGIN&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    procDebug(&#39;PKG_Search.&#39; || lc_proc || &#39;[p_master_transfer_id &#61;&gt; &#39; || p_master_transfer_id);&#10;    --&#10;    l_SQL :&#61;&#10;&#39;WITH T AS (&#10;  SELECT&#10;    /*[00]*/1 AS LEVELS  --OFFENDER&#10;  FROM offender_transfer OT&#10;  WHERE OT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND OT.accepted_decision_id IS NULL AND OT.rejection_reason_id IS NULL AND OT.withdrawal_reason_id IS NULL&#10;  UNION ALL&#10;  SELECT&#10;    2 AS LEVELS -- OFFENDER NSI&#10;  FROM nsi_transfer NT&#10;  WHERE NT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND NT.accepted_decision_id IS NULL AND NT.rejection_reason_id IS NULL AND NT.withdrawal_reason_id IS NULL&#10;  UNION ALL&#10;  SELECT&#10;    3 AS LEVELS -- EVENT&#10;  FROM order_transfer OT&#10;  WHERE OT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND OT.accepted_decision_id IS NULL AND OT.rejection_reason_id IS NULL AND OT.withdrawal_reason_id IS NULL&#10;  UNION ALL&#10;  SELECT&#10;    4 AS LEVELS -- RQMNT&#10;  FROM rqmnt_transfer RT&#10;  WHERE RT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND RT.accepted_decision_id IS NULL AND RT.rejection_reason_id IS NULL AND RT.withdrawal_reason_id IS NULL&#10;  UNION ALL&#10;  SELECT&#10;    5 AS LEVELS -- LIC_CONDITION&#10;  FROM lic_condition_transfer LCT&#10;  WHERE LCT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND LCT.accepted_decision_id IS NULL AND LCT.rejection_reason_id IS NULL AND LCT.withdrawal_reason_id IS NULL&#10;  UNION ALL&#10;  SELECT&#10;    6 AS LEVELS -- PSS_RQMNT&#10;  FROM pss_rqmnt_transfer PRT&#10;  WHERE PRT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND PRT.accepted_decision_id IS NULL AND PRT.rejection_reason_id IS NULL AND PRT.withdrawal_reason_id IS NULL&#10;  UNION ALL&#10;  SELECT&#10;    8 AS LEVELS -- INSTITUTIONAL REPORT&#10;  FROM institutional_report_transfer IRT&#10;  WHERE IRT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND IRT.accepted_decision_id IS NULL AND IRT.rejection_reason_id IS NULL AND IRT.withdrawal_reason_id IS NULL&#10;  UNION ALL&#10;  SELECT&#10;    9 AS LEVELS -- COURT REPORT&#10;  FROM court_report_transfer CRT&#10;  WHERE CRT.master_transfer_id &#61; :p_master_transfer_id&#10;    AND CRT.accepted_decision_id IS NULL AND CRT.REJECTED_REASON_ID IS NULL AND CRT.withdrawal_reason_id IS NULL&#10;)&#10;--&#10;SELECT *&#10;FROM T&#10;ORDER BY 1&#39;;&#10;    --&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      p_master_transfer_id, p_master_transfer_id, p_master_transfer_id, p_master_transfer_id,&#10;      p_master_transfer_id, p_master_transfer_id, p_master_transfer_id, p_master_transfer_id&#10;    ;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab;&#10;    CLOSE l_cur;&#10;    --&#10;    --l_CNT :&#61; l_TAB.COUNT;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_cnt :&#61; l_cnt + 1;&#10;        PIPE ROW ( l_tab(l_i) );&#10;    END LOOP;&#10;    --&#10;    procDebug( lc_proc || &#39; (rows&#61;&#39; || l_tab.COUNT       || &#39;)&#39;   ||&#10;        &#39;(&#39; || PKG_Debug.funcgetDbStats                  || &#39;): &#39; ||&#10;        &#39;(p_master_transfer_id&#61;&#39; || p_master_transfer_id || &#39;)&#39;   ||&#10;        l_SQL );&#10;    --&#10;    --RETURN l_TAB;&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_NEEDED THEN&#10;        procDebug( lc_proc || &#39; (&#39; || l_cnt || &#39; of &#39; || l_tab.COUNT || &#39; rows called from the cursor)&#39; ||&#10;            &#39;(&#39; || PKG_Debug.funcgetDbStats                  || &#39;): &#39; ||&#10;            &#39;(p_master_transfer_id&#61;&#39; || p_master_transfer_id || &#39;)&#39;   ||&#10;            l_SQL );&#10;    WHEN OTHERS THEN&#10;        procDebug( lc_proc || &#39; ERROR: &#39; || SQLERRM          || &#39; &#39; ||&#10;            &#39;(p_master_transfer_id&#61;&#39; || p_master_transfer_id || &#39;)&#39;   ||&#10;            l_SQL );&#10;        RAISE;&#10;END procMasterTranPenTranTAB;&#10;--&#10;PROCEDURE procMasterTranPenTran(&#10;    p_master_transfer_id      NUMBER,&#10;    p_outcursor           OUT SYS_REFCURSOR)&#10;AS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*[00]*/ level_code&#10;      FROM TABLE( PKG_Search.procMasterTranPenTranTAB(p_master_transfer_id &#61;&gt; p_master_transfer_id) );&#10;    --&#10;END procMasterTranPenTran;&#10;--&#10;FUNCTION procGetInterestedCRCsTAB(p_offender_id_LST IN CLOB) RETURN ttabInterestedAreas PIPELINED&#10;IS&#10;    --&#10;    l_rec           trecInterestedAreas;&#10;    --&#10;    l_user_name     USER_.distinguished_name%TYPE;&#10;    --&#10;    l_L1            NUMBER;&#10;    l_L2            NUMBER;&#10;    l_L3            NUMBER;&#10;    l_candidate     BOOLEAN;&#10;    l_organisations T_TAB_ORGANISATIONS;&#10;    --&#10;BEGIN&#10;    --&#10;    --PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    FOR each_po IN ( SELECT&#10;                       PA.probation_area_id,&#10;                       PA.code,&#10;                       PKG_LSTUTL.get_list_2_array(PA.probation_area_id) AS organisations&#10;                     FROM&#10;                       probation_area PA&#10;                        INNER JOIN r_standard_reference_list R1 ON PA.spg_active_id &#61; R1.standard_reference_list_id&#10;                      WHERE 1&#61;1&#10;                        AND R1.code_value !&#61; &#39;N&#39;&#10;                        AND PA.private &#61; 1&#10;                        AND PA.selectable &#61; &#39;Y&#39; )&#10;    LOOP&#10;        --&#10;        FOR each_offender IN ( SELECT&#10;                                 offender_id,&#10;                                 crn,&#10;                                 CAST(organisations AS T_TAB_ORGANISATIONS) AS orgs&#10;                               FROM offender&#10;                               WHERE offender_id IN (&#10;                                     --SELECT TO_NUMBER(column_value) offender_id&#10;                                     --FROM XMLTABLE(p_offender_id_LST)&#10;                                     SELECT TO_NUMBER(TRIM(REGEXP_SUBSTR(p_offender_id_LST, &#39;[^,]+&#39;, 1, LEVEL))) offender_id&#10;                                     FROM dual&#10;                                     CONNECT BY LEVEL &lt;&#61; REGEXP_COUNT(p_offender_id_LST,&#39;,&#39;) + 1 ) )&#10;        LOOP&#10;            --&#10;            l_candidate :&#61; FALSE;&#10;            --&#10;            IF PKG_COMMON.funcMultisetIntersectIsEmpty(each_po.organisations, each_offender.orgs) &#61; 0 THEN&#10;                l_user_name :&#61; each_po.code;&#10;                PKG_RBAC.do_set_rbac_levels(&#10;                    p_offender_id &#61;&gt; each_offender.offender_id,&#10;                    p_L1          &#61;&gt; l_L1,&#10;                    p_L2          &#61;&gt; l_L2,&#10;                    p_L3          &#61;&gt; l_L3,&#10;                    p_username    &#61;&gt; l_user_name );&#10;                --&#10;                l_candidate :&#61; ( l_L1 &#61; 1 OR l_L3 &#61; 1 );&#10;                --&#10;            END IF;&#10;            --&#10;            IF l_candidate THEN&#10;                l_rec.offender_id :&#61; each_offender.offender_id;&#10;                l_rec.probation_area_id :&#61; each_po.probation_area_id;&#10;                l_rec.code :&#61; each_po.code;&#10;                --&#10;                PIPE ROW(l_rec);&#10;                --&#10;            END IF;&#10;            --&#10;        END LOOP;&#10;        --&#10;    END LOOP;&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_NEEDED THEN&#10;        procDebug( &#39;procGetInterestedCRCsTAB &#39; ||&#10;            &#39;(&#39; || PKG_Debug.funcgetDbStats                                   || &#39;): &#39; ||&#10;            &#39;(p_offender_id_LST&#61;&#39; || DBMS_LOB.SUBSTR(p_offender_id_LST, 4000) || &#39;)&#39;   ||&#10;            &#39;(user_name&#61;&#39;         || l_user_name                              || &#39;)&#39;   );&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;procGetInterestedCRCsTAB ERROR: &#39; || SQLERRM || &#39; &#39; ||&#10;            &#39;(p_offender_id_LST&#61;&#39; || DBMS_LOB.SUBSTR(p_offender_id_LST, 4000) || &#39;)&#39;   ||&#10;            &#39;(user_name&#61;&#39;         || l_user_name                              || &#39;)&#39;  );&#10;        RAISE;&#10;END procGetInterestedCRCsTAB;&#10;--&#10;PROCEDURE procGetInterestedCRCs(&#10;    p_offender_id_LST IN CLOB,&#10;    p_outcursor       OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        T.offender_id,&#10;        T.probation_area_id,&#10;        T.code&#10;      FROM TABLE( PKG_Search.procGetInterestedCRCsTAB( p_offender_id_LST&#61;&gt;p_offender_id_LST) ) T;&#10;END procGetInterestedCRCs;&#10;--&#10;--&#10;-- Offender CRC Extract support subroutines&#10;--&#10;FUNCTION procGetOffCRCExtractSummaryTAB(&#10;    p_probation_area_id NUMBER,&#10;    p_team_id           NUMBER DEFAULT -1,&#10;    p_staff_id          NUMBER DEFAULT -1 )&#10;RETURN PKG_SPG_EXPORT.ttabOffCRCExtractSummary PIPELINED&#10;IS&#10;    l_tab PKG_SPG_EXPORT.ttabOffCRCExtractSummary;&#10;BEGIN&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_SPG_EXPORT.procGetOffCRCExtractSummaryTAB(&#10;                    p_probation_area_id &#61;&gt; p_probation_area_id,&#10;                    p_team_id           &#61;&gt; p_team_id,&#10;                    p_staff_id          &#61;&gt; p_staff_id )&#10;              );&#10;    FOR l_idx IN 1..l_tab.COUNT LOOP&#10;        PIPE ROW ( l_tab(l_idx) );&#10;    END LOOP;&#10;END procGetOffCRCExtractSummaryTAB;&#10;--&#10;PROCEDURE procGetOffCRCExtractSummary(&#10;    p_probation_area_id NUMBER,&#10;    p_team_id           NUMBER DEFAULT -1,&#10;    p_staff_id          NUMBER DEFAULT -1,&#10;    p_outcursor OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ rbac_level,&#10;        /*01*/ num_of_rows&#10;      FROM TABLE( PKG_SPG_EXPORT.procGetOffCRCExtractSummaryTAB( p_probation_area_id&#61;&gt; p_probation_area_id, p_team_id&#61;&gt;p_team_id, p_staff_id&#61;&gt;p_staff_id) ) T;&#10;END procGetOffCRCExtractSummary;&#10;--&#10;FUNCTION procGetOffCRCExtractTAB(&#10;    p_probation_area_id           NUMBER,&#10;    p_team_id                     NUMBER   DEFAULT -1,&#10;    p_staff_id                    NUMBER   DEFAULT -1,&#10;    p_excl_already_extracted_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_incl_already_extracted_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_crc_export_date_from        DATE     DEFAULT NULL,&#10;    p_crc_export_date_to          DATE     DEFAULT NULL,&#10;    p_crn                         VARCHAR2  DEFAULT NULL,&#10;    p_status_export_flag          SMALLINT  DEFAULT 0,&#10;    p_debug_flag                  VARCHAR2 DEFAULT &#39;Y&#39;,&#10;    --&#10;    p_max_rows                    INTEGER  DEFAULT 10000,&#10;    p_max_rows_L1                 INTEGER  DEFAULT 10000,&#10;    p_max_rows_L3                 INTEGER  DEFAULT 10000 )&#10;RETURN PKG_SPG_EXPORT.ttabOffCRCExtract PIPELINED&#10;IS&#10;    l_tab PKG_SPG_EXPORT.ttabOffCRCExtract;&#10;BEGIN&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_SPG_EXPORT.procGetOffCRCExtractTAB(&#10;                    p_probation_area_id &#61;&gt; p_probation_area_id,&#10;                    p_team_id           &#61;&gt; p_team_id,&#10;                    p_staff_id          &#61;&gt; p_staff_id,&#10;                    p_excl_already_extracted_flag &#61;&gt; p_excl_already_extracted_flag,&#10;                    p_incl_already_extracted_flag &#61;&gt; p_incl_already_extracted_flag,&#10;                    p_crc_export_date_from        &#61;&gt; p_crc_export_date_from,&#10;                    p_crc_export_date_to          &#61;&gt; p_crc_export_date_to,&#10;                    p_crn                         &#61;&gt; p_crn,&#10;                    p_status_export_flag          &#61;&gt; p_status_export_flag,&#10;                    p_debug_flag                  &#61;&gt; p_debug_flag,&#10;                    --&#10;                    p_max_rows_L1          &#61;&gt; p_max_rows_L1,&#10;                    p_max_rows_L3          &#61;&gt; p_max_rows_L3,&#10;                    --&#10;                    p_max_rows  &#61;&gt; p_max_rows )&#10;              );&#10;    FOR l_idx IN 1..l_tab.COUNT LOOP&#10;        PIPE ROW ( l_tab(l_idx) );&#10;    END LOOP;&#10;END procGetOffCRCExtractTAB;&#10;--&#10;PROCEDURE procGetOffCRCExtract(&#10;    p_probation_area_id           NUMBER,&#10;    p_team_id                     NUMBER   DEFAULT -1,&#10;    p_staff_id                    NUMBER   DEFAULT -1,&#10;    p_excl_already_extracted_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_max_rows                    INTEGER  DEFAULT 10000,&#10;    p_max_rows_L1                 INTEGER  DEFAULT 10000,&#10;    p_max_rows_L3                 INTEGER  DEFAULT 10000,&#10;    --&#10;    p_outcursor               OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ offender_id,&#10;        /*01*/ rbac_level,&#10;        /*02*/ entity_code,&#10;        /*03*/ entity_id&#10;      FROM TABLE( PKG_SPG_EXPORT.procGetOffCRCExtractTAB(&#10;                      p_probation_area_id &#61;&gt; p_probation_area_id,&#10;                      p_team_id           &#61;&gt; p_team_id,&#10;                      p_staff_id          &#61;&gt; p_staff_id,&#10;                      p_excl_already_extracted_flag &#61;&gt; PKG_Common.NVLSTR(p_excl_already_extracted_flag, &#39;N&#39;),&#10;                      --&#10;                      p_max_rows_L1          &#61;&gt; p_max_rows_L1,&#10;                      p_max_rows_L3          &#61;&gt; p_max_rows_L3,&#10;                      --&#10;                      p_max_rows  &#61;&gt; p_max_rows )&#10;                ) T;&#10;END procGetOffCRCExtract;&#10;--&#10;--&#10;FUNCTION procGetOffCRCExtractedOffTAB(&#10;    p_probation_area_id           NUMBER,&#10;    p_team_id                     NUMBER    DEFAULT -1,&#10;    p_staff_id                    NUMBER    DEFAULT -1,&#10;    p_crc_export_date_from        DATE      DEFAULT NULL,&#10;    p_crc_export_date_to          DATE      DEFAULT NULL,&#10;    p_crn                         VARCHAR2  DEFAULT NULL,&#10;    p_status_export_flag          SMALLINT  DEFAULT 0,&#10;    p_max_rows                    INTEGER   DEFAULT 10000 )&#10;RETURN PKG_SPG_EXPORT.ttabOffCRCExtractedOff PIPELINED&#10;IS&#10;    l_tab PKG_SPG_EXPORT.ttabOffCRCExtractedOff;&#10;BEGIN&#10;    SELECT * BULK COLLECT INTO l_tab&#10;    FROM TABLE( PKG_SPG_EXPORT.procGetOffCRCExtractedOffTAB(&#10;                    p_probation_area_id    &#61;&gt; p_probation_area_id,&#10;                    p_team_id              &#61;&gt; p_team_id,&#10;                    p_staff_id             &#61;&gt; p_staff_id,&#10;                    p_crc_export_date_from &#61;&gt; p_crc_export_date_from,&#10;                    p_crc_export_date_to   &#61;&gt; p_crc_export_date_to,&#10;                    p_crn                  &#61;&gt; p_crn,&#10;                    p_status_export_flag   &#61;&gt; p_status_export_flag,&#10;                    p_max_rows             &#61;&gt; p_max_rows )&#10;              );&#10;    FOR l_idx IN 1..l_tab.COUNT LOOP&#10;        PIPE ROW ( l_tab(l_idx) );&#10;    END LOOP;&#10;END procGetOffCRCExtractedOffTAB;&#10;--&#10;PROCEDURE procGetOffCRCExtractedOff(&#10;    p_probation_area_id           NUMBER,&#10;    p_team_id                     NUMBER    DEFAULT -1,&#10;    p_staff_id                    NUMBER    DEFAULT -1,&#10;    p_crc_export_date_from        DATE      DEFAULT NULL,&#10;    p_crc_export_date_to          DATE      DEFAULT NULL,&#10;    p_crn                         VARCHAR2  DEFAULT NULL,&#10;    p_status_export_flag          SMALLINT  DEFAULT 0,&#10;    p_max_rows                    INTEGER   DEFAULT 10000,&#10;    p_outcursor               OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        /*00*/ offender_id,&#10;        /*01*/ first_name,&#10;        /*02*/ second_name,&#10;        /*03*/ surname,&#10;        /*04*/ crn,&#10;        --&#10;        /*05*/ probation_area_id,&#10;        /*06*/ probation_area_code,&#10;        /*07*/ probation_area_desc,&#10;        --&#10;        /*08*/ trust_provider_flag,&#10;        /*09*/ trust_provider_team_id,&#10;        /*10*/ team_code,&#10;        /*11*/ team_desc,&#10;        /*12*/ staff_employee_id,&#10;        /*13*/ staff_code,&#10;        /*14*/ staff_first_name,&#10;        /*15*/ staff_second_name,&#10;        /*16*/ staff_surname,&#10;        --&#10;        /*17*/ export_date,&#10;        /*18*/ rbac_level,&#10;        /*19*/ crc_provider_id,&#10;        --&#10;        /*20*/ row_version,&#10;        /*21*/ created_by_user_id,&#10;        /*22*/ created_datetime,&#10;        /*23*/ last_updated_user_id,&#10;        /*24*/ last_updated_datetime,&#10;        /*25*/ requested_export_level,&#10;        /*26*/ error_flag,&#10;        /*27*/ submitted_datetime,&#10;        /*28*/ processed_datetime,&#10;        /*29*/ error_message,&#10;        /*30*/ spg_notification_id,&#10;        /*31*/ offender_crc_export_id,&#10;        /*32*/ current_exclusion,&#10;        /*33*/ current_restriction,&#10;        /*34*/ batch_flag&#10;        --&#10;      FROM TABLE( PKG_SPG_EXPORT.procGetOffCRCExtractedOffTAB(&#10;                      p_probation_area_id    &#61;&gt; p_probation_area_id,&#10;                      p_team_id              &#61;&gt; p_team_id,&#10;                      p_staff_id             &#61;&gt; p_staff_id,&#10;                      p_crc_export_date_from &#61;&gt; p_crc_export_date_from,&#10;                      p_crc_export_date_to   &#61;&gt; p_crc_export_date_to,&#10;                      p_crn                  &#61;&gt; p_crn,&#10;                      p_status_export_flag   &#61;&gt; p_status_export_flag,&#10;                      p_max_rows             &#61;&gt; p_max_rows )&#10;                ) T;&#10;END procGetOffCRCExtractedOff;&#10;--&#10;PROCEDURE create_crc_export_batch(&#10;    p_probation_area_id           NUMBER,&#10;    p_team_id                     NUMBER    DEFAULT -1,&#10;    p_staff_id                    NUMBER    DEFAULT -1,&#10;    p_excl_already_extracted_flag VARCHAR2  DEFAULT &#39;N&#39;,&#10;    p_incl_already_extracted_flag VARCHAR2  DEFAULT &#39;N&#39;,&#10;    p_crc_export_date_from        DATE      DEFAULT NULL,&#10;    p_crc_export_date_to          DATE      DEFAULT NULL,&#10;    p_crn                         VARCHAR2  DEFAULT NULL,&#10;    p_status_export_flag          SMALLINT  DEFAULT 0,&#10;    p_debug_flag                  VARCHAR2  DEFAULT &#39;Y&#39;,&#10;    --&#10;    p_max_rows                    INTEGER   DEFAULT -1,&#10;    p_max_rows_L1                 INTEGER   DEFAULT -1,&#10;    p_max_rows_L3                 INTEGER   DEFAULT -1,&#10;    --&#10;    p_async_flag                  VARCHAR2 DEFAULT &#39;N&#39; )&#10;IS&#10;BEGIN&#10;    PKG_SPG_SUPPORT.create_crc_export_batch(&#10;        p_probation_area_id           &#61;&gt; p_probation_area_id,&#10;        p_team_id                     &#61;&gt; p_team_id,&#10;        p_staff_id                    &#61;&gt; p_staff_id,&#10;        p_excl_already_extracted_flag &#61;&gt; p_excl_already_extracted_flag,&#10;        p_incl_already_extracted_flag &#61;&gt; p_incl_already_extracted_flag,&#10;        p_crc_export_date_from        &#61;&gt; p_crc_export_date_from,&#10;        p_crc_export_date_to          &#61;&gt; p_crc_export_date_to,&#10;        p_crn                         &#61;&gt; p_crn,&#10;        p_status_export_flag          &#61;&gt; p_status_export_flag,&#10;        p_debug_flag                  &#61;&gt; p_debug_flag,&#10;        --&#10;        p_max_rows                    &#61;&gt; p_max_rows,&#10;        p_max_rows_L1                 &#61;&gt; p_max_rows_L1,&#10;        p_max_rows_L3                 &#61;&gt; p_max_rows_L3,&#10;        --&#10;        p_async_flag                  &#61;&gt; p_async_flag );&#10;    --&#10;END create_crc_export_batch;&#10;--&#10;--&#10;--&#10;&#10;PROCEDURE procGetCurrentResidents(&#10;    p_approved_premises_id       NUMBER DEFAULT NULL,&#10;    p_approved_premises_group_id NUMBER    DEFAULT NULL,&#10;    p_outcursor                  OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    --&#10;    OPEN p_outcursor FOR&#10;      SELECT&#10;        RESIDENCE.approved_premises_residence_id,&#10;        RESIDENCE.arrival_date,&#10;        RESIDENCE.expected_departure_date,&#10;        REFERRAL.approved_premises_referral_id,&#10;        O.offender_id,&#10;        O.first_name,&#10;        O.surname,&#10;        O.crn,&#10;        O.current_highest_risk_colour,&#10;        O.current_restriction,&#10;        O.current_exclusion,&#10;        E.event_id,&#10;        D.disposal_id,&#10;        D.termination_date,&#10;        D.upw,&#10;        DT.disposal_type_id,&#10;        DT.sentence_type,&#10;        DT.cja2003,&#10;        DT.pre_cja2003,&#10;        AP.approved_premises_id,&#10;        HC.code_value,&#10;        HC.code_description,&#10;        S.officer_code,&#10;        S.forename,&#10;        S.forename2,&#10;        S.surname&#10;      FROM&#10;        approved_premises_residence RESIDENCE&#10;          JOIN approved_premises_referral REFERRAL ON REFERRAL.approved_premises_referral_id &#61; RESIDENCE.approved_premises_referral_id&#10;            JOIN event E ON E.event_id &#61; REFERRAL.event_id&#10;              JOIN offender O ON O.offender_id &#61; E.offender_id&#10;              LEFT OUTER JOIN disposal D ON D.event_id &#61; E.event_id&#10;                LEFT OUTER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;          LEFT OUTER JOIN r_approved_premises AP ON AP.approved_premises_id &#61; RESIDENCE.approved_premises_id&#10;            LEFT OUTER JOIN r_standard_reference_list HC ON AP.national_hostel_code &#61; HC.standard_reference_list_id&#10;          LEFT OUTER JOIN staff S ON RESIDENCE.key_worker_staff_id &#61; S.staff_id&#10;      WHERE RESIDENCE.departure_reason_id IS NULL&#10;        AND RESIDENCE.soft_deleted &#61; 0&#10;        AND O.soft_deleted &#61; 0&#10;        AND ( p_approved_premises_id IS NULL OR RESIDENCE.approved_premises_id &#61; p_approved_premises_id )&#10;        AND ( p_approved_premises_group_id IS NULL OR&#10;              RESIDENCE.approved_premises_id IN (&#10;                SELECT apGroup.approved_Premises_Id&#10;                FROM&#10;                  r_ap_referral_group apGroup&#10;                    JOIN r_approved_premises premises ON apGroup.approved_premises_id &#61; PREMISES.approved_premises_id&#10;                WHERE apGroup.STANDARD_REFERENCE_LIST_ID &#61; p_approved_premises_group_id&#10;                  AND apGroup.approved_Premises_Id &#61; PREMISES.approved_Premises_Id ) )&#10;      --&#10;      UNION&#10;      /* Reservations */&#10;      SELECT&#10;        NULL, /* AP residence id */&#10;        REFERRAL.reservation_start_date, /* Arrival date */&#10;        (REFERRAL.reservation_start_date + REFERRAL.reservation_length - 1), /* Departure Date */&#10;        REFERRAL.approved_premises_referral_id, /* ap_referral */&#10;        O.offender_id,&#10;        O.first_name,&#10;        O.surname,&#10;        O.crn,&#10;        O.current_highest_risk_colour,&#10;        O.current_restriction,&#10;        O.current_exclusion,&#10;        E.event_id,&#10;        D.disposal_id,&#10;        D.termination_date,&#10;        D.upw,&#10;        DT.disposal_type_id,&#10;        DT.sentence_type,&#10;        DT.cja2003,&#10;        DT.pre_cja2003,&#10;        AP.approved_premises_id,&#10;        HC.code_value,&#10;        HC.code_description,&#10;        NULL,&#10;        NULL,&#10;        NULL,&#10;        NULL&#10;      FROM&#10;        approved_premises_referral REFERRAL&#10;          JOIN event E ON E.event_id &#61; REFERRAL.event_id&#10;            JOIN offender O ON O.offender_id &#61; E.offender_id&#10;            LEFT OUTER JOIN disposal D ON D.event_id &#61; E.event_id&#10;              LEFT OUTER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;          LEFT OUTER JOIN r_approved_premises AP ON AP.approved_premises_id &#61; REFERRAL.approved_premises_id&#10;            LEFT OUTER JOIN r_standard_reference_list HC ON AP.national_hostel_code &#61; HC.standard_reference_list_id&#10;          LEFT OUTER JOIN approved_premises_residence RESIDENCE ON RESIDENCE.approved_premises_referral_id &#61; REFERRAL.approved_premises_referral_id&#10;      WHERE RESIDENCE.approved_premises_residence_id IS NULL&#10;        AND REFERRAL.soft_deleted &#61; 0&#10;        AND O.soft_deleted &#61; 0&#10;        AND REFERRAL.reservation_start_date &lt;&#61; TRUNC(SYSDATE)&#10;        AND (REFERRAL.reservation_start_date + (REFERRAL.reservation_length - 1)) &gt;&#61; TRUNC(SYSDATE)&#10;        AND REFERRAL.non_arrival_date IS NULL&#10;        AND ( p_approved_premises_id IS NULL OR REFERRAL.approved_premises_id &#61; p_approved_premises_id )&#10;        AND ( p_approved_premises_group_id IS NULL OR&#10;              REFERRAL.approved_premises_id IN (&#10;                SELECT apGroup.approved_Premises_Id&#10;                FROM&#10;                  r_ap_referral_group apGroup&#10;                    JOIN r_approved_premises PREMISES ON apGroup.approved_premises_id &#61; PREMISES.approved_premises_id&#10;                WHERE apGroup.STANDARD_REFERENCE_LIST_ID &#61; p_approved_premises_group_id&#10;                  AND apGroup.approved_Premises_Id &#61; PREMISES.approved_Premises_Id ) );&#10;    --&#10;END procGetCurrentResidents;&#10;--&#10;PROCEDURE procGetCurrentReservationCount(&#10;    p_approved_premises_id NUMBER DEFAULT NULL,&#10;    p_date                 DATE,&#10;    p_outcursor            OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    --&#10;    OPEN p_outcursor FOR&#10;      SELECT COUNT(*)&#10;      FROM&#10;        approved_premises_referral REFERRAL&#10;          JOIN event E ON E.event_id &#61; REFERRAL.event_id&#10;            JOIN offender O ON O.offender_id &#61; E.offender_id&#10;          LEFT OUTER JOIN approved_premises_residence RESIDENCE ON RESIDENCE.approved_premises_referral_id &#61; REFERRAL.approved_premises_referral_id&#10;      WHERE RESIDENCE.approved_premises_residence_id IS NULL&#10;        AND REFERRAL.soft_deleted &#61; 0&#10;        AND O.soft_deleted &#61; 0&#10;        AND REFERRAL.EXPECTED_ARRIVAL_DATE &lt;&#61; TRUNC(p_date)&#10;        AND REFERRAL.EXPECTED_DEPARTURE_DATE &gt;&#61; TRUNC(p_date)&#10;        AND REFERRAL.approved_premises_id &#61; p_approved_premises_id&#10;        AND RESIDENCE.arrival_date is NULL&#10;        AND REFERRAL.non_arrival_date IS NULL&#10;        AND REFERRAL.referral_decision_id IN (&#10;            SELECT LL.STANDARD_REFERENCE_DATA1&#10;            FROM&#10;              r_linked_list LL&#10;               JOIN r_standard_reference_list SRL ON srl.standard_reference_list_id &#61; LL.standard_reference_data2&#10;                 JOIN r_reference_data_master rdm ON RDM.reference_data_master_id &#61; SRL.reference_data_master_id&#10;            WHERE RDM.CODE_SET_NAME &#61; &#39;AP REFERRAL TYPE&#39;&#10;              AND srl.CODE_VALUE &#61; &#39;A&#39; );&#10;    --&#10;END procGetCurrentReservationCount;&#10;&#10;--&#10;-- Contact Alerts Summary&#10;--&#10;FUNCTION procGetAlertSummaryTAB(p_staff_id NUMBER) RETURN ttabContactAlertSummary PIPELINED&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;      SELECT&#10;        p_staff_id AS staff_id,&#10;        COUNT(1)   AS contact_alert_qty&#10;      FROM&#10;        contact_alert CA&#10;          INNER JOIN contact C ON C.contact_id &#61; CA.contact_id&#10;            INNER JOIN offender O ON O.offender_id &#61; C.offender_id&#10;        WHERE 1&#61;1&#10;          AND C.soft_deleted &#61; 0&#10;          AND O.soft_deleted &#61; 0&#10;          --&#10;          AND CA.trust_provider_flag &#61; 0&#10;          AND CA.staff_employee_id &#61; p_staff_id;&#10;    --&#10;    l_tab ttabContactAlertSummary;&#10;    --&#10;BEGIN&#10;    --&#10;    OPEN cs;&#10;    FETCH cs BULK COLLECT INTO l_tab LIMIT 1000;&#10;    CLOSE cs;&#10;    --&#10;    FOR l_idx IN 1..l_tab.COUNT LOOP&#10;        PIPE ROW ( l_tab(l_idx) );&#10;    END LOOP;&#10;    --&#10;END procGetAlertSummaryTAB;&#10;--&#10;PROCEDURE procGetAlertCountForStaff(&#10;    p_staff_id  NUMBER DEFAULT NULL,&#10;    p_outcursor OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    --&#10;    OPEN p_outcursor FOR&#10;      SELECT contact_alert_qty&#10;      FROM TABLE( PKG_Search.procGetAlertSummaryTAB(p_staff_id) );&#10;    --&#10;END procGetAlertCountForStaff;&#10;&#10;--&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;-- Package Body initialisation block&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;BEGIN&#10;    --&#10;    PKG_Global.do_init;&#10;    --&#10;    -----------------------------------------------------------------&#10;    -- Cache reference values to be used within package procedures --&#10;    -----------------------------------------------------------------&#10;    g_limit               :&#61; PKG_Lookups.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;OFFENDER_SEARCH_MAX_RESULTS&#39;, p_default_value &#61;&gt; 10);&#10;&#10;    g_transfer_pending_id :&#61; PKG_Lookups.funcgetStdRefListID(p_code_set &#61;&gt; &#39;TRANSFER STATUS&#39;, p_code &#61;&gt; &#39;PN&#39;);&#10;    --&#10;    --&#10;END pkg_search;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>