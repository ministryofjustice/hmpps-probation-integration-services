<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.SPGCONFIG</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY SPGConfig&#10;AS&#10;--&#10;--&#10;--&#10;--&#10;    g_ob_broker           SPG_CONTROL.control_code%TYPE :&#61; &#39;BROKEROB&#39;;&#10;    g_ob_queue            SPG_CONTROL.control_code%TYPE :&#61; &#39;QUEUEOB&#39;;&#10;    g_obq_username        SPG_CONTROL.control_code%TYPE :&#61; &#39;Q_USER&#39;;&#10;    g_obq_password        SPG_CONTROL.control_code%TYPE :&#61; &#39;Q_PASS&#39;;&#10;    g_ob_cref             SPG_CONTROL.control_code%TYPE :&#61; &#39;CREF&#39;;&#10;    g_teamref             SPG_CONTROL.control_code%TYPE :&#61; &#39;TEAMREF&#39;;&#10;    g_staffref            SPG_CONTROL.control_code%TYPE :&#61; &#39;STAFREF&#39;;&#10;    g_locref              SPG_CONTROL.control_code%TYPE :&#61; &#39;LOCREF&#39;;&#10;    g_spgmodules          SPG_CONTROL.control_code%TYPE :&#61; &#39;SPGMOD&#39;;&#10;    g_alfrescourl         SPG_CONTROL.control_code%TYPE :&#61; &#39;ALFURL&#39;;&#10;    g_alfrescouser        SPG_CONTROL.control_code%TYPE :&#61; &#39;ALFUSER&#39;;&#10;    g_alfrescowallet      SPG_CONTROL.control_code%TYPE :&#61; &#39;ALFWALLET&#39;;&#10;    --&#10;    g_default_sender      PROBATION_AREA.code%TYPE :&#61; &#39;N00&#39;;&#10;    g_broadcast_domain    PROBATION_AREA.code%TYPE :&#61; &#39;ALL&#39;;&#10;    --&#10;    g_package_version CONSTANT VARCHAR2(30) :&#61; GC_VERSION;&#10;    g_component_code  CONSTANT VARCHAR2(3)  :&#61; &#39;SPG&#39;;&#10;    g_package_name    CONSTANT VARCHAR2(30) :&#61; &#39;SPGMessage&#39;;&#10;    g_instance_id     INTEGER :&#61; 0;&#10;    --&#10;    g_procedure_name  VARCHAR2(30) :&#61; &#39;initial_value&#39;;&#10;    g_label           VARCHAR2(6)  :&#61; &#39;000000&#39;;&#10;    g_pdm             NUMBER;&#10;    g_unit_test       BOOLEAN      :&#61; FALSE;&#10;    --&#10;    -- message type&#10;    mt_debug          CONSTANT NUMBER :&#61; 0;&#10;    mt_information    CONSTANT NUMBER :&#61; 1;&#10;    mt_warning        CONSTANT NUMBER :&#61; 2;&#10;    mt_error          CONSTANT NUMBER :&#61; 3;&#10;    mt_fatal_error    CONSTANT NUMBER :&#61; 4;&#10;    --&#10;    -- encryption&#10;    G_CHARACTER_SET   VARCHAR2(10) :&#61; &#39;AL32UTF8&#39;;&#10;    G_STRING          VARCHAR2(32) :&#61; &#39;12345678901234567890123456789012&#39;;&#10;    G_KEY             RAW(250)     :&#61; UTL_I18N.string_to_raw( data &#61;&gt; G_STRING, dst_charset &#61;&gt; G_CHARACTER_SET );&#10;    G_ENCRYPTION_TYPE PLS_INTEGER  :&#61; DBMS_CRYPTO.encrypt_aes256 + DBMS_CRYPTO.chain_cbc + DBMS_CRYPTO.pad_pkcs5;&#10;    --&#10;    G_USR_NAME_MAX_LEN  NUMBER :&#61; 30;&#10;    --&#10;&#10;    -- SPG Reference Data Outbound Messaging&#10;    GC_REFDATA_IN_LATEST_XSD_FLAG CONSTANT BOOLEAN :&#61; FALSE;&#10;&#10;&#10;--&#10;--&#10;--&#10;FUNCTION get_version RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN GC_VERSION;&#10;END get_version;&#10;--***************************************************&#10;-- PKG_DEBUG wrappers                               *&#10;--***************************************************&#10;PROCEDURE procDebug(p_msg CLOB, p_print_flag VARCHAR2 DEFAULT &#39;N&#39;) IS&#10;BEGIN&#10;    PKG_Debug.procDebug(p_msg, p_print_flag);&#10;END procDebug;&#10;&#10;FUNCTION funcgetDebugMode RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Debug.funcgetDebugMode;&#10;END funcgetDebugMode;&#10;--&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level INTEGER DEFAULT 0) IS&#10;BEGIN&#10;    procDebug(&#39;[&#39; || g_label || &#39;] &#39; || p_msg, p_print_flag &#61;&gt; &#39;Y&#39;);&#10;END message;&#10;--&#10;--***************************************************&#10;-- PKG_COMMON wrappers                              *&#10;--***************************************************&#10;--&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;--&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;--&#10;PROCEDURE raise_error(&#10;    error_code_in    IN PLS_INTEGER DEFAULT NULL,&#10;    error_message_in IN VARCHAR2 DEFAULT NULL)&#10;IS&#10;    --&#10;    l_error_code    PLS_INTEGER    :&#61; NVL(error_code_in, SQLCODE);&#10;    l_error_message VARCHAR2(4000) :&#61; SUBSTR(NVLSTR(error_message_in, SQLERRM), 1, 4000);&#10;    --&#10;BEGIN&#10;    --&#10;    g_procedure_name :&#61; &#39;raise_error&#39;;&#10;    IF l_error_code BETWEEN -20999 AND -20000 THEN&#10;        RAISE_APPLICATION_ERROR (l_error_code, l_error_message);&#10;    ELSIF l_error_code &gt; 0 AND l_error_code NOT IN (1,100) THEN&#10;        RAISE_APPLICATION_ERROR (-20000, l_error_code||&#39; - &#39;||l_error_message);&#10;    ELSIF l_error_code IN (100, -1403) THEN&#10;        RAISE_APPLICATION_ERROR (-20000, l_error_code||&#39; - &#39;||l_error_message);&#10;    ELSE --IF l_error_code &lt;&gt; 0 THEN&#10;        RAISE_APPLICATION_ERROR(-20000, &#39;INTERNAL ERROR: An unexpected error in PL/SQL: &#39; || l_error_message);&#10;    END IF;&#10;    --&#10;END raise_error;&#10;--&#10;--***************************************************&#10;-- Helpers                                          *&#10;--***************************************************&#10;PROCEDURE do_init_vars IS&#10;BEGIN&#10;    --&#10;    G_USR_NAME_MAX_LEN :&#61;&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;            p_table     &#61;&gt; &#39;user_tab_columns&#39;,&#10;            p_data_fld  &#61;&gt; &#39;char_length&#39;,&#10;            p_ref_col   &#61;&gt; &#39;table_name&#39;,&#10;            p_ref_val   &#61;&gt; &#39;SPG_ERROR_LOG&#39;,&#10;            p_where     &#61;&gt; &#39;column_name &#61; :p_col_name&#39;,&#10;            p_bind_var1 &#61;&gt; &#39;CREATED_BY&#39; );&#10;    IF G_USR_NAME_MAX_LEN IS NULL THEN&#10;        G_USR_NAME_MAX_LEN :&#61; 30;&#10;    END IF;&#10;    --&#10;END do_init_vars;&#10;--&#10;--&#10;--&#10;--&#10;FUNCTION SPGPersistActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGPersistActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGPersistActive;&#10;--&#10;--&#10;FUNCTION SPGInfoActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGInfoActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGInfoActive;&#10;--&#10;--&#10;FUNCTION SPGWarnActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGWarnActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGWarnActive;&#10;--&#10;--&#10;FUNCTION SPGDocsToDiskActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGDocsToDiskActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGDocsToDiskActive;&#10;--&#10;--&#10;FUNCTION SPGValidateXMLActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGValidateXMLActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGValidateXMLActive;&#10;--&#10;--&#10;FUNCTION SPGAlfrescoActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGAlfrescoActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGAlfrescoActive;&#10;--&#10;--&#10;FUNCTION SPGPermissionDirectActive RETURN BOOLEAN&#10;IS&#10;  l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGPermissionDirectActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGPermissionDirectActive;&#10;--&#10;FUNCTION SPGSaveXMLActive  RETURN BOOLEAN&#10;IS&#10;  l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGSaveXMLActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGSaveXMLActive;&#10;--&#10;FUNCTION SPGMultiThreadActive  RETURN BOOLEAN&#10;IS&#10;  l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGMultiThreadActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGMultiThreadActive;&#10;--&#10;FUNCTION SPGSuppressDeferralActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGSuppressDeferralActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGSuppressDeferralActive;&#10;--&#10;FUNCTION SPGDocsMigrateActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_SPGDocsMigrateActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END SPGDocsMigrateActive;&#10;--&#10;FUNCTION PRFMultiThreadActive RETURN BOOLEAN&#10;IS&#10;    l_ret BOOLEAN :&#61; FALSE;&#10;BEGIN&#10;    BEGIN&#10;        IF SUBSTR(PKG_Common.dec2bin(get_spg_modules), PKG_Global.g_PRFMultiThreadActive,1) &#61; &#39;1&#39; THEN&#10;            l_ret :&#61; TRUE;&#10;        END IF;&#10;    EXCEPTION WHEN OTHERS THEN&#10;        NULL;&#10;    END;&#10;    --&#10;    RETURN l_ret;&#10;END PRFMultiThreadActive;&#10;&#10;--&#10;FUNCTION SPGInfoActive_c             RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGInfoActive);             END SPGInfoActive_c;&#10;FUNCTION SPGWarnActive_c             RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGWarnActive);             END SPGWarnActive_c;&#10;FUNCTION SPGPersistActive_c          RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGPersistActive);          END SPGPersistActive_c;&#10;FUNCTION SPGDocsToDiskActive_c       RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGDocsToDiskActive);       END SPGDocsToDiskActive_c;&#10;FUNCTION SPGValidateXMLActive_c      RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGValidateXMLActive);      END SPGValidateXMLActive_c;&#10;FUNCTION SPGAlfrescoActive_c         RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGAlfrescoActive);         END SPGAlfrescoActive_c;&#10;FUNCTION SPGPermissionDirectActive_c RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGPermissionDirectActive); END SPGPermissionDirectActive_c;&#10;FUNCTION SPGSaveXMLActive_c          RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGSaveXMLActive);          END SPGSaveXMLActive_c;&#10;FUNCTION SPGMultiThreadActive_c      RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGMultiThreadActive);      END SPGMultiThreadActive_c;&#10;FUNCTION SPGSuppressDeferralActive_c RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGSuppressDeferralActive); END SPGSuppressDeferralActive_c;&#10;FUNCTION SPGDocsMigrateActive_c      RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(SPGDocsMigrateActive);      END SPGDocsMigrateActive_c;&#10;FUNCTION PRFMultiThreadActive_c      RETURN VARCHAR2 IS BEGIN RETURN PKG_Common.bool_2_char(PRFMultiThreadActive);      END PRFMultiThreadActive_c;&#10;&#10;--&#10;--&#10;PROCEDURE insert_message_log(&#10;    message_type_id_in  IN NUMBER,&#10;    component_code_in   IN VARCHAR2,&#10;    package_name_in     IN VARCHAR2,&#10;    procedure_name_in   IN VARCHAR2,&#10;    label_in            IN VARCHAR2,&#10;    message_text_in     IN VARCHAR2,&#10;    spg_error_log_id_in IN NUMBER DEFAULT NULL,&#10;    dbms_output_in      IN VARCHAR2 DEFAULT &#39;N&#39;,&#10;    log_table_name      IN VARCHAR2 DEFAULT &#39;SPG_MESSAGE_LOG&#39; )&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    --&#10;    l_msg_type        VARCHAR2(30);&#10;    l_msg             VARCHAR2(4000);&#10;    l_component_code  VARCHAR2(30);&#10;    l_package_name    VARCHAR2(30);&#10;    l_procedure_name  VARCHAR2(30);&#10;    l_label           VARCHAR2(10);&#10;    l_sql             CLOB;&#10;    --&#10;BEGIN&#10;    --&#10;    l_component_code :&#61; SUBSTRB(component_code_in, 1, 30);&#10;    l_package_name   :&#61; SUBSTRB(package_name_in  , 1, 30);&#10;    l_procedure_name :&#61; SUBSTRB(procedure_name_in, 1, 30);&#10;    l_label          :&#61; SUBSTRB(label_in         , 1, 10);&#10;    l_msg            :&#61; SUBSTRB(message_text_in  , 1, 4000);&#10;    --&#10;    IF log_table_name &#61; &#39;DMS_MESSAGE_LOG&#39; THEN&#10;        l_sql :&#61; &#39;INSERT INTO dms_message_log (dms_message_log_id, dms_message_timestamp, dms_message_type, dms_component_code, dms_package_name, dms_procedure_name, dms_procedure_label, message_text, dms_error_log_id, instance_id)&#10;                  VALUES (dms_message_log_id_seq.NEXTVAL, :dms_message_timestamp, :dms_message_type, :dms_component_code, :dms_package_name, :dms_procedure_name, :dms_procedure_label, :message_text, :dms_error_log_id, :instance_id)&#39;;&#10;        --&#10;        l_msg_type :&#61; CASE message_type_id_in&#10;                        WHEN 0 THEN &#39;DEBUG&#39;&#10;                        WHEN 1 THEN &#39;INFO&#39;&#10;                        WHEN 2 THEN &#39;WARN&#39;&#10;                        ELSE &#39;ERROR&#39;&#10;                      END;&#10;        --&#10;    ELSE&#10;        l_sql :&#61; &#39;INSERT INTO spg_message_log (spg_message_log_id, message_timestamp, message_type_id, component_code, package_name, procedure_name, label, message_text, spg_error_log_id, instance_id)&#10;                  VALUES (spg_message_log_id_seq.NEXTVAL, :message_timestamp, :message_type_id, :component_code, :package_name, :procedure_name, :label, :message_text, :spg_error_log_id, :instance_id)&#39;;&#10;        --&#10;        l_msg_type :&#61; message_type_id_in;&#10;    END IF;&#10;    --&#10;    EXECUTE IMMEDIATE l_sql&#10;    USING&#10;      SYSTIMESTAMP,&#10;      l_msg_type,&#10;      l_component_code,&#10;      l_package_name,&#10;      l_procedure_name,&#10;      l_label,&#10;      l_msg,&#10;      spg_error_log_id_in,&#10;      NVL(g_instance_id, 0);&#10;    --&#10;    COMMIT;&#10;    --&#10;    IF dbms_output_in &#61; &#39;Y&#39; THEN&#10;        DBMS_OUTPUT.put_line(&#10;            SUBSTRB(&#10;                &#39;[&#39; || TO_CHAR(systimestamp, &#39;YYYYMMDDHH24MISS&#39;) || &#39;]&#39; ||&#10;                &#39;[&#39; || l_component_code                          || &#39;]&#39; ||&#10;                &#39;[&#39; || l_package_name                            || &#39;]&#39; ||&#10;                &#39;[&#39; || l_procedure_name                          || &#39;]&#39; ||&#10;                &#39;[&#39; || l_label                                   || &#39;]&#39; ||&#10;                &#39;[&#39; || message_text_in                           || &#39;]&#39;,&#10;                1, 32767 ) );&#10;    END IF;&#10;    --&#10;END insert_message_log;&#10;--&#10;--&#10;PROCEDURE record_error(&#10;    message_type_id_in IN NUMBER,&#10;    component_code_in  IN VARCHAR2,&#10;    package_name_in    IN VARCHAR2,&#10;    procedure_name_in  IN VARCHAR2,&#10;    label_in           IN VARCHAR2,&#10;    message_text_in    IN VARCHAR2,&#10;    raise_error_in     IN BOOLEAN DEFAULT FALSE,&#10;    log_table_name     IN VARCHAR2 DEFAULT &#39;SPG_MESSAGE_LOG&#39; )&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    --&#10;    l_code             PLS_INTEGER :&#61; SQLCODE;&#10;    l_mesg             VARCHAR2(32767) :&#61; SUBSTR(message_text_in || &#39; [&#39; || SQLERRM || &#39;]&#39;, 1, 32767);&#10;    l_spg_error_log_id NUMBER;&#10;    l_sql              CLOB;&#10;    --&#10;BEGIN&#10;    --&#10;    IF l_code &lt;&gt; 0 THEN&#10;        IF log_table_name &#61; &#39;DMS_MESSAGE_LOG&#39; THEN&#10;            l_sql :&#61; &#39;INSERT INTO dms_error_log(dms_error_log_id, error_code, error_message, backtrace, callstack, date_created, created_by, dms_package_name, dms_procedure_name, label, instance_id)&#10;                      VALUES (spg_error_log_id_seq.NEXTVAL, :error_code, :error_message, :backtrace, :callstack, :date_created, :created_by, :dms_package_name, :dms_procedure_name, :label, :instance_id)&#10;                      RETURNING dms_error_log_id INTO :spg_error_log_id&#39;;&#10;        ELSE&#10;            l_sql :&#61; &#39;INSERT INTO spg_error_log(spg_error_log_id, error_code, error_message, backtrace, callstack, date_created, created_by, package_name, procedure_name, label, instance_id)&#10;                      VALUES (spg_error_log_id_seq.NEXTVAL, :error_code, :error_message, :backtrace, :callstack, :date_created, :created_by, :package_name, :procedure_name, :label, :instance_id)&#10;                      RETURNING spg_error_log_id INTO :spg_error_log_id&#39;;&#10;        END IF;&#10;        --&#10;        EXECUTE IMMEDIATE l_sql&#10;        USING&#10;          l_code,&#10;          l_mesg,&#10;          sys.DBMS_UTILITY.format_error_backtrace,&#10;          sys.DBMS_UTILITY.format_call_stack,&#10;          SYSDATE,&#10;          SUBSTR(USER, 1, NVL(G_USR_NAME_MAX_LEN, 30)),&#10;          SUBSTR(package_name_in, 1, 30),&#10;          SUBSTR(procedure_name_in, 1, 30),&#10;          SUBSTR(label_in, 1, 10),&#10;          NVL(g_instance_id, 0)&#10;        RETURN INTO l_spg_error_log_id;&#10;    END IF;&#10;    --&#10;    insert_message_log(&#10;        message_type_id_in  &#61;&gt; message_type_id_in,&#10;        component_code_in   &#61;&gt; component_code_in,&#10;        package_name_in     &#61;&gt; package_name_in,&#10;        procedure_name_in   &#61;&gt; procedure_name_in,&#10;        label_in            &#61;&gt; label_in,&#10;        message_text_in     &#61;&gt; message_text_in,&#10;        spg_error_log_id_in &#61;&gt; l_spg_error_log_id,&#10;        log_table_name      &#61;&gt; log_table_name );&#10;    COMMIT;&#10;    --&#10;    IF raise_error_in THEN&#10;        raise_error(error_code_in&#61;&gt;l_code, error_message_in&#61;&gt;l_mesg);&#10;    END IF;&#10;    --&#10;END record_error;&#10;--&#10;-- Used to populate mtt_message_log with information type message&#10;PROCEDURE debug(message_in VARCHAR2) IS&#10;BEGIN&#10;    insert_message_log(&#10;        message_type_id_in &#61;&gt; mt_debug,&#10;        component_code_in  &#61;&gt; g_component_code,&#10;        package_name_in    &#61;&gt; g_package_name,&#10;        procedure_name_in  &#61;&gt; g_procedure_name,&#10;        label_in           &#61;&gt; g_label,&#10;        message_text_in    &#61;&gt; message_in );&#10;END debug;&#10;--&#10;PROCEDURE info(message_in VARCHAR2) IS&#10;BEGIN&#10;    IF SPGInfoActive THEN&#10;        insert_message_log(&#10;            message_type_id_in &#61;&gt; mt_information,&#10;            component_code_in  &#61;&gt; g_component_code,&#10;            package_name_in    &#61;&gt; g_package_name,&#10;            procedure_name_in  &#61;&gt; g_procedure_name,&#10;            label_in           &#61;&gt; g_label,&#10;            message_text_in    &#61;&gt; message_in );&#10;    END IF;&#10;END info;&#10;--&#10;-- Will populate mtt_message_log with warning message - will populate mtt_error_log if result of exception&#10;PROCEDURE warn(message_in VARCHAR2) IS&#10;BEGIN&#10;    IF SPGWarnActive THEN&#10;        record_error(&#10;            message_type_id_in &#61;&gt; mt_warning,&#10;            component_code_in  &#61;&gt; g_component_code,&#10;            package_name_in    &#61;&gt; g_package_name,&#10;            procedure_name_in  &#61;&gt; g_procedure_name,&#10;            label_in           &#61;&gt; g_label,&#10;            message_text_in    &#61;&gt; message_in );&#10;    END IF;&#10;END warn;&#10;--&#10;-- Will populate mtt_message_log with error message and populate mtt_error_log with exception - used for log and continue&#10;PROCEDURE error (message_in VARCHAR2) IS&#10;BEGIN&#10;    record_error(&#10;        message_type_id_in &#61;&gt; mt_error,&#10;        component_code_in  &#61;&gt; g_component_code,&#10;        package_name_in    &#61;&gt; g_package_name,&#10;        procedure_name_in  &#61;&gt; g_procedure_name,&#10;        label_in           &#61;&gt; g_label,&#10;        message_text_in    &#61;&gt; message_in );&#10;END error;&#10;--&#10;-- Will populate mtt_message_log, mtt_error_log with error message and raise exception - used for log and halt&#10;PROCEDURE fatal(message_in VARCHAR2) IS&#10;BEGIN&#10;    record_error(&#10;        message_type_id_in &#61;&gt; mt_fatal_error,&#10;        component_code_in  &#61;&gt; g_component_code,&#10;        package_name_in    &#61;&gt; g_package_name,&#10;        procedure_name_in  &#61;&gt; g_procedure_name,&#10;        label_in           &#61;&gt; g_label,&#10;        message_text_in    &#61;&gt; message_in,&#10;        raise_error_in     &#61;&gt; TRUE );&#10;END fatal;&#10;--&#10;--&#10;--***************************************************&#10;-- Main procedures and functions                    *&#10;--***************************************************&#10;PROCEDURE record_error_message(&#10;    spg_notification_id_in SPG_NOTIFICATION.spg_notification_id%TYPE,&#10;    error_message_in       SPG_NOTIFICATION.error_message%TYPE )&#10;IS&#10;    --PRAGMA AUTONOMOUS_TRANSACTION;&#10;BEGIN&#10;    --&#10;    PKG_DynSQL.exec_SQL_atnm(&#10;        &#39;UPDATE spg_notification SET&#10;           processed_flag     &#61; 1,&#10;           processed_datetime &#61; SYSDATE,&#10;           message_id         &#61; ( CASE WHEN message_id &#61; &#39;&#39;PENDING&#39;&#39; THEN NULL ELSE message_id END ),&#10;           error_flag         &#61; 1,&#10;           error_message      &#61; REPLACE(:p_param_1, &#39;&#39;&lt;\qt&gt;&#39;&#39;, CHR(39))&#10;         WHERE spg_notification_id &#61; :p_param_2&#39;,&#10;        --&#10;        p_param_1 &#61;&gt; REPLACE(error_message_in, &#39;&#39;&#39;&#39;, &#39;&lt;\qt&gt;&#39;),&#10;        p_param_2 &#61;&gt; TO_CHAR(spg_notification_id_in) );&#10;        --&#10;        PKG_DynSQL.exec_SQL_atnm(&#10;        &#39;INSERT INTO SPG_ERROR (SPG_ERROR_ID, SPG_NOTIFICATION_ID, SPG_MESSAGE_TYPE_ID, ERROR_DATE, CREATED_BY_USER_ID, CREATED_DATETIME, LAST_UPDATED_USER_ID, LAST_UPDATED_DATETIME, SPG_ERROR_CATEGORY_ID, MESSAGE_CRN)&#10;           SELECT SPG_ERROR_ID_SEQ.NEXTVAL, SPGN.SPG_NOTIFICATION_ID,&#10;           nvl((SELECT STANDARD_REFERENCE_LIST_ID FROM R_STANDARD_REFERENCE_LIST r JOIN R_REFERENCE_DATA_MASTER m ON m.REFERENCE_DATA_MASTER_ID &#61; r.REFERENCE_DATA_MASTER_ID and m.CODE_SET_NAME &#61; &#39; || chr(39) || &#39;SPG MESSAGE TYPE&#39; || chr(39) || &#39; WHERE r.CODE_VALUE &#61; nvl(&#39; || chr(39) || chr(39) || &#39;||bm.ROOT_XML_MESSAGE_ID, &#39; || chr(39) || &#39;UNK&#39; || chr(39) || &#39;)), (SELECT STANDARD_REFERENCE_LIST_ID FROM R_STANDARD_REFERENCE_LIST r JOIN R_REFERENCE_DATA_MASTER m ON m.REFERENCE_DATA_MASTER_ID &#61; r.REFERENCE_DATA_MASTER_ID and m.CODE_SET_NAME &#61; &#39; || chr(39) || &#39;SPG MESSAGE TYPE&#39; || chr(39) || &#39; WHERE r.CODE_VALUE &#61; &#39; || chr(39) || &#39;UNK&#39; || chr(39) || &#39;)),&#10;           SPGN.DATE_CREATED,&#10;           (SELECT USER_ID FROM USER_ WHERE DISTINGUISHED_NAME &#61; rpa.CODE),&#10;           SPGN.DATE_CREATED,&#10;           (SELECT USER_ID FROM USER_ WHERE DISTINGUISHED_NAME &#61; rpa.CODE),&#10;           SPGN.DATE_CREATED,&#10;           (SELECT STANDARD_REFERENCE_LIST_ID FROM R_STANDARD_REFERENCE_LIST r JOIN R_REFERENCE_DATA_MASTER m ON m.REFERENCE_DATA_MASTER_ID &#61; r.REFERENCE_DATA_MASTER_ID and m.CODE_SET_NAME &#61; &#39; || chr(39) || &#39;SPG ERROR CATEGORY&#39; || chr(39) || &#39; WHERE r.CODE_VALUE &#61; &#39; || chr(39) || &#39;498&#39; || chr(39) || &#39;),&#10;           nvl(O.CRN, &#39; || chr(39) || &#39;XXXXXXX&#39; || chr(39) || &#39;)&#10;           FROM spg_notification spgn&#10;JOIN PROBATION_AREA rpa on rpa.PROBATION_AREA_ID &#61; spgn.RECEIVER_IDENTITY_ID&#10;JOIN R_SPG_XSD_PROBATION_AREA xsdpa on xsdpa.PROBATION_AREA_ID &#61; rpa.PROBATION_AREA_ID&#10;JOIN SPG_XSD xsd on xsd.SPG_XSD_ID &#61; xsdpa.SPG_XSD_ID&#10;LEFT OUTER JOIN BUSINESS_INT_XML_MAP bm on bm.BUSINESS_INTERACTION_ID &#61; spgn.BUSINESS_INTERACTION_ID and bm.XSD_NUMBER &#61; xsd.XSD_NUMBER&#10;LEFT OUTER JOIN OFFENDER O on O.OFFENDER_ID &#61; SPGN.OFFENDER_ID&#10;JOIN R_STANDARD_REFERENCE_LIST SPGA ON SPGA.STANDARD_REFERENCE_LIST_ID &#61; rpa.SPG_ACTIVE_ID&#10;         WHERE spg_notification_id &#61; :p_param_1&#10;         AND NOT EXISTS (SELECT SPG_ERROR_ID FROM SPG_ERROR WHERE SPG_NOTIFICATION_ID &#61; :p_param_2)&#39;,&#10;        --&#10;        p_param_1 &#61;&gt; TO_CHAR(spg_notification_id_in),&#10;        p_param_2 &#61;&gt; TO_CHAR(spg_notification_id_in) );&#10;  --COMMIT;&#10;END record_error_message;&#10;--&#10;--&#10;PROCEDURE set_value_string( control_code_in   SPG_CONTROL.control_code%TYPE,&#10;                            value_string_in   SPG_CONTROL.value_string%TYPE)&#10;IS&#10;BEGIN&#10;  UPDATE spg_control&#10;    SET value_string &#61; value_string_in&#10;  WHERE control_code &#61; control_code_in;&#10;  --&#10;  IF SQL%ROWCOUNT &#61; 0 THEN&#10;      INSERT INTO spg_control(spg_control_id, control_type, control_code, value_string) VALUES (spg_control_id_SEQ.nextval, &#39;C&#39;, control_code_in, value_string_in);&#10;  END IF;&#10;  --&#10;  COMMIT;&#10;END set_value_string;&#10;--&#10;--&#10;PROCEDURE set_value_number( control_code_in   SPG_CONTROL.control_code%TYPE,&#10;                            value_number_in   SPG_CONTROL.value_string%TYPE)&#10;IS&#10;BEGIN&#10;  UPDATE spg_control&#10;    SET value_number &#61; value_number_in&#10;  WHERE control_code &#61; control_code_in;&#10;  --&#10;  IF SQL%ROWCOUNT &#61; 0 THEN&#10;      INSERT INTO spg_control(spg_control_id, control_type, control_code, value_number) VALUES (spg_control_id_SEQ.nextval, &#39;C&#39;, control_code_in, value_number_in);&#10;  END IF;&#10;  --&#10;  COMMIT;&#10;END set_value_number;&#10;--&#10;--&#10;FUNCTION get_value_string(control_code_in SPG_CONTROL.control_code%TYPE) RETURN VARCHAR2&#10;IS&#10;BEGIN&#10;    RETURN&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;            p_table    &#61;&gt; &#39;spg_control&#39;,&#10;            p_ref_col  &#61;&gt; &#39;control_code&#39;,&#10;            p_ref_val  &#61;&gt; control_code_in,&#10;            p_data_fld &#61;&gt; &#39;value_string&#39; );&#10;END get_value_string;&#10;--&#10;--&#10;FUNCTION get_value_number(control_code_in SPG_CONTROL.control_code%TYPE) RETURN NUMBER IS&#10;BEGIN&#10;    RETURN&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;            p_table    &#61;&gt; &#39;spg_control&#39;,&#10;            p_ref_col  &#61;&gt; &#39;control_code&#39;,&#10;            p_ref_val  &#61;&gt; control_code_in,&#10;            p_data_fld &#61;&gt; &#39;value_number&#39; );&#10;END get_value_number;&#10;--&#10;--&#10;FUNCTION get_default_sender_id RETURN NUMBER IS&#10;BEGIN&#10;    RETURN&#10;        PKG_LOOKUPS.funcgetTabRecord_CACHED(&#10;            p_table    &#61;&gt; &#39;probation_area&#39;,&#10;            p_ref_col  &#61;&gt; &#39;code&#39;,&#10;            p_ref_val  &#61;&gt; g_default_sender,&#10;            p_data_fld &#61;&gt; &#39;probation_area_id&#39; );&#10;END get_default_sender_id;&#10;--&#10;--&#10;FUNCTION get_default_sender_code RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN g_default_sender;&#10;END get_default_sender_code;&#10;--&#10;--&#10;FUNCTION get_broadcast_domain_id RETURN NUMBER IS&#10;BEGIN&#10;    RETURN&#10;        PKG_LOOKUPS.funcgetTabRecord_CACHED(&#10;            p_table    &#61;&gt; &#39;probation_area&#39;,&#10;            p_ref_col  &#61;&gt; &#39;code&#39;,&#10;            p_ref_val  &#61;&gt; g_broadcast_domain,&#10;            p_data_fld &#61;&gt; &#39;probation_area_id&#39; );&#10;END get_broadcast_domain_id;&#10;--&#10;--&#10;FUNCTION get_broadcast_domain_code RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN g_broadcast_domain;&#10;END get_broadcast_domain_code;&#10;--&#10;&#10;FUNCTION encrypt_val( p_val IN VARCHAR2 ) RETURN RAW&#10;IS&#10;    --&#10;    l_val RAW(32) :&#61; UTL_I18N.STRING_TO_RAW( p_val, G_CHARACTER_SET );&#10;    l_encrypted RAW(32);&#10;    --&#10;BEGIN&#10;    --&#10;    l_val :&#61; UTL_I18N.string_to_raw( data&#61;&gt;p_val, dst_charset&#61;&gt;G_CHARACTER_SET );&#10;    --&#10;    l_encrypted :&#61; DBMS_CRYPTO.encrypt( src&#61;&gt;l_val, typ&#61;&gt;G_ENCRYPTION_TYPE, key&#61;&gt;G_KEY );&#10;    --&#10;    RETURN l_encrypted;&#10;END encrypt_val;&#10;--&#10;--&#10;FUNCTION decrypt_val( p_val IN RAW ) RETURN VARCHAR2&#10;IS&#10;    --&#10;    l_decrypted        RAW(32);&#10;    l_decrypted_string VARCHAR2(32);&#10;    --&#10;BEGIN&#10;    --&#10;    l_decrypted :&#61; DBMS_CRYPTO.decrypt( src&#61;&gt;p_val, typ&#61;&gt;G_ENCRYPTION_TYPE, key&#61;&gt;G_KEY );&#10;    --&#10;    l_decrypted_string :&#61; utl_i18n.raw_to_char( data&#61;&gt;l_decrypted, src_charset&#61;&gt;G_CHARACTER_SET );&#10;    --&#10;    RETURN l_decrypted_string;&#10;END decrypt_val;&#10;--&#10;--&#10;PROCEDURE set_outbound_broker(broker_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_value_string( control_code_in&#61;&gt;g_ob_broker, value_string_in&#61;&gt;broker_in );&#10;END set_outbound_broker;&#10;--&#10;--&#10;FUNCTION get_outbound_broker RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN get_value_string(g_ob_broker);&#10;END get_outbound_broker;&#10;--&#10;--&#10;PROCEDURE set_outbound_queue(queue_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_value_string( control_code_in&#61;&gt;g_ob_queue, value_string_in&#61;&gt;queue_in );&#10;END set_outbound_queue;&#10;--&#10;--&#10;FUNCTION get_outbound_queue RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN get_value_string(g_ob_queue);&#10;END get_outbound_queue;&#10;--&#10;--&#10;PROCEDURE set_broker_username(username_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_value_string( control_code_in&#61;&gt;g_obq_username, value_string_in&#61;&gt;username_in );&#10;END set_broker_username;&#10;--&#10;--&#10;FUNCTION get_broker_username RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN get_value_string(g_obq_username);&#10;END get_broker_username;&#10;--&#10;--&#10;PROCEDURE set_broker_password(password_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_value_string( control_code_in&#61;&gt;g_obq_password, value_string_in&#61;&gt;password_in );&#10;END set_broker_password;&#10;--&#10;--&#10;FUNCTION get_broker_password(username_in IN VARCHAR2) RETURN VARCHAR2&#10;IS&#10;    --&#10;    l_ret SPG_CONTROL.value_string%TYPE;&#10;    --&#10;BEGIN&#10;    IF get_broker_username &#61; username_in THEN&#10;        l_ret:&#61; decrypt_val( get_value_string(g_obq_password) );&#10;    END IF;&#10;    RETURN l_ret;&#10;END get_broker_password;&#10;--&#10;--&#10;PROCEDURE set_broker_credentials(username_in IN VARCHAR2, password_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_broker_username(username_in);&#10;    set_broker_password( encrypt_val(password_in) );&#10;END set_broker_credentials;&#10;--&#10;--&#10;FUNCTION get_schema_name RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;            p_table    &#61;&gt; &#39;user_xml_schemas&#39;,&#10;            p_ref_col  &#61;&gt; &#39;1&#39;,&#10;            p_ref_val  &#61;&gt; &#39;1&#39;,&#10;            p_data_fld &#61;&gt; &#39;schema_url&#39;,&#10;            p_where    &#61;&gt; &#39;schema_url LIKE &#39;&#39;SPG-XML_Message_Root-V%&#39;&#39;&#39;);&#10;END get_schema_name;&#10;--&#10;--&#10;FUNCTION get_schema_name(xsd_number_in IN SPG_XSD.xsd_number%TYPE) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;            p_table    &#61;&gt; &#39;spg_xsd&#39;,&#10;            p_ref_col  &#61;&gt; &#39;xsd_number&#39;,&#10;            p_ref_val  &#61;&gt; xsd_number_in,&#10;            p_data_fld &#61;&gt; &#39;xsd_name&#39;);&#10;END get_schema_name;&#10;--&#10;--&#10;PROCEDURE set_spg_modules(modules_in IN NUMBER) IS&#10;BEGIN&#10;    set_value_number( control_code_in&#61;&gt;g_spgmodules, value_number_in&#61;&gt;modules_in );&#10;END set_spg_modules;&#10;--&#10;--&#10;PROCEDURE set_spg_modules (modules_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_spg_modules( PKG_COMMON.bin2dec(modules_in) );&#10;END set_spg_modules;&#10;--&#10;--&#10;FUNCTION get_spg_modules RETURN NUMBER IS&#10;BEGIN&#10;    RETURN get_value_number(g_spgmodules);&#10;END get_spg_modules;&#10;--&#10;--&#10;FUNCTION get_spg_module_map RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN LPAD( NVL(PKG_Common.dec2bin(get_value_number(g_spgmodules)),&#39;0&#39;), PKG_Global.g_SPGMaxElem, &#39;0&#39; );&#10;END get_spg_module_map;&#10;--&#10;--&#10;PROCEDURE generateIdentifiers(&#10;    p_payload_in               IN  spg_payload_type,&#10;    control_reference_out      OUT SPG_NOTIFICATION.control_reference%TYPE,&#10;    receiver_ctl_reference_out OUT SPG_NOTIFICATION.receiver_control_reference%TYPE,&#10;    sender_identity_id_out     OUT SPG_NOTIFICATION.sender_identity_id%TYPE,&#10;    receiver_identity_id_out   OUT SPG_NOTIFICATION.receiver_identity_id%TYPE)&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    --&#10;    l_unique_id              SPG_NOTIFICATION.unique_id%TYPE;&#10;    l_control_reference      SPG_NOTIFICATION.control_reference%TYPE;&#10;    l_receiver_ctl_reference SPG_NOTIFICATION.receiver_control_reference%TYPE;&#10;    l_sender_identity_id     SPG_NOTIFICATION.sender_identity_id%TYPE;&#10;    l_receiver_identity_id   SPG_NOTIFICATION.receiver_identity_id%TYPE;&#10;    l_default_sender_id      NUMBER;&#10;    l_default_receiver_id    NUMBER;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT probation_area_id INTO l_default_sender_id&#10;    FROM probation_area&#10;    WHERE code &#61; &#39;N00&#39;;&#10;    --&#10;    SELECT probation_area_id INTO l_default_receiver_id&#10;    FROM probation_area&#10;    WHERE code &#61; &#39;ALL&#39;;&#10;    --&#10;    SELECT&#10;      unique_id,&#10;      control_reference,&#10;      receiver_control_reference,&#10;      sender_identity_id,&#10;      receiver_identity_id&#10;    INTO&#10;      l_unique_id,&#10;      l_control_reference,&#10;      l_receiver_ctl_reference,&#10;      l_sender_identity_id,&#10;      l_receiver_identity_id&#10;    FROM spg_notification&#10;    WHERE spg_notification_id &#61; p_payload_in.spg_notification_id;&#10;    --&#10;    IF l_control_reference IS NOT NULL THEN&#10;        control_reference_out      :&#61; l_control_reference;&#10;        receiver_ctl_reference_out :&#61; l_receiver_ctl_reference;&#10;        sender_identity_id_out     :&#61; l_sender_identity_id;&#10;        receiver_identity_id_out   :&#61; l_receiver_identity_id;&#10;    ELSE&#10;        IF p_payload_in.interaction_code IN (&#39;CABI020&#39;) THEN&#10;            --&#10;            SELECT&#10;              SPGConfig.getnextcontrolreference(orig_pa.code) AS control_reference,&#10;              orig_pa.probation_area_id                       AS sender_identity_id,&#10;              recv_pa.probation_area_id                       AS receiver_identity_id&#10;              INTO&#10;                l_control_reference,&#10;                l_sender_identity_id,&#10;                l_receiver_identity_id&#10;            FROM offender_transfer ot&#10;              INNER JOIN team orig_t ON ot.origin_team_id &#61; orig_t.team_id&#10;                INNER JOIN probation_area orig_pa ON orig_pa.probation_area_id &#61; orig_t.probation_area_id&#10;              INNER JOIN team recv_t ON ot.receiving_team_id &#61; recv_t.team_id&#10;                INNER JOIN probation_area recv_pa ON recv_pa.probation_area_id &#61; recv_t.probation_area_id&#10;            WHERE ot.offender_id &#61; l_unique_id;&#10;            --&#10;            UPDATE spg_notification SET&#10;              control_reference    &#61; l_control_reference,&#10;              sender_identity_id   &#61; l_sender_identity_id,&#10;              receiver_identity_id &#61; l_receiver_identity_id&#10;            WHERE spg_notification_id &#61; p_payload_in.spg_notification_id&#10;            RETURNING&#10;              control_reference,&#10;              sender_identity_id,&#10;              receiver_identity_id&#10;            INTO&#10;              control_reference_out,&#10;              sender_identity_id_out,&#10;              receiver_identity_id_out;&#10;        ELSIF p_payload_in.interaction_code IN (&#39;REF01&#39;,&#39;REF02&#39;) THEN&#10;            --&#10;            SELECT&#10;              SPGConfig.getnextcontrolreference(g_default_sender) AS control_reference,&#10;              NVL(l_sender_identity_id, l_default_sender_id)      AS sender_identitiy_id,&#10;              NVL(l_receiver_identity_id, l_default_receiver_id)  AS receiver_identity_id&#10;            INTO&#10;              l_control_reference,&#10;              l_sender_identity_id,&#10;              l_receiver_identity_id&#10;            FROM DUAL;&#10;            --&#10;            UPDATE spg_notification SET&#10;              control_reference    &#61; l_control_reference,&#10;              sender_identity_id   &#61; l_sender_identity_id,&#10;              receiver_identity_id &#61; l_receiver_identity_id&#10;            WHERE spg_notification_id &#61; p_payload_in.spg_notification_id&#10;            RETURNING&#10;              control_reference,&#10;              sender_identity_id,&#10;              receiver_identity_id&#10;            INTO&#10;              control_reference_out,&#10;              sender_identity_id_out,&#10;              receiver_identity_id_out;&#10;            --&#10;        ELSE&#10;            --&#10;            SELECT&#10;              SPGConfig.getnextcontrolreference(g_default_sender) AS control_reference,&#10;              NVL(l_sender_identity_id, l_default_sender_id)      AS sender_identity_id,&#10;              NVL(l_receiver_identity_id, l_default_receiver_id)  AS receiver_identity_id&#10;            INTO&#10;              l_control_reference,&#10;              l_sender_identity_id,&#10;              l_receiver_identity_id&#10;            FROM DUAL;&#10;            --&#10;            UPDATE spg_notification SET&#10;              control_reference    &#61; l_control_reference,&#10;              sender_identity_id   &#61; l_sender_identity_id,&#10;              receiver_identity_id &#61; l_receiver_identity_id&#10;            WHERE spg_notification_id &#61; p_payload_in.spg_notification_id&#10;            RETURNING&#10;              control_reference,&#10;              sender_identity_id,&#10;              receiver_identity_id,&#10;              receiver_control_reference&#10;            INTO&#10;              control_reference_out,&#10;              sender_identity_id_out,&#10;              receiver_identity_id_out,&#10;              receiver_ctl_reference_out;&#10;            --&#10;        END IF;&#10;        --&#10;        COMMIT;&#10;        --&#10;    END IF;&#10;    --&#10;END generateIdentifiers;&#10;--&#10;--&#10;FUNCTION get_xml_map(business_interaction_code_in business_interaction.business_interaction_code%TYPE) RETURN xml_map_rec&#10;IS&#10;    --&#10;    xml_map   xml_map_rec;&#10;    --&#10;    CURSOR cur(business_interaction_code_in business_interaction.business_interaction_code%TYPE) IS&#10;      SELECT&#10;        BI.business_interaction_code,&#10;        PKG_DynSQL.get_xml_view_name(BIXM.root_xml_message_id) table_name,&#10;        BIXM.xml_message_name,&#10;--        Pkg_LstUtl.get_array_2_list     (Pkg_LstUtl.get_list_2_array(BIXM.include_xml_message_list), p_iterator_function&#61;&gt;&#39;PKG_DynSQL.get_xml_view_name(:p_xml_msg_id)&#39;) AS inc_xml_msg_list,&#10;--        Pkg_LstUtl.get_array_2_list     (Pkg_LstUtl.get_list_2_array(BIXM.exclude_xml_message_list), p_iterator_function&#61;&gt;&#39;PKG_DynSQL.get_xml_view_name(:p_xml_msg_id)&#39;) AS excl_xml_msg_list,&#10;        Pkg_LstUtl.get_array_2_list_CLOB(Pkg_LstUtl.get_list_2_array(bixm.include_xml_message_list), p_iterator_function&#61;&gt;&#39;PKG_DynSQL.get_xml_view_name(:p_xml_msg_id)&#39;) AS inc_xml_msg_list,&#10;        Pkg_LstUtl.get_array_2_list_CLOB(Pkg_LstUtl.get_list_2_array(bixm.exclude_xml_message_list), p_iterator_function&#61;&gt;&#39;PKG_DynSQL.get_xml_view_name(:p_xml_msg_id)&#39;) AS excl_xml_msg_list,&#10;        BIXM.data_update_mode&#10;      FROM&#10;        business_int_xml_map BIXM&#10;          INNER JOIN business_interaction BI ON BI.business_interaction_id &#61; BIXM.business_interaction_id&#10;      WHERE BI.business_interaction_code &#61; business_interaction_code_in&#10;        AND BIXM.xsd_number &#61; NVL(SPGMESSAGE.GC_SCHEMA_NUMBER, 1);&#10;    --&#10;BEGIN&#10;    --&#10;    OPEN cur(business_interaction_code_in);&#10;    FETCH cur INTO xml_map;&#10;    CLOSE cur;&#10;    --&#10;    RETURN xml_map;&#10;END get_xml_map;&#10;--&#10;--&#10;FUNCTION ControlCodeExists(controlcode_in SPG_CONTROL.control_code%TYPE) RETURN BOOLEAN IS&#10;BEGIN&#10;    RETURN&#10;        ( &#39;Y&#39; &#61;&#10;          PKG_Lookups.funcgetTabRecord_CACHED(&#10;              p_table    &#61;&gt; &#39;spg_control&#39;,&#10;              p_ref_col  &#61;&gt; &#39;control_code&#39;,&#10;              p_ref_val  &#61;&gt; controlcode_in,&#10;              p_data_fld &#61;&gt; &#39;&#39;&#39;Y&#39;&#39;&#39;,&#10;              p_default_val &#61;&gt; &#39;&#39;&#39;N&#39;&#39;&#39; ) );&#10;END ControlCodeExists;&#10;--&#10;--&#10;FUNCTION getNextControlReference(probation_area_code_in PROBATION_AREA.code%TYPE) RETURN NUMBER&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    --&#10;    l_ret          NUMBER;&#10;    l_control_code SPG_CONTROL.control_code%TYPE;&#10;    --&#10;BEGIN&#10;    --&#10;    g_label :&#61; &#39;450000&#39;;&#10;    g_procedure_name :&#61; &#39;getNextControlReference&#39;;&#10;    --&#10;    l_control_code :&#61; SUBSTRB(g_ob_cref || probation_area_code_in,1,10);&#10;    --&#10;    IF ControlCodeExists(l_control_code) THEN&#10;        --&#10;        g_label :&#61; &#39;450010&#39;;&#10;        UPDATE spg_control SET&#10;          value_number &#61; CASE WHEN TRUNC(SYSDATE) &#61; TRUNC(VALUE_DATE) THEN value_number + 1 ELSE 1 END,&#10;          value_date &#61; SYSDATE&#10;        WHERE control_code &#61; l_control_code&#10;        RETURNING value_number INTO l_ret;&#10;        --&#10;    ELSE&#10;        --&#10;        INSERT INTO spg_control(&#10;          spg_control_id, control_code, control_name, control_type, value_number, value_date&#10;        ) VALUES (&#10;          spg_control_id_seq.NEXTVAL, l_control_code, &#39;Control Reference for &#39; || probation_area_code_in,&#39;R&#39;,1,SYSDATE )&#10;        RETURNING value_number INTO l_ret;&#10;        --&#10;    END IF;&#10;    --&#10;    g_label :&#61; &#39;450015&#39;;&#10;    l_ret :&#61; TO_NUMBER(TO_CHAR(SYSDATE, &#39;yymmdd&#39;) || LPAD(l_ret, 8, &#39;0&#39;));&#10;    --&#10;    g_label :&#61; &#39;450020&#39;;&#10;    COMMIT;&#10;    --&#10;    g_label :&#61; &#39;450030&#39;;&#10;    RETURN l_ret;&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    fatal(&#39;Error getting next sequence from control file&#39;);&#10;END getNextControlReference;&#10;--&#10;--&#10;PROCEDURE broadcast_reference_data(probation_area_id_in IN NUMBER DEFAULT NULL)&#10;IS&#10;    --&#10;    l_sender_identity_id NUMBER;&#10;    --&#10;BEGIN&#10;    --&#10;    l_sender_identity_id :&#61; SPGCONFIG.get_default_sender_id;&#10;    --&#10;    FOR PO IN (&#10;        SELECT pa.probation_area_id, pa.code&#10;        FROM&#10;          probation_area pa&#10;          INNER JOIN r_standard_reference_list rs ON pa.spg_active_id &#61; rs.standard_reference_list_id AND rs.code_value IN (&#39;A&#39;,&#39;T&#39;)&#10;        WHERE pa.selectable &#61; &#39;Y&#39;&#10;          AND pa.private &#61; 1&#10;          AND (probation_area_id_in IS NULL OR pa.probation_area_id &#61; probation_area_id_in ) )&#10;    LOOP&#10;        --&#10;        INSERT INTO spg_notification (spg_notification_id, business_interaction_id, date_created, control_reference, sender_identity_id, receiver_identity_id, message_direction)&#10;        VALUES (spg_notification_id_seq.NEXTVAL, PKG_LOOKUPS.funcGetBusinessInteractionID(&#39;REF01&#39;), SYSDATE, SPGCONFIG.getNextControlReference(g_default_sender), l_sender_identity_id , PO.probation_area_id,&#39;O&#39; );&#10;        --&#10;        INSERT INTO spg_notification (spg_notification_id, business_interaction_id, date_created, control_reference, sender_identity_id, receiver_identity_id, message_direction)&#10;        VALUES (spg_notification_id_seq.NEXTVAL, PKG_LOOKUPS.funcGetBusinessInteractionID(&#39;REF02&#39;), SYSDATE, SPGCONFIG.getNextControlReference(g_default_sender), l_sender_identity_id , PO.probation_area_id, &#39;O&#39;);&#10;        --&#10;        INSERT INTO spg_notification (spg_notification_id, business_interaction_id, date_created, control_reference, sender_identity_id, receiver_identity_id, message_direction)&#10;        VALUES (spg_notification_id_seq.NEXTVAL, PKG_LOOKUPS.funcGetBusinessInteractionID(&#39;REF03&#39;), SYSDATE, SPGCONFIG.getNextControlReference(g_default_sender), l_sender_identity_id , PO.probation_area_id, &#39;O&#39;);&#10;        --&#10;    END LOOP;&#10;    --&#10;    COMMIT;&#10;    --&#10;END broadcast_reference_data;&#10;--&#10;FUNCTION get_xml_message_id(p_xml_message_name IN VARCHAR2) RETURN NUMBER&#10;IS&#10;    l_ret NUMBER;&#10;BEGIN&#10;    SELECT xml_message_id INTO l_ret&#10;    FROM business_int_xml_summary&#10;    WHERE xsd_number &#61; NVL(SPGMESSAGE.GC_SCHEMA_NUMBER, 1)&#10;      AND (UPPER(xml_message_name) &#61; UPPER(p_xml_message_name) OR UPPER(xml_message_name) || &#39;D&#39; &#61; UPPER(p_xml_message_name));&#10;    --&#10;    RETURN l_ret;&#10;END get_xml_message_id;&#10;--&#10;--&#10;FUNCTION getNextTeamReference(probation_area_code_in PROBATION_AREA.code%TYPE) RETURN VARCHAR2&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    --&#10;    l_ret           SPG_CONTROL.value_string%TYPE;&#10;    l_control_code  SPG_CONTROL.control_code%TYPE;&#10;    l_temp          SPG_CONTROL.value_number%TYPE;&#10;    --&#10;    l_pad_char      VARCHAR2(1) :&#61; &#39;#&#39;;&#10;    --&#10;BEGIN&#10;    g_label :&#61; &#39;750000&#39;;&#10;    g_procedure_name :&#61; &#39;getNextTeamReference&#39;;&#10;    --&#10;    l_control_code :&#61; SUBSTRB(g_teamref || probation_area_code_in, 1, 10);&#10;    --&#10;    IF ControlCodeExists(l_control_code) THEN&#10;        --&#10;        g_label :&#61; &#39;750010&#39;;&#10;        UPDATE spg_control SET&#10;          value_string &#61; RPAD(TRIM(TO_CHAR(value_number + 1, &#39;XXXXXX&#39;)),6,l_pad_char),&#10;          value_number &#61;  value_number + 1,&#10;          value_date   &#61; SYSDATE&#10;        WHERE control_code &#61; l_control_code&#10;        RETURNING TRIM(value_string) INTO l_ret;&#10;        --&#10;    ELSE&#10;        --&#10;        l_temp :&#61; TO_NUMBER(LPAD(TO_CHAR(NVL(PKG_Common.char_2_number(SUBSTR(probation_area_code_in, 2, 2)), 0)), 2, &#39;0&#39;) || LPAD(1, 5, &#39;0&#39;));&#10;        --l_temp :&#61; TO_NUMBER(SUBSTR(probation_area_code_in,2,2) || LPAD(1,5,&#39;0&#39;));&#10;        --&#10;        INSERT INTO spg_control(&#10;          spg_control_id,&#10;          control_code,&#10;          control_name,&#10;          control_type,&#10;          value_number,&#10;          value_string,&#10;          value_date&#10;        ) VALUES (&#10;          spg_control_id_seq.NEXTVAL,&#10;          l_control_code,&#10;          &#39;Team Reference for &#39; || probation_area_code_in,&#10;          &#39;R&#39;,&#10;          l_temp,&#10;          RPAD(TRIM(TO_CHAR(l_temp, &#39;XXXXXX&#39;)), 6, l_pad_char),&#10;          SYSDATE )&#10;        RETURNING TRIM(value_string) INTO l_ret;&#10;        --&#10;    END IF;&#10;    --&#10;    g_label :&#61; &#39;750020&#39;;&#10;    COMMIT;&#10;    --&#10;    g_label :&#61; &#39;750030&#39;;&#10;    RETURN l_ret;&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    fatal(&#39;Error getting next team reference from control file&#39;);&#10;END getNextTeamReference;&#10;--&#10;--&#10;FUNCTION getNextStaffReference(probation_area_code_in PROBATION_AREA.code%TYPE, p_preferred_code STAFF.officer_code%TYPE DEFAULT NULL) RETURN VARCHAR2&#10;IS&#10;    --&#10;    l_prefix       VARCHAR2(100) :&#61; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;;&#10;    l_found        BOOLEAN :&#61; FALSE;&#10;    l_officer_code STAFF.officer_code%TYPE;&#10;    l_suffix       VARCHAR2(1);&#10;    l_start_cnt    INTEGER;&#10;    l_cnt          INTEGER;&#10;    --&#10;    probation_code_no_match EXCEPTION;&#10;    invalid_format          EXCEPTION;&#10;    exhausted_values        EXCEPTION;&#10;    --&#10;    FUNCTION officer_code_free(p_officer_code STAFF.officer_code%TYPE) RETURN BOOLEAN&#10;    IS&#10;        --&#10;        l_cnt INTEGER;&#10;        l_ret BOOLEAN :&#61; FALSE;&#10;        --&#10;    BEGIN&#10;        IF p_officer_code IS NOT NULL THEN&#10;            l_cnt :&#61;&#10;                PKG_Lookups.funcgetTabRecord_CACHED(&#10;                    p_table       &#61;&gt; &#39;staff&#39;,&#10;                    p_data_fld    &#61;&gt; &#39;COUNT(1)&#39;,&#10;                    p_default_val &#61;&gt; -1,&#10;                    p_ref_col     &#61;&gt; &#39;officer_code&#39;,&#10;                    p_ref_val     &#61;&gt; p_officer_code );&#10;            IF l_cnt &#61; 0 THEN&#10;                l_ret :&#61; TRUE;&#10;            END IF;&#10;        END IF;&#10;        --&#10;        RETURN l_ret;&#10;    END officer_code_free;&#10;    --&#10;BEGIN&#10;    --&#10;    g_label :&#61; &#39;750000&#39;;&#10;    g_procedure_name :&#61; &#39;getNextStaffReference&#39;;&#10;    --&#10;    IF NOT REGEXP_LIKE(p_preferred_code, &#39;^[A-Z][0-9][0-9][A-Z][0-9][0-9][0-9]&#39;) THEN&#10;        RAISE invalid_format;&#10;    ELSIF probation_area_code_in !&#61; SUBSTR(p_preferred_code,1,3) THEN&#10;        RAISE probation_code_no_match;&#10;    END IF;&#10;    --&#10;    g_label :&#61; &#39;750010&#39;;&#10;    IF officer_code_free(p_preferred_code) THEN&#10;        g_label :&#61; &#39;750020&#39;;&#10;        l_officer_code :&#61; p_preferred_code;&#10;    ELSE&#10;        g_label :&#61; &#39;750030&#39;;&#10;        --&#10;        FOR x IN 1..LENGTH(l_prefix) LOOP&#10;            l_suffix :&#61; SUBSTR(l_prefix,x,1);&#10;            WITH range AS (&#10;              SELECT ROWNUM least_number&#10;              FROM DUAL CONNECT BY LEVEL &lt;&#61; 999&#10;              MINUS&#10;              SELECT TO_NUMBER((SUBSTR(officer_code,5,3)))&#10;              FROM staff&#10;              WHERE officer_code LIKE &#39;C01&#39; || l_suffix || &#39;%&#39;&#10;              AND REGEXP_LIKE(officer_code, &#39;^[A-Z][0-9][0-9][A-Z][0-9][0-9][0-9]&#39;) )&#10;            SELECT MIN(least_number)&#10;            INTO l_start_cnt&#10;            FROM range;&#10;            --&#10;            FOR y IN l_start_cnt..999 LOOP&#10;                g_label :&#61; &#39;750040&#39;;&#10;                l_officer_code :&#61; probation_area_code_in || l_suffix || LPAD(y,3,&#39;0&#39;);&#10;                --&#10;                g_label :&#61; &#39;750050&#39;;&#10;                IF officer_code_free(l_officer_code) THEN&#10;                    g_label :&#61; &#39;750060&#39;;&#10;                    l_found :&#61; TRUE;&#10;                    EXIT;&#10;                END IF;&#10;            END LOOP;&#10;            --&#10;            EXIT WHEN l_found;&#10;            --&#10;        END LOOP;&#10;        --&#10;    END IF;&#10;    --&#10;    g_label :&#61; &#39;750070&#39;;&#10;    IF NOT l_found THEN&#10;        RAISE exhausted_values;&#10;    END IF;&#10;    --&#10;    g_label :&#61; &#39;750080&#39;;&#10;    RETURN l_officer_code;&#10;    --&#10;EXCEPTION&#10;  WHEN invalid_format THEN&#10;      fatal(&#39;Preferred officer_code invalid format&#39;);&#10;  WHEN probation_code_no_match THEN&#10;      fatal(&#39;Probation code not valid for preferred officer_code&#39;);&#10;  WHEN exhausted_values THEN&#10;      fatal(&#39;No available officer_code for probation area&#39;);&#10;  WHEN OTHERS THEN&#10;      fatal(&#39;Error getting next officer code&#39;);&#10;END getNextStaffReference;&#10;--&#10;FUNCTION getNextLocationReference(probation_area_code_in PROBATION_AREA.code%TYPE) RETURN VARCHAR2&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    --&#10;    l_ret           SPG_CONTROL.value_string%TYPE;&#10;    l_control_code  SPG_CONTROL.control_code%TYPE;&#10;    l_temp          SPG_CONTROL.value_number%TYPE;&#10;    --&#10;    l_pad_char      VARCHAR2(1) :&#61; &#39;#&#39;;&#10;    --&#10;BEGIN&#10;    --&#10;    g_label :&#61; &#39;750000&#39;;&#10;    g_procedure_name :&#61; &#39;getNextLocationReference&#39;;&#10;    --&#10;    l_control_code :&#61; SUBSTRB(g_locref || probation_area_code_in,1,10);&#10;    --&#10;    IF ControlCodeExists(l_control_code) THEN&#10;        --&#10;        g_label :&#61; &#39;750010&#39;;&#10;        UPDATE spg_control SET&#10;          value_string &#61; RPAD(TRIM(TO_CHAR(value_number + 1, &#39;XXXXXXX&#39;)),7,l_pad_char),&#10;          value_number &#61;  value_number + 1,&#10;          value_date   &#61; SYSDATE&#10;        WHERE control_code &#61; l_control_code&#10;        RETURNING TRIM(value_string) INTO l_ret;&#10;        --&#10;    ELSE&#10;        --&#10;        l_temp :&#61; TO_NUMBER(LPAD(TO_CHAR(NVL(PKG_Common.char_2_number(SUBSTR(probation_area_code_in, 2, 2)), 0)), 2, &#39;0&#39;) || LPAD(1, 6, &#39;0&#39;));&#10;        --l_temp :&#61; TO_NUMBER(SUBSTR(probation_area_code_in,2,2) || LPAD(1,6,&#39;0&#39;));&#10;        --&#10;        INSERT INTO spg_control(&#10;          spg_control_id,&#10;          control_code,&#10;          control_name,&#10;          control_type,&#10;          value_number,&#10;          value_string,&#10;          value_date&#10;        ) VALUES (&#10;          spg_control_id_seq.NEXTVAL,&#10;          l_control_code,&#10;          &#39;Location Reference for &#39; || probation_area_code_in,&#10;          &#39;R&#39;,&#10;          l_temp,&#10;          RPAD(TRIM(TO_CHAR(l_temp, &#39;XXXXXXX&#39;)), 7, l_pad_char),&#10;          SYSDATE )&#10;        RETURNING TRIM(value_string) INTO l_ret;&#10;        --&#10;    END IF;&#10;    --&#10;    g_label :&#61; &#39;750020&#39;;&#10;    COMMIT;&#10;    --&#10;    g_label :&#61; &#39;750030&#39;;&#10;    RETURN l_ret;&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    fatal(&#39;Error getting next location reference from control file&#39;);&#10;END getNextLocationReference;&#10;--&#10;--&#10;PROCEDURE set_alfresco_url(url_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_value_string( control_code_in&#61;&gt;g_alfrescourl, value_string_in&#61;&gt;url_in );&#10;END set_alfresco_url;&#10;--&#10;--&#10;FUNCTION get_alfresco_url RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN get_value_string(g_alfrescourl);&#10;END get_alfresco_url;&#10;--&#10;--&#10;PROCEDURE set_alfresco_user (user_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_value_string( control_code_in&#61;&gt;g_alfrescouser, value_string_in&#61;&gt;user_in );&#10;END set_alfresco_user;&#10;--&#10;--&#10;FUNCTION get_alfresco_user RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN get_value_string(g_alfrescouser);&#10;END get_alfresco_user;&#10;--&#10;--&#10;PROCEDURE set_alfresco_wallet (wallet_in IN VARCHAR2) IS&#10;BEGIN&#10;    set_value_string( control_code_in&#61;&gt;g_alfrescowallet, value_string_in&#61;&gt;wallet_in );&#10;END set_alfresco_wallet;&#10;--&#10;--&#10;FUNCTION get_alfresco_wallet RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN get_value_string(g_alfrescowallet);&#10;END get_alfresco_wallet;&#10;--&#10;--&#10;FUNCTION get_xsd_number(&#10;    p_probation_area_id          NUMBER,&#10;    p_bi_code                    VARCHAR2 DEFAULT NULL,&#10;    p_refdata_in_latest_xsd_flag VARCHAR2 DEFAULT NULL )&#10;RETURN SPG_xsd.xsd_number%TYPE&#10;IS&#10;    --&#10;    l_xsd_number                 SPG_xsd.xsd_number%TYPE;&#10;    l_refdata_in_latest_xsd_flag BOOLEAN;&#10;    l_ref_msg_flag               BOOLEAN;&#10;    --&#10;BEGIN&#10;    --&#10;    IF p_refdata_in_latest_xsd_flag IN (&#39;Y&#39;, &#39;N&#39;) THEN&#10;        l_refdata_in_latest_xsd_flag :&#61; (p_refdata_in_latest_xsd_flag &#61; &#39;Y&#39;);&#10;    ELSE&#10;        l_refdata_in_latest_xsd_flag :&#61; GC_REFDATA_IN_LATEST_XSD_FLAG;&#10;    END IF;&#10;    --&#10;    l_ref_msg_flag :&#61; ( l_refdata_in_latest_xsd_flag &#61; TRUE )&#10;                      AND&#10;                      (  p_bi_code IN ( &#39;REF01&#39;,&#39;REF02&#39;, &#39;REF_03&#39; ) OR&#10;                         p_bi_code LIKE &#39;R__CONFIG&#39;                 OR&#10;                         p_bi_code LIKE &#39;LLBI___&#39;&#10;                      );&#10;    IF l_ref_msg_flag THEN&#10;        l_xsd_number :&#61; 1;&#10;    ELSE&#10;        SELECT NVL(MIN(SX.xsd_number), 1) INTO l_xsd_number&#10;        FROM&#10;          probation_area           PA,&#10;          r_spg_xsd_probation_area XPA,&#10;          spg_xsd                  SX&#10;        WHERE 1&#61;1&#10;          AND XPA.probation_area_id &#61; PA.probation_area_id&#10;          AND SX.spg_xsd_id         &#61; XPA.spg_xsd_id&#10;          AND PA.probation_area_id  &#61; p_probation_area_id;&#10;    END IF;&#10;    --&#10;    RETURN l_xsd_number;&#10;    --&#10;EXCEPTION WHEN NO_DATA_FOUND THEN&#10;    RETURN 1;&#10;END get_xsd_number;&#10;--&#10;-- Overload 1&#10;FUNCTION get_xsd_number(&#10;    p_probation_area_code        PROBATION_AREA.code%TYPE,&#10;    p_bi_code                    VARCHAR2 DEFAULT NULL,&#10;    p_refdata_in_latest_xsd_flag VARCHAR2 DEFAULT NULL )&#10;RETURN SPG_xsd.xsd_number%TYPE&#10;IS&#10;    l_probation_area_id NUMBER;&#10;BEGIN&#10;    --&#10;    l_probation_area_id :&#61;&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;            p_table    &#61;&gt; &#39;PROBATION_AREA&#39;,&#10;            p_ref_col  &#61;&gt; &#39;code&#39;,&#10;            p_ref_val  &#61;&gt; p_probation_area_code,&#10;            p_data_fld &#61;&gt; &#39;probation_area_id&#39; );&#10;    --&#10;    RETURN&#10;        get_xsd_number(&#10;            p_probation_area_id          &#61;&gt; l_probation_area_id,&#10;            p_bi_code                    &#61;&gt; p_bi_code,&#10;            p_refdata_in_latest_xsd_flag &#61;&gt; p_refdata_in_latest_xsd_flag);&#10;    --&#10;END get_xsd_number;&#10;--&#10;-- Overload 2&#10;FUNCTION get_xsd_number(&#10;    p_probation_area_id          NUMBER,&#10;    p_bi_id                      NUMBER DEFAULT NULL,&#10;    p_refdata_in_latest_xsd_flag VARCHAR2 DEFAULT NULL )&#10;RETURN SPG_xsd.xsd_number%TYPE&#10;IS&#10;    l_bi_code BUSINESS_INTERACTION.business_interaction_code%TYPE :&#61; NULL;&#10;BEGIN&#10;    --&#10;    IF p_bi_id IS NOT NULL THEN&#10;        l_bi_code :&#61;&#10;            PKG_Lookups.funcgetTabRecord_CACHED(&#10;                p_table    &#61;&gt; &#39;BUSINESS_INTERACTION&#39;,&#10;                p_ref_col  &#61;&gt; &#39;business_interaction_id&#39;,&#10;                p_ref_val  &#61;&gt; TO_CHAR(p_bi_id),&#10;                p_data_fld &#61;&gt; &#39;business_interaction_code&#39; );&#10;    END IF;&#10;    --&#10;    RETURN&#10;        get_xsd_number(&#10;            p_probation_area_id          &#61;&gt; p_probation_area_id,&#10;            p_bi_code                    &#61;&gt; l_bi_code,&#10;            p_refdata_in_latest_xsd_flag &#61;&gt; p_refdata_in_latest_xsd_flag );&#10;    --&#10;END get_xsd_number;&#10;&#10;--&#10;--&#10;-- PLSQL package Initialisation block&#10;--&#10;--&#10;BEGIN&#10;    --&#10;    PKG_Global.do_init;&#10;    --&#10;    do_init_vars;&#10;    --&#10;END SPGConfig;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>