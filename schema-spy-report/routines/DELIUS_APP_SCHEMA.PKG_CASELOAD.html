<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.PKG_CASELOAD</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY PKG_CASELOAD&#10;AS&#10;--&#10;--&#10;--&#10;--&#10;&#10;--&#10;-- Global variables&#10;--&#10;g_label VARCHAR2(100);&#10;&#10;g_limit                 NUMBER :&#61; NULL;&#10;&#10;--&#10;--&#10;-- PKG_COMMON wrappers&#10;--&#10;PROCEDURE procDebug(p_msg CLOB) IS&#10;BEGIN&#10;    PKG_Debug.procDebug(p_msg);&#10;END procDebug;&#10;&#10;FUNCTION funcgetDebugMode RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Debug.funcgetDebugMode;&#10;END funcgetDebugMode;&#10;--&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level INTEGER DEFAULT 0) IS&#10;BEGIN&#10;    PKG_Common.print_message(&#10;        p_msg         &#61;&gt; p_msg,&#10;        p_trace_level &#61;&gt; NVL(p_trace_level, PKG_Common.GC_TRACE_LEVEL),&#10;        p_label       &#61;&gt; g_label );&#10;END message;&#10;--&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;--&#10;PROCEDURE raise_error(p_err_msg VARCHAR2, p_proc VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    PKG_Common.raise_error( p_err_msg, p_proc, p_label );&#10;END raise_error;&#10;--&#10;--&#10;--&#10;&#10;--&#10;-- CASELOAD&#10;--&#10;FUNCTION procFindCaseLoadTAB(&#10;    p_team_id              NUMBER  DEFAULT NULL,&#10;    p_provider_team_id     NUMBER  DEFAULT NULL,&#10;    p_staff_id             NUMBER  DEFAULT NULL,&#10;    p_provider_employee_id NUMBER  DEFAULT NULL,&#10;    p_offender_id          NUMBER  DEFAULT NULL,&#10;    p_components           VARCHAR2 DEFAULT &#39;Y&#39;,&#10;    p_filter               VARCHAR2 DEFAULT NULL,&#10;    p_date                 DATE DEFAULT NULL,&#10;    p_borough_id           NUMBER DEFAULT NULL,&#10;    p_district_id          NUMBER DEFAULT NULL,&#10;    p_use_caseload_table   VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_max_rows             INTEGER  DEFAULT 100000)&#10;RETURN ttabCaseLoad PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    l_SQL CLOB;&#10;    --&#10;    l_rec trecCaseLoad;&#10;    l_row INTEGER :&#61; 0;&#10;    --&#10;    l_tab     ttabCaseLoad;&#10;    l_tab_idx INTEGER;&#10;    --&#10;    l_caseload_test_mode INTEGER;&#10;    l_offender_id        NUMBER;&#10;    --&#10;    l_trust_provider_team_id NUMBER;&#10;    l_staff_employee_id      NUMBER;&#10;    l_trust_provider_flag    NUMBER;&#10;    --&#10;BEGIN&#10;    IF NOT (&#10;      ( (p_offender_id IS NOT NULL AND p_team_id IS NULL AND p_staff_id IS NULL AND p_provider_team_id IS NULL AND p_provider_employee_id IS NULL)      ) OR&#10;      ( (p_team_id IS NOT NULL OR p_staff_id IS NOT NULL) AND (p_offender_id IS NULL AND p_provider_team_id IS NULL AND p_provider_employee_id IS NULL) ) OR&#10;      ( (p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL) AND (p_offender_id IS NULL AND p_team_id IS NULL AND p_staff_id IS NULL) ) )&#10;    THEN&#10;        --raise_application_error(-20001,&#10;        procDebug(&#39;ERROR: unexpected combination of the parameter values: (&#39; ||&#10;            &#39;team_id&#61;&#39; || p_team_id || &#39;,&#39; ||&#10;            &#39;provider_team_id&#61;&#39; || p_provider_team_id || &#39;,&#39; ||&#10;            &#39;staff_id&#61;&#39; || p_staff_id || &#39;,&#39; ||&#10;            &#39;provider_employee_id&#61;&#39; || p_provider_employee_id || &#39;,&#39; ||&#10;            &#39;offender_id&#61;&#39; || p_offender_id || &#39;,&#39; ||&#10;            &#39;components&#61;&#39; || p_components || &#39;,&#39; ||&#10;            &#39;use_caseload_table&#61;&#39; || p_use_caseload_table || &#39;)&#39;);&#10;        RETURN/* ttabCaseLoad()*/;&#10;    END IF;&#10;    --&#10;    IF p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;        l_trust_provider_team_id :&#61; p_team_id;&#10;        l_staff_employee_id      :&#61; p_staff_id;&#10;        l_trust_provider_flag    :&#61; 0;&#10;    ELSIF p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;        l_trust_provider_team_id :&#61; p_provider_team_id;&#10;        l_staff_employee_id      :&#61; p_provider_employee_id;&#10;        l_trust_provider_flag    :&#61; 1;&#10;    ELSE&#10;        l_trust_provider_team_id :&#61; NULL;&#10;        l_staff_employee_id      :&#61; NULL;&#10;        l_trust_provider_flag    :&#61; NULL;&#10;    END IF;&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    --&#10;    IF NVLSTR(p_use_caseload_table, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;        --&#10;        l_caseload_test_mode :&#61; PKG_Lookups.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;CASELOAD_TEST_MODE&#39;, p_default_value &#61;&gt; 0);&#10;        IF l_caseload_test_mode &#61; 1 THEN&#10;            SELECT offender_id INTO l_offender_id&#10;            FROM caseload&#10;            WHERE rownum &#61; 1;&#10;        ELSE&#10;            l_offender_id :&#61; p_offender_id;&#10;        END IF;&#10;        --&#10;        -- Dynamic SQl based on CASELOAD de-normalised table&#10;        --&#10;        l_SQL :&#61;&#10;            &#39;SELECT&#10;              /*00*/ CASE&#10;                  -- TS2&#10;                  WHEN CL.pss_rqmnt_id                IS NOT NULL THEN &#39;&#39;PSS_RQMNT_MANAGER&#39;&#39;&#10;                  -- TS2 end&#10;                  WHEN CL.rqmnt_id                    IS NOT NULL THEN &#39;&#39;RQMNT_MANAGER&#39;&#39;&#10;                  WHEN CL.lic_condition_id            IS NOT NULL THEN &#39;&#39;LIC_COND_MANAGER&#39;&#39;&#10;                  WHEN CL.order_manager_id            IS NOT NULL THEN &#39;&#39;ORDER_MANAGER&#39;&#39;&#10;                  WHEN CL.nsi_manager_id              IS NOT NULL THEN &#39;&#39;NSI_MANAGER&#39;&#39;&#10;                  WHEN CL.prison_offender_manager_id  IS NOT NULL THEN &#39;&#39;POM_MANAGER&#39;&#39;&#10;                  WHEN CL.report_manager_id           IS NOT NULL THEN &#39;&#39;REPORT_MANAGER&#39;&#39;&#10;                  ELSE                                                 &#39;&#39;OFFENDER_MANAGER&#39;&#39;&#10;              END AS role,&#10;              /*01*/ CL.offender_id,&#10;              /*02*/ CL.crn,&#10;              /*03*/ NULL AS Gender,&#10;              /*04*/ CL.first_name,&#10;              /*05*/ CL.second_name,&#10;              /*06*/ CL.third_name,&#10;              /*07*/ CL.surname,&#10;              /*08*/ CL.current_highest_risk_colour,&#10;              /*09*/ CL.current_restriction,&#10;              /*10*/ CL.current_exclusion,&#10;              /*11*/ NULL AS restriction_message,&#10;              /*12*/ NULL AS exclusion_message,&#10;              /*13*/ NULL AS TIER,&#10;              /*14*/ NULL AS TEAM,&#10;              /*15*/ CL.offender_manager_id,&#10;              /*16*/ CL.event_id,&#10;              /*17*/ CL.order_manager_id,&#10;              /*18*/ CL.disposal_id,&#10;              /*19*/ CL.lic_condition_id,&#10;              /*20*/ CL.lic_condition_manager_id,&#10;              /*21*/ CL.rqmnt_id,&#10;              /*22*/ CL.rqmnt_manager_id,&#10;              -- TS2&#10;              /*23*/ CL.pss_rqmnt_id,&#10;              /*24*/ CL.pss_rqmnt_manager_id,&#10;              -- TS2 end&#10;              /*25*/ NULL AS sentence_description,&#10;              /*26*/ CL.length_value,&#10;              /*27*/ NULL AS component_description,&#10;              /*28*/ CL.role_code,&#10;              /*29*/ NULL AS length_units,&#10;              /*30*/ CL.date_of_birth,&#10;              /*31*/ CL.start_date,&#10;              /*32*/ CL.trust_provider_flag,&#10;              /*33*/ CL.trust_provider_team_id,&#10;              /*34*/ CL.staff_employee_id,&#10;              /*35*/ CL.gender_id,&#10;              /*36*/ CL.current_tier,&#10;              /*37*/ CL.disposal_type_id,&#10;              /*38*/ CL.lic_cond_type_main_cat_id,&#10;              /*39*/ CL.rqmnt_type_main_category_id,&#10;              /*40*/ CL.ad_rqmnt_type_main_category_id,&#10;              /*41*/ CL.pss_rqmnt_type_main_cat_id,&#10;              /*42*/ CL.allocation_date,&#10;              -- PTR1 Start&#10;              /*43*/ CL.notional_end_date,&#10;              /*44*/ CL.entry_length,&#10;              /*45*/ CL.length_in_days,&#10;              /*46*/ CL.entry_length_units_id,&#10;              /*47*/ NULL AS entry_length_units_code,&#10;              /*48*/ NULL AS entry_length_units_desc,&#10;              -- PTR1 end&#10;              --&#10;              /*49*/ CL.nsi_id,&#10;              /*50*/ CL.nsi_manager_id,&#10;              /*51*/ CL.prison_offender_manager_id,&#10;              --&#10;              /*52*/ CL.court_report_id,&#10;              /*53*/ CL.institutional_report_id,&#10;              /*54*/ CL.report_manager_id,&#10;              --&#10;              /*55*/ O.cdc_custody_start_date,&#10;              /*56*/ CASE&#10;                         WHEN CL.role_code NOT IN (&#39;&#39;OM&#39;&#39;)&#10;                             THEN NULL&#10;                         WHEN O.cdc_custody_start_date IS NULL&#10;                             THEN 3&#10;                         WHEN MONTHS_BETWEEN(TRUNC(SYSDATE), O.cdc_custody_start_date) &lt; 12&#10;                             THEN 1&#10;                         ELSE&#10;                             CEIL(MONTHS_BETWEEN(TRUNC(SYSDATE), O.cdc_custody_start_date) / 12)&#10;                     END AS ro_year,&#10;              /*57*/ NULL AS ro_count,&#10;              --&#10;              /*58*/ NULL AS L1,&#10;              /*59*/ NULL AS L2,&#10;              /*60*/ NULL AS L3&#10;              --&#10;            FROM&#10;              caseload CL&#10;                INNER JOIN offender O ON O.offender_id &#61; CL.offender_id&#10;                INNER JOIN all_team T ON T.trust_provider_team_id &#61; CL.trust_provider_team_id AND T.trust_provider_flag &#61; CL.trust_provider_flag&#10;                  LEFT OUTER JOIN district D ON D.district_id &#61; T.district_id&#10;            WHERE 1&#61;1&#10;              AND &#39; || CASE WHEN l_offender_id             IS NULL THEN &#39;:p_offender_id IS NULL&#39;            ELSE &#39;CL.offender_id &#61; :p_offender_id&#39;                       END || &#39;&#10;              AND &#39; || CASE WHEN l_trust_provider_team_id  IS NULL THEN &#39;:p_trust_provider_team_id IS NULL&#39; ELSE &#39;CL.trust_provider_team_id &#61; :p_trust_provider_team_id&#39; END || &#39;&#10;              AND &#39; || CASE WHEN l_staff_employee_id       IS NULL THEN &#39;:p_staff_employee_id IS NULL&#39;      ELSE &#39;CL.staff_employee_id &#61; :p_staff_employee_id&#39;           END || &#39;&#10;              AND &#39; || CASE WHEN l_trust_provider_flag     IS NULL THEN &#39;:p_trust_provider_flag IS NULL&#39;    ELSE &#39;CL.trust_provider_flag &#61; :p_trust_provider_flag&#39;       END || &#39;&#10;              AND &#39; || CASE WHEN p_district_id             IS NULL THEN &#39;:p_district_id IS NULL&#39;            ELSE &#39;T.district_id &#61; :p_district_id&#39;                        END || &#39;&#10;              AND &#39; || CASE WHEN p_borough_id              IS NULL THEN &#39;:p_borough_id IS NULL&#39;             ELSE &#39;D.borough_id &#61; :p_borough_id&#39;                          END || &#39;&#10;              AND &#39; || CASE WHEN p_date                    IS NULL THEN &#39;:p_allocation_date IS NULL&#39;        ELSE &#39;CL.allocation_date &gt;&#61; :p_allocation_date&#39;              END || &#39;&#10;              AND &#39; || CASE&#10;                       WHEN NVLSTR(p_components, &#39;N&#39;) &lt;&gt; &#39;Y&#39; THEN &#39;CL.role_code NOT IN (&#39;&#39;LC&#39;&#39;, &#39;&#39;RQ&#39;&#39;, &#39;&#39;PQ&#39;&#39;, &#39;&#39;NSI&#39;&#39;, &#39;&#39;POM&#39;&#39;, &#39;&#39;RM&#39;&#39;)&#39;&#10;                       WHEN p_filter &#61; &#39;OM&#39;                  THEN &#39;CL.role_code &#61; &#39;&#39;OM&#39;&#39;&#39;&#10;                       WHEN p_filter &#61; &#39;OS&#39;                  THEN &#39;CL.role_code &#61; &#39;&#39;OS&#39;&#39;&#39;&#10;                       WHEN p_filter &#61; &#39;CM&#39;                  THEN &#39;CL.role_code IN (&#39;&#39;LC&#39;&#39;, &#39;&#39;RQ&#39;&#39;, &#39;&#39;PQ&#39;&#39;, &#39;&#39;NSI&#39;&#39;, &#39;&#39;POM&#39;&#39;, &#39;&#39;RM&#39;&#39;)&#39;&#10;                       ELSE &#39;1&#61;1&#39;&#10;                       END || &#39;&#10;              -- NSI and CR/IR sub-components are not part of the CASELOAD yet..&#10;              AND role_code NOT IN ( &#39;&#39;NSI&#39;&#39;, &#39;&#39;RM&#39;&#39;)&#39;&#10;        ;&#10;        --&#10;        --&#10;        -- Now Open dynamic PLSQL cursor&#10;        --&#10;        OPEN l_cur FOR l_SQL&#10;        USING&#10;          l_offender_id,&#10;          l_trust_provider_team_id,&#10;          l_staff_employee_id,&#10;          l_trust_provider_flag,&#10;          p_district_id,&#10;          p_borough_id,&#10;          p_date;&#10;        --&#10;    ELSE&#10;        --&#10;        -- Dynamic SQl based on OFFENDER tables&#10;        --&#10;        l_SQL :&#61;&#10;           &#39;SELECT&#10;             /*00*/ &#39;&#39;@ROLE_CODE&#39;&#39; AS role,&#10;             /*01*/ O.offender_id,&#10;             /*02*/ O.crn,&#10;             /*03*/ NULL AS Gender,&#10;             /*04*/ O.first_name,&#10;             /*05*/ O.second_name,&#10;             /*06*/ O.third_name,&#10;             /*07*/ O.surname,&#10;             /*08*/ O.current_highest_risk_colour,&#10;             /*09*/ O.current_restriction,&#10;             /*10*/ O.current_exclusion,&#10;             /*11*/ O.restriction_message,&#10;             /*12*/ O.exclusion_message,&#10;             /*13*/ NULL AS TIER,&#10;             /*14*/ NULL AS TEAM,&#10;             &#39; || &#39;@&#39; || &#39;LEVEL_SPECIFIC_COLUMNS,&#10;             --&#10;             /*55*/ O.cdc_custody_start_date,&#10;             /*56*/ NULL AS ro_year,&#10;             /*57*/ NULL AS ro_count,&#10;             --&#10;             /*58*/ NULL AS L1,&#10;             /*59*/ NULL AS L2,&#10;             /*60*/ NULL AS L3&#10;             --&#10;           FROM&#10;             offender O&#10;             , &#39; || &#39;@&#39; || &#39;OM_TABLE_NAME&#10;           WHERE O.soft_deleted &#61; 0&#39;;&#10;        --&#10;        l_SQL :&#61;&#10;            &#39;-- OFFENDER_MANAGER level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;OFFENDER_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;OM.offender_manager_id, NULL AS event_id, NULL AS order_manager_id,&#10;                    NULL AS disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    &#39;&#39;&#39;&#39; AS sentence_description, &#39;&#39;&#39;&#39; AS length_value, &#39;&#39;&#39;&#39; AS component_description, &#39;&#39;OM&#39;&#39; AS role_code, &#39;&#39;&#39;&#39; AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, O.created_datetime AS start_date,&#10;                    OM.trust_provider_flag, OM.trust_provider_team_id, OM.staff_employee_id,&#10;                    O.gender_id, O.current_tier, NULL disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, ALLOCATION_DATE as allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, OFFENDER_MANAGER OM&#39;)              || CHR(10) ||&#10;            &#39;  AND OM.offender_id &#61; O.offender_id&#39;                        || CHR(10) ||&#10;            &#39;  --&#39;                                                        || CHR(10) ||&#10;            &#39;  AND OM.soft_deleted &#61; 0&#39;                                   || CHR(10) ||&#10;            &#39;  AND O.current_disposal &#61; 1&#39;                                || CHR(10) ||&#10;            &#39;  --&#39;                                                        || CHR(10) ||&#10;            &#39;  AND OM.active_flag &#61; 1&#39;                                    || CHR(10) ||&#10;            CASE WHEN p_offender_id IS NOT NULL THEN&#10;              &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;            WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;              &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.trust_provider_team_id &#61; :p_team_id AND OM.trust_provider_flag &#61; 0)&#39; END || CHR(10) ||&#10;              &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_staff_id AND OM.trust_provider_flag &#61; 0)&#39;     END || CHR(10) ||&#10;              &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;            WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;              &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(OM.trust_provider_team_id &#61; :p_provider_team_id AND OM.trust_provider_flag &#61; 1)&#39; END || CHR(10) ||&#10;              &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_provider_employee_id AND OM.trust_provider_flag &#61; 1)&#39;  END || CHR(10) ||&#10;              &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;            END                      || CHR(10) ||&#10;            &#39;UNION&#39;                  || CHR(10) ||&#10;            &#39;-- ORDER_MANAGER level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;ORDER_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, EVENT.event_id, OM.order_manager_id,&#10;                    D.disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, TO_CHAR(D.length) AS length_value, &#39;&#39;&#39;&#39; AS component_description, &#39;&#39;OS&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, EVENT.referral_date AS start_date,&#10;                    OM.trust_provider_flag, OM.trust_provider_team_id, OM.staff_employee_id,&#10;                    O.gender_id, O.current_tier, D.disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, ALLOCATION_DATE as allocation_date,&#10;                    --PTR1 Start&#10;                    D.notional_end_date, D.entry_length, D.length_in_days,&#10;                    D.entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, EVENT, DISPOSAL D, ORDER_MANAGER OM&#39;) || CHR(10) ||&#10;            &#39;  AND EVENT.offender_id &#61; O.offender_id&#39;                                                                         || CHR(10) ||&#10;            &#39;  -- There should be at most 1 active DISPOSAL record per EVENT so it if safe to use the INNER JOIN here&#39;        || CHR(10) ||&#10;            &#39;  -- Note: Only Sentenced (with DISPOSAL record) EVENTs are included&#39;                                            || CHR(10) ||&#10;            &#39;  AND D.event_id &#61; EVENT.event_id&#39;                                                                               || CHR(10) ||&#10;            &#39;  AND D.active_flag &#61; 1&#39;                                                                                         || CHR(10) ||&#10;            &#39;  --&#39;                                                                                                            || CHR(10) ||&#10;            &#39;  AND OM.event_id &#61; EVENT.event_id&#39;                                                                              || CHR(10) ||&#10;            &#39;  --&#39;                                                                                                            || CHR(10) ||&#10;            &#39;  AND EVENT.soft_deleted &#61; 0&#39;                                                                                    || CHR(10) ||&#10;            &#39;  --&#39;                                                                                                            || CHR(10) ||&#10;            &#39;  AND OM.active_flag &#61; 1&#39;                                                                                        || CHR(10) ||&#10;            CASE WHEN p_offender_id IS NOT NULL THEN&#10;              &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;            WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;              &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.trust_provider_team_id &#61; :p_team_id AND OM.trust_provider_flag &#61; 0)&#39; END || CHR(10) ||&#10;              &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_staff_id AND OM.trust_provider_flag &#61; 0)&#39;     END || CHR(10) ||&#10;              &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;            WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;              &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(OM.trust_provider_team_id &#61; :p_provider_team_id AND OM.trust_provider_flag &#61; 1)&#39; END  || CHR(10) ||&#10;              &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_provider_employee_id AND OM.trust_provider_flag &#61; 1)&#39;  END  || CHR(10) ||&#10;              &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;            END                             || CHR(10) ||&#10;        &#39;-- end of dynamic query (Main) --&#39; || CHR(10) ||&#10;        CASE WHEN p_components &#61; &#39;Y&#39; THEN&#10;            &#39;UNION&#39;                         || CHR(10) ||&#10;            &#39;-- LIC_COND_MANAGER level&#39;     || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;LIC_COND_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, EVENT.event_id, NULL AS order_manager_id,&#10;                    D.disposal_id, LIC_CONDITION.lic_condition_id, OM.lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, TO_CHAR(LIC_CONDITION.length) AS length_value, NULL AS component_description, &#39;&#39;LC&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, LIC_CONDITION.commencement_date AS start_date,&#10;                    OM.trust_provider_flag, OM.trust_provider_team_id, OM.staff_employee_id,&#10;                    O.gender_id, O.current_tier, D.disposal_type_id, LIC_CONDITION.lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, ALLOCATION_DATE as allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, EVENT, DISPOSAL D, LIC_CONDITION, LIC_CONDITION_MANAGER OM&#39;) || CHR(10) ||&#10;                &#39;  AND EVENT.offender_id &#61; O.offender_id&#39;                                         || CHR(10) ||&#10;                &#39;  AND EVENT.soft_deleted &#61; 0&#39;                                                    || CHR(10) ||&#10;                &#39;  AND D.event_id &#61; EVENT.event_id&#39;                                               || CHR(10) ||&#10;                &#39;  AND D.active_flag &#61; 1&#39;                                                         || CHR(10) ||&#10;                &#39;  AND LIC_CONDITION.disposal_id &#61; D.disposal_id&#39;                                 || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.lic_condition_id &#61; LIC_CONDITION.lic_condition_id&#39;                      || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND LIC_CONDITION.soft_deleted &#61; 0&#39;                                            || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND LIC_CONDITION.active_flag &#61; 1&#39;                                             || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.trust_provider_team_id &#61; :p_team_id AND OM.trust_provider_flag &#61; 0)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_staff_id AND OM.trust_provider_flag &#61; 0)&#39;     END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(OM.trust_provider_team_id &#61; :p_provider_team_id AND OM.trust_provider_flag &#61; 1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_provider_employee_id AND OM.trust_provider_flag &#61; 1)&#39;  END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END                  || CHR(10) ||&#10;            &#39;UNION&#39;                  || CHR(10) ||&#10;            &#39;-- RQMNT_MANAGER level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;RQMNT_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, EVENT.event_id, NULL AS order_manager_id,&#10;                    D.disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, RQMNT.rqmnt_id, OM.rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, TO_CHAR(RQMNT.length) AS length_value, NULL AS component_description, &#39;&#39;RQ&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, RQMNT.commencement_date AS start_date,&#10;                    OM.trust_provider_flag, OM.trust_provider_team_id, OM.staff_employee_id,&#10;                    O.gender_id, O.current_tier, D.disposal_type_id, NULL AS lic_cond_type_main_cat_id, RQMNT.rqmnt_type_main_category_id AS rqmnt_type_main_category_id, RQMNT.ad_rqmnt_type_main_category_id AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, ALLOCATION_DATE as allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, EVENT, DISPOSAL D, RQMNT, RQMNT_MANAGER OM&#39;)               || CHR(10) ||&#10;                &#39;  AND EVENT.offender_id &#61; O.offender_id&#39;                                         || CHR(10) ||&#10;                &#39;  AND EVENT.soft_deleted &#61; 0&#39;                                                    || CHR(10) ||&#10;                &#39;  AND D.event_id &#61; EVENT.event_id&#39;                                               || CHR(10) ||&#10;                &#39;  AND D.active_flag &#61; 1&#39;                                                         || CHR(10) ||&#10;                &#39;  AND RQMNT.disposal_id &#61; D.disposal_id&#39;                                         || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.rqmnt_id &#61; RQMNT.rqmnt_id&#39;                                              || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND RQMNT.soft_deleted &#61; 0&#39;                                                    || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND RQMNT.active_flag &#61; 1&#39;                                                     || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.trust_provider_team_id &#61; :p_team_id AND OM.trust_provider_flag &#61; 0)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_staff_id AND OM.trust_provider_flag &#61; 0)&#39;     END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(OM.trust_provider_team_id &#61; :p_provider_team_id AND OM.trust_provider_flag &#61; 1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_provider_employee_id AND OM.trust_provider_flag &#61; 1)&#39;  END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END                || CHR(10) ||&#10;            &#39;UNION&#39;                || CHR(10) ||&#10;            --&#10;            -- NSI level: both OFFENDER and EVENT sub-types&#10;            -- NOTE: Event level NSI should only be included when their parent Event record is un-terminated&#10;            &#39;-- NSI_MANAGER (OFFENDER) level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;NSI&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, NSI.event_id, NULL AS order_manager_id,&#10;                    NULL AS disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, NULL AS length_value, NULL AS component_description, &#39;&#39;NSI&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, NULL AS start_date,&#10;                    0 AS trust_provider_flag, OM.team_id AS trust_provider_team_id, OM.staff_id AS staff_employee_id,&#10;                    O.gender_id, O.current_tier, NULL AS disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, NULL as allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NSI.nsi_id, OM.nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, NSI, NSI_MANAGER OM&#39;)                                      || CHR(10) ||&#10;                &#39;  AND NSI.offender_id &#61; O.offender_id&#39;                                           || CHR(10) ||&#10;                &#39;  AND NSI.event_id IS NULL&#39;                                                      || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.nsi_id &#61; NSI.nsi_id&#39;                                                    || CHR(10) ||&#10;                &#39;  AND NSI.soft_deleted &#61; 0&#39;                                                      || CHR(10) ||&#10;                &#39;  AND OM.soft_deleted &#61; 0&#39;                                                       || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND NSI.active_flag &#61; 1&#39;                                                       || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.team_id &#61; :p_team_id)&#39;   END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_id &#61; :p_staff_id)&#39; END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(1&lt;&gt;1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(1&lt;&gt;1)&#39; END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END                            || CHR(10) ||&#10;            &#39;UNION&#39;                            || CHR(10) ||&#10;            &#39;-- NSI_MANAGER (EVENT) level&#39;     || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;NSI&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, NSI.event_id, NULL AS order_manager_id,&#10;                    D.disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, NULL AS length_value, NULL AS component_description, &#39;&#39;NSI&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS DATE_OF_BIRTH, NULL AS start_date,&#10;                    0 AS TRUST_PROVIDER_FLAG, OM.team_id AS TRUST_PROVIDER_TEAM_ID, OM.staff_id AS STAFF_EMPLOYEE_ID,&#10;                    O.gender_id, O.current_tier, D.disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, NULL as allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NSI.nsi_id, OM.nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, NSI, EVENT, DISPOSAL D, NSI_MANAGER OM&#39;)                   || CHR(10) ||&#10;                &#39;  AND NSI.offender_id &#61; O.offender_id&#39;                                           || CHR(10) ||&#10;                &#39;  AND EVENT.event_id &#61; NSI.event_id&#39;                                             || CHR(10) ||&#10;                &#39;  AND EVENT.soft_deleted &#61; 0&#39;                                                    || CHR(10) ||&#10;                &#39;  AND D.event_id &#61; EVENT.event_id&#39;                                               || CHR(10) ||&#10;                &#39;  /*AND D.active_flag &#61; 1 YF: ND application should be validating this*/&#39;        || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.nsi_id &#61; NSI.nsi_id&#39;                                                    || CHR(10) ||&#10;                &#39;  AND NSI.soft_deleted &#61; 0&#39;                                                      || CHR(10) ||&#10;                &#39;  AND OM.soft_deleted &#61; 0&#39;                                                       || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND NSI.active_flag &#61; 1&#39;                                                       || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.team_id &#61; :p_team_id)&#39;   END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_id &#61; :p_staff_id)&#39; END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(1&lt;&gt;1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(1&lt;&gt;1)&#39; END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END                            || CHR(10) ||&#10;            &#39;UNION&#39;                            || CHR(10) ||&#10;            --&#10;            -- POM level&#10;            &#39;-- PRISON_OFFENDER_MANAGER level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;PRISON_OFFENDER_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, NULL AS event_id, NULL AS order_manager_id,&#10;                    NULL AS disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS Rqmnt_Id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, NULL AS length_value, NULL AS component_description, &#39;&#39;POM&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS DATE_OF_BIRTH, NULL AS start_date,&#10;                    0 AS TRUST_PROVIDER_FLAG, OM.allocation_team_id AS TRUST_PROVIDER_TEAM_ID, OM.allocation_staff_id AS STAFF_EMPLOYEE_ID,&#10;                    O.gender_id, O.current_tier, NULL AS disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, NULL as allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    OM.prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, PRISON_OFFENDER_MANAGER OM&#39;)                               || CHR(10) ||&#10;                &#39;  AND OM.offender_id &#61; O.offender_id&#39;                                            || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.soft_deleted &#61; 0&#39;                                                       || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.allocation_team_id &#61; :p_team_id)&#39;   END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.allocation_staff_id &#61; :p_staff_id)&#39; END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(1&lt;&gt;1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(1&lt;&gt;1)&#39; END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END                      || CHR(10) ||&#10;            &#39;UNION&#39;                      || CHR(10) ||&#10;            --&#10;            &#39;-- PSS_RQMNT_MANAGER level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;PSS_RQMNT_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, EVENT.event_id, NULL AS order_manager_id,&#10;                    D.disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    PSS_RQMNT.pss_rqmnt_id AS pss_rqmnt_id, OM.pss_rqmnt_manager_id AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, TO_CHAR(PSS_RQMNT.length) AS length_value, NULL AS component_description, &#39;&#39;PQ&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, PSS_RQMNT.commencement_date AS start_date,&#10;                    OM.trust_provider_flag, OM.trust_provider_team_id, OM.staff_employee_id,&#10;                    O.gender_id, O.current_tier, D.disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, PSS_RQMNT.pss_rqmnt_type_main_cat_id AS pss_rqmnt_type_main_cat_id, ALLOCATION_DATE as allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, NULL AS institutional_report_id, NULL AS report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, EVENT, DISPOSAL D, CUSTODY C, PSS_RQMNT, PSS_RQMNT_MANAGER OM&#39;)       || CHR(10) ||&#10;                &#39;  AND EVENT.offender_id &#61; O.offender_id&#39;                                         || CHR(10) ||&#10;                &#39;  AND EVENT.soft_deleted &#61; 0&#39;                                                    || CHR(10) ||&#10;                &#39;  AND D.event_id &#61; EVENT.event_id&#39;                                               || CHR(10) ||&#10;                &#39;  AND D.disposal_id &#61; C.disposal_id&#39;                                             || CHR(10) ||&#10;                &#39;  AND D.active_flag &#61; 1&#39;                                                         || CHR(10) ||&#10;                &#39;  AND PSS_RQMNT.custody_id &#61; C.custody_id&#39;                                       || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.pss_rqmnt_id &#61; PSS_RQMNT.pss_rqmnt_id&#39;                                  || CHR(10) ||&#10;                &#39;  AND PSS_RQMNT.soft_deleted &#61; 0&#39;                                                || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND PSS_RQMNT.active_flag &#61; 1&#39;                                                 || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.trust_provider_team_id &#61; :p_team_id AND OM.trust_provider_flag &#61; 0)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_staff_id AND OM.trust_provider_flag &#61; 0)&#39;     END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(OM.trust_provider_team_id &#61; :p_provider_team_id AND OM.trust_provider_flag &#61; 1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_provider_employee_id AND OM.trust_provider_flag &#61; 1)&#39;  END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END                        || CHR(10) ||&#10;            &#39;UNION&#39;                        || CHR(10) ||&#10;            --&#10;            -- RM_CR Level&#10;            &#39;-- REPORT_MANAGER (CR) level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;REPORT_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, EVENT.event_id, NULL AS order_manager_id,&#10;                    D.disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, NULL AS length_value, NULL AS component_description, &#39;&#39;RM&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, OM.allocation_date AS start_date,&#10;                    OM.trust_provider_flag, OM.trust_provider_team_id, OM.staff_employee_id,&#10;                    O.gender_id, O.current_tier, D.disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, NULL AS allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    CR.court_report_id, NULL AS institutional_report_id, OM.report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, EVENT, DISPOSAL D, COURT_APPEARANCE CA, COURT_REPORT CR, REPORT_MANAGER OM&#39;)          || CHR(10) ||&#10;                &#39;  AND EVENT.offender_id &#61; O.offender_id&#39;                                                                    || CHR(10) ||&#10;                &#39;  AND D.event_id(+) &#61; EVENT.event_id&#39;                                                                       || CHR(10) ||&#10;                &#39;  AND D.active_flag(+) &#61; 1&#39;                                                                                 || CHR(10) ||&#10;                &#39;  AND D.soft_deleted(+) &#61; 0&#39;                                                                                || CHR(10) ||&#10;                &#39;  --&#39;                                                                                                       || CHR(10) ||&#10;                &#39;  AND CA.event_id &#61; EVENT.event_id&#39;                                                                         || CHR(10) ||&#10;                &#39;  AND CR.court_appearance_id &#61; CA.court_appearance_id&#39;                                                      || CHR(10) ||&#10;                &#39;  -- YF: DST-4793 The below &quot;Report COMPLETED&quot; criteria is now replaced with the &quot;ACTIVE Parent EVENT&quot; rule&#39;|| CHR(10) ||&#10;                &#39;  AND NOT EXISTS( SELECT 1 FROM disposal WHERE event_id &#61; EVENT.event_id AND active_flag &#61; 0 AND soft_deleted &#61; 0 )&#39; || CHR(10) ||&#10;                &#39;  --/*CC045: Use the below condition instead: xx CR.completed_date IS NULL*/&#39;                               || CHR(10) ||&#10;                &#39;  --AND CR.sent_to_court_date IS NULL&#39;                                                                      || CHR(10) ||&#10;                &#39;  ---- #SPG-10175: where delivered court report type.CODE&#61;NIL. Thats all it takes to mark as abandoned&#39;     || CHR(10) ||&#10;                &#39;  --AND &#39;&#39;NIL&#39;&#39; &lt;&gt;&#10;                   --    PKG_Lookups.funcgetTabRecord_CACHED(&#10;                   --        p_table       &#61;&gt; &#39;&#39;R_COURT_REPORT_TYPE&#39;&#39;,&#10;                   --        p_ref_col     &#61;&gt; &#39;&#39;court_report_type_id&#39;&#39;,&#10;                   --        p_ref_val     &#61;&gt; CR.delivered_court_report_type_id,&#10;                   --        p_data_fld    &#61;&gt; &#39;&#39;code&#39;&#39;,&#10;                   --        p_default_val &#61;&gt; &#39;&#39;xyz&#39;&#39;)&#39;                                           || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.court_report_id &#61; CR.court_report_id&#39;                                   || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND EVENT.soft_deleted &#61; 0&#39;                                                    || CHR(10) ||&#10;                &#39;  AND CR.soft_deleted &#61; 0&#39;                                                       || CHR(10) ||&#10;                &#39;  AND OM.soft_deleted &#61; 0&#39;                                                       || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.trust_provider_team_id &#61; :p_team_id AND OM.trust_provider_flag &#61; 0)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_staff_id AND OM.trust_provider_flag &#61; 0)&#39;     END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(OM.trust_provider_team_id &#61; :p_provider_team_id AND OM.trust_provider_flag &#61; 1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_provider_employee_id AND OM.trust_provider_flag &#61; 1)&#39;  END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END                        || CHR(10) ||&#10;            &#39;UNION&#39;                        || CHR(10) ||&#10;            --&#10;            -- RM_IR Level&#10;            &#39;-- REPORT_MANAGER (IR) level&#39; || CHR(10) ||&#10;            REPLACE(&#10;                REPLACE(REPLACE(l_SQL, &#39;@ROLE_CODE&#39;, &#39;REPORT_MANAGER&#39;),&#10;                    &#39;@LEVEL_SPECIFIC_COLUMNS&#39;,&#10;                    &#39;NULL AS offender_manager_id, EVENT.event_id, NULL AS order_manager_id,&#10;                    D.disposal_id, NULL AS lic_condition_id, NULL AS lic_condition_manager_id, NULL AS rqmnt_id, NULL AS rqmnt_manager_id,&#10;                    -- TS2&#10;                    NULL AS pss_rqmnt_id, NULL AS pss_rqmnt_manager_id,&#10;                    -- TS2 end&#10;                    NULL AS sentence_description, NULL AS length_value, NULL AS component_description, &#39;&#39;RM&#39;&#39; AS role_code, NULL AS length_units,&#10;                    O.date_of_birth_date AS date_of_birth, OM.allocation_date AS start_date,&#10;                    OM.trust_provider_flag, OM.trust_provider_team_id, OM.staff_employee_id,&#10;                    O.gender_id, O.current_tier, D.disposal_type_id, NULL AS lic_cond_type_main_cat_id, NULL AS rqmnt_type_main_category_id, NULL AS ad_rqmnt_type_main_category_id, NULL AS pss_rqmnt_type_main_cat_id, NULL AS allocation_date,&#10;                    --PTR1 Start&#10;                    NULL AS notional_end_date, NULL AS entry_length, NULL AS length_in_days,&#10;                    NULL AS entry_length_units_id, NULL AS entry_length_units_code, NULL AS entry_length_units_desc,&#10;                    --PTR1 end&#10;                    NULL AS nsi_id, NULL AS nsi_manager_id,&#10;                    NULL AS prison_offender_manager_id,&#10;                    NULL AS court_report_id, IR.institutional_report_id, OM.report_manager_id&#39;),&#10;                &#39;, @OM_TABLE_NAME&#39;, &#39;, EVENT, DISPOSAL D, CUSTODY CU, INSTITUTIONAL_REPORT IR, REPORT_MANAGER OM&#39;)           || CHR(10) ||&#10;                &#39;  AND EVENT.offender_id &#61; O.offender_id&#39;                                                                    || CHR(10) ||&#10;                &#39;  AND D.event_id &#61; EVENT.event_id&#39;                                                                          || CHR(10) ||&#10;                &#39;  AND D.active_flag &#61; 1&#39;                                                                                    || CHR(10) ||&#10;                &#39;  --&#39;                                                                                                       || CHR(10) ||&#10;                &#39;  AND CU.disposal_id &#61; D.disposal_id&#39;                                                                       || CHR(10) ||&#10;                &#39;  AND IR.custody_id &#61; CU.custody_id&#39;                                                                        || CHR(10) ||&#10;                &#39;  -- YF: DST-4794 The below &quot;Report COMPETED&quot; criteria is now replaced with the &quot;ACTIVE Parent EVENT&quot; rule&#39; || CHR(10) ||&#10;                &#39;  --/*CC045: Use the below condition instead: xx IR.date_completed IS NULL*/&#39;                               || CHR(10) ||&#10;                &#39;  --AND NOT ( IR.date_abandoned IS NOT NULL OR&#10;                   --          IR.date_sent      IS NOT NULL OR&#10;                   --          IR.sent_to_prison_date IS NOT NULL&#10;                   --        )&#39;                                                                   || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.institutional_report_id &#61; IR.institutional_report_id&#39;                   || CHR(10) ||&#10;                &#39;  -- &#39;                                                                           || CHR(10) ||&#10;                &#39;  AND EVENT.soft_deleted &#61; 0&#39;                                                    || CHR(10) ||&#10;                &#39;  AND D.soft_deleted &#61; 0&#39;                                                        || CHR(10) ||&#10;                &#39;  AND IR.soft_deleted &#61; 0&#39;                                                       || CHR(10) ||&#10;                &#39;  AND OM.soft_deleted &#61; 0&#39;                                                       || CHR(10) ||&#10;                &#39;  --&#39;                                                                            || CHR(10) ||&#10;                &#39;  AND OM.active_flag &#61; 1&#39;                                                        || CHR(10) ||&#10;                CASE WHEN p_offender_id IS NOT NULL THEN&#10;                  &#39; AND O.offender_id &#61; :p_offender_id&#39;&#10;                WHEN p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_team_id IS NULL &#39; ELSE &#39;(OM.trust_provider_team_id &#61; :p_team_id AND OM.trust_provider_flag &#61; 0)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_staff_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_staff_id AND OM.trust_provider_flag &#61; 0)&#39;     END || CHR(10) ||&#10;                  &#39; AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;&#10;                WHEN p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;                  &#39; AND &#39; || CASE WHEN p_team_id  IS NULL THEN &#39;:p_provider_team_id IS NULL&#39;     ELSE &#39;(OM.trust_provider_team_id &#61; :p_provider_team_id AND OM.trust_provider_flag &#61; 1)&#39; END || CHR(10) ||&#10;                  &#39; AND &#39; || CASE WHEN p_staff_id IS NULL THEN &#39;:p_provider_employee_id IS NULL&#39; ELSE &#39;(OM.staff_employee_id &#61; :p_provider_employee_id AND OM.trust_provider_flag &#61; 1)&#39;  END || CHR(10) ||&#10;                  &#39; AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;&#10;                END  || CHR(10) ||&#10;                &#39;--&#39; || CHR(10) ||&#10;                &#39;-- end of dynamic query (LC/RQMNT/PSS_RQMNT/NSI/POM/RM levels) --&#39;&#10;                --&#10;        END;&#10;&#10;        --&#10;        -- Now Open dynamic PLSQL cursor&#10;        --&#10;        IF NVLSTR(p_components, &#39;N&#39;) &lt;&gt; &#39;Y&#39; THEN&#10;            IF p_offender_id IS NOT NULL THEN&#10;                OPEN l_cur FOR l_SQL&#10;                USING p_offender_id, p_offender_id;&#10;            ELSE&#10;                OPEN l_cur FOR l_SQL&#10;                USING&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id;&#10;            END IF;&#10;        ELSE&#10;            IF p_offender_id IS NOT NULL THEN&#10;                OPEN l_cur FOR l_SQL&#10;                USING&#10;                  -- OM Level&#10;                  p_offender_id,&#10;                  -- OS (ORDER_MANAGER) Level&#10;                  p_offender_id,&#10;                  -- LC Level&#10;                  p_offender_id,&#10;                  -- RQMNT Level&#10;                  p_offender_id,&#10;                  -- NSI (Offender and Event) Levels&#10;                  p_offender_id,&#10;                  p_offender_id,&#10;                  -- POM Level&#10;                  p_offender_id,&#10;                  -- PSS_RQMNT Level&#10;                  p_offender_id,&#10;                  -- RM/CR Level&#10;                  p_offender_id,&#10;                  -- RM/IR Level&#10;                  p_offender_id&#10;                ;&#10;            ELSE&#10;                OPEN l_cur FOR l_SQL&#10;                USING&#10;                  -- OM Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- OS (ORDER_MANAGER) Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- LC Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- RQMNT Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- NSI (Offender and Event) Levels&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- POM Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- PSS_RQMNT Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- RM/CR Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;                  -- RM/IR Level&#10;                  p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id&#10;                ;&#10;            END IF;&#10;        END IF;&#10;    END IF;&#10;    --&#10;    -- Fetch through the result set of records; if P_OFFENDER_ID parameter is not set then set LOOKUP DESCRIPTION values&#10;    --&#10;    LOOP&#10;        FETCH l_cur BULK COLLECT INTO l_tab LIMIT 1000;&#10;        FOR l_tab_idx IN 1..l_tab.COUNT LOOP&#10;            --&#10;            l_rec :&#61; l_tab(l_tab_idx);&#10;            --&#10;            IF p_offender_id IS NULL OR ( p_use_caseload_table &#61; &#39;Y&#39; ) THEN&#10;                l_rec.gender :&#61; PKG_Lookups.funcgetGenderCode(l_rec.gender_id);&#10;                IF l_rec.current_tier IS NOT NULL THEN&#10;                    l_rec.tier_description :&#61; PKG_Lookups.funcgetTierDescription(l_rec.current_tier);&#10;                END IF;&#10;                l_rec.team :&#61; PKG_Lookups.funcgetTeamDescription(l_rec.trust_provider_flag, l_rec.trust_provider_team_id);&#10;                IF l_rec.disposal_type_id IS NOT NULL THEN&#10;                    l_rec.sentence_description :&#61; PKG_Lookups.funcgetDisposalTypeDescription(l_rec.disposal_type_id);&#10;                    IF l_rec.record_type &#61; &#39;ORDER_MANAGER&#39; THEN&#10;                        l_rec.length_units :&#61; PKG_Lookups.funcgetDisposalTypeUnits(l_rec.disposal_type_id);&#10;                    END IF;&#10;                END IF;&#10;                IF l_rec.lic_cond_type_main_cat_id IS NOT NULL THEN&#10;                    l_rec.component_description :&#61; PKG_Lookups.funcgetLicCondTypeDescription(l_rec.lic_cond_type_main_cat_id);&#10;                    l_rec.length_units :&#61; PKG_Lookups.funcgetLicCondTypeUnits(l_rec.lic_cond_type_main_cat_id);&#10;                END IF;&#10;                IF l_rec.rqmnt_type_main_category_id IS NOT NULL THEN&#10;                    l_rec.component_description :&#61; PKG_Lookups.funcgetRqmntTypeDescription(l_rec.rqmnt_type_main_category_id);&#10;                    l_rec.length_units :&#61; PKG_Lookups.funcgetRqmntTypeUnits(l_rec.rqmnt_type_main_category_id);&#10;                END IF;&#10;                IF l_rec.ad_rqmnt_type_main_category_id IS NOT NULL THEN&#10;                    l_rec.component_description :&#61; PKG_Lookups.funcgetADRqmntTypeDescription(l_rec.ad_rqmnt_type_main_category_id);&#10;                    l_rec.length_units :&#61; PKG_Lookups.funcgetADRqmntTypeUnits(l_rec.ad_rqmnt_type_main_category_id);&#10;                END IF;&#10;                IF l_rec.pss_rqmnt_type_main_cat_id IS NOT NULL THEN&#10;                    l_rec.component_description :&#61; PKG_Lookups.funcgetPSSRqmntTypeDescription(l_rec.pss_rqmnt_type_main_cat_id);&#10;                    l_rec.length_units :&#61; PKG_Lookups.funcgetPSSRqmntTypeUnits(l_rec.pss_rqmnt_type_main_cat_id);&#10;                END IF;&#10;                IF l_rec.entry_length_units_id IS NOT NULL THEN&#10;                    l_rec.entry_length_units_desc :&#61; PKG_Lookups.funcgetStdRefListCodeAndDesc(l_rec.entry_length_units_id, &#39;|&#39;);&#10;                    l_rec.entry_length_units_code :&#61; PKG_LstUtl.list_next_elem(l_rec.entry_length_units_desc, &#39;|&#39;);&#10;            END IF;&#10;                --&#10;                IF l_rec.ro_year &gt; 0 THEN&#10;                    --&#10;                    -- &#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61; Definitions &#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61; --&#10;                    -- StartA &#61; ADD_MONTHS(TRUNC(SYSDATE), -1 * l_rec.ro_year * 12)&#10;                    -- EndA   &#61; TRUNC(SYSDATE)&#10;                    -- StartB &#61; RO.start_date&#10;                    -- EndB   &#61; NVL(RO.end_date, TRUNC(SYSDATE)+1)&#10;                    -- Note 1: StartB (RO.start_date) can be on the same day as EndA (l_ro_end_date)&#10;                    -- Note 2: EndB (RO.end_date) cannot be on the same day as StartA (l_ro_start_date)&#10;                    -- &#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61; --&#10;                    -- If one of these is true, then the two date ranges (see Notes 1 and 2) DO NOT overlap:&#10;                    --   (EndA &lt; StartB) OR (StartA &gt;&#61; EndB)&#10;                    -- Thefore, the &quot;OVERLAP&quot; condition would be as follows:&#10;                    --   NOT ( EndA &lt; StartB OR StartA &gt;&#61; EndB ) &#61;&gt; ( apply de Morgan rule: NOT (A or B) &#61; (NOT A and NOT B) ) &#61;&gt;&#10;                    --   EndA &gt;&#61; StartB AND StartA &lt; EndB&#10;                    --&#10;                    SELECT COUNT(1) INTO l_rec.ro_count&#10;                    FROM responsible_officer RO&#10;                    WHERE RO.offender_id &#61; l_rec.offender_id&#10;                      AND /*EndA  */ SYSDATE                                       &gt;&#61; /*StartB*/ RO.start_date&#10;                      AND /*StartA*/ ADD_MONTHS(TRUNC(SYSDATE), -1 * l_rec.ro_year * 12)  &lt;  /*EndB  */ NVL(RO.end_date, TRUNC(SYSDATE)+1);&#10;                    --&#10;            END IF;&#10;            --&#10;            END IF;&#10;            --&#10;            IF NVLSTR(p_use_caseload_table, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;                PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;l_rec.offender_id, p_L1&#61;&gt;l_rec.L1, p_L2&#61;&gt;l_rec.L2, p_L3&#61;&gt;l_rec.L3);&#10;            END IF;&#10;            --&#10;            PIPE ROW (l_rec);&#10;            l_row :&#61; l_row + 1;&#10;            --&#10;        END LOOP;&#10;        --&#10;        EXIT WHEN l_cur%NOTFOUND;&#10;        --&#10;        EXIT WHEN l_row &gt;&#61; NVL(p_max_rows, 100000);&#10;    END LOOP;&#10;    CLOSE l_cur;&#10;    --&#10;    procDebug(&#39;procFindCaseLoadTAB (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;dbusr&#61;&#39;  || UPPER(SYS_CONTEXT(&#39;USERENV&#39;, &#39;CURRENT_USER&#39;))   || &#39;,&#39; ||&#10;              &#39;schema&#61;&#39; || UPPER(SYS_CONTEXT(&#39;USERENV&#39;, &#39;CURRENT_SCHEMA&#39;)) || &#39;,&#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39; || p_team_id || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39; || p_staff_id  || &#39;, &#39; ||&#10;              &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id || &#39;, &#39; ||&#10;              &#39;p_provider_employee_id&#61;&gt;&#39; || p_provider_employee_id || &#39;, &#39; ||&#10;              &#39;p_offender_id&#61;&gt;&#39; || p_offender_id || &#39;, &#39; ||&#10;              &#39;p_components&#61;&gt;&#39; || p_components ||  CHR(10) ||&#10;              l_SQL);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;              &#39;procFindCaseLoadTAB (rows&#61;&#39; || l_row || &#39;): &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39; || p_team_id || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39; || p_staff_id  || &#39;, &#39; ||&#10;              &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id || &#39;, &#39; ||&#10;              &#39;p_provider_employee_id&#61;&gt;&#39; || p_provider_employee_id ||&#10;              &#39;p_offender_id&#61;&gt;&#39; || p_offender_id || &#39;, &#39; ||&#10;              &#39;p_components&#61;&gt;&#39; || p_components || CHR(10) ||&#10;              l_SQL);&#10;    RAISE;&#10;END procFindCaseLoadTAB;&#10;--&#10;--&#10;-- COHORT Diary&#10;--&#10;FUNCTION get_cohort_diary_SQL(&#10;    p_probation_area_ID     NUMBER DEFAULT NULL,&#10;    p_sentence_date         DATE   DEFAULT NULL,&#10;    p_release_date          DATE   DEFAULT NULL,&#10;    p_offence_date          DATE   DEFAULT NULL,&#10;    p_team_id               NUMBER DEFAULT NULL,&#10;    p_staff_id              NUMBER DEFAULT NULL,&#10;    --&#10;    p_offender_id           NUMBER DEFAULT NULL,&#10;    --&#10;    p_offender_id_only_flag VARCHAR2 DEFAULT &#39;N&#39; )&#10;RETURN VARCHAR2 IS&#10;    --&#10;    l_SQL VARCHAR2(10000);&#10;    --&#10;BEGIN&#10;    --&#10;    l_SQL :&#61;&#10;    --&#10;&#39;SELECT DISTINCT&#10;  /*00*/ O.offender_ID,&#10;  /*01*/ O.first_name,&#10;  /*02*/ O.surname,&#10;  /*03*/ O.third_name,&#10;  /*04*/ O.current_highest_risk_colour,&#10;  /*05*/ O.current_exclusion,&#10;  /*06*/ O.current_restriction,&#10;  /*07*/ O.crn,&#10;  --&#10;  /*08*/ E.event_ID,&#10;  --&#10;  /*09*/ D.disposal_ID,&#10;  /*10*/ D.disposal_date,&#10;  /*11*/ D.termination_date,&#10;  --&#10;  /*12*/ E.first_release_date,&#10;  --&#10;  /*13*/ D.upw AS upw_order,&#10;  /*14*/ DT.sentence_type,&#10;  /*15*/ DT.cja2003,&#10;  /*16*/ DT.pre_cja2003,&#10;  /*17*/ DT.cohort,&#10;  --&#10;  /*18*/ pa.description,&#10;  --&#10;  /*19*/ NULL AS L1,&#10;  /*20*/ NULL AS L2,&#10;  /*21*/ NULL AS L3,&#10;  --&#10;  /*22*/ OM.offender_manager_id,&#10;  /*23*/ MO.main_offence_id,&#10;  /*24*/ OM.probation_area_id,&#10;  /*25*/ OM.trust_provider_flag,&#10;  /*26*/ OM.trust_provider_team_id,&#10;  /*27*/ OM.staff_employee_id,&#10;  /*28*/ D.disposal_type_id,&#10;  /*29*/ MO.offence_date&#10;  --&#10;FROM&#10;  event E&#10;    JOIN offender O ON O.offender_id &#61; E.offender_id&#10;      JOIN offender_manager OM ON OM.offender_id &#61; O.offender_id AND OM.active_flag &#61; 1&#10;    JOIN main_offence MO ON MO.event_id &#61; E.event_id&#10;    JOIN disposal D ON D.event_id &#61; E.event_id&#10;      JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;    JOIN order_manager OS ON OS.event_id &#61; E.event_id AND OS.active_flag &#61; 1&#10;      JOIN probation_area PA ON PA.probation_area_id &#61; OS.probation_area_id&#10;WHERE E.soft_deleted &#61; 0&#10;  AND NOT EXISTS(&#10;      SELECT cohort_ID&#10;      FROM cohort&#10;      WHERE event_ID &#61; E.event_ID )&#10;  AND DT.cohort IN ( &#39;&#39;S&#39;&#39;, &#39;&#39;R&#39;&#39;, &#39;&#39;T&#39;&#39; )&#10;  --&#39;;&#10;    --&#10;    IF p_offender_id_only_flag &#61; &#39;Y&#39; THEN&#10;        --&#10;        l_SQL :&#61; l_SQL || &#39;&#10;  AND E.offender_id &#61; :p_offender_id&#39;;&#10;        --&#10;    ELSE&#10;        --&#10;        l_SQL :&#61; l_SQL || &#39;&#10;  AND &#39; || CASE WHEN p_offender_id       IS NOT NULL THEN &#39; E.offender_id &#61; :p_offender_id&#39;                       ELSE &#39;:p_offender_id IS NULL&#39;       END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_ID IS NOT NULL THEN &#39; OM.probation_area_ID &#61; :p_probation_area_ID&#39;          ELSE &#39;:p_probation_area_ID IS NULL&#39; END || &#39;&#10;  --&#10;  AND &#39; || CASE WHEN p_team_id &gt; 0   THEN &#39;OM.team_id &#61; :p_team_id&#39;              ELSE &#39;:p_team_id IS NULL&#39;  END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_id &gt; 0  THEN &#39;OM.allocation_staff_id &#61; :p_staff_id&#39; ELSE &#39;:p_staff_id IS NULL&#39; END || &#39;&#10;  --&#10;  AND &#39; ||&#10;      CASE WHEN p_offender_id IS NULL THEN&#10;      &#39;( ( DT.cohort &#61; &#39;&#39;S&#39;&#39; AND D.disposal_date      &gt;&#61; :p_sentence_date ) OR&#10;         ( DT.cohort &#61; &#39;&#39;R&#39;&#39; AND E.first_release_date &gt;&#61; :p_release_date  ) OR&#10;         ( DT.cohort &#61; &#39;&#39;T&#39;&#39; AND E.first_release_date &gt;&#61; :p_release_date AND MO.offence_date &gt;&#61; :p_offence_date ) )&#39;&#10;      ELSE&#10;      &#39;( :p_sentence_date IS NULL AND :p_release_date IS NULL AND :p_release_date IS NULL AND :p_offence_date IS NULL )&#39;&#10;      END;&#10;        --&#10;    END IF;&#10;    --&#10;    RETURN l_SQL;&#10;    --&#10;END get_cohort_diary_SQL;&#10;--&#10;FUNCTION procFindCohortDiaryTAB(&#10;    p_probation_area_ID   NUMBER DEFAULT NULL,&#10;    p_sentence_date       DATE   DEFAULT NULL,&#10;    p_release_date        DATE   DEFAULT NULL,&#10;    p_offence_date        DATE   DEFAULT NULL,&#10;    p_team_id             NUMBER DEFAULT NULL,&#10;    p_staff_id            NUMBER DEFAULT NULL,&#10;    --&#10;    p_offender_id         NUMBER  DEFAULT NULL,&#10;    p_use_cohort_table    VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_max_rows             INTEGER DEFAULT 100000 )&#10;RETURN ttabCohortDiary PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    l_SQL VARCHAR2(10000);&#10;    --&#10;    l_rec trecCohortDiary;&#10;    l_tab ttabCohortDiary;&#10;    l_row INTEGER :&#61; 0;&#10;    l_i   INTEGER;&#10;    --&#10;    l_cohort_test_mode NUMBER;&#10;    l_offender_id      NUMBER;&#10;    --&#10;BEGIN&#10;    IF NOT ( p_offender_id IS NOT NULL OR&#10;             ( ( p_probation_area_ID IS NOT NULL )&#10;               AND&#10;               ( p_sentence_date IS NOT NULL OR&#10;                 p_release_date  IS NOT NULL OR&#10;                 p_offence_date  IS NOT NULL&#10;               )&#10;             )&#10;           )&#10;    THEN&#10;        raise_application_error(-20001, &#39;Error in procFindCohortDiaryTAB: insufficient number of parameters specified &#39; ||&#10;            &#39;(p_probation_area_id&#61;&#39; || p_probation_area_id  || &#39;)&#39; ||&#10;            &#39;(p_sentence_date&#61;&#39;     || p_sentence_date      || &#39;)&#39; ||&#10;            &#39;(p_release_date&#61;&#39;      || p_release_date       || &#39;)&#39; ||&#10;            &#39;(p_offence_date&#61;&#39;      || p_offence_date       || &#39;)&#39; ||&#10;            &#39;(p_team_id&#61;&#39;           || p_team_id            || &#39;)&#39; ||&#10;            &#39;(p_staff_id&#61;&#39;          || p_staff_id           || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_offender_id&#61;&#39;       || p_offender_id        || &#39;)&#39; ||&#10;            &#39;(p_use_cohort_table&#61;&#39;  || p_use_cohort_table   || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_max_rows&#61;&#39;          || p_max_rows           || &#39;)&#39; );&#10;        RETURN/* ttabCohortDiary()*/;&#10;    END IF;&#10;    --&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    IF NVLSTR(p_use_cohort_table, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;        --&#10;        l_cohort_test_mode :&#61; PKG_Lookups.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;COHORT_TEST_MODE&#39;, p_default_value &#61;&gt; &#39;0&#39;);&#10;        IF l_cohort_test_mode &#61; 1 THEN&#10;            SELECT offender_id INTO l_offender_id&#10;            FROM cohort_diary&#10;            WHERE rownum &#61; 1;&#10;        ELSE&#10;            l_offender_id :&#61; p_offender_id;&#10;        END IF;&#10;        --&#10;        -- Dynamic SQl based on CASELOAD de-normalised table&#10;        --&#10;        l_SQL :&#61;&#10;        --&#10;&#39;SELECT DISTINCT&#10;  /*00*/ CH.offender_ID,&#10;  /*01*/ O.first_name,&#10;  /*02*/ O.surname,&#10;  /*03*/ O.third_name,&#10;  /*04*/ O.current_highest_risk_colour,&#10;  /*05*/ O.current_exclusion,&#10;  /*06*/ O.current_restriction,&#10;  /*07*/ O.crn,&#10;  --&#10;  /*08*/ CH.event_ID,&#10;  --&#10;  /*09*/ CH.disposal_ID,&#10;  /*10*/ CH.disposal_date,&#10;  /*11*/ D.termination_date,&#10;  --&#10;  /*12*/ CH.first_release_date,&#10;  --&#10;  /*13*/ CH.upw AS upw_order,&#10;  /*14*/ DT.sentence_type,&#10;  /*15*/ DT.cja2003,&#10;  /*16*/ DT.pre_cja2003,&#10;  /*17*/ CH.cohort,&#10;  --&#10;  /*18*/ PA.description,&#10;  --&#10;  /*19*/ NULL AS L1,&#10;  /*20*/ NULL AS L2,&#10;  /*21*/ NULL AS L3,&#10;  --&#10;  /*22*/ CH.offender_manager_id,&#10;  /*23*/ CH.main_offence_id,&#10;  /*24*/ CH.probation_area_id,&#10;  /*25*/ CH.trust_provider_flag,&#10;  /*26*/ CH.trust_provider_team_id,&#10;  /*27*/ CH.staff_employee_id,&#10;  /*28*/ CH.disposal_type_id,&#10;  /*29*/ CH.offence_date&#10;  --&#10;FROM&#10;  cohort_diary CH&#10;  JOIN offender O ON O.offender_id &#61; CH.offender_id&#10;  JOIN disposal D ON CH.disposal_id &#61; D.disposal_id&#10;    JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;  JOIN probation_area PA ON PA.probation_area_id &#61; CH.probation_area_id&#10;WHERE 1&#61;1&#10;  AND &#39; || CASE WHEN l_offender_id       IS NOT NULL THEN &#39; CH.offender_id &#61; :p_offender_id&#39;                      ELSE &#39;:p_offender_id IS NULL&#39;       END || &#39;&#10;  AND &#39; || CASE WHEN p_probation_area_ID IS NOT NULL THEN &#39; CH.probation_area_ID &#61; :p_probation_area_ID&#39;          ELSE &#39;:p_probation_area_ID IS NULL&#39; END || &#39;&#10;  --&#10;  AND &#39; || CASE WHEN p_team_id &gt; 0  THEN &#39;CH.trust_provider_flag &#61; 0 AND CH.trust_provider_team_id &#61; :p_team_id&#39;  ELSE &#39;:p_team_id IS NULL&#39;           END || &#39;&#10;  AND &#39; || CASE WHEN p_staff_id &gt; 0 THEN &#39;CH.trust_provider_flag &#61; 0 AND CH.staff_employee_id      &#61; :p_staff_id&#39; ELSE &#39;:p_staff_id IS NULL&#39;          END || &#39;&#10;  --&#10;  AND ( ( CH.cohort &#61; &#39;&#39;S&#39;&#39; AND CH.disposal_date      &gt;&#61; :p_sentence_date ) OR&#10;        ( CH.cohort &#61; &#39;&#39;R&#39;&#39; AND CH.first_release_date &gt;&#61; :p_release_date  ) OR&#10;        ( CH.cohort &#61; &#39;&#39;T&#39;&#39; AND CH.first_release_date &gt;&#61; :p_release_date AND CH.offence_date &gt;&#61; :p_offence_date )&#10;      )&#10;   --&#10;   --&#39;;&#10;        --&#10;    ELSE&#10;        --&#10;        l_offender_id :&#61; p_offender_id;&#10;        --&#10;        l_SQL :&#61;&#10;            get_cohort_diary_SQL(&#10;                p_probation_area_ID &#61;&gt; p_probation_area_ID,&#10;                p_sentence_date     &#61;&gt; p_sentence_date,&#10;                p_release_date      &#61;&gt; p_release_date,&#10;                p_offence_date      &#61;&gt; p_offence_date,&#10;                p_team_id           &#61;&gt; p_team_id,&#10;                p_staff_id          &#61;&gt; p_staff_id,&#10;                --&#10;                p_offender_id       &#61;&gt; l_offender_id );&#10;        --&#10;    END IF;&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      l_offender_id,&#10;      p_probation_area_ID,&#10;      p_team_id,&#10;      p_staff_id,&#10;      p_sentence_date,&#10;      p_release_date,&#10;      p_release_date, p_offence_date&#10;    ;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab LIMIT NVL(p_max_rows, 10000);&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_row :&#61; l_row + 1;&#10;        --EXIT WHEN l_row &gt; NVL(p_max_rows, 100000);&#10;        --&#10;        IF NVLSTR(p_use_cohort_table, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;            PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;l_tab(l_i).offender_id, p_L1&#61;&gt;l_tab(l_i).L1, p_L2&#61;&gt;l_tab(l_i).L2, p_L3&#61;&gt;l_tab(l_i).L3);&#10;        END IF;&#10;        --&#10;        PIPE ROW (l_tab(l_i));&#10;    END LOOP;&#10;    --&#10;    procDebug(&#39;procCohortDiaryTAB (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;num_of_rows&#61;&#39; || l_row || &#39;, &#39; ||&#10;              --&#10;              &#39;(p_probation_area_id&#61;&#39; || p_probation_area_ID  || &#39;)&#39; ||&#10;              &#39;(p_sentence_date&#61;&#39;     || p_sentence_date      || &#39;)&#39; ||&#10;              &#39;(p_release_date&#61;&#39;      || p_release_date       || &#39;)&#39; ||&#10;              &#39;(p_offence_date&#61;&#39;      || p_offence_date       || &#39;)&#39; ||&#10;              &#39;(p_team_id&#61;&#39;           || p_team_id            || &#39;)&#39; ||&#10;              &#39;(p_staff_id&#61;&#39;          || p_staff_id           || &#39;)&#39; ||&#10;              --&#10;              &#39;(p_offender_id&#61;&#39;       || p_offender_id        || &#39;)&#39; ||&#10;              &#39;(p_use_cohort_table&#61;&#39;  || p_use_cohort_table   || &#39;)&#39; ||&#10;              --&#10;              &#39;(p_max_rows&#61;&#39;          || p_max_rows           || &#39;)&#39; ||&#10;              --&#10;              &#39;(off_cache_HITS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;              &#39;(off_cache_MISS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39; || CHR(10) ||&#10;              l_SQL );&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;              &#39;procFindCohortDiaryTAB: &#39; ||&#10;              &#39;num_of_rows&#61;&#39; || l_row || CHR(10) ||&#10;              --&#10;              &#39;(p_probation_area_ID&#61;&#39; || p_probation_area_ID  || &#39;)&#39; ||&#10;              &#39;(p_sentence_date&#61;&#39;     || p_sentence_date      || &#39;)&#39; ||&#10;              &#39;(p_release_date&#61;&#39;      || p_release_date       || &#39;)&#39; ||&#10;              &#39;(p_offence_date&#61;&#39;      || p_offence_date       || &#39;)&#39; ||&#10;              &#39;(p_team_id&#61;&#39;           || p_team_id            || &#39;)&#39; ||&#10;              &#39;(p_staff_id&#61;&#39;          || p_staff_id           || &#39;)&#39; ||&#10;              --&#10;              &#39;(p_offender_id&#61;&#39;       || p_offender_id        || &#39;)&#39; ||&#10;              &#39;(p_use_cohort_table&#61;&#39;  || p_use_cohort_table   || &#39;)&#39; ||&#10;              --&#10;              &#39;(p_max_rows&#61;&#39;          || p_max_rows           || &#39;)&#39; ||&#10;              --&#10;              CHR(10) || l_SQL );&#10;    RAISE;&#10;END procFindCohortDiaryTAB;&#10;&#10;--&#10;-- Court AppearanceDiary&#10;--&#10;FUNCTION procCourtAppDiaryTAB(&#10;    p_date                DATE,&#10;    p_appearance_type_id  NUMBER,&#10;    p_probation_area_ID   NUMBER   DEFAULT NULL,&#10;    p_court_id            NUMBER   DEFAULT NULL,&#10;    p_soft_deleted        SMALLINT DEFAULT 0,&#10;    --&#10;    p_max_rows            INTEGER  DEFAULT 100000 )&#10;RETURN ttabCourtAppDiary PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    --&#10;    l_cur       l_cur_TYP;&#10;    l_SQL       VARCHAR2(10000);&#10;    --&#10;    l_cur_1     l_cur_TYP;&#10;    l_SQL_1     VARCHAR2(1000);&#10;    --&#10;    l_rec       trecCourtAppDiary;&#10;    l_tab       ttabCourtAppDiary;&#10;    l_row       INTEGER :&#61; 0;&#10;    l_i         INTEGER;&#10;    --&#10;    l_court_id  NUMBER;&#10;    --&#10;    l_exit_flag BOOLEAN :&#61; FALSE;&#10;    --&#10;BEGIN&#10;    IF NOT ( p_court_id IS NOT NULL OR p_probation_area_ID IS NOT NULL ) THEN&#10;        raise_application_error(-20001, &#39;Error in procCourtAppDiaryTAB: insufficient number of parameters specified &#39; ||&#10;            &#39;(p_probation_area_id&#61;&#39;  || p_probation_area_id  || &#39;)&#39; ||&#10;            &#39;(p_court_id&#61;&#39;           || p_court_id           || &#39;)&#39; ||&#10;            &#39;(p_appearance_type_id&#61;&#39; || p_appearance_type_id || &#39;)&#39; ||&#10;            &#39;(p_date&#61;&#39;               || p_date               || &#39;)&#39; ||&#10;            &#39;(p_soft_deleted&#61;&#39;       || p_soft_deleted       || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_max_rows&#61;&#39;           || p_max_rows           || &#39;)&#39; );&#10;        RETURN/* ttabCourtAppDiary()*/;&#10;    END IF;&#10;    --&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    l_SQL_1 :&#61;&#10;    --&#10;&#39;SELECT court_id&#10;FROM court&#10;WHERE 1&#61;1&#10;  AND &#39; || CASE WHEN p_probation_area_id IS NOT NULL AND p_court_id IS NULL THEN &#39;probation_area_id &#61; :p_probation_area_id&#39; ELSE &#39;NVL(:p_probation_area_id, -1) IS NOT NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN p_court_id IS NOT NULL                                 THEN &#39;court_id &#61; :p_court_id&#39;                   ELSE &#39;NVL(:p_court_id, -1) IS NOT NULL&#39;          END || &#39;&#10;--&#39;;&#10;    --&#10;    l_SQL :&#61;&#10;    --&#10;&#39;WITH CA AS (&#10;  SELECT /*+ INDEX( CA, xie4court_appearance ) */&#10;    *&#10;  FROM&#10;      court_appearance CA&#10;  WHERE 1&#61;1&#10;    AND TRUNC(CA.appearance_date) &#61; :p_date&#10;    AND CA.court_id &#61; :p_court_id&#10;    AND CA.appearance_type_id &#61; :p_appearance_type_id --PKG_Lookups.funcgetStdRefListID()&#10;    AND CA.soft_deleted &#61; :p_soft_deleted&#10;    )&#10;--&#10;SELECT DISTINCT /*+ INDEX( CA, xie4court_appearance ) */&#10;  /*00*/ CA.court_appearance_id,&#10;  /*01*/ CA.appearance_date,&#10;  /*02*/ COURT.court_name,&#10;  /*03*/ COURT_OUTCOME.code_description  AS outcome_desc,&#10;  /*04*/ O.offender_id,&#10;  /*05*/ O.crn,&#10;  /*06*/ O.first_name,&#10;  /*07*/ O.second_name,&#10;  /*08*/ O.third_name,&#10;  /*09*/ O.surname,&#10;  /*10*/ O.date_of_birth_date,&#10;  /*11*/ O.current_highest_risk_colour,&#10;  /*12*/ O.current_exclusion,&#10;  /*13*/ O.current_restriction,&#10;  /*14*/ GENDER.code_description         AS gender_code,&#10;  /*15*/ CURR_TIER.code_description      AS current_tier_desc,&#10;  /*16*/ E.event_id,&#10;  /*17*/ D.disposal_id,&#10;  /*18*/ D.termination_date,&#10;  /*19*/ D.upw,&#10;  /*20*/ DT.disposal_type_id,&#10;  /*21*/ DT.sentence_type,&#10;  /*22*/ DT.cja2003,&#10;  /*23*/ DT.pre_cja2003&#10;FROM&#10;  CA&#10;    INNER JOIN court ON COURT.court_id &#61; CA.court_id&#10;    --INNER JOIN r_standard_reference_list CAT ON CAT.standard_reference_list_id &#61; CA.appearance_type_id&#10;    LEFT OUTER JOIN r_standard_reference_list COURT_OUTCOME ON COURT_OUTCOME.standard_reference_list_id &#61; CA.outcome_ID&#10;    INNER JOIN event E ON E.event_id &#61; CA.event_id&#10;      INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;        INNER JOIN r_standard_reference_list GENDER ON GENDER.standard_reference_list_id &#61; O.gender_id&#10;        LEFT OUTER JOIN r_standard_reference_list CURR_TIER ON CURR_TIER.standard_reference_list_id &#61; O.current_tier&#10;      LEFT OUTER JOIN disposal D ON D.event_id &#61; E.event_id&#10;       LEFT OUTER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;WHERE 1&#61;1&#10;   --&#39;;&#10;    --&#10;    OPEN l_cur_1 FOR l_SQL_1&#10;    USING p_probation_area_id, p_court_id;&#10;    LOOP&#10;        FETCH l_cur_1 INTO l_court_id;&#10;        EXIT WHEN l_cur_1%NOTFOUND OR l_exit_flag;&#10;        --&#10;        OPEN l_cur FOR l_SQL&#10;        USING&#10;          TRUNC(NVL(p_date, SYSDATE)),&#10;          l_court_id,&#10;          p_appearance_type_id,&#10;          NVL(p_soft_deleted, 0)&#10;        ;&#10;        --&#10;        FETCH l_cur BULK COLLECT INTO l_tab;&#10;        CLOSE l_cur;&#10;        --&#10;        FOR l_i IN 1..l_tab.COUNT LOOP&#10;            l_row :&#61; l_row + 1;&#10;            --&#10;            l_exit_flag :&#61; ( l_row &gt; NVL(p_max_rows, 100000) );&#10;            EXIT WHEN l_exit_flag;&#10;            --&#10;            PIPE ROW (l_tab(l_i));&#10;        END LOOP;&#10;        --&#10;    END LOOP;&#10;    --&#10;    IF l_cur_1%ISOPEN THEN&#10;        CLOSE l_cur_1;&#10;    END IF;&#10;    --&#10;    procDebug(&#10;        &#39;procCourtAppDiaryTAB (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;        &#39;num_of_rows&#61;&#39; || l_row || &#39;, &#39; ||&#10;        --&#10;        &#39;(p_probation_area_id&#61;&#39;  || p_probation_area_id  || &#39;)&#39; ||&#10;        &#39;(p_court_id&#61;&#39;           || p_court_id           || &#39;)&#39; ||&#10;        &#39;(p_appearance_type_id&#61;&#39; || p_appearance_type_id || &#39;)&#39; ||&#10;        &#39;(p_date&#61;&#39;               || p_date               || &#39;)&#39; ||&#10;        &#39;(p_soft_deleted&#61;&#39;       || p_soft_deleted       || &#39;)&#39; ||&#10;        --&#10;        &#39;(p_max_rows&#61;&#39;           || p_max_rows           || &#39;)&#39; ||&#10;        --&#10;        &#39;(off_cache_HITS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;        &#39;(off_cache_MISS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39; || CHR(10) ||&#10;        CHR(10) || l_SQL_1 ||&#10;        CHR(10) || l_SQL );&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug( SQLERRM || CHR(10) ||&#10;        &#39;procCourtAppDiaryTAB: &#39; ||&#10;        &#39;num_of_rows&#61;&#39; || l_row || &#39;, &#39; ||&#10;        --&#10;        &#39;(p_probation_area_id&#61;&#39;  || p_probation_area_id  || &#39;)&#39; ||&#10;        &#39;(p_court_id&#61;&#39;           || p_court_id           || &#39;)&#39; ||&#10;        &#39;(p_appearance_type_id&#61;&#39; || p_appearance_type_id || &#39;)&#39; ||&#10;        &#39;(p_date&#61;&#39;               || p_date               || &#39;)&#39; ||&#10;        &#39;(p_soft_deleted&#61;&#39;       || p_soft_deleted       || &#39;)&#39; ||&#10;        --&#10;        &#39;(p_max_rows&#61;&#39;           || p_max_rows           || &#39;)&#39; ||&#10;        --&#10;        CHR(10) || l_SQL_1 ||&#10;        CHR(10) || l_SQL );&#10;    RAISE;&#10;END procCourtAppDiaryTAB;&#10;&#10;--&#10;-- Release Diary&#10;--&#10;FUNCTION procReleaseDiaryTAB(&#10;    p_team_id              OFFENDER_MANAGER.team_id%TYPE,&#10;    p_provider_team_id     OFFENDER_MANAGER.provider_team_id%TYPE,&#10;    p_staff_id             OFFENDER_MANAGER.allocation_staff_id%TYPE,&#10;    p_provider_employee_id OFFENDER_MANAGER.provider_employee_id%TYPE,&#10;    p_from_date            DATE,&#10;    p_to_date              DATE,&#10;    p_key_date_type_code   R_STANDARD_REFERENCE_LIST.code_value%TYPE,&#10;    p_max_rows             INTEGER DEFAULT 100000 )&#10;RETURN ttabReleaseDiary PIPELINED&#10;IS&#10;    --&#10;    l_proc CONSTANT VARCHAR2(30) :&#61; &#39;procReleaseDiaryTAB&#39;;&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    l_SQL VARCHAR2(10000);&#10;    --&#10;    l_rec trecReleaseDiary;&#10;    l_tab ttabReleaseDiary;&#10;    l_row INTEGER :&#61; 0;&#10;    l_i   INTEGER;&#10;    --&#10;    l_trust_provider_flag    OFFENDER_MANAGER.trust_provider_flag%TYPE;&#10;    l_trust_provider_team_id OFFENDER_MANAGER.trust_provider_team_id%TYPE;&#10;    l_staff_employee_id      NUMBER;&#10;    --&#10;    l_date_1 DATE;&#10;    l_date_2 DATE;&#10;    --&#10;    l_key_date_type_id KEY_DATE.key_date_type_id%TYPE;&#10;    --&#10;BEGIN&#10;    IF EMPTY2NULL(p_key_date_type_code) IS NULL THEN&#10;        l_key_date_type_id :&#61; NULL;&#10;    ELSE&#10;        l_key_date_type_id :&#61; PKG_Lookups.funcgetStdRefListID(p_code_set&#61;&gt;&#39;THROUGHCARE DATE TYPE&#39;, p_code&#61;&gt;p_key_date_type_code);&#10;    END IF;&#10;    --&#10;    IF p_team_id IS NOT NULL THEN&#10;        l_trust_provider_flag    :&#61; 0;&#10;        l_trust_provider_team_id :&#61; p_team_id;&#10;        l_staff_employee_id      :&#61; p_staff_id;&#10;    ELSIF p_provider_team_id IS NOT NULL THEN&#10;        l_trust_provider_flag    :&#61; 1;&#10;        l_trust_provider_team_id :&#61; p_provider_team_id;&#10;        l_staff_employee_id      :&#61; p_provider_employee_id;&#10;    END IF;&#10;    --&#10;    IF EMPTY2NULL(p_key_date_type_code) IS NULL OR&#10;       l_key_date_type_id               IS NULL OR&#10;       l_trust_provider_team_id         IS NULL&#10;    THEN&#10;        raise_application_error(-20001, &#39;Error in &#39; || l_proc || &#39;: insufficient number of parameters specified&#39; || CHR(10) ||&#10;            &#39;(p_team_id&#61;&#39;               || p_team_id              || &#39;)&#39; ||&#10;            &#39;(p_provider_team_id&#61;&#39;      || p_provider_team_id     || &#39;)&#39; ||&#10;            &#39;(p_staff_id&#61;&#39;              || p_staff_id             || &#39;)&#39; ||&#10;            &#39;(p_provider_employee_id&#61;&#39;  || p_provider_employee_id || &#39;)&#39; ||&#10;            &#39;(p_from_date&#61;&#39;             || p_from_date            || &#39;)&#39; ||&#10;            &#39;(p_to_date&#61;&#39;               || p_to_date              || &#39;)&#39; ||&#10;            &#39;(p_key_date_type_code&#61;&#39;    || p_key_date_type_code   || &#39;)&#39; ||&#10;            &#39;(p_max_rows&#61;&#39;              || p_max_rows             || &#39;)&#39; );&#10;    END IF;&#10;    --&#10;    l_date_1 :&#61; NVL(p_from_date, ADD_MONTHS(TRUNC(SYSDATE), -12));&#10;    l_date_2 :&#61; NVL(p_to_date  , TRUNC(SYSDATE)+1);&#10;    --&#10;    l_SQL :&#61;&#10;&#39;WITH OM1 AS (&#10;  SELECT&#10;    O.offender_id,&#10;    CUS.prisoner_number,&#10;    CUS.custody_id,&#10;    INST.institution_name,&#10;    D.disposal_id,&#10;    D.disposal_date,&#10;    D.termination_date,&#10;    D.upw,&#10;    O.first_name,&#10;    O.surname,&#10;    O.third_name,&#10;    O.crn,&#10;    O.current_highest_risk_colour,&#10;    O.current_exclusion,&#10;    O.current_restriction,&#10;    e.event_id&#10;  FROM&#10;    offender_manager OM,&#10;    offender         O,&#10;    event            E,&#10;    disposal         D,&#10;    custody          CUS,&#10;    r_institution    INST&#10;  WHERE 1&#61;1&#10;    AND OM.trust_provider_team_id &#61; :p_trust_provider_team_id&#10;    AND &#39; ||&#10;      CASE WHEN l_staff_employee_id IS NULL&#10;          THEN &#39;:p_staff_employee_id IS NULL&#39;&#10;          ELSE &#39;OM.staff_employee_id &#61; :p_staff_employee_id&#39;&#10;      END || &#39;&#10;    AND OM.trust_provider_flag &#61; :p_trust_provider_flag&#10;    AND OM.active_flag &#61; 1&#10;    --&#10;    AND O.offender_id &#61; OM.offender_id&#10;    AND E.offender_id &#61; O.offender_id&#10;    AND D.event_id &#61; E.event_id&#10;    AND D.active_flag &#61; 1 --D.TERMINATION_DATE IS NULL&#10;    AND CUS.disposal_id &#61; D.disposal_id&#10;    AND INST.institution_id(+) &#61; CUS.institution_id&#10;    AND INST.establishment(+) &#61; CUS.establishment&#10;    -- soft_deleted checks&#10;    AND OM.soft_deleted  &#61; 0&#10;    AND O.soft_deleted   &#61; 0&#10;    AND E.soft_deleted   &#61; 0&#10;    AND D.soft_deleted   &#61; 0&#10;    AND CUS.soft_deleted &#61; 0&#10;    ),&#10;KD1 AS (&#10;  SELECT&#10;    KD.key_date,&#10;    KD.custody_id&#10;  FROM&#10;    key_date                  KD&#10;    --r_standard_reference_list KD_TYP&#10;  WHERE 1&#61;1&#10;    AND KD.key_date BETWEEN :p_date_1 AND :p_date_2&#10;    AND KD.key_date_type_id &#61; :p_key_date_type_id&#10;    --AND KD_TYP.standard_reference_list_id &#61; KD.key_date_type_id&#10;    --AND KD_TYP.code_value &#61; :2&#10;    --AND KD_TYP.standard_reference_list_id &#61; :2&#10;    -- soft_deleted checks&#10;    AND KD.soft_deleted &#61; 0 )&#10;--&#10;SELECT&#10;  /*00*/ offender_id,&#10;  /*01*/ key_date,&#10;  /*02*/ prisoner_number,&#10;  /*03*/ OM1.custody_id,&#10;  /*04*/ institution_name,&#10;  /*05*/ disposal_id,&#10;  /*06*/ disposal_date,&#10;  /*07*/ termination_date,&#10;  /*08*/ upw,&#10;  /*09*/ first_name,&#10;  /*10*/ surname,&#10;  /*11*/ third_name,&#10;  /*12*/ crn,&#10;  /*13*/ current_highest_risk_colour,&#10;  /*14*/ current_exclusion,&#10;  /*15*/ current_restriction,&#10;  /*16*/ event_id&#10;FROM&#10;  OM1,&#10;  KD1&#10;WHERE KD1.custody_id &#61; OM1.custody_id&#39;;&#10;    --&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      l_trust_provider_team_id, l_staff_employee_id, l_trust_provider_flag,&#10;      l_date_1, l_date_2,&#10;      l_key_date_type_id;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab LIMIT p_max_rows;&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_row :&#61; l_row + 1;&#10;        --EXIT WHEN v_row &gt; NVL(p_max_rows, 100000);&#10;        --&#10;        --PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;v_tab(v_i).offender_id, p_L1&#61;&gt;v_tab(v_i).L1, p_L2&#61;&gt;v_tab(v_i).L2, p_L3&#61;&gt;v_tab(v_i).L3);&#10;        --&#10;        PIPE ROW (l_tab(l_i));&#10;    END LOOP;&#10;    --&#10;    procDebug(l_proc || &#39; (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;        &#39;num_of_rows&#61;&#39;             || l_row || &#39;, &#39; ||&#10;        &#39;(p_team_id&#61;&#39;              || p_team_id              || &#39;)&#39; ||&#10;        &#39;(p_provider_team_id&#61;&#39;     || p_provider_team_id     || &#39;)&#39; ||&#10;        &#39;(p_staff_id&#61;&#39;             || p_staff_id             || &#39;)&#39; ||&#10;        &#39;(p_provider_employee_id&#61;&#39; || p_provider_employee_id || &#39;)&#39; ||&#10;        &#39;(p_from_date&#61;&#39;            || p_from_date            || &#39;)&#39; ||&#10;        &#39;(p_to_date&#61;&#39;              || p_to_date              || &#39;)&#39; ||&#10;        &#39;(p_key_date_type_code&#61;&#39;   || p_key_date_type_code   || &#39;)&#39; ||&#10;        &#39;(p_max_rows&#61;&#39;             || p_max_rows             || &#39;)&#39; || CHR(10) ||&#10;        l_SQL );&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;        l_proc                     || &#39;: &#39; ||&#10;        &#39;(p_team_id&#61;&#39;              || p_team_id              || &#39;)&#39; ||&#10;        &#39;(p_provider_team_id&#61;&#39;     || p_provider_team_id     || &#39;)&#39; ||&#10;        &#39;(p_staff_id&#61;&#39;             || p_staff_id             || &#39;)&#39; ||&#10;        &#39;(p_provider_employee_id&#61;&#39; || p_provider_employee_id || &#39;)&#39; ||&#10;        &#39;(p_from_date&#61;&#39;            || p_from_date            || &#39;)&#39; ||&#10;        &#39;(p_to_date&#61;&#39;              || p_to_date              || &#39;)&#39; ||&#10;        &#39;(p_key_date_type_code&#61;&#39;   || p_key_date_type_code   || &#39;)&#39; ||&#10;        &#39;(p_max_rows&#61;&#39;             || p_max_rows             || &#39;)&#39; || CHR(10) ||&#10;        l_SQL );&#10;    RAISE;&#10;END procReleaseDiaryTAB;&#10;&#10;--&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;-- Package Body initialisation block&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;BEGIN&#10;    --&#10;    PKG_Global.do_init;&#10;    --&#10;END PKG_CASELOAD;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>