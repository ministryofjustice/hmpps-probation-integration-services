<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.PKG_CAS_SUPPORT</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY pkg_cas_support&#10;AS&#10;--&#10;--&#10;&#10;g_label VARCHAR2(100) :&#61; &#39;000000&#39;;&#10;&#10;--&#10;g_component_code  CONSTANT VARCHAR2(3)  :&#61; &#39;CAS&#39;;&#10;g_package_name    CONSTANT VARCHAR2(30) :&#61; &#39;PKG_CAS_SUPPORT&#39;;&#10;g_procedure_name  VARCHAR2(30)          :&#61; &#39;initial_value&#39;;&#10;&#10;--&#10;-- message type&#10;mt_information    CONSTANT NUMBER :&#61; 1;&#10;mt_warning        CONSTANT NUMBER :&#61; 2;&#10;mt_error          CONSTANT NUMBER :&#61; 3;&#10;mt_fatal_error    CONSTANT NUMBER :&#61; 4;&#10;--&#10;&#10;&#10;--&#10;-- PKG_COMMON wrappers&#10;--&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level NUMBER DEFAULT 0) IS&#10;BEGIN&#10;    PKG_Common.print_message(&#10;        p_msg         &#61;&gt; p_msg,&#10;        p_trace_level &#61;&gt; NVL(p_trace_level, PKG_Common.GC_TRACE_LEVEL),&#10;        p_label       &#61;&gt; g_label );&#10;END message;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;--&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;--&#10;PROCEDURE raise_error(p_err_msg VARCHAR2, p_proc VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    PKG_Common.raise_error( p_err_msg, p_proc, p_label );&#10;END raise_error;&#10;--&#10;--***************************************************&#10;-- Helpers                                          *&#10;--***************************************************&#10;--&#10;-- Used to populate mtt_message_log with information type message&#10;PROCEDURE info(message_in VARCHAR2, p_trace_level INTEGER DEFAULT 15, p_proc VARCHAR2 DEFAULT NULL, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    --&#10;    IF PKG_TriggerSupport.get_debug_flag &#61; &#39;Y&#39; THEN&#10;        message(NVL(p_proc, g_procedure_name) || &#39;: &#39; || message_in, p_trace_level);&#10;    END IF;&#10;    --&#10;    IF SPGConfig.SPGInfoActive THEN&#10;        SPGConfig.insert_message_log(&#10;            message_type_id_in &#61;&gt; mt_information,&#10;            component_code_in  &#61;&gt; g_component_code,&#10;            package_name_in    &#61;&gt; g_package_name,&#10;            procedure_name_in  &#61;&gt; NVL(p_proc, g_procedure_name),&#10;            label_in           &#61;&gt; NVL(p_label, g_label),&#10;            message_text_in    &#61;&gt; message_in );&#10;    END IF;&#10;    --&#10;END info;&#10;--&#10;-- Will populate mtt_message_log with warning message - will populate mtt_error_log if result of exception&#10;PROCEDURE warn(message_in VARCHAR2, p_proc VARCHAR2 DEFAULT NULL, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    --&#10;    IF PKG_TriggerSupport.get_debug_flag &#61; &#39;Y&#39; THEN&#10;        message(&#39;WARNING in &#39; || NVL(p_proc, g_procedure_name) || &#39;: &#39; || message_in, 0);&#10;    END IF;&#10;    --&#10;    IF SPGConfig.SPGWarnActive THEN&#10;        SPGConfig.record_error(&#10;            message_type_id_in &#61;&gt; mt_warning,&#10;            component_code_in  &#61;&gt; g_component_code,&#10;            package_name_in    &#61;&gt; g_package_name,&#10;            procedure_name_in  &#61;&gt; NVL(p_proc, g_procedure_name),&#10;            label_in           &#61;&gt; NVL(p_label, g_label),&#10;            message_text_in    &#61;&gt; message_in );&#10;    END IF;&#10;END warn;&#10;--&#10;-- Will populate mtt_message_log with error message and populate mtt_error_log with exception - used for log and continue&#10;PROCEDURE error(message_in VARCHAR2, p_proc VARCHAR2 DEFAULT NULL, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    --&#10;    IF PKG_TriggerSupport.get_debug_flag &#61; &#39;Y&#39; THEN&#10;        message(&#39;ERROR in &#39; || NVL(p_proc, g_procedure_name) || &#39;: &#39; || message_in, 5);&#10;    END IF;&#10;    --&#10;    SPGConfig.record_error(&#10;        message_type_id_in &#61;&gt; mt_error,&#10;        component_code_in  &#61;&gt; g_component_code,&#10;        package_name_in    &#61;&gt; g_package_name,&#10;        procedure_name_in  &#61;&gt; NVL(p_proc, g_procedure_name),&#10;        label_in           &#61;&gt; NVL(p_label, g_label),&#10;        message_text_in    &#61;&gt; message_in);&#10;END error;&#10;--&#10;-- Will populate mtt_message_log, mtt_error_log with error message and raise exception - used for log and halt&#10;PROCEDURE fatal(message_in VARCHAR2, p_proc VARCHAR2 DEFAULT NULL, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    --&#10;    IF PKG_TriggerSupport.get_debug_flag &#61; &#39;Y&#39; THEN&#10;        message(&#39;FATAL ERROR in &#39; || NVL(p_proc, g_procedure_name) || &#39;: &#39; || message_in, 0);&#10;    END IF;&#10;    --&#10;    SPGConfig.record_error(&#10;        message_type_id_in &#61;&gt; mt_fatal_error,&#10;        component_code_in  &#61;&gt; g_component_code,&#10;        package_name_in    &#61;&gt; g_package_name,&#10;        procedure_name_in  &#61;&gt; NVL(p_proc, g_procedure_name),&#10;        label_in           &#61;&gt; NVL(p_label, g_label),&#10;        message_text_in    &#61;&gt; message_in,&#10;        raise_error_in     &#61;&gt; TRUE );&#10;END fatal;&#10;--&#10;&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--    CAS Calculation subroutines&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;FUNCTION get_CAS_sentenced_flag(p_disposal_type_id NUMBER) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table    &#61;&gt; &#39;r_disposal_type&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;disposal_type_id&#39;,&#10;                  p_ref_val  &#61;&gt; p_disposal_type_id,&#10;                  p_data_fld &#61;&gt; &#39;CASE WHEN sentence_type IN ( &#39;&#39;SC&#39;&#39;, &#39;&#39;SP&#39;&#39; ) THEN &#39;&#39;Y&#39;&#39; ELSE &#39;&#39;N&#39;&#39; END&#39; );&#10;END get_CAS_sentenced_flag;&#10;--&#10;FUNCTION get_CAS_custodial_order_flag(p_disposal_type_id NUMBER) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table    &#61;&gt; &#39;r_disposal_type&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;disposal_type_id&#39;,&#10;                  p_ref_val  &#61;&gt; p_disposal_type_id,&#10;                  p_data_fld &#61;&gt; &#39;CASE WHEN sentence_type &#61; &#39;&#39;SC&#39;&#39; THEN &#39;&#39;Y&#39;&#39; ELSE &#39;&#39;N&#39;&#39; END&#39; );&#10;END get_CAS_custodial_order_flag;&#10;--&#10;FUNCTION get_CAS_suspended_sentense_order_flag(p_disposal_type_id NUMBER) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN&#10;        PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table    &#61;&gt; &#39;r_disposal_type&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;disposal_type_id&#39;,&#10;                  p_ref_val  &#61;&gt; p_disposal_type_id,&#10;                  p_data_fld &#61;&gt;&#10;                     &#39;CASE WHEN disposal_type_code IN (&#10;                                  &#39;&#39;203&#39;&#39;, -- CJA - Suspended Sentence Order&#10;                                  &#39;&#39;216&#39;&#39;, -- Suspended Sentence Supn Order&#10;                                  &#39;&#39;330&#39;&#39;, -- ORA Suspended Sentence Order&#10;                                  &#39;&#39;341&#39;&#39;, -- SA2020 Suspended Sentence Order&#10;                                  &#39;&#39;408&#39;&#39;  -- Suspended Sentence&#10;                                )&#10;                          THEN &#39;&#39;Y&#39;&#39;&#10;                          ELSE &#39;&#39;N&#39;&#39;&#10;                      END&#39; );&#10;END get_CAS_suspended_sentense_order_flag;&#10;--&#10;PROCEDURE procCalculateCAS(&#10;    p_offender_id           NUMBER,&#10;    p_event_id              NUMBER DEFAULT NULL,&#10;    p_nd_user_flag          VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_automated_flag        VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_create_CAS_staff_team VARCHAR2 DEFAULT NULL,&#10;    p_api_flag              VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_rsr_score             NUMBER   DEFAULT NULL,&#10;    p_rsr_level_id          NUMBER   DEFAULT NULL,&#10;    p_osp_level_i_id        NUMBER   DEFAULT NULL,&#10;    p_osp_level_c_id        NUMBER   DEFAULT NULL,&#10;    -- Two new parameters (new OSP levels from the SNS notification) added as per DST-16367&#10;    p_osp_level_iic_id      NUMBER DEFAULT NULL, /* OSPIndirectIndecentBand*/&#10;    p_osp_level_dc_id       NUMBER DEFAULT NULL  /* OSPDirectContactBand*/ )&#10;IS&#10;    --&#10;    l_proc CONSTANT VARCHAR2(30) :&#61; &#39;procCalculateCAS&#39;;&#10;    --&#10;    l_distinguished_name USER_.distinguished_name%TYPE;&#10;    --&#10;    LC_DATE_TIME DATE :&#61; SYSDATE;&#10;    LC_USER_ID   NUMBER;&#10;    --&#10;    l_rows NUMBER :&#61; 0;&#10;    --&#10;    l_crn OFFENDER.crn%TYPE;&#10;    --&#10;    l_active_OM_details VARCHAR2(255);&#10;    --&#10;    CURSOR cs IS&#10;      WITH CAS AS (&#10;        SELECT&#10;          O.crn,&#10;          O.offender_id,&#10;          E.event_id,&#10;          E.event_number,&#10;          E.active_flag,&#10;          D.disposal_id,&#10;          OM.offender_manager_id,&#10;          --&#10;          /*&#10;          A Decision of Retained (enhanced resourcing) will be recorded for an active sentenced event if&#10;            01  The Person has a Tier of A or B&#10;            02  A sentence of any type for an offence flagged as a schedule 15 sexual offence is recorded on this event&#10;            03  A sentence of any type for an offence flagged as a Modern Day Slavery Act (2015) is recorded on this event {R_OFFENCE.MODERN_DAY_SLAVERY}&#10;            04  A custodial sentence of 12 months or more for an offence a type flagged as a schedule 15 violent offence is recorded on this event&#10;            05  A custodial sentence of 12 months or more for an offence a type flagged as a Child Abduction act (1984) is recorded on this event {R_OFFENCE.CHILD_ABDUCTION}&#10;            05a A custodial sentence of 12 months or more for an offence of type 00867, Controlling or Coercive Behaviour in an intimate or family relationship, is recorded on this event&#10;            05b A suspended sentence order of 12 months or more for an offence of type 00867, Controlling or Coercive Behaviour in an intimate or family relationship, is recorded on this event&#10;            06  A sentence for an offence with the Misuse of Drugs Act (1971) with Child Concerns flag set {R_OFFENCE.DRUG_MISUSE}&#10;                AND an active registration with the ���Child Concerns��� Flag set {r_register_type.CHILD_CONCERNS}&#10;            07  An active registration with the Notifications Flag set {r_register_type.NOTIFICATIONS}&#10;          If none of these conditions is met then a decision of Allocated (normal resourcing) is identified.&#10;          */&#10;          -- 01 The Person has a Tier of A or B&#10;          CASE WHEN&#10;              PKG_Lookups.funcgetTabRecord(&#10;                  p_table    &#61;&gt; &#39;management_tier MT INNER JOIN r_standard_reference_list R ON R.standard_reference_list_id &#61; MT.tier_id&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;MT.offender_id&#39;,&#10;                  p_ref_val  &#61;&gt; E.offender_id,&#10;                  p_data_fld &#61;&gt; &#39;R.code_value&#39;,&#10;                  p_where    &#61;&gt; &#39;MT.soft_deleted &#61; 0&#39;,&#10;                  p_order_by &#61;&gt; &#39;MT.date_changed DESC&#39; )&#10;              IN ( &#39;A&#39; , &#39;UA0&#39;, &#39;UA1&#39;, &#39;UA2&#39;, &#39;UA3&#39;, &#39;UA0S&#39;, &#39;UA1S&#39;, &#39;UA2S&#39;, &#39;UA3S&#39;,&#10;                   &#39;B1&#39;, &#39;B2&#39; , &#39;UB0&#39;, &#39;UB1&#39;, &#39;UB2&#39;, &#39;UB3&#39; , &#39;UB0S&#39;, &#39;UB1S&#39;, &#39;UB2S&#39;, &#39;UB3S&#39; )&#10;              THEN &#39;Y&#39;&#10;              ELSE &#39;N&#39;&#10;          END AS tier_A_or_B,&#10;          --&#10;          -- 02 A sentence of a type for an offence flagged as a schedule 15 sexual offence is recorded on this event&#10;          ( SELECT COUNT(1)&#10;            FROM&#10;              main_offence MO&#10;                INNER JOIN r_offence R ON R.offence_id &#61; MO.offence_id&#10;            WHERE MO.event_id &#61; E.event_id&#10;              AND MO.soft_deleted &#61; 0&#10;              AND R.schedule15_sexual_offence &#61; &#39;Y&#39;&#10;          ) AS qty_schedule15_sexual_offence,&#10;          --&#10;          -- 03 A sentence of a type for an offence flagged as a Modern Day Slavery Act (2015) is recorded on this event (R_OFFENCE.modern_day_slavery}&#10;          ( SELECT COUNT(1)&#10;            FROM&#10;              main_offence MO&#10;                INNER JOIN r_offence R ON R.offence_id &#61; MO.offence_id&#10;            WHERE MO.event_id &#61; E.event_id&#10;              AND MO.soft_deleted &#61; 0&#10;              AND R.modern_day_slavery &#61; &#39;Y&#39;&#10;          ) AS qty_modern_day_slavery_offence,&#10;          --&#10;          -- 04 A custodial sentence of 12 months or more for an offence a type flagged as a schedule 15 violent offence is recorded on this event&#10;          ( SELECT COUNT(1)&#10;            FROM&#10;              main_offence MO&#10;                INNER JOIN r_offence R ON R.offence_id &#61; MO.offence_id&#10;            WHERE MO.event_id &#61; E.event_id&#10;              AND MO.soft_deleted &#61; 0&#10;              AND R.schedule15_violent_offence &#61; &#39;Y&#39;&#10;              AND D.length &gt;&#61; 12&#10;          ) AS qty_schedule15_violent_offence,&#10;          --&#10;          -- 05 A custodial sentence of 12 months or more for an offence a type flagged as a Child Abduction act (1984) is recorded on this event {R_OFFENCE.child_abduction}&#10;          ( SELECT COUNT(1)&#10;            FROM&#10;              main_offence MO&#10;                INNER JOIN r_offence R ON R.offence_id &#61; MO.offence_id&#10;            WHERE MO.event_id &#61; E.event_id&#10;              AND MO.soft_deleted &#61; 0&#10;              AND R.child_abduction &#61; &#39;Y&#39;&#10;              AND D.length &gt;&#61; 12&#10;          ) AS qty_child_abduction_offence,&#10;          --&#10;          -- 05a a custodial sentence of 12 months or more for an offence of type 00867, Controlling or Coercive Behaviour in an intimate or family relationship, is recorded on this event&#10;          -- 05b a suspended sentence order of 12 months or more for an offence of type 00867, Controlling or Coercive Behaviour in an intimate or family relationship, is recorded on this event&#10;          ( SELECT COUNT(1)&#10;            FROM&#10;              main_offence MO&#10;                INNER JOIN r_offence R ON R.offence_id &#61; MO.offence_id&#10;            WHERE MO.event_id &#61; E.event_id&#10;              AND MO.soft_deleted &#61; 0&#10;              AND R.code IN ( &#39;00867&#39; )&#10;              AND D.length &gt;&#61; 12&#10;          ) AS qty_ctrl_behaviour_offence,&#10;          --&#10;          --&#10;          -- 06 A Sentence for an offence with the Misuse of Drugs Act (1971) with Child Concerns flag set {R_OFFENCE.drug_misuse}&#10;          --    AND an active registration with the ���Child Concerns��� Flag set {R_REGISTER_TYPE.child_concerns}&#10;          ( SELECT COUNT(1)&#10;            FROM&#10;              main_offence MO&#10;                INNER JOIN r_offence R1 ON R1.offence_id &#61; MO.offence_id&#10;                INNER JOIN registration R ON R.offender_id &#61; MO.offender_id&#10;                  INNER JOIN r_register_type RT ON RT.register_type_id &#61; R.register_type_id&#10;            WHERE MO.event_id &#61; E.event_id&#10;              AND MO.soft_deleted &#61; 0&#10;              --AND R1.code IN ( &#39;09230&#39;, &#39;09231&#39;, &#39;09232&#39;, &#39;09233&#39;, &#39;09234&#39;, &#39;09235&#39;, &#39;09239&#39; )&#10;              AND R1.drug_misuse &#61; &#39;Y&#39;&#10;              --&#10;              AND R.soft_deleted &#61; 0&#10;              AND R.deregistered &#61; 0&#10;              --AND RT.code IN ( &#39;RCCO&#39;, &#39;RCPR&#39;, &#39;RCHD&#39; )&#10;              AND RT.child_concerns &#61; &#39;Y&#39;&#10;          ) AS qty_drugs_chld_concerns_reg,&#10;          --&#10;          -- 07 An active registration with the Notifications Flag set {R_REGISTER_TYPE.notifications}&#10;          ( SELECT COUNT(1)&#10;            FROM&#10;              registration R&#10;                INNER JOIN r_register_type RT ON RT.register_type_id &#61; R.register_type_id&#10;            WHERE R.offender_id &#61; E.offender_id&#10;              AND R.soft_deleted &#61; 0&#10;              AND R.deregistered &#61; 0&#10;              --AND RT.code IN ( &#39;ALT3&#39;, &#39;ALT10&#39;, &#39;ARSO&#39;, &#39;RTAO&#39; )&#10;              AND RT.notifications &#61; &#39;Y&#39;&#10;          ) AS qty_notifications_reg,&#10;          --&#10;          -- 08 The person is a foreign national&#10;          R2.code_value       AS nationality_code,&#10;          R2.code_description AS nationality_desc,&#10;          CASE WHEN NVL(R2.code_value, &#39;BRIT&#39;) NOT IN (&#39;BRIT&#39;) THEN &#39;Y&#39; END AS foreign_national,&#10;          --&#10;          -- 09 The Community Manager (COM) is in the Wales Provider (N03)&#10;          OM.probation_area_id,&#10;          CASE WHEN ( PA.code &#61; &#39;N03&#39; ) THEN &#39;Y&#39; END AS welsh_provider,&#10;          PA.code                                    AS probation_area_code,&#10;          --&#10;          PKG_Lookups.funcgetTabRecord_CACHED(&#10;              p_table     &#61;&gt; &#39;team&#39;,&#10;              p_ref_col   &#61;&gt; &#39;code&#39;,&#10;              p_ref_val   &#61;&gt; PA.code || &#39;AAT&#39;,&#10;              p_data_fld  &#61;&gt; &#39;team_id&#39;,&#10;              p_where     &#61;&gt; &#39;probation_area_id &#61; :p_area_id&#39;,&#10;              p_bind_var1 &#61;&gt; PA.probation_area_id&#10;          ) AS CAS_team_id,&#10;          --&#10;          PKG_Lookups.funcgetTabRecord_CACHED(&#10;              p_table     &#61;&gt; &#39;staff&#39;,&#10;              p_ref_col   &#61;&gt; &#39;officer_code&#39;,&#10;              p_ref_val   &#61;&gt; PA.code || &#39;AATH&#39;,&#10;              p_data_fld  &#61;&gt; &#39;staff_id&#39;,&#10;              p_where     &#61;&gt; &#39;probation_area_id &#61; :p_area_id&#39;,&#10;              p_bind_var1 &#61;&gt; PA.probation_area_id&#10;          ) AS CAS_staff_id,&#10;          --&#10;          PKG_CAS_SUPPORT.get_CAS_sentenced_flag(D.disposal_type_id)                AS sentenced_flag,&#10;          PKG_CAS_SUPPORT.get_CAS_custodial_order_flag(D.disposal_type_id)          AS custodial_order_flag,&#10;          PKG_CAS_SUPPORT.get_CAS_suspended_sentense_order_flag(D.disposal_type_id) AS suspended_sentense_flag,&#10;          --&#10;          CAS.case_allocation_id     AS case_allocation_id_OLD,&#10;          CAS.allocation_decision_id AS allocation_decision_id_OLD,&#10;          --&#10;          R1.code_value              AS allocation_decision_code_OLD,&#10;          PKG_Lookups.funcgetTabRecord(&#10;              p_table     &#61;&gt; &#39;contact C INNER JOIN r_contact_type CT ON CT.contact_type_id &#61; C.contact_type_id&#39;,&#10;              p_ref_col   &#61;&gt; &#39;C.event_id&#39;,&#10;              p_ref_val   &#61;&gt; E.event_id,&#10;              p_where     &#61;&gt; &#39;C.soft_deleted &#61; 0 AND CT.code &#61; :p_contact_type_code&#39;,&#10;              p_bind_var1 &#61;&gt; &#39;ICAD&#39;,&#10;              p_data_fld &#61;&gt; &#39;COUNT(1)&#39;&#10;          ) AS qty_icad_contact,&#10;          --&#10;          CAS.rsr_score,&#10;          CAS.osp_score,&#10;          PKG_Lookups.funcgetStdRefListCodeDesc(CAS.rsr_level_id  ) AS rsr_level,&#10;          --&#10;          PKG_Lookups.funcgetStdRefListCodeDesc(CAS.osp_level_i_id) AS osp_level_i,&#10;          PKG_Lookups.funcgetStdRefListCodeDesc(CAS.osp_level_c_id) AS osp_level_c,&#10;          --&#10;          PKG_Lookups.funcgetStdRefListCodeDesc(CAS.osp_level_indirect_indecent_id) AS osp_level_iic,&#10;          PKG_Lookups.funcgetStdRefListCodeDesc(CAS.osp_level_direct_contact_id)    AS osp_level_dc,&#10;          --&#10;          CAS.allocation_decision_notes,&#10;          CAS.allocation_decision_date&#10;          --&#10;        FROM&#10;          event E&#10;            INNER JOIN disposal D ON D.event_id &#61; E.event_id&#10;              --INNER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;            LEFT OUTER JOIN case_allocation CAS ON CAS.event_id &#61; E.event_id AND&#10;                                                   CAS.case_allocation_id &#61; (SELECT MAX(case_allocation_id) FROM case_allocation WHERE event_id &#61; CAS.event_id)&#10;              LEFT OUTER JOIN r_standard_reference_list R1 ON R1.standard_reference_list_id &#61; CAS.allocation_decision_id&#10;            INNER JOIN offender_manager OM ON OM.offender_id &#61; E.offender_id AND OM.active_flag &#61; 1&#10;              INNER JOIN probation_area PA ON PA.probation_area_id &#61; OM.probation_area_id&#10;            INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;              LEFT OUTER JOIN r_standard_reference_list R2 ON R2.standard_reference_list_id &#61; O.nationality_id&#10;        WHERE 1&#61;1&#10;          AND E.offender_id &#61; p_offender_id&#10;          AND E.soft_deleted &#61; 0&#10;          AND D.soft_deleted &#61; 0&#10;          AND O.soft_deleted &#61; 0&#10;          AND OM.soft_deleted &#61; 0&#10;          --AND E.active_flag &#61; 1&#10;          AND D.termination_date IS NULL&#10;          --&#10;      ),&#10;      CAS1 AS (&#10;        SELECT&#10;          CAS.*,&#10;          --&#10;          CASE WHEN&#10;              sentenced_flag &#61; &#39;Y&#39;&#10;              AND ( -- The Person has a Tier of A or B&#10;                    tier_A_or_B &#61; &#39;Y&#39; OR&#10;                    -- A sentence for a schedule 15 sexual offence is recorded on this event&#10;                    qty_schedule15_sexual_offence &gt; 0 OR&#10;                    -- A sentence of a type for an offence flagged as a Modern Day Slavery Act (2015) is recorded on this event (R_OFFENCE.modern_day_slavery}&#10;                    qty_modern_day_slavery_offence &gt; 0 OR&#10;                    -- A custodial sentence of 12 months or more for a schedule 15 violent offence is recorded on this event&#10;                    (custodial_order_flag &#61; &#39;Y&#39; AND qty_schedule15_violent_offence &gt; 0) OR&#10;                    -- A custodial sentence of 12 months or more for an offence a type flagged as a Child Abduction act (1984) is recorded on this event {R_OFFENCE.child_abduction}&#10;                    (custodial_order_flag &#61; &#39;Y&#39; AND qty_child_abduction_offence &gt; 0) OR&#10;                    -- A custodial sentence of 12 months or more for an offence of type 00867, Controlling or Coercive Behaviour in an intimate or family relationship, is recorded on this event&#10;                    (custodial_order_flag &#61; &#39;Y&#39; AND qty_ctrl_behaviour_offence &gt; 0) OR&#10;                    -- A suspended sentence order of 12 months or more for an offence of type 00867, Controlling or Coercive Behaviour in an intimate or family relationship, is recorded on this event&#10;                    (suspended_sentense_flag &#61; &#39;Y&#39; AND qty_ctrl_behaviour_offence &gt; 0) OR&#10;                    -- DST-12616: Active Registration of&#10;                    qty_drugs_chld_concerns_reg &gt; 0 OR&#10;                    qty_notifications_reg       &gt; 0 OR&#10;                    --&#10;                    /*DST-14400: remove FNOs and Wales from the CAS calculation&#10;                    foreign_national &#61; &#39;Y&#39; OR&#10;                    --&#10;                    -- The Offender Manager (COM) is in the Wales Provider (N03)&#10;                    welsh_provider &#61; &#39;Y&#39;*/&#10;                    1&lt;&gt;1&#10;                  )&#10;          THEN&#10;              &#39;R&#39; --Retained/ Enhanced Resourcing&#10;          ELSE&#10;              &#39;A&#39; --Allocated/Normal Resourcing&#10;          END AS allocation_decision_code_NEW&#10;          --&#10;        FROM CAS )&#10;    --&#10;    SELECT&#10;      CAS1.*,&#10;      PKG_Lookups.funcgetStdRefListID(&#39;ALLOCATION DECISION&#39;, allocation_decision_code_NEW) AS allocation_decision_id_NEW,&#10;      CASE&#10;          WHEN CAS1.allocation_decision_date &lt;&#61;&#10;               TO_DATE( PKG_Lookups.funcgetTabRecord_CACHED(p_table &#61;&gt; &#39;ND_PARAMETER&#39;,&#10;                p_data_fld    &#61;&gt; &#39;TRIM(nd_value_string)&#39;,&#10;                p_ref_col     &#61;&gt; &#39;nd_parameter&#39;,&#10;                p_ref_val     &#61;&gt; &#39;CAS_AUTOMATED_CALCULATION&#39;),&#10;            &#39;DD-MON-YYYY HH24:MI:SS&#39; )&#10;          THEN &#39;Y&#39;&#10;          ELSE &#39;N&#39;&#10;      END AS cas_manual_flag_OLD&#10;      --&#10;    FROM CAS1&#10;    WHERE 1&#61;1&#10;      AND event_id &#61; NVL(p_event_id, event_id)&#10;    ORDER BY&#10;      crn,&#10;      event_number,&#10;      case_allocation_id_OLD DESC;&#10;    --&#10;    l_rec cs%ROWTYPE;&#10;    --&#10;    l_debug_flag BOOLEAN;&#10;    --&#10;    PROCEDURE do_init&#10;    IS&#10;        --&#10;        PROCEDURE do_set_user&#10;        IS&#10;            --&#10;            lc_CAS_user_name CONSTANT VARCHAR2(30) :&#61; &#39;HandoverCalculationUser&#39;;&#10;            --&#10;        BEGIN&#10;            --&#10;            IF NVL(p_nd_user_flag, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;                l_distinguished_name :&#61; NVL(SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;), lc_CAS_user_name);&#10;            ELSE&#10;                l_distinguished_name :&#61; lc_CAS_user_name;&#10;            END IF;&#10;            --&#10;            LC_USER_ID :&#61; PKG_Lookups.GetUserID(l_distinguished_name);&#10;            --&#10;            IF LC_USER_ID IS NULL THEN&#10;                l_distinguished_name :&#61; &#39;DELIUS_SYSTEM_USER&#39;;&#10;                LC_USER_ID :&#61; PKG_Lookups.GetUserID(l_distinguished_name);&#10;            END IF;&#10;            --&#10;        END do_set_user;&#10;        --&#10;    BEGIN&#10;        --&#10;        do_set_user;&#10;        --&#10;        l_debug_flag :&#61; (PKG_Lookups.funcgetNDParameterValue(&#39;CAS_DEBUG_FLAG&#39;, &#39;0&#39;) &#61; &#39;1&#39;);&#10;        --&#10;        IF l_debug_flag THEN&#10;            --&#10;            l_crn :&#61;&#10;                PKG_Lookups.funcgetTabRecord(&#10;                    p_table     &#61;&gt; &#39;offender&#39;,&#10;                    p_ref_col   &#61;&gt; &#39;offender_id&#39;,&#10;                    p_ref_val   &#61;&gt; p_offender_id,&#10;                    p_data_fld  &#61;&gt; &#39;crn&#39; );&#10;            --&#10;            l_active_OM_details :&#61;&#10;                PKG_Lookups.funcgetTabRecord(&#10;                    p_table     &#61;&gt; &#39;offender_manager OM INNER JOIN probation_area PA ON PA.probation_area_id&#61;OM.probation_area_id&#39;,&#10;                    p_ref_col   &#61;&gt; &#39;OM.offender_id&#39;,&#10;                    p_ref_val   &#61;&gt; p_offender_id,&#10;                    p_data_fld  &#61;&gt; &#39;OM.offender_manager_id || &#39;&#39; &#39;&#39; || PA.code&#39;,&#10;                    p_where     &#61;&gt; &#39;OM.end_date IS NULL&#39; );&#10;            --&#10;        END IF;&#10;        --&#10;    END do_init;&#10;    --&#10;    PROCEDURE do_debug(p_msg VARCHAR2, p_label VARCHAR2) IS&#10;    BEGIN&#10;        IF l_debug_flag THEN&#10;            warn( p_msg, l_proc, p_label );&#10;        END IF;&#10;    END do_debug;&#10;    --&#10;    PROCEDURE do_cr_CAS_staff_team&#10;    IS&#10;        --&#10;        l_ins_st_flag BOOLEAN :&#61; FALSE;&#10;        --&#10;    BEGIN&#10;        --&#10;        l_ins_st_flag :&#61; FALSE;&#10;        --&#10;        IF l_rec.CAS_team_id IS NULL THEN&#10;            --&#10;            l_ins_st_flag :&#61; TRUE;&#10;            l_rec.CAS_team_id :&#61; team_id_SEQ.nextval;&#10;            --&#10;            INSERT INTO team(&#10;              team_id,&#10;              code,&#10;              description,&#10;              district_id,&#10;              local_delivery_unit_id,&#10;              unpaid_work_team,&#10;              row_version,&#10;              start_date,&#10;              end_date,&#10;              created_datetime,&#10;              created_by_user_id,&#10;              last_updated_datetime,&#10;              last_updated_user_id,&#10;              probation_area_id,&#10;              private&#10;            ) VALUES (&#10;              l_rec.CAS_team_id,&#10;              l_rec.probation_area_code || &#39;AAT&#39;,&#10;              &#39;Automated Allocation Team&#39;,&#10;              PKG_LOOKUPS.getdistrictid(l_rec.probation_area_code || &#39;NPSA&#39;),&#10;              PKG_LOOKUPS.getlduid(lducode_in &#61;&gt; l_rec.probation_area_code || &#39;NPS1&#39;, probationareaid_in &#61;&gt; l_rec.probation_area_id),&#10;              &#39;N&#39;,&#10;              1,&#10;              TRUNC(SYSDATE),&#10;              TRUNC(SYSDATE),&#10;              SYSDATE,&#10;              4,&#10;              SYSDATE,&#10;              4,&#10;              l_rec.probation_area_id,&#10;              0 );&#10;        END IF;&#10;        --&#10;        IF l_rec.CAS_staff_id IS NULL THEN&#10;            --&#10;            l_ins_st_flag :&#61; TRUE;&#10;            l_rec.CAS_staff_id :&#61; staff_id_SEQ.nextval;&#10;            --&#10;            INSERT INTO staff(&#10;              staff_id,&#10;              start_date,&#10;              surname,&#10;              end_date,&#10;              forename,&#10;              forename2,&#10;              row_version,&#10;              officer_code,&#10;              created_by_user_id,&#10;              last_updated_user_id,&#10;              created_datetime,&#10;              last_updated_datetime,&#10;              private,&#10;              probation_area_id&#10;            ) VALUES (&#10;              l_rec.CAS_staff_id,&#10;              SYSDATE,&#10;              &#39;Service&#39;,&#10;              NULL,&#10;              &#39;Tiering&#39;,&#10;              &#39;&#39;,&#10;              1,&#10;              l_rec.probation_area_code || &#39;AATH&#39;,&#10;              4,&#10;              4,&#10;              SYSDATE,&#10;              SYSDATE,&#10;              0,&#10;              l_rec.probation_area_id );&#10;            --&#10;        END IF;&#10;        --&#10;        IF l_ins_st_flag THEN&#10;            INSERT INTO staff_team(&#10;              staff_id,&#10;              team_id,&#10;              row_version,&#10;              created_by_user_id,&#10;              created_datetime,&#10;              last_updated_user_id,last_updated_datetime&#10;            ) VALUES (&#10;              l_rec.CAS_staff_id,&#10;              l_rec.CAS_team_id,&#10;              1,&#10;              4,&#10;              SYSDATE,&#10;              4,&#10;              SYSDATE );&#10;        END IF;&#10;        --&#10;    END do_cr_CAS_staff_team;&#10;    --&#10;    PROCEDURE do_create_cas_contact(p_i_u_flag VARCHAR2)&#10;    IS&#10;        --&#10;        l_contact_id NUMBER :&#61; contact_id_SEQ.nextval;&#10;        --&#10;    BEGIN&#10;        --&#10;        -- DST-13385: Handle edge cases when integration OASys API has been invoked for new ICAD&#10;        -- to show rsr/osp values in the contact notes&#10;        --&#10;        IF p_api_flag &#61; &#39;Y&#39; AND p_i_u_flag &#61; &#39;I&#39; AND l_rec.case_allocation_id_OLD IS NULL&#10;        THEN&#10;            --&#10;            l_rec.rsr_score     :&#61; p_rsr_score;&#10;            l_rec.rsr_level     :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(p_rsr_level_id);&#10;            --&#10;            l_rec.osp_level_i   :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(p_osp_level_i_id);&#10;            l_rec.osp_level_c   :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(p_osp_level_c_id);&#10;            --&#10;            l_rec.osp_level_iic :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(p_osp_level_iic_id);&#10;            l_rec.osp_level_dc  :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(p_osp_level_dc_id);&#10;            --&#10;        END IF;&#10;        --&#10;        INSERT INTO contact(&#10;          contact_id,&#10;          offender_id,&#10;          event_id,&#10;          --&#10;          contact_date,&#10;          --&#10;          contact_type_id,&#10;          --&#10;          notes,&#10;          --&#10;          team_id,&#10;          staff_id,&#10;          --&#10;          visor_contact,&#10;          visor_exported,&#10;          --&#10;          soft_deleted,&#10;          partition_area_id,&#10;          row_version,&#10;          --&#10;          created_by_user_id,&#10;          created_datetime,&#10;          last_updated_user_id,&#10;          last_updated_datetime )&#10;        SELECT&#10;          l_contact_id                     AS contact_id,&#10;          p_offender_id                    AS offender_id,&#10;          l_rec.event_id                   AS event_id,&#10;          --&#10;          TRUNC(LC_DATE_TIME)              AS contact_date,&#10;          --&#10;          PKG_Lookups.funcgetTabRecord_CACHED(&#10;              p_table &#61;&gt; &#39;r_contact_type&#39;,&#10;              p_ref_col  &#61;&gt; &#39;code&#39;,&#10;              p_ref_val  &#61;&gt; p_i_u_flag || &#39;CAD&#39;,&#10;              p_data_fld &#61;&gt; &#39;contact_type_id&#39;&#10;          ) AS contact_type_id,&#10;          --&#10;          PKG_LstUtl.concat(&#10;              PKG_LstUtl.add_prefix(&#39;A new tier of A or B is recorded: &#39;,&#10;                  CASE WHEN l_rec.tier_A_or_B &#61; &#39;Y&#39; THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Sentence for a schedule 15 sexual offence is recorded: &#39;,&#10;                  CASE WHEN l_rec.qty_schedule15_sexual_offence &gt; 0 THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Sentence of a type for an offence flagged as a Modern Day Slavery Act (2015) is recorded: &#39;,&#10;                  CASE WHEN l_rec.qty_modern_day_slavery_offence &gt; 0 THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Custodial sentence of 12 months or more for a schedule 15 violent offence is recorded: &#39;,&#10;                  CASE WHEN (l_rec.custodial_order_flag &#61; &#39;Y&#39; AND l_rec.qty_schedule15_violent_offence &gt; 0) THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Custodial sentence of 12 months or more for an offence a type flagged as a Child Abduction act (1984) is recorded: &#39;,&#10;                  CASE WHEN (l_rec.custodial_order_flag &#61; &#39;Y&#39; AND l_rec.qty_child_abduction_offence &gt; 0) THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Custodial sentence of 12 months or more for an offence of a type 00867, Controlling or Coercive Behaviour in an intimate or family relationship is recorded: &#39;,&#10;                  CASE WHEN (l_rec.custodial_order_flag &#61; &#39;Y&#39; AND l_rec.qty_ctrl_behaviour_offence &gt; 0) THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Suspended sentence of 12 months or more for an offence of a type 00867, Controlling or Coercive Behaviour in an intimate or family relationship is recorded: &#39;,&#10;                  CASE WHEN (l_rec.suspended_sentense_flag &#61; &#39;Y&#39; AND l_rec.qty_ctrl_behaviour_offence &gt; 0) THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Drug Offences and Child Concerns: &#39;,&#10;                  CASE WHEN l_rec.qty_drugs_chld_concerns_reg &gt; 0 THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Subject to Notification requirements: &#39;,&#10;                  CASE WHEN l_rec.qty_notifications_reg &gt; 0 THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              /*DST-14400: not required anymore&#10;              PKG_LstUtl.add_prefix(&#39;The person is a foreign national: &#39;,&#10;                  CASE WHEN l_rec.foreign_national &#61; &#39;Y&#39; THEN &#39;Yes&#39; ELSE &#39;No&#39; END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Community Manager (COM) is in the Wales Region: &#39;,&#10;                  CASE WHEN l_rec.welsh_provider &#61; &#39;Y&#39; THEN &#39;Yes&#39; ELSE &#39;No&#39; END),*/&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Case Allocation Decision: &#39;,&#10;                  CASE&#10;                      WHEN l_rec.allocation_decision_code_NEW &#61; &#39;R&#39; THEN &#39;Retained (enhanced resourcing)&#39;&#10;                      WHEN l_rec.allocation_decision_code_NEW &#61; &#39;A&#39; THEN &#39;Allocated (normal resourcing)&#39;&#10;                  END),&#10;              --&#10;              PKG_LstUtl.add_prefix(&#39;Case Allocation Date: &#39;, TO_CHAR(TRUNC(LC_DATE_TIME), &#39;DD/MM/YYYY&#39;)),&#10;              --&#10;              &#39;RSR Percentage Score: &#39; || PKG_Common.number_2_char(l_rec.rsr_score), -- RSR_SCORE Displays a Percentage Score (previously known as RSR Score) as per the CAS Screen&#10;              &#39;OSP Score: &#39;            || PKG_Common.number_2_char(l_rec.osp_score), -- OSP_SCORE Displays the OSP Score as per the CAS Screen&#10;              &#39;RSR Level: &#39;            || l_rec.rsr_level  , -- RSR_LEVEL_ID   Displays the Level as per the CAS Screen&#10;              --&#10;              &#39;OSP Level (i): &#39;        || l_rec.osp_level_i, -- OSP_LEVEL_I_ID Displays the OSP Level  as per the CAS Screen - Note Jira is formatting this automatically - should be &quot;( i )&quot; - but without the spaces.&#10;              &#39;OSP Level (c): &#39;        || l_rec.osp_level_c, -- OSP_LEVEL_C_ID Displays the OSP Level (c) as per the CAS Screen&#10;              -- Added as per DST-16367&#10;              &#39;OSP Level IIC: &#39;        || l_rec.osp_level_iic,&#10;              &#39;OSP Level DC: &#39;         || l_rec.osp_level_dc,&#10;              --&#10;              CASE WHEN p_i_u_flag &#61; &#39;U&#39; THEN&#10;                  PKG_LstUtl.add_prefix(&#39;Notes: &#39;, l_rec.allocation_decision_notes)&#10;              END,&#10;              --&#10;              p_delim &#61;&gt; CHR(10)&#10;          )                                AS notes,&#10;          --&#10;          l_rec.CAS_team_id                AS CAS_team_id,&#10;          l_rec.CAS_staff_id               AS CAS_staff_id,&#10;          --&#10;          &#39;N&#39;                              AS visor_contact,&#10;          &#39;N&#39;                              AS visor_exported,&#10;          --&#10;          0                                AS soft_deleted,&#10;          0                                AS partition_area_id,&#10;          0                                AS row_version,&#10;          --&#10;          LC_USER_ID                       AS created_by_user_id,&#10;          LC_DATE_TIME                     AS created_datetime,&#10;          LC_USER_ID                       AS last_updated_user_id,&#10;          LC_DATE_TIME                     AS last_updated_datetime&#10;        FROM dual;&#10;        --&#10;    END do_create_cas_contact;&#10;    --&#10;    PROCEDURE do_ins_cas&#10;    IS&#10;        --&#10;        l_case_allocation_id NUMBER :&#61; case_allocation_id_SEQ.nextval;&#10;        --&#10;    BEGIN&#10;        --&#10;        INSERT INTO case_allocation(&#10;          case_allocation_id,&#10;          offender_id,&#10;          event_id,&#10;          --&#10;          allocation_decision_id,&#10;          allocation_decision_date,&#10;          --&#10;          decision_provider_id,&#10;          decision_team_id,&#10;          decision_staff_id,&#10;          --&#10;          row_version,&#10;          --&#10;          created_by_user_id,&#10;          created_datetime,&#10;          last_updated_user_id,&#10;          last_updated_datetime )&#10;        SELECT&#10;          l_case_allocation_id             AS case_allocation_id,&#10;          p_offender_id                    AS offender_id,&#10;          l_rec.event_id                   AS event_id,&#10;          --&#10;          l_rec.allocation_decision_id_NEW AS allocation_decision_id,&#10;          LC_DATE_TIME                     AS allocation_decision_date,&#10;          --&#10;          NULL                             AS decision_provider_id,&#10;          NULL                             AS decision_team_id,&#10;          NULL                             AS decision_staff_id,&#10;          --&#10;          0                                AS row_version,&#10;          --&#10;          LC_USER_ID                       AS created_by_user_id,&#10;          LC_DATE_TIME                     AS created_datetime,&#10;          LC_USER_ID                       AS last_updated_user_id,&#10;          LC_DATE_TIME                     AS last_updated_datetime&#10;        FROM dual;&#10;        --&#10;        do_create_cas_contact(&#39;I&#39;);&#10;        --&#10;    END do_ins_cas;&#10;    --&#10;    PROCEDURE do_upd_cas IS&#10;    BEGIN&#10;        --&#10;        UPDATE case_allocation SET&#10;          --&#10;          allocation_decision_id   &#61; l_rec.allocation_decision_id_NEW,&#10;          allocation_decision_date &#61; LC_DATE_TIME,&#10;          --&#10;          --decision_provider_id,&#10;          --decision_team_id,&#10;          --decision_staff_id,&#10;          --&#10;          row_version &#61; row_version + 1,&#10;          --&#10;          last_updated_user_id  &#61; LC_USER_ID,&#10;          last_updated_datetime &#61; LC_DATE_TIME&#10;          --&#10;        WHERE case_allocation_id &#61; l_rec.case_allocation_id_OLD;&#10;        --&#10;        -- DST-12552: When a CAS is sentenced and the CAS has a Decision of &quot;Not Yet Assessed&quot; and ICAD contact has not already been created&#10;        --            then it will need to be created rather than a UCAD contact.&#10;        IF l_rec.qty_icad_contact &#61; 0 THEN&#10;            do_create_cas_contact(&#39;I&#39;);&#10;        ELSE --l_rec.allocation_decision_code_OLD &#61; &#39;N&#39;&#10;            do_create_cas_contact(&#39;U&#39;);&#10;        END IF;&#10;        --&#10;    END do_upd_cas;&#10;    --&#10;BEGIN&#10;    --&#10;    do_init;&#10;    --&#10;    IF l_debug_flag THEN&#10;        do_debug(&#10;            &#39;Start the CAS process &#39; ||&#10;            &#39;[usr&#61;&#39;         || SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;) || &#39;]&#39; ||&#10;            &#39;[CAS_usr&#61;&#39;     || l_distinguished_name                        || &#39;]&#39; ||&#10;            &#39;[crn&#61;&#39;         || l_crn               || &#39;]&#39; ||&#10;            &#39;[offender_id&#61;&#39; || p_offender_id       || &#39;]&#39; ||&#10;            &#39;[event_id&#61;&#39;    || p_event_id          || &#39;]&#39; ||&#10;            &#39;[nd_usr&#61;&#39;      || p_nd_user_flag      || &#39;]&#39; ||&#10;            &#39;[curr_OM&#61;&#39;     || l_active_OM_details || &#39;]&#39;,&#10;            --&#10;            &#39;001&#39; );&#10;    END IF;&#10;    --&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        l_rows :&#61; l_rows + 1;&#10;        --&#10;        IF p_create_CAS_staff_team &#61; &#39;Y&#39; THEN&#10;            do_cr_CAS_staff_team;&#10;        END IF;&#10;        --&#10;        IF l_rec.CAS_team_id IS NULL OR l_rec.CAS_staff_id IS NULL THEN&#10;            --&#10;            PKG_TriggerSupport.do_CAS_Deferred_tab_delete(l_rec.offender_id);&#10;            --&#10;            fatal(&#10;                &#39;Failed to identify CAS Team/Staff for the &#39; ||&#10;                &#39;[crn&#61;&#39;                        || l_rec.CRN                             || &#39;]&#39; ||&#10;                &#39;[event_number&#61;&#39;               || l_rec.event_number                    || &#39;]&#39; ||&#10;                &#39;[area_code&#61;&#39;                  || l_rec.probation_area_code             || &#39;]&#39; ||&#10;                &#39;[tier_A_or_B&#61;&#39;                || l_rec.tier_A_or_B                     || &#39;]&#39; ||&#10;                --&#10;                &#39;[schedule15_sexual_offence&#61;&#39;  || l_rec.qty_schedule15_sexual_offence   || &#39;]&#39; ||&#10;                &#39;[modern_day_slavery_offence&#61;&#39; || l_rec.qty_modern_day_slavery_offence  || &#39;]&#39; ||&#10;                &#39;[schedule15_violent_offence&#61;&#39; || l_rec.qty_schedule15_violent_offence  || &#39;]&#39; ||&#10;                &#39;[child_abduction_offence&#61;&#39;    || l_rec.qty_child_abduction_offence     || &#39;]&#39; ||&#10;                &#39;[ctrl_behaviour_offence&#61;&#39;     || l_rec.qty_ctrl_behaviour_offence      || &#39;]&#39; ||&#10;                --&#10;                &#39;[drugs_chld_concerns_reg&#61;&#39;    || l_rec.qty_drugs_chld_concerns_reg     || &#39;]&#39; ||&#10;                &#39;[notifications_reg&#61;&#39;          || l_rec.qty_notifications_reg           || &#39;]&#39; ||&#10;                --&#10;                &#39;[nationality_code&#61;&#39;           || l_rec.nationality_code                || &#39;]&#39; ||&#10;                --&#10;                &#39;[CAS_team_id&#61;&#39;                || l_rec.CAS_team_id                     || &#39;]&#39; ||&#10;                --&#10;                &#39;[CAS_staff_id&#61;&#39;               || l_rec.CAS_staff_id                    || &#39;]&#39; ||&#10;                --&#10;                &#39;[case_alloc_id_OLD&#61;&#39;          || l_rec.case_allocation_id_OLD          || &#39;]&#39; ||&#10;                &#39;[alloc_decision_id_OLD&#61;&#39;      || l_rec.allocation_decision_id_OLD      || &#39;]&#39; ||&#10;                --&#10;                &#39;[alloc_decision_id_NEW&#61;&#39;      || l_rec.allocation_decision_id_NEW      || &#39;]&#39;,&#10;                --&#10;                &#39;procCalculateCAS&#39; );&#10;            --&#10;            RETURN;&#10;        END IF;&#10;        --&#10;        IF l_debug_flag THEN&#10;            do_debug(&#10;                PKG_LstUtl.concat(&#10;                    &#39;CAS process &#39; ||&#10;                    &#39;[usr&#61;&#39;                        || SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;) || &#39;]&#39; ||&#10;                    --&#39;[CAS_usr&#61;&#39;                    || l_distinguished_name                  || &#39;]&#39;,&#10;                    &#39;[crn&#61;&#39;                        || l_rec.CRN                             || &#39;]&#39;,&#10;                    &#39;[event_number&#61;&#39;               || l_rec.event_number                    || &#39;]&#39;,&#10;                    &#39;[area_code&#61;&#39;                  || l_rec.probation_area_code             || &#39;]&#39;,&#10;                    &#39;[tier_A_or_B&#61;&#39;                || l_rec.tier_A_or_B                     || &#39;]&#39;,&#10;                    --&#10;                    &#39;[schedule15_sexual_offence&#61;&#39;  || l_rec.qty_schedule15_sexual_offence   || &#39;]&#39;,&#10;                    &#39;[modern_day_slavery_offence&#61;&#39; || l_rec.qty_modern_day_slavery_offence  || &#39;]&#39;,&#10;                    &#39;[schedule15_violent_offence&#61;&#39; || l_rec.qty_schedule15_violent_offence  || &#39;]&#39;,&#10;                    &#39;[child_abduction_offence&#61;&#39;    || l_rec.qty_child_abduction_offence     || &#39;]&#39;,&#10;                    &#39;[qty_ctrl_behaviour_offence&#61;&#39; || l_rec.qty_ctrl_behaviour_offence      || &#39;]&#39;,&#10;                    --&#10;                    &#39;[drugs_chld_concerns_reg&#61;&#39;    || l_rec.qty_drugs_chld_concerns_reg     || &#39;]&#39;,&#10;                    &#39;[notifications_reg&#61;&#39;          || l_rec.qty_notifications_reg           || &#39;]&#39;,&#10;                    --&#10;                    &#39;[sentenced_flag&#61;&#39;             || l_rec.sentenced_flag                  || &#39;]&#39;,&#10;                    &#39;[custodial_order_flag&#61;&#39;       || l_rec.custodial_order_flag            || &#39;]&#39;,&#10;                    &#39;[suspended_sentense_flag&#61;&#39;    || l_rec.suspended_sentense_flag         || &#39;]&#39;,&#10;                    --&#10;                    &#39;[nationality_code&#61;&#39;           || l_rec.nationality_code                || &#39;]&#39;,&#10;                    --&#10;                    &#39;[CAS_team_id&#61;&#39;                || l_rec.CAS_team_id                     || &#39;]&#39;,&#10;                    &#39;[CAS_staff_id&#61;&#39;               || l_rec.CAS_staff_id                    || &#39;]&#39;,&#10;                    --&#10;                    &#39;[case_alloc_id_OLD&#61;&#39;          || l_rec.case_allocation_id_OLD          || &#39;]&#39;,&#10;                    &#39;[alloc_decision_id_OLD&#61;&#39;      || l_rec.allocation_decision_id_OLD      || &#39;]&#39;,&#10;                    --&#10;                    &#39;[alloc_decision_id_NEW&#61;&#39;      || l_rec.allocation_decision_id_NEW      || &#39;]&#39;,&#10;                    --&#10;                    p_delim&#61;&gt;CHR(10) ),&#10;                --&#10;                &#39;002&#39; );&#10;        END IF;&#10;        --&#10;        IF l_rec.case_allocation_id_OLD IS NULL THEN&#10;            -- If there is no CAS against the Event, and a Re-calculation has been triggered, then a new CAS should be created against the Event.&#10;            -- When a CAS is created by the Automation System, then it should be populated as per Story DST-11720, and a new Contact should be created as per Story DST-11717.&#10;            do_ins_cas;&#10;            --&#10;        ELSE&#10;            IF l_rec.allocation_decision_id_NEW &lt;&gt; l_rec.allocation_decision_id_OLD THEN&#10;                -- If there is a CAS against the Event, and a Re-calculation has been triggered, and the CAS Decision has changed, then the CAS should be updated.&#10;                --- When a CAS is updated by the Automation System, then it should be populated as per Story DST-11720, and a new Contact should be created as per Story DST-11719.&#10;                do_upd_cas;&#10;            ELSIF l_rec.allocation_decision_id_NEW &#61; l_rec.allocation_decision_id_OLD AND&#10;                  l_rec.cas_manual_flag_OLD &#61; &#39;Y&#39; AND&#10;                  p_automated_flag &#61; &#39;Y&#39;&#10;            THEN&#10;                -- DST-13433 / DST-13434: Update CAS Allocation Decision Date (only from a specific GUI screen within ND -&#10;                --                        it sets P_AUTOMATED_FLAG to Y&#10;                do_upd_cas;&#10;            ELSE&#10;                -- If there is a CAS against the Event, and a Re-calculation has been triggered, and the CAS Decision has not changed, then the CAS should not updated.&#10;                NULL;&#10;            END IF;&#10;        END IF;&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;    IF l_debug_flag THEN&#10;        do_debug(&#10;            &#39;Completed the CAS process &#39; ||&#10;            &#39;[usr&#61;&#39;         || SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;) || &#39;]&#39; ||&#10;            &#39;[CAS_usr&#61;&#39;     || l_distinguished_name                        || &#39;]&#39; ||&#10;            &#39;[crn&#61;&#39;         || l_crn          || &#39;]&#39; ||&#10;            &#39;[offender_id&#61;&#39; || p_offender_id  || &#39;]&#39; ||&#10;            &#39;[event_id&#61;&#39;    || p_event_id     || &#39;]&#39; ||&#10;            &#39;[nd_usr&#61;&#39;      || p_nd_user_flag || &#39;]&#39; ||&#10;            &#39;[tot_rows&#61;&#39;    || l_rows         || &#39;]&#39;,&#10;            --&#10;            &#39;010&#39; );&#10;    END IF;&#10;    --&#10;END procCalculateCAS;&#10;--&#10;PROCEDURE procUpdateCAS(&#10;    p_crn                VARCHAR2,&#10;    p_event_number       NUMBER,&#10;    --&#10;    p_rsr_assessor_date  DATE,&#10;    --&#10;    p_rsr_score          NUMBER,&#10;    p_rsr_level_code     VARCHAR2, /*RSR LEVEL*/&#10;    --&#10;    p_osp_score_i        NUMBER,&#10;    p_osp_score_c        NUMBER,&#10;    p_osp_level_i_code   VARCHAR2, /*OSP Level I*/&#10;    p_osp_level_c_code   VARCHAR2, /*OSP Level C*/&#10;    -- Two new parameters (new OSP levels from the SNS notification) added as per DST-16367&#10;    p_osp_level_iic_code VARCHAR2 DEFAULT NULL, /* OSPIndirectIndecentBand */&#10;    p_osp_level_dc_code  VARCHAR2 DEFAULT NULL, /* OSPDirectContactBand    */&#10;    -- DST-19293&#10;    p_rsr_static_flag    VARCHAR2 DEFAULT NULL, /* RSRStaticOrDynamic      */&#10;    p_rsr_band           VARCHAR2 DEFAULT NULL  /* RSRBand                 */ )&#10;IS&#10;    --&#10;    l_proc CONSTANT VARCHAR2(30) :&#61; &#39;procUpdateCAS&#39;;&#10;    --&#10;    l_distinguished_name USER_.distinguished_name%TYPE;&#10;    --&#10;    LC_DATE_TIME DATE :&#61; SYSDATE;&#10;    LC_USER_ID   NUMBER;&#10;    --&#10;    l_allocation_decision_id NUMBER;&#10;    --&#10;    l_rsr_level_id     NUMBER; /*RSR LEVEL*/&#10;    --&#10;    l_osp_level_i_id   NUMBER; /*OSP Level I*/&#10;    l_osp_level_c_id   NUMBER; /*OSP Level C*/&#10;    --&#10;    l_osp_level_iic_id NUMBER; /*OSP Level ICC*/&#10;    l_osp_level_dc_id  NUMBER; /*OSP Level DC*/&#10;    --&#10;    l_event_number     NUMBER;&#10;    --&#10;    CURSOR cs IS&#10;      SELECT&#10;        O.crn,&#10;        O.offender_id,&#10;        --&#10;        O.dynamic_rsr_score,&#10;        O.iom_nominal,&#10;        O.safeguarding_issue,&#10;        O.vulnerability_issue,&#10;        --&#10;        E.event_id,&#10;        E.event_number,&#10;        E.active_flag,&#10;        E.soft_deleted,&#10;        --&#10;        D.disposal_id,&#10;        D.termination_date,&#10;        --&#10;        OM.offender_manager_id,&#10;        OM.staff_employee_id,&#10;        OM.probation_area_id,&#10;        OM.trust_provider_team_id,&#10;        --&#10;        CASE WHEN D.disposal_id IS NULL AND E.event_id IS NOT NULL THEN &#39;Y&#39; END             AS presentenced_flag,&#10;        CASE WHEN D.disposal_id IS NOT NULL AND D.termination_date IS NOT NULL THEN &#39;Y&#39; END AS terminated_flag,&#10;        --&#10;        PKG_CAS_SUPPORT.get_CAS_sentenced_flag(D.disposal_type_id)                AS sentenced_flag,&#10;        PKG_CAS_SUPPORT.get_CAS_custodial_order_flag(D.disposal_type_id)          AS custodial_order_flag,&#10;        PKG_CAS_SUPPORT.get_CAS_suspended_sentense_order_flag(D.disposal_type_id) AS suspended_sentense_flag,&#10;        --&#10;        CAS.case_allocation_id,&#10;        --&#10;        CAS.allocation_decision_id,&#10;        CAS.allocation_decision_date,&#10;        --&#10;        CAS.allocation_override_reason_id,&#10;        CAS.allocation_override,&#10;        --&#10;        CAS.rsr_score,&#10;        CAS.rsr_level_id,&#10;        CAS.rsr_assessor_provider_id,&#10;        CAS.rsr_assessor_team_id,&#10;        CAS.rsr_assessor_staff_id,&#10;        CAS.rsr_assessor_date,&#10;        --&#10;        CAS.osp_score,&#10;        CAS.osp_level_id,&#10;        CAS.osp_level_i_id,&#10;        CAS.osp_level_c_id,&#10;        --&#10;        CAS.osp_level_indirect_indecent_id,&#10;        CAS.osp_level_direct_contact_id,&#10;        --&#10;        CAS.target_provider_id,&#10;        --&#10;        CAS.decision_provider_id,&#10;        CAS.decision_team_id,&#10;        CAS.decision_staff_id,&#10;        --&#10;        CAS.created_datetime,&#10;        CAS.last_updated_datetime,&#10;        --&#10;        PKG_Lookups.funcgetTabRecord(&#10;          p_table      &#61;&gt; &#39;event E1&#39;,&#10;          p_data_fld   &#61;&gt; &#39;COUNT(1)&#39;,&#10;          p_ref_col    &#61;&gt; &#39;E1.offender_id&#39;,&#10;          p_ref_val    &#61;&gt; E.offender_id,&#10;          p_where      &#61;&gt; &#39;E1.soft_deleted &#61; 0 AND E1.active_flag &#61; 1 AND E1.event_number &#61; :p_event_number&#39;,&#10;          p_bind_var1  &#61;&gt; E.event_number&#10;        ) AS event_number_qty&#10;        --&#10;      FROM&#10;        offender O&#10;          LEFT OUTER JOIN event E ON E.offender_id &#61; O.offender_id AND E.event_number &#61; l_event_number&#10;            LEFT OUTER JOIN disposal D ON D.event_id &#61; E.event_id AND D.soft_deleted &#61; 0&#10;              LEFT OUTER JOIN case_allocation CAS ON CAS.event_id &#61; E.event_id AND&#10;                                                     CAS.case_allocation_id &#61; (SELECT MAX(case_allocation_id) FROM case_allocation WHERE event_id &#61; CAS.event_id)&#10;                LEFT OUTER JOIN r_standard_reference_list R1 ON R1.standard_reference_list_id &#61; CAS.allocation_decision_id&#10;          INNER JOIN offender_manager OM ON OM.offender_id &#61; O.offender_id AND OM.active_flag &#61; 1&#10;            INNER JOIN probation_area PA ON PA.probation_area_id &#61; OM.probation_area_id&#10;      WHERE 1&#61;1&#10;        AND O.crn &#61; p_crn&#10;        AND O.soft_deleted &#61; 0&#10;        AND OM.soft_deleted &#61; 0;&#10;    --&#10;    l_rec cs%ROWTYPE;&#10;    --&#10;    l_debug_flag BOOLEAN;&#10;    --&#10;    PROCEDURE do_init&#10;    IS&#10;        --&#10;        PROCEDURE do_set_user&#10;        IS&#10;            --&#10;            lc_CAS_user_name CONSTANT VARCHAR2(30) :&#61; &#39;HandoverCalculationUser&#39;;&#10;            --&#10;        BEGIN&#10;            --&#10;--            IF NVL(p_nd_user_flag, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;--                l_distinguished_name :&#61; NVL(SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;), lc_CAS_user_name);&#10;--            ELSE&#10;                l_distinguished_name :&#61; lc_CAS_user_name;&#10;--            END IF;&#10;            --&#10;            LC_USER_ID :&#61; PKG_Lookups.GetUserID(l_distinguished_name);&#10;            --&#10;            IF LC_USER_ID IS NULL THEN&#10;                l_distinguished_name :&#61; &#39;DELIUS_SYSTEM_USER&#39;;&#10;                LC_USER_ID :&#61; PKG_Lookups.GetUserID(l_distinguished_name);&#10;            END IF;&#10;            --&#10;        END do_set_user;&#10;        --&#10;        PROCEDURE do_set_loopkups IS&#10;        BEGIN&#10;            --&#10;            l_rsr_level_id   :&#61; PKG_Lookups.funcgetStdRefListID(&#39;RSR LEVEL&#39;  , p_rsr_level_code  );&#10;            --&#10;            l_osp_level_i_id :&#61; PKG_Lookups.funcgetStdRefListID(&#39;OSP Level I&#39;, p_osp_level_i_code);&#10;            l_osp_level_c_id :&#61; PKG_Lookups.funcgetStdRefListID(&#39;OSP LEVEL&#39;  , p_osp_level_c_code);&#10;            --&#10;            l_osp_level_iic_id :&#61; PKG_Lookups.funcgetStdRefListID(&#39;OSP Level I&#39;, p_osp_level_iic_code);&#10;            l_osp_level_dc_id  :&#61; PKG_Lookups.funcgetStdRefListID(&#39;OSP LEVEL&#39;  , p_osp_level_dc_code );&#10;            --&#10;        END do_set_loopkups;&#10;        --&#10;        PROCEDURE do_identify_active_event IS&#10;        BEGIN&#10;            --&#10;            IF p_event_number IS NULL THEN&#10;                l_event_number :&#61;&#10;                    PKG_Lookups.funcgetTabRecord(&#10;                        p_table    &#61;&gt; &#39;event E INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#39;,&#10;                        p_data_fld &#61;&gt; &#39;event_number&#39;,&#10;                        p_ref_col  &#61;&gt; &#39;O.crn&#39;,&#10;                        p_ref_val  &#61;&gt; p_crn,&#10;                        p_where    &#61;&gt; &#39;E.soft_deleted &#61; 0 AND E.active_flag &#61; 1&#39;,&#10;                        p_order_by &#61;&gt; &#39;E.created_datetime DESC, E.event_id DESC&#39; );&#10;                --&#10;                --raise_application_error(-20001, &#39;CRN&#61;&#39; || p_crn || &#39;; L_EVENT_NUMBER&#61;&#39; || l_event_number);&#10;                --&#10;            ELSE&#10;                l_event_number :&#61; p_event_number;&#10;            END IF;&#10;            --&#10;        END do_identify_active_event;&#10;        --&#10;    BEGIN&#10;        --&#10;        do_set_user;&#10;        do_set_loopkups;&#10;        do_identify_active_event;&#10;        --&#10;        l_debug_flag :&#61; (PKG_Lookups.funcgetNDParameterValue(&#39;CAS_DEBUG_FLAG&#39;, &#39;0&#39;) &#61; &#39;1&#39;);&#10;        --&#10;        OPEN cs;&#10;        FETCH cs INTO l_rec;&#10;        CLOSE cs;&#10;        --&#10;    END do_init;&#10;    --&#10;    PROCEDURE do_debug(p_msg VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;    BEGIN&#10;        IF l_debug_flag THEN&#10;            warn( p_msg, l_proc, p_label );&#10;        END IF;&#10;    END do_debug;&#10;    --&#10;    PROCEDURE do_error(p_msg VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;    BEGIN&#10;        fatal(&#10;            &#39;ERROR &#39;      ||&#10;            &#39;[crn&#61;&#39;       || p_crn || &#39;]&#39; ||&#10;            &#39;[event_num&#61;&#39; || p_event_number || &#39;]: &#39; ||&#10;            p_msg,&#10;            l_proc,&#10;            p_label );&#10;    END do_error;&#10;    --&#10;    PROCEDURE do_perform_checks IS&#10;    BEGIN&#10;        --&#10;        IF l_rec.offender_id IS NULL THEN&#10;            do_error(&#39;CRN/Offender does not exist&#39;);&#10;        ELSIF p_event_number IS NULL AND l_event_number IS NULL THEN&#10;            do_error(&#39;Event Number &#61; Null and no active events for the case&#39;);&#10;        ELSIF l_rec.event_id IS NULL THEN&#10;            do_error(&#39;The event number does not exist against the specified Offender&#39;);&#10;        ELSIF l_rec.soft_deleted &#61; 1 THEN&#10;            do_error(&#39;The Event is Soft Deleted&#39;);&#10;        ELSIF l_rec.rsr_assessor_date &gt; p_rsr_assessor_date OR ( l_rec.rsr_assessor_date IS NOT NULL AND p_rsr_assessor_date IS NULL ) THEN&#10;            do_error(&#39;The existing CAS Assessment Date [&#39; || PKG_Common.date_2_char(l_rec.rsr_assessor_date) || &#39;] is greater than a specified P_ASSESSMENT_DATE value [&#39; || PKG_Common.date_2_char(p_rsr_assessor_date) || &#39;]&#39;);&#10;        ELSIF NOT (l_rec.presentenced_flag &#61; &#39;Y&#39;) AND l_rec.case_allocation_id IS NULL THEN&#10;            do_error(&#39;Failed to locate the CAS record against the specified Event&#39;);&#10;        ELSIF p_rsr_assessor_date &gt; SYSDATE THEN&#10;            do_error(&#39;Specified p_rsr_assessor_date value [&#39; || PKG_Common.date_2_char(p_rsr_assessor_date) || &#39;] cannot be in the future&#39;);&#10;        ELSIF l_rec.event_number_qty &gt; 1 THEN&#10;            do_error(&#39;Duplicate event numbers found against the specified Offender&#39;);&#10;        ELSIF p_rsr_level_code IS NOT NULL AND l_rsr_level_id IS NULL THEN&#10;            do_error(&#39;RSR Band not known&#39;);&#10;        ELSIF  p_osp_level_i_code IS NOT NULL AND l_osp_level_i_id IS NULL THEN&#10;            do_error(&#39;OSP Indecent Band not known&#39;);&#10;        ELSIF  p_osp_level_c_code IS NOT NULL AND l_osp_level_c_id IS NULL THEN&#10;            do_error(&#39;OSP Contact Band not known&#39;);&#10;        ELSIF  p_osp_level_iic_code IS NOT NULL AND l_osp_level_iic_id IS NULL THEN&#10;            do_error(&#39;OSP Indirect Indecent Band not known&#39;);&#10;        ELSIF  p_osp_level_dc_code IS NOT NULL AND l_osp_level_dc_id IS NULL THEN&#10;            do_error(&#39;OSP Direct Contact Band not known&#39;);&#10;        ELSIF p_rsr_static_flag IS NOT NULL AND p_rsr_static_flag NOT IN (&#39;STATIC&#39;, &#39;DYNAMIC&#39;) THEN&#10;            do_error(&#39;RSRStaticOrDynamic value is invalid&#39;);&#10;        END IF;&#10;        --&#10;    END do_perform_checks;&#10;    --&#10;    PROCEDURE do_process_CAS_record&#10;    IS&#10;        --&#10;        PROCEDURE do_submit_mt_change IS&#10;        BEGIN&#10;            --&#10;            IF PKG_Lookups.funcgetNDParameterValue(&#39;DISABLE_TIER_CALCULATION_NOTIFICATION&#39;, &#39;0&#39;) &lt;&gt; &#39;0&#39; THEN&#10;                RETURN;&#10;            END IF;&#10;            --&#10;            INSERT INTO management_tier_event(&#10;              management_tier_event_id,&#10;              offender_id,&#10;              tier_id,&#10;              tier_change_reason_id,&#10;              contact_type_id,&#10;              iom_nominal,&#10;              safeguarding_issue,&#10;              vulnerability_issue,&#10;              row_version,&#10;              created_by_user_id,&#10;              created_datetime,&#10;              last_updated_user_id,&#10;              last_updated_datetime )&#10;            SELECT&#10;              management_tier_event_id_SEQ.nextval                           AS management_tier_event_id,&#10;              l_rec.offender_id,&#10;              --&#10;              PKG_Lookups.funcgetStdRefListID(&#39;TIER&#39;, &#39;NA&#39;)                  AS tier_id,&#10;              PKG_Lookups.funcgetStdRefListID(&#39;TIER CHANGE REASON&#39;, &#39;RSR&#39;)   AS tier_change_reason_id,&#10;              PKG_Lookups.funcGetTabRecord_CACHED(&#10;                  p_table    &#61;&gt; &#39;R_CONTACT_TYPE&#39;,&#10;                  p_data_fld &#61;&gt; &#39;CONTACT_TYPE_ID&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;code&#39;,&#10;                  p_ref_val  &#61;&gt; &#39;ETCH08&#39; )                                   AS contact_type_id,&#10;              --&#10;              NVL(l_rec.iom_nominal,&#39;N&#39;),&#10;              NVL(l_rec.safeguarding_issue,&#39;N&#39;),&#10;              NVL(l_rec.vulnerability_issue,&#39;N&#39;),&#10;              --&#10;              1            AS row_version,&#10;              LC_USER_ID   AS created_by_user_id,&#10;              LC_DATE_TIME AS created_datetime,&#10;              LC_USER_ID   AS last_updated_user_id,&#10;              LC_DATE_TIME AS last_updated_datetime&#10;            FROM dual;&#10;            --&#10;        END do_submit_mt_change;&#10;        --&#10;        PROCEDURE do_upd_rsr_score&#10;        IS&#10;            --&#10;            l_dyn_rsr_score_changed_flag BOOLEAN;&#10;            --&#10;            l_reason_for_change_code VARCHAR2(10);&#10;            l_reason_for_change_id   NUMBER;&#10;            --&#10;            PROCEDURE do_create_rsr_contact&#10;            IS&#10;                --&#10;                l_contact_type_code VARCHAR2(10);&#10;                l_contact_type_id NUMBER;&#10;                --&#10;            BEGIN&#10;                --&#10;                l_contact_type_code :&#61;&#10;                    CASE&#10;                        WHEN p_rsr_static_flag &#61; &#39;DYNAMIC&#39; THEN&#10;                            &#39;DRSR&#39; -- Dynamic RSR Score&#10;                        WHEN ( p_rsr_static_flag &#61; &#39;STATIC&#39; ) OR ( p_rsr_static_flag IS NULL AND p_rsr_band IS NOT NULL ) THEN&#10;                            &#39;SRSR&#39; -- Static RSR Score&#10;                        ELSE&#10;                            &#39;DRSR&#39; -- Dynamic RSR Score&#10;                    END;&#10;                --&#10;                l_contact_type_id :&#61;&#10;                    PKG_Lookups.funcgetTabRecord_CACHED(&#10;                        p_table    &#61;&gt; &#39;r_contact_type&#39;,&#10;                        p_ref_col  &#61;&gt; &#39;code&#39;,&#10;                        p_ref_val  &#61;&gt; l_contact_type_code,&#10;                        p_data_fld &#61;&gt; &#39;contact_type_id&#39; );&#10;                --&#10;                IF l_contact_type_id IS NULL THEN&#10;                    do_error( &#39;Failed to identify R_CONTACT_TYPE record for [&#39; || l_contact_type_code || &#39;]&#39; );&#10;                END IF;&#10;                --&#10;                INSERT INTO contact(&#10;                  contact_id,&#10;                  offender_id,&#10;                  event_id,&#10;                  --&#10;                  contact_date,&#10;                  --&#10;                  contact_type_id,&#10;                  --&#10;                  notes,&#10;                  --&#10;                  team_id,&#10;                  staff_id,&#10;                  probation_area_id,&#10;                  --&#10;                  visor_contact,&#10;                  visor_exported,&#10;                  --&#10;                  soft_deleted,&#10;                  partition_area_id,&#10;                  row_version,&#10;                  --&#10;                  created_by_user_id,&#10;                  created_datetime,&#10;                  last_updated_user_id,&#10;                  last_updated_datetime )&#10;                SELECT&#10;                  contact_id_SEQ.nextval           AS contact_id,&#10;                  l_rec.offender_id                AS offender_id,&#10;                  NULL /*l_rec.event_id*/          AS event_id,&#10;                  --&#10;                  TRUNC(LC_DATE_TIME)              AS contact_date,&#10;                  --&#10;                  l_contact_type_id                AS contact_type_id,&#10;                  --&#10;                  &#39;RSR Score: &#39; || PKG_Common.number_2_char(p_rsr_score) AS notes,&#10;                  --&#10;                  l_rec.trust_provider_team_id     AS team_id,&#10;                  l_rec.staff_employee_id          AS staff_id,&#10;                  l_rec.probation_area_id          AS probation_area_id,&#10;                  --&#10;                  &#39;N&#39;                              AS visor_contact,&#10;                  &#39;N&#39;                              AS visor_exported,&#10;                  --&#10;                  0                                AS soft_deleted,&#10;                  0                                AS partition_area_id,&#10;                  0                                AS row_version,&#10;                  --&#10;                  LC_USER_ID                       AS created_by_user_id,&#10;                  LC_DATE_TIME                     AS created_datetime,&#10;                  LC_USER_ID                       AS last_updated_user_id,&#10;                  LC_DATE_TIME                     AS last_updated_datetime&#10;                FROM dual;&#10;                --&#10;            END do_create_rsr_contact;&#10;            --&#10;        BEGIN&#10;            --&#10;            IF p_rsr_score IS NOT NULL THEN&#10;                --&#10;                IF p_rsr_static_flag &#61; &#39;DYNAMIC&#39; AND&#10;                   NVL(l_rec.dynamic_rsr_score, -1) &lt;&gt; NVL(p_rsr_score, -2)&#10;                THEN&#10;                    --&#10;                    UPDATE offender SET&#10;                      dynamic_rsr_score &#61; p_rsr_score,&#10;                      --&#10;                      row_version &#61; row_version + 1,&#10;                      --&#10;                      last_updated_user_id  &#61; LC_USER_ID,&#10;                      last_updated_datetime &#61; LC_DATE_TIME&#10;                    WHERE offender_id &#61; l_rec.offender_id;&#10;                    --&#10;                    l_dyn_rsr_score_changed_flag :&#61; (SQL%ROWCOUNT &gt; 0);&#10;                    --&#10;                ELSE&#10;                    --&#10;                    l_dyn_rsr_score_changed_flag :&#61; FALSE;&#10;                    --&#10;                END IF;&#10;                --&#10;                l_reason_for_change_code :&#61;&#10;                    CASE&#10;                        WHEN p_rsr_static_flag &#61; &#39;DYNAMIC&#39; THEN&#10;                            &#39;D&#39; -- Dynamic RSR Score&#10;                        WHEN p_rsr_static_flag &#61; &#39;STATIC&#39; THEN&#10;                            &#39;S&#39; -- Static RSR Score&#10;                        ELSE&#10;                            &#39;F&#39; -- From OASYS Assessment Message&#10;                    END;&#10;                --&#10;                l_reason_for_change_id :&#61; PKG_Lookups.funcgetStdRefListID( &#39;RSR SCORE CHANGE&#39;, l_reason_for_change_code );&#10;                --&#10;                IF l_reason_for_change_id IS NULL THEN&#10;                    --&#10;                    do_error( &#39;Failed to identify R_STANDARD_REFERENCE_LIST record for [RSR SCORE CHANGE][&#39; || l_reason_for_change_code || &#39;]&#39; );&#10;                    --&#10;                END IF;&#10;                --&#10;                INSERT INTO dynamic_rsr_history(&#10;                  dynamic_rsr_history_id,&#10;                  offender_id,&#10;                  dynamic_rsr_score,&#10;                  --&#10;                  reason_for_change_id,&#10;                  --&#10;                  date_recorded,&#10;                  --&#10;                  created_by_user_id,&#10;                  created_datetime,&#10;                  last_updated_user_id,&#10;                  last_updated_datetime&#10;                ) VALUES (&#10;                  dynamic_rsr_history_id_SEQ.nextval,&#10;                  l_rec.offender_id,&#10;                  p_rsr_score,&#10;                  --&#10;                  l_reason_for_change_id,&#10;                  --&#10;                  p_rsr_assessor_date,&#10;                  --&#10;                  LC_USER_ID,&#10;                  LC_DATE_TIME,&#10;                  LC_USER_ID,&#10;                  LC_DATE_TIME );&#10;                --&#10;                do_create_rsr_contact;&#10;                --&#10;                IF l_dyn_rsr_score_changed_flag OR ( NVL(l_rec.rsr_score, -1) &lt;&gt; NVL(p_rsr_score, -2) ) THEN&#10;                    do_submit_mt_change;&#10;                END IF;&#10;                --&#10;            END IF;&#10;            --&#10;        END do_upd_rsr_score;&#10;        --&#10;        PROCEDURE do_ins_CAS_non_assessed IS&#10;            --&#10;            l_case_allocation_id NUMBER :&#61; case_allocation_id_SEQ.nextval;&#10;            --&#10;        BEGIN&#10;            --&#10;            INSERT INTO case_allocation(&#10;              case_allocation_id,&#10;              offender_id,&#10;              event_id,&#10;              --&#10;              allocation_decision_id,&#10;              allocation_decision_date,&#10;              --&#10;              rsr_assessor_date,&#10;              --&#10;              rsr_score,&#10;              rsr_level_id,&#10;              --&#10;              osp_level_i_id,&#10;              osp_level_c_id,&#10;              --&#10;              osp_level_indirect_indecent_id,&#10;              osp_level_direct_contact_id,&#10;              --&#10;              decision_provider_id,&#10;              decision_team_id,&#10;              decision_staff_id,&#10;              --&#10;              row_version,&#10;              --&#10;              created_by_user_id,&#10;              created_datetime,&#10;              last_updated_user_id,&#10;              last_updated_datetime )&#10;            SELECT&#10;              l_case_allocation_id             AS case_allocation_id,&#10;              l_rec.offender_id                AS offender_id,&#10;              l_rec.event_id                   AS event_id,&#10;              --&#10;              l_allocation_decision_id         AS allocation_decision_id,&#10;              NULL                             AS allocation_decision_date,&#10;              --&#10;              p_rsr_assessor_date,&#10;              --&#10;              p_rsr_score,&#10;              l_rsr_level_id,&#10;              --&#10;              l_osp_level_i_id,&#10;              l_osp_level_c_id,&#10;              --&#10;              l_osp_level_iic_id,&#10;              l_osp_level_dc_id,&#10;              --&#10;              NULL                             AS decision_provider_id,&#10;              NULL                             AS decision_team_id,&#10;              NULL                             AS decision_staff_id,&#10;              --&#10;              0                                AS row_version,&#10;              --&#10;              LC_USER_ID                       AS created_by_user_id,&#10;              LC_DATE_TIME                     AS created_datetime,&#10;              LC_USER_ID                       AS last_updated_user_id,&#10;              LC_DATE_TIME                     AS last_updated_datetime&#10;            FROM dual;&#10;            --&#10;            do_upd_rsr_score;&#10;            --&#10;        END do_ins_CAS_non_assessed;&#10;        --&#10;        PROCEDURE do_upd_existing_CAS IS&#10;        BEGIN&#10;            --&#10;            UPDATE case_allocation SET&#10;              rsr_assessor_date &#61; p_rsr_assessor_date,&#10;              --&#10;              rsr_score &#61; p_rsr_score,&#10;              rsr_level_id &#61; l_rsr_level_id,&#10;              --&#10;              --osp_score &#61; p_osp_score,&#10;          --    osp_score_i &#61; p_osp_score_i,&#10;          --    osp_score_c &#61; p_osp_score_c,&#10;              osp_level_i_id &#61; l_osp_level_i_id,&#10;              osp_level_c_id &#61; l_osp_level_c_id,&#10;              --&#10;              osp_level_indirect_indecent_id &#61; l_osp_level_iic_id,&#10;              osp_level_direct_contact_id    &#61; l_osp_level_dc_id,&#10;              --&#10;              row_version &#61; row_version + 1,&#10;              --&#10;              last_updated_user_id  &#61; LC_USER_ID,&#10;              last_updated_datetime &#61; LC_DATE_TIME&#10;              --&#10;            WHERE case_allocation_id &#61; l_rec.case_allocation_id;&#10;            --&#10;            do_upd_rsr_score;&#10;            --&#10;        END do_upd_existing_CAS;&#10;        --&#10;    BEGIN&#10;        --&#10;        IF l_rec.presentenced_flag &#61; &#39;Y&#39; AND l_rec.case_allocation_id IS NULL THEN&#10;            --&#10;            l_allocation_decision_id :&#61; PKG_Lookups.funcgetStdRefListID(&#39;ALLOCATION DECISION&#39;, &#39;N&#39; /*Not Assessed*/);&#10;            do_ins_CAS_non_assessed;&#10;            --&#10;        ELSIF l_rec.presentenced_flag &#61; &#39;Y&#39; AND l_rec.case_allocation_id IS NOT NULL THEN&#10;            --&#10;            do_upd_existing_CAS;&#10;            --&#10;        ELSIF l_rec.case_allocation_id IS NOT NULL THEN&#10;            --&#10;            do_upd_existing_CAS;&#10;            --&#10;            IF NOT (l_rec.terminated_flag &#61; &#39;Y&#39;) OR l_rec.sentenced_flag &#61; &#39;Y&#39; THEN&#10;                PKG_TriggerSupport.procAddCASDeferred(l_rec.offender_id, l_rec.event_id);&#10;                PKG_TriggerSupport.procUpdateCAS_DEFERRED(&#39;procUpdateCAS&#39;);&#10;            END IF;&#10;            --&#10;        ELSIF l_rec.sentenced_flag &#61; &#39;Y&#39; THEN&#10;            --&#10;            PKG_TriggerSupport.procCalculateCAS(&#10;                p_offender_id       &#61;&gt; l_rec.offender_id,&#10;                p_event_id          &#61;&gt; l_rec.event_id,&#10;                p_api_flag          &#61;&gt; &#39;Y&#39;,&#10;                p_rsr_score         &#61;&gt; p_rsr_score,&#10;                p_rsr_level_id      &#61;&gt; PKG_Lookups.funcgetStdRefListID(&#39;RSR LEVEL&#39;, p_rsr_level_code),&#10;                p_osp_level_i_id    &#61;&gt; PKG_Lookups.funcgetStdRefListID(&#39;OSP Level I&#39;, p_osp_level_i_code),&#10;                p_osp_level_c_id    &#61;&gt; PKG_Lookups.funcgetStdRefListID(&#39;OSP LEVEL&#39;, p_osp_level_c_code),&#10;                --&#10;                p_osp_level_iic_id  &#61;&gt; PKG_Lookups.funcgetStdRefListID(&#39;OSP Level I&#39;, p_osp_level_iic_code),&#10;                p_osp_level_dc_id   &#61;&gt; PKG_Lookups.funcgetStdRefListID(&#39;OSP LEVEL&#39;, p_osp_level_dc_code) );&#10;            --&#10;            -- A new CAS and decision is made and rsr/osp scores and levels have been added to the CAS.&#10;            -- The call to procCalculate now handles these type of parameters. Therefore perform a do_upd_existing_CAS&#10;            do_init; -- Run again to pick new CAS&#10;            do_upd_existing_CAS;&#10;            --&#10;        END IF;&#10;        --&#10;    END do_process_CAS_record;&#10;    --&#10;BEGIN&#10;    --&#10;    do_init;&#10;    do_perform_checks;&#10;    do_process_CAS_record;&#10;    --&#10;END procUpdateCAS;&#10;--&#10;&#10;--&#10;--&#10;--&#10;PROCEDURE do_init_vars IS&#10;BEGIN&#10;    NULL;&#10;END do_init_vars;&#10;--&#10;--&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--    PKG Initialisation block&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;--&#10;BEGIN&#10;    PKG_Global.do_init;&#10;    do_init_vars;&#10;    --&#10;--&#10;--&#10;END pkg_cas_support;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>