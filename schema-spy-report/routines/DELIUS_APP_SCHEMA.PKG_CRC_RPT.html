<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.PKG_CRC_RPT</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY pkg_crc_rpt AS&#10;--&#10;--&#10;--&#10;--&#10;-- Global Constants&#10;GC_UNDERSCORE_CHR CONSTANT VARCHAR2(1) :&#61; &#39;_&#39;;&#10;GC_EMPTY_CHR VARCHAR2(1) :&#61; &#39;&#39;;&#10;&#10;-- Global variables&#10;g_step       VARCHAR2(16);&#10;g_message    VARCHAR2(2000);&#10;g_label      VARCHAR2(100);&#10;&#10;GC_BI_ALLOC_OFFENDER CONSTANT VARCHAR2(30) :&#61; &#39;CABI020&#39;;&#10;&#10;--&#10;--&#10;--&#10;/*-----------------------------------------------------------------------------------------&#10;|&#10;| System output routines&#10;|&#10;-------------------------------------------------------------------------------------------&#10;*/&#10;PROCEDURE procDebug(p_msg VARCHAR2) IS&#10;BEGIN&#10;    PKG_Debug.procDebug(p_msg);&#10;END procDebug;&#10;&#10;--&#10;-- PKG_COMMON wrappers&#10;--&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level INTEGER DEFAULT 0) IS&#10;BEGIN&#10;    PKG_Common.print_message(&#10;        p_msg         &#61;&gt; p_msg,&#10;        p_trace_level &#61;&gt; NVL(p_trace_level, PKG_Common.GC_TRACE_LEVEL),&#10;        p_label       &#61;&gt; g_label );&#10;END message;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;PROCEDURE raise_error(p_err_msg VARCHAR2, p_proc VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    PKG_Common.raise_error( p_err_msg, p_proc, p_label );&#10;END raise_error;&#10;--&#10;PROCEDURE print_line(p_line VARCHAR2)&#10;IS&#10;BEGIN&#10;    PKG_Common.print_message(GC_EMPTY_CHR || p_line, p_log_output_flag&#61;&gt;&#39;R&#39;);&#10;END print_line;&#10;--&#10;/*-----------------------------------------------------------------------------------------&#10;|&#10;| Generic report routines&#10;|&#10;-------------------------------------------------------------------------------------------&#10;*/&#10;PROCEDURE init_report(p_rows INTEGER, p_cols INTEGER) IS&#10;BEGIN&#10;    g_report_rows :&#61; p_rows;&#10;    g_report_cols :&#61; p_cols;&#10;END init_report;&#10;--&#10;PROCEDURE do_check_rpt_settings IS&#10;BEGIN&#10;    IF g_report_cols &lt;&#61; 0 THEN&#10;        message(&#39;ERROR in DO_CHECK_RPT_SETTINGS: Please set the report page dimensions&#39;);&#10;        RAISE EX_RPT_ERROR;&#10;    END IF;&#10;END do_check_rpt_settings;&#10;--&#10;FUNCTION get_txt_L(p_text VARCHAR2, p_line_len INTEGER DEFAULT g_report_cols) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN RPAD(p_text, p_line_len);&#10;END get_txt_L;&#10;--&#10;FUNCTION get_txt_R(p_text VARCHAR2, p_line_len INTEGER DEFAULT g_report_cols) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN LPAD(p_text, p_line_len);&#10;END get_txt_R;&#10;--&#10;FUNCTION get_txt_C(p_text VARCHAR2, p_line_len INTEGER DEFAULT g_report_cols) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN LPAD(RPAD(p_text, ROUND((p_line_len + LENGTH(p_text)) / 2, 0)),&#10;                p_line_len);&#10;END get_txt_C;&#10;--&#10;FUNCTION get_txt(p_text VARCHAR2, p_align_flag VARCHAR2, p_line_len INTEGER DEFAULT g_report_cols, p_what_to_print VARCHAR2 DEFAULT NULL)&#10;RETURN VARCHAR2&#10;IS&#10;    l_ret_val VARCHAR2(512);&#10;    l_text    VARCHAR2(512);&#10;BEGIN&#10;    l_text :&#61; CASE WHEN p_what_to_print &#61; &#39;T&#39; THEN TRIM(p_text) ELSE p_text END;&#10;    --&#10;    IF    p_align_flag &#61; &#39;L&#39; THEN l_ret_val :&#61; get_txt_L(l_text, p_line_len);&#10;    ELSIF p_align_flag &#61; &#39;R&#39; THEN l_ret_val :&#61; get_txt_R(l_text, p_line_len);&#10;    ELSIF p_align_flag &#61; &#39;C&#39; THEN l_ret_val :&#61; get_txt_C(l_text, p_line_len);&#10;    ELSE&#10;        message(&#39;ERROR in GET_ALIGNED_TEXT: Invalid parameter value for P_ALIGN_FLAG[&#39; || p_align_flag || &#39;]&#39;);&#10;        RAISE EX_RPT_ERROR;&#10;    END IF;&#10;    RETURN l_ret_val;&#10;END get_txt;&#10;--&#10;PROCEDURE do_add_col_def(&#10;    p_cols_tab  IN OUT  rpt_cols_TAB_TYP,&#10;    p_col_num           INTEGER,&#10;    p_val_type          VARCHAR2,&#10;    p_max_size          INTEGER,&#10;    p_align_flag        VARCHAR2,&#10;    p_wrap_flag         VARCHAR2,&#10;    p_name              VARCHAR2,&#10;    p_title             VARCHAR2,&#10;    p_value             VARCHAR2 DEFAULT &#39;&#39;)&#10;IS&#10;    l_i       INTEGER;&#10;    l_tot_len INTEGER :&#61; 0;&#10;    l_col_rec rpt_col_TYP;&#10;BEGIN&#10;    do_check_rpt_settings;&#10;    IF p_cols_tab.EXISTS(p_col_num) THEN&#10;        message(&#39;ERROR in ADD_COL_DEF: column [&#39; || p_col_num || &#39;][&#39; ||&#10;                p_name || &#39;] have already been added -[&#39; ||&#10;                p_cols_tab(p_col_num).name || &#39;]&#39;);&#10;        RAISE EX_RPT_ERROR;&#10;    ELSIF NVL(p_max_size, 0) &lt;&#61; 0 THEN&#10;        message(&#39;ERROR in ADD_COL_DEF: P_MAX_SIZE has to be &gt;&#61; 0&#39;);&#10;        RAISE EX_RPT_ERROR;&#10;    ELSIF NVL(p_align_flag, &#39;X&#39;) NOT IN (&#39;R&#39;, &#39;L&#39;, &#39;C&#39;) THEN&#10;        message(&#39;ERROR in ADD_COL_DEF: P_ALIGN_FLAG has to be one of (R,L,C)&#39;);&#10;        RAISE EX_RPT_ERROR;&#10;    --ELSIF p_col_num &#61; 1 AND p_align_flag &lt;&gt; &#39;L&#39; THEN&#10;    --    message(&#39;ERROR in ADD_COL_DEF: for the first column P_ALIGN_FLAG has to be [L]&#39;);&#10;    --    RAISE EX_RPT_ERROR;&#10;    END IF;&#10;    --&#10;    l_i :&#61; p_cols_tab.FIRST;&#10;    LOOP&#10;        EXIT WHEN l_i IS NULL;&#10;        l_tot_len :&#61; l_tot_len + p_cols_tab(l_i).max_size + 1;&#10;        l_i :&#61; p_cols_tab.NEXT(l_i);&#10;    END LOOP;&#10;    l_tot_len :&#61; l_tot_len + p_max_size;&#10;    IF l_tot_len &gt; g_report_cols THEN&#10;        message(&#39;ERROR in ADD_COL_DEF: column [&#39;     || p_col_num ||&#10;                &#39;] - current line size [&#39;            || l_tot_len ||&#10;                &#39;] exceeded the specified maximum [&#39; || g_report_cols || &#39;]&#39;);&#10;        RAISE EX_RPT_ERROR;&#10;    END IF;&#10;    --&#10;    l_col_rec.val_type   :&#61; p_val_type;&#10;    l_col_rec.max_size   :&#61; p_max_size;&#10;    l_col_rec.align_flag :&#61; p_align_flag;&#10;    l_col_rec.wrap_flag  :&#61; p_wrap_flag;&#10;    l_col_rec.name       :&#61; p_name;&#10;    l_col_rec.title      :&#61; p_title;&#10;    l_col_rec.value      :&#61; p_value;&#10;    --&#10;    p_cols_tab(p_col_num) :&#61; l_col_rec;&#10;    --&#10;END do_add_col_def;&#10;--&#10;PROCEDURE do_print_line_buf(&#10;    p_cols_tab      IN OUT rpt_cols_TAB_TYP,&#10;    p_what_to_print VARCHAR2 )&#10;IS&#10;    l_i              INTEGER;&#10;    l_i_next         INTEGER;&#10;    l_pos            INTEGER;&#10;    l_pos_start      INTEGER;&#10;    l_pos_dummy      INTEGER :&#61; 9999;&#10;    l_chars_to_print INTEGER;&#10;    l_chars_to_skip INTEGER;&#10;    l_len            INTEGER;&#10;    l_wraps_cnt      INTEGER;&#10;    l_wraps_limit    INTEGER :&#61; 100;&#10;    --&#10;    l_char_CR        VARCHAR2(1) :&#61; CASE WHEN p_what_to_print &#61; &#39;T&#39; THEN &#39;|&#39; WHEN p_what_to_print &#61; &#39;D&#39; THEN CHR(10) END;&#10;    --&#10;    l_curr_col_val   VARCHAR2(512);&#10;    l_col_text       VARCHAR2(512);&#10;    l_line_text      VARCHAR2(2048);&#10;    --&#10;    l_space_char     VARCHAR2(1);&#10;    l_continue_flag  VARCHAR2(1) :&#61; &#39;Y&#39;;&#10;    l_col_rec        rpt_col_TYP;&#10;    l_tmp            VARCHAR2(2048);&#10;    --&#10;    FUNCTION get_curr_col_val RETURN VARCHAR2 IS&#10;        l_ret_val VARCHAR2(512);&#10;    BEGIN&#10;        IF p_what_to_print &#61; &#39;T&#39; THEN&#10;            l_col_rec.align_flag :&#61; &#39;L&#39;;&#10;            l_col_rec.wrap_flag  :&#61; &#39;Y&#39;;&#10;            l_ret_val :&#61; p_cols_tab(l_i).title;&#10;        ELSIF p_what_to_print &#61; &#39;U&#39; THEN&#10;            l_col_rec.align_flag :&#61; &#39;L&#39;;&#10;            l_col_rec.wrap_flag  :&#61; &#39;Y&#39;;&#10;            l_ret_val :&#61; LPAD(GC_UNDERSCORE_CHR, p_cols_tab(l_i).max_size, GC_UNDERSCORE_CHR);&#10;        ELSE&#10;            l_ret_val :&#61; p_cols_tab(l_i).value;&#10;        END IF;&#10;        l_len :&#61; LENGTH(l_ret_val);&#10;        RETURN l_ret_val;&#10;    END;&#10;    --&#10;    PROCEDURE initialize_buff IS&#10;    BEGIN&#10;        l_i :&#61; p_cols_tab.FIRST;&#10;        LOOP EXIT WHEN l_i IS NULL;&#10;            l_curr_col_val :&#61; get_curr_col_val;&#10;            p_cols_tab(l_i).chars_left    :&#61; l_len;&#10;            p_cols_tab(l_i).chars_printed :&#61; 0;&#10;            l_i :&#61; p_cols_tab.NEXT(l_i);&#10;        END LOOP;&#10;    END;&#10;    --&#10;BEGIN&#10;    --&#10;    initialize_buff;&#10;    l_wraps_cnt :&#61; 1;&#10;    LOOP&#10;        l_continue_flag :&#61; &#39;N&#39;;&#10;        l_line_text     :&#61; &#39;&#39;;&#10;        l_i             :&#61; p_cols_tab.FIRST;&#10;        LOOP EXIT WHEN l_i IS NULL;&#10;            l_col_rec :&#61; p_cols_tab(l_i);&#10;            l_i_next  :&#61; p_cols_tab.NEXT(l_i);&#10;            --&#10;            IF l_i_next IS NULL THEN&#10;                l_space_char :&#61; &#39;&#39;;&#10;            ELSE&#10;                l_space_char :&#61; &#39; &#39;;&#10;            END IF;&#10;            --&#10;            l_curr_col_val :&#61; get_curr_col_val;&#10;            --&#10;            IF l_col_rec.wrap_flag &#61; &#39;Y&#39; THEN&#10;                IF l_col_rec.chars_left &gt; 0 THEN&#10;                        --&#10;                        l_chars_to_skip  :&#61; 0;&#10;                        --&#10;                        l_pos_start      :&#61; l_col_rec.chars_printed + 1;&#10;                        l_chars_to_print :&#61; LEAST(l_col_rec.max_size, l_col_rec.chars_left);&#10;                        --&#10;                        IF p_what_to_print IN (&#39;T&#39;, &#39;D&#39;) THEN&#10;                            l_pos :&#61; INSTR(NVL(SUBSTR(l_curr_col_val, l_pos_start, l_chars_to_print), &#39; &#39;), l_char_CR);&#10;                            IF l_pos &gt; 0 THEN&#10;                                l_chars_to_print :&#61; l_pos - 1;&#10;                                l_chars_to_skip :&#61; 1;&#10;                            END IF;&#10;                        END IF;&#10;                        --&#10;                        l_col_rec.chars_left    :&#61; l_col_rec.chars_left - l_chars_to_print - l_chars_to_skip;&#10;                        l_col_rec.chars_printed :&#61; l_col_rec.chars_printed + l_chars_to_print + l_chars_to_skip;&#10;                        --&#10;                ELSE&#10;                        l_pos_start             :&#61; l_pos_dummy;&#10;                        l_chars_to_print        :&#61; 0;&#10;                        l_col_rec.chars_left    :&#61; 0;&#10;                END IF;&#10;            ELSE&#10;                IF l_wraps_cnt &#61; 1 THEN&#10;                        l_pos_start             :&#61; 1;&#10;                        l_chars_to_print        :&#61; LEAST(l_col_rec.max_size, l_len);&#10;                        l_col_rec.chars_left    :&#61; 0;&#10;                        l_col_rec.chars_printed :&#61; l_len;&#10;                ELSE&#10;                        l_pos_start             :&#61; l_pos_dummy;&#10;                        l_chars_to_print        :&#61; 0;&#10;                        l_col_rec.chars_left    :&#61; 0;&#10;                END IF;&#10;            END IF;&#10;            --&#10;            IF l_pos_start &lt;&gt; l_pos_dummy THEN&#10;                l_col_text :&#61; get_txt(&#10;                                   NVL(SUBSTR(l_curr_col_val, l_pos_start, l_chars_to_print), &#39; &#39;),&#10;                                   l_col_rec.align_flag,&#10;                                   l_col_rec.max_size,&#10;                                   p_what_to_print );&#10;            ELSE&#10;                l_col_text :&#61; LPAD(&#39; &#39;, l_col_rec.max_size);&#10;            END IF;&#10;            l_line_text :&#61; l_line_text || l_col_text || l_space_char;&#10;            --&#10;            --IF l_col_rec.name &#61; &#39;err_desc&#39; THEN&#10;            --    SELECT l_tmp || DECODE(l_tmp, NULL, &#39;&#39;, &#39;|&#39;) || l_col_text INTO l_tmp FROM dual;&#10;            --END IF;&#10;            --&#10;            IF l_col_rec.chars_printed + l_col_rec.chars_left &lt;&gt; LENGTH(l_curr_col_val) THEN&#10;                message(&#39;ERROR in PRINT_LINE_BUFFER: chars_printed[&#39; || l_col_rec.chars_printed ||&#10;                        &#39;] + chars_left [&#39; || l_col_rec.chars_left || &#39;] &lt;&gt; LENGTH(get_curr_col_val)[&#39; ||&#10;                        l_len || &#39;]&#39;);&#10;                message(&#39;  l_pos_start     &#61;&#39; || l_pos_start);&#10;                message(&#39;  l_chars_to_print&#61;&#39; || l_chars_to_print);&#10;                message(&#39;  wraps_iteration  &#61;&#39; || l_wraps_cnt);&#10;                message(&#39;  num of col       &#61;&#39; || l_i);&#10;                message(&#39;  Column Value     &#61;&#39; || l_curr_col_val);&#10;                RAISE EX_RPT_ERROR;&#10;            END IF;&#10;            p_cols_tab(l_i).chars_printed :&#61; l_col_rec.chars_printed;&#10;            p_cols_tab(l_i).chars_left    :&#61; l_col_rec.chars_left;&#10;            --&#10;            --&#10;            IF l_col_rec.chars_left &gt; 0 THEN&#10;                l_continue_flag :&#61; &#39;Y&#39;;&#10;            END IF;&#10;            l_i :&#61; l_i_next;&#10;        END LOOP;&#10;        --&#10;        print_line(l_line_text);&#10;        --&#10;        EXIT WHEN l_continue_flag &#61; &#39;N&#39;;&#10;        l_wraps_cnt :&#61; l_wraps_cnt + 1;&#10;        IF l_wraps_cnt &gt; l_wraps_limit THEN&#10;            message(&#39;ERROR in PRINT_LINE_BUFFER: Total count of the WRAP iteration has exceeded its limit&#39;);&#10;            RAISE EX_RPT_ERROR;&#10;        END IF;&#10;    END LOOP;&#10;    --&#10;    IF l_tmp IS NOT NULL AND p_what_to_print IN (&#39;D&#39;, &#39;U&#39;) THEN&#10;        message(&#39;l_tmp[&#39; || l_tmp       || &#39;]&#39;);&#10;        message(l_line_text);&#10;    END IF;&#10;    --&#10;END do_print_line_buf;&#10;--&#10;PROCEDURE do_print_rpt_title(p_title VARCHAR2) IS&#10;BEGIN&#10;    print_line(&#39;&#39;);&#10;    print_line(get_txt(p_title, &#39;C&#39;));&#10;    print_line(get_txt(LPAD(GC_UNDERSCORE_CHR, LENGTH(p_title), GC_UNDERSCORE_CHR), &#39;C&#39;));&#10;    print_line(&#39;&#39;);&#10;    print_line(&#39;&#39;);&#10;END;&#10;--&#10;PROCEDURE do_print_page_hdr(p_crc VARCHAR2, p_direction VARCHAR2 DEFAULT NULL, p_start_date DATE DEFAULT NULL, p_end_date DATE DEFAULT NULL)&#10;IS&#10;    CURSOR cs IS&#10;      SELECT&#10;        TRUNC(SYSDATE) AS print_date,&#10;        description&#10;      FROM probation_area&#10;      WHERE code &#61; p_crc;&#10;    l_rec cs%ROWTYPE;&#10;BEGIN&#10;    OPEN  cs;&#10;    FETCH cs INTO l_rec;&#10;    CLOSE cs;&#10;    --&#10;    do_print_rpt_title(&#39;nDelius CRC Reconciliation&#39;);&#10;    print_line(&#39;&#39;);&#10;    print_line(&#39;&#39;);&#10;    print_line(&#39;&#39;);&#10;    --&#10;    print_line(&#39;TARGET CRC         : &#39; || p_crc || CASE WHEN p_crc &lt;&gt; &#39;ALL&#39; THEN &#39; &#39; || l_rec.description END );&#10;    print_line(&#39;&#39;);&#10;    --&#10;    IF EMPTY2NULL(p_direction) IS NOT NULL THEN&#10;        print_line(&#39;TRANSFERS DIRECTION    : &#39; || p_direction );&#10;        print_line(&#39;&#39;);&#10;    END IF;&#10;    --&#10;    IF EMPTY2NULL(p_start_date) IS NOT NULL THEN&#10;        print_line(&#39;PERIOD START DATE  : &#39; || TO_CHAR(TRUNC(p_start_date), &#39;DD-MON-YYYY&#39;) );&#10;        print_line(&#39;&#39;);&#10;    END IF;&#10;    --&#10;    IF EMPTY2NULL(p_end_date) IS NOT NULL THEN&#10;        print_line(&#39;PERIOD END DATE    : &#39; || TO_CHAR(TRUNC(p_end_date), &#39;DD-MON-YYYY&#39;) );&#10;        print_line(&#39;&#39;);&#10;    END IF;&#10;    --&#10;    print_line(&#39;PRINT DATE / TIME  : &#39; || TO_CHAR(l_rec.print_date, &#39;DD-MON-YYYY HH24:MI&#39;));&#10;    print_line(&#39;&#39;);&#10;    --&#10;    print_line(&#39;&#39;);&#10;    print_line(&#39;&#39;);&#10;    print_line(&#39;&#39;);&#10;    print_line(CHR(12));&#10;END do_print_page_hdr;&#10;--&#10;--&#10;--&#10;-----------------------------------------------------------------------------------------&#10;--&#10;-- Exception report routines&#10;--&#10;-----------------------------------------------------------------------------------------&#10;--&#10;PROCEDURE rpt_ACTIVE_OFFENDERS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;      WITH&#10;        L AS (&#10;          SELECT DISTINCT&#10;            CL.offender_id,&#10;            DECODE(CL.role_code, &#39;OM&#39;, &#39;L1&#39;, &#39;L3&#39;) AS RBAC_level,&#10;            T.probation_area_id,&#10;            CL.trust_provider_team_id,&#10;            CL.staff_employee_id&#10;          FROM&#10;            caseload CL&#10;              INNER JOIN all_team T ON T.trust_provider_flag &#61; CL.trust_provider_flag AND T.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;          WHERE PA.code &#61; UPPER(TRIM(p_crc))&#10;            AND CL.trust_provider_flag &#61; 0&#10;        ),&#10;        L1 AS (&#10;          SELECT DISTINCT offender_id, probation_area_id&#10;          FROM L&#10;          WHERE rbac_level &#61; &#39;L1&#39;&#10;            --AND &#39; || CASE WHEN NVL(p_team_id, -1)  &gt; 0 THEN &#39;trust_provider_team_id &#61; :p_team_id&#39; ELSE &#39;NVL(:p_team_id, -1) &lt; 0&#39;  END || &#39;&#10;            --AND &#39; || CASE WHEN NVL(p_staff_id, -1) &gt; 0 THEN &#39;staff_employee_id &#61; :p_staff_id&#39;     ELSE &#39;NVL(:p_staff_id, -1) &lt; 0&#39; END || &#39;&#10;        ),&#10;        L3 AS (&#10;          SELECT DISTINCT offender_id, probation_area_id&#10;          FROM L&#10;          WHERE rbac_level &#61; &#39;L3&#39;&#10;            --AND &#39; || CASE WHEN NVL(p_team_id, -1)  &gt; 0 THEN &#39;trust_provider_team_id &#61; :p_team_id&#39; ELSE &#39;NVL(:p_team_id, -1) &lt; 0&#39;  END || &#39;&#10;            --AND &#39; || CASE WHEN NVL(p_staff_id, -1) &gt; 0 THEN &#39;staff_employee_id &#61; :p_staff_id&#39;     ELSE &#39;NVL(:p_staff_id, -1) &lt; 0&#39; END || &#39;&#10;            AND offender_id NOT IN ( SELECT offender_id FROM L WHERE rbac_level &#61; &#39;L1&#39; )&#10;        )&#10;      --&#10;      SELECT&#10;        &#39;L1&#39;                                  AS RBAC_level_code,&#10;        &#39;RBAC Level 1 - TOTAL&#39;                AS RBAC_level_desc,&#10;        COUNT(DISTINCT L1.offender_id)        AS num_of_rows&#10;      FROM L1&#10;      UNION ALL&#10;      SELECT&#10;        &#39;L1_1&#39;                                AS RBAC_level_code,&#10;        &#39;RBAC Level 1 - Submitted to CRC&#39;     AS RBAC_level_desc,&#10;        COUNT(DISTINCT L1.offender_id)        AS num_of_rows&#10;      FROM&#10;        L1&#10;          INNER JOIN offender_crc_export E ON E.offender_id         &#61; L1.offender_id&#10;                                          AND E.crc_provider_id     &#61; L1.probation_area_id&#10;                                          AND E.current_record_flag &#61; &#39;Y&#39;&#10;                                          AND NVL(E.error_flag, 0)  &#61; 0&#10;                                          AND submitted_datetime IS NOT NULL&#10;      UNION ALL&#10;      SELECT&#10;        &#39;L1_2&#39;                                AS RBAC_level_code,&#10;        &#39;RBAC Level 1 - Processed by CRC&#39;     AS RBAC_level_desc,&#10;        COUNT(DISTINCT L1.offender_id)        AS num_of_rows&#10;      FROM&#10;        L1&#10;          INNER JOIN offender_crc_export E ON E.offender_id         &#61; L1.offender_id&#10;                                          AND E.crc_provider_id     &#61; L1.probation_area_id&#10;                                          AND E.current_record_flag &#61; &#39;Y&#39;&#10;                                          AND NVL(E.error_flag, 0)  &#61; 0&#10;                                          AND processed_datetime IS NOT NULL&#10;      UNION ALL&#10;      SELECT&#10;        &#39;L1_3&#39;                                AS RBAC_level_code,&#10;        &#39;RBAC Level 1 - CRC Export Error&#39;     AS RBAC_level_desc,&#10;        COUNT(DISTINCT L1.offender_id)        AS num_of_rows&#10;      FROM&#10;        L1&#10;          INNER JOIN offender_crc_export E ON E.offender_id         &#61; L1.offender_id&#10;                                          AND E.crc_provider_id     &#61; L1.probation_area_id&#10;                                          AND E.current_record_flag &#61; &#39;Y&#39;&#10;                                          AND NVL(E.error_flag, 0)  &gt; 0&#10;      UNION ALL&#10;      SELECT&#10;        &#39;L3&#39;                                  AS RBAC_level_code,&#10;        &#39;RBAC Level 3 - TOTAL&#39;                AS RBAC_level_desc,&#10;        COUNT(DISTINCT offender_id)           AS num_of_rows&#10;      FROM L3&#10;      UNION ALL&#10;      SELECT&#10;        &#39;L3_1&#39;                                AS RBAC_level_code,&#10;        &#39;RBAC Level 3 - Submitted to CRC&#39;     AS RBAC_level_desc,&#10;        COUNT(DISTINCT L3.offender_id)        AS num_of_rows&#10;      FROM&#10;        L3&#10;          INNER JOIN offender_crc_export E ON E.offender_id         &#61; L3.offender_id&#10;                                          AND E.crc_provider_id     &#61; L3.probation_area_id&#10;                                          AND E.current_record_flag &#61; &#39;Y&#39;&#10;                                          AND NVL(E.error_flag, 0)  &#61; 0&#10;                                          AND submitted_datetime IS NOT NULL&#10;      UNION ALL&#10;      SELECT&#10;        &#39;L3_2&#39;                                AS RBAC_level_code,&#10;        &#39;RBAC Level 3 - Processed by CRC&#39;     AS RBAC_level_desc,&#10;        COUNT(DISTINCT L3.offender_id)        AS num_of_rows&#10;      FROM&#10;        L3&#10;          INNER JOIN offender_crc_export E ON E.offender_id         &#61; L3.offender_id&#10;                                          AND E.crc_provider_id     &#61; L3.probation_area_id&#10;                                          AND E.current_record_flag &#61; &#39;Y&#39;&#10;                                          AND NVL(E.error_flag, 0)  &#61; 0&#10;                                          AND E.processed_datetime IS NOT NULL&#10;      UNION ALL&#10;      SELECT&#10;        &#39;L3_3&#39;                                AS RBAC_level_code,&#10;        &#39;RBAC Level 3 - CRC Export Error&#39;     AS RBAC_level_desc,&#10;        COUNT(DISTINCT L3.offender_id)        AS num_of_rows&#10;      FROM&#10;        L3&#10;          INNER JOIN offender_crc_export E ON E.offender_id         &#61; L3.offender_id&#10;                                          AND E.crc_provider_id     &#61; L3.probation_area_id&#10;                                          AND E.current_record_flag &#61; &#39;Y&#39;&#10;                                          AND NVL(E.error_flag, 0)  &gt; 0;&#10;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 11, &#39;L&#39;, &#39;Y&#39;, &#39;rbac_src_code&#39;, &#39;RBAC Level Code&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;rbac_src_desc&#39;, &#39;RBAC Level Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;N&#39;,  10, &#39;R&#39;, &#39;Y&#39;, &#39;qty&#39;          , &#39;Number of Offender Records&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        -- RBAC_level_code,&#10;        -- RBAC_level_desc,&#10;        -- num_of_rows&#10;        l_cols_TAB(1).value :&#61; l_rec.RBAC_level_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.RBAC_level_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 132;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Active Offenders - L1/L3 levels&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_ACTIVE_OFFENDERS;&#10;--&#10;PROCEDURE rpt_REGISTRATIONS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH R AS (&#10;            SELECT DISTINCT&#10;              R1.registration_id,&#10;              R1.offender_id,&#10;              CASE WHEN R1.deregistered &#61; 1&#10;                  THEN &#39;INACTIVE&#39;&#10;                  ELSE &#39;ACTIVE&#39;&#10;              END             AS registration_status,&#10;              RT1.code        AS registration_type_code,&#10;              RT1.description AS registration_type_desc&#10;            FROM&#10;              registration R1&#10;                INNER JOIN r_register_type RT1 ON RT1.register_type_id &#61; R1.register_type_id&#10;            WHERE 1&#61;1&#10;              --AND RT1.code NOT IN (&#39;IMAP&#39;,&#39;IMAR&#39;)&#10;              AND EXISTS(&#10;                SELECT DISTINCT&#10;                  CL.offender_id,&#10;                  DECODE(CL.role_code, &#39;OM&#39;, &#39;L1&#39;, &#39;L3&#39;) AS RBAC_level,&#10;                  T.probation_area_id,&#10;                  CL.trust_provider_team_id,&#10;                  CL.staff_employee_id&#10;                FROM&#10;                  caseload CL&#10;                    INNER JOIN all_team T ON T.trust_provider_flag &#61; CL.trust_provider_flag AND T.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                      INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;                WHERE PA.code &#61; UPPER(TRIM(p_crc))&#10;                  AND CL.trust_provider_flag &#61; 0&#10;                  AND CL.offender_id &#61; R1.offender_id )&#10;          )&#10;        --&#10;        SELECT&#10;          registration_type_code,&#10;          registration_type_desc,&#10;          COUNT( DISTINCT offender_id )                        AS num_of_rows_OFF,&#10;          COUNT( DISTINCT registration_id )                    AS num_of_rows_REG,&#10;          SUM( DECODE(registration_status, &#39;ACTIVE&#39;, 1, 0) )   AS num_of_rows_REG_ACTIVE,&#10;          SUM( DECODE(registration_status, &#39;INACTIVE&#39;, 1, 0) ) AS num_of_rows_REG_INACTIVE&#10;        FROM R&#10;        GROUP BY&#10;          --registration_status,&#10;          registration_type_code,&#10;          registration_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;registration_type_code&#39;, &#39;Registration Type&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;registration_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 13, &#39;L&#39;, &#39;Y&#39;, &#39;registration_qty_active&#39;, &#39;Total Active Registrations&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;registration_qty_inactive&#39;, &#39;Total Inactive Registrations&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.registration_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.registration_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_REG_ACTIVE;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_REG_INACTIVE;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 132;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Registrations&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_REGISTRATIONS;&#10;--&#10;PROCEDURE rpt_ORDERS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              OM.order_manager_id   AS om_id,&#10;              E.offender_id,&#10;              CASE WHEN D.active_flag &#61; 1&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              DT.disposal_type_code AS om_type_code,&#10;              DT.description        AS om_type_desc&#10;            FROM&#10;              order_manager OM&#10;                INNER JOIN event E ON E.event_id &#61; OM.event_id&#10;                  INNER JOIN disposal D ON D.event_id &#61; E.event_id&#10;                    INNER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.allocation_team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; E.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;Order Type&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 16, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed Orders - Total Active   Orders&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 16, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed Orders - Total Inactive Orders&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Active Orders&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Inactive Orders&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 160;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Orders&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_ORDERS;&#10;--&#10;PROCEDURE rpt_CUSTODIAL_ORDERS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              C.custody_id          AS om_id,&#10;              E.offender_id,&#10;              CASE WHEN D.active_flag &#61; 1&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              CS.code_value         AS om_type_code,&#10;              CS.code_description   AS om_type_desc&#10;--              DT.disposal_type_code AS om_type_code,&#10;--              DT.description        AS om_type_desc&#10;            FROM&#10;              order_manager OM&#10;                INNER JOIN event E ON E.event_id &#61; OM.event_id&#10;                  INNER JOIN disposal D ON D.event_id &#61; E.event_id&#10;                    INNER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;                    INNER JOIN custody C ON C.disposal_id &#61; D.disposal_id&#10;                      INNER JOIN r_standard_reference_list CS ON CS.standard_reference_list_id &#61; C.custodial_status_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.allocation_team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              --AND DT.custodial_order &#61; &#39;Y&#39;&#10;              AND DT.sentence_type &#61; &#39;SC&#39;&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; E.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM&#10;--          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;--          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;--          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;--          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        WHERE om_status &#61; &#39;ACTIVE&#39;&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 9, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;Custodial Status  Code&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 19, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Active       Custodial Orders&#39;);&#10;        --do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 16, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed Orders - Total Active   Orders&#39;);&#10;        --do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 16, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed Orders - Total Inactive Orders&#39;);&#10;        --do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Active Orders&#39;);&#10;        --do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Inactive Orders&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM;&#10;--        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;--        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;--        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;--        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 90;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Active Custodial Orders&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_CUSTODIAL_ORDERS;&#10;--&#10;PROCEDURE rpt_REQUIREMENTS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              OM.rqmnt_id           AS om_id,&#10;              E.offender_id,&#10;              CASE WHEN R.active_flag &#61; 1&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              --&#10;              CASE WHEN R.rqmnt_type_main_category_id IS NOT NULL THEN&#10;                  PKG_Lookups.funcgetTabRecord_CACHED(&#10;                      p_table &#61;&gt; &#39;r_rqmnt_type_main_category&#39;,&#10;                      p_data_fld &#61;&gt; &#39;CODE&#39;,&#10;                      p_ref_col  &#61;&gt; &#39;rqmnt_type_main_category_id&#39;,&#10;                      p_ref_val  &#61;&gt; TO_CHAR(R.rqmnt_type_main_category_id))&#10;              ELSE&#10;                  PKG_Lookups.funcgetTabRecord_CACHED(&#10;                      p_table &#61;&gt; &#39;r_ad_rqmnt_type_main_category&#39;,&#10;                      p_data_fld &#61;&gt; &#39;&#39;&#39;[AD] &#39;&#39; || CODE&#39;,&#10;                      p_ref_col  &#61;&gt; &#39;ad_rqmnt_type_main_category_id&#39;,&#10;                      p_ref_val  &#61;&gt; TO_CHAR(R.ad_rqmnt_type_main_category_id))&#10;              END                   AS om_type_code,&#10;              --&#10;              CASE WHEN R.rqmnt_type_main_category_id IS NOT NULL THEN&#10;                  PKG_Lookups.funcgetTabRecord_CACHED(&#10;                      p_table &#61;&gt; &#39;r_rqmnt_type_main_category&#39;,&#10;                      p_data_fld &#61;&gt; &#39;DESCRIPTION&#39;,&#10;                      p_ref_col  &#61;&gt; &#39;rqmnt_type_main_category_id&#39;,&#10;                      p_ref_val  &#61;&gt; TO_CHAR(R.rqmnt_type_main_category_id))&#10;              ELSE&#10;                  PKG_Lookups.funcgetTabRecord_CACHED(&#10;                      p_table &#61;&gt; &#39;r_ad_rqmnt_type_main_category&#39;,&#10;                      p_data_fld &#61;&gt; &#39;DESCRIPTION&#39;,&#10;                      p_ref_col  &#61;&gt; &#39;ad_rqmnt_type_main_category_id&#39;,&#10;                      p_ref_val  &#61;&gt; TO_CHAR(R.ad_rqmnt_type_main_category_id))&#10;              END                   AS om_type_desc&#10;              --&#10;            FROM&#10;              rqmnt_manager OM&#10;                INNER JOIN rqmnt R ON R.rqmnt_id &#61; OM.rqmnt_id&#10;                  INNER JOIN disposal D ON D.disposal_id &#61; R.disposal_id&#10;                    --INNER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;                    INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.allocated_team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; E.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 25, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;Requirement Type /       [AD]ditional Requirement Type&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 50, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed Requirements - Total Active          Requirements&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed Requirements - Total Inactive       Requirements&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Active        Requirements&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Inactive        Requirements&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 180;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Requirements&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_REQUIREMENTS;&#10;--&#10;PROCEDURE rpt_LIC_CONDITIONS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              OM.lic_condition_id   AS om_id,&#10;              E.offender_id,&#10;              CASE WHEN L.active_flag &#61; 1&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_lic_cond_type_main_cat&#39;,&#10;                  p_data_fld &#61;&gt; &#39;CODE&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;lic_cond_type_main_cat_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(L.lic_cond_type_main_cat_id)) om_type_code,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_lic_cond_type_main_cat&#39;,&#10;                  p_data_fld &#61;&gt; &#39;DESCRIPTION&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;lic_cond_type_main_cat_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(L.lic_cond_type_main_cat_id)) om_type_desc&#10;              --&#10;            FROM&#10;              lic_condition_manager OM&#10;                INNER JOIN lic_condition L ON L.lic_condition_id &#61; OM.lic_condition_id&#10;                  INNER JOIN disposal D ON D.disposal_id &#61; L.disposal_id&#10;                    --INNER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;                    INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; E.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;License Condition Type&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 28, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed Licence Conditions - Total Active Licence Conditions&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 28, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed Licence Conditions - Total Inactive Licence Conditions&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Active Licence Conditions&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Inactive        Licence Conditions&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 200;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Licence Conditions&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_LIC_CONDITIONS;&#10;--&#10;PROCEDURE rpt_PSS_REQUIREMENTS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              OM.pss_rqmnt_id       AS om_id,&#10;              E.offender_id,&#10;              CASE WHEN R.active_flag &#61; 1&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_pss_rqmnt_type_main_category&#39;,&#10;                  p_data_fld &#61;&gt; &#39;CODE&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;pss_rqmnt_type_main_cat_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(R.pss_rqmnt_type_main_cat_id)) AS om_type_code,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_pss_rqmnt_type_main_category&#39;,&#10;                  p_data_fld &#61;&gt; &#39;DESCRIPTION&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;pss_rqmnt_type_main_cat_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(R.pss_rqmnt_type_main_cat_id)) AS om_type_desc&#10;              --&#10;            FROM&#10;              pss_rqmnt_manager OM&#10;                INNER JOIN pss_rqmnt R ON R.pss_rqmnt_id &#61; OM.pss_rqmnt_id&#10;                  INNER JOIN custody C ON C.custody_id &#61; R.custody_id&#10;                    INNER JOIN disposal D ON D.disposal_id &#61; C.disposal_id&#10;                      --INNER JOIN r_disposal_type DT ON DT.disposal_type_id &#61; D.disposal_type_id&#10;                      INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; E.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 25, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;PSS Requirement Type Code&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 50, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed Requirements - Total Active          PSS Requirements&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed Requirements - Total Inactive       PSS Requirements&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Active        PSS Requirements&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Inactive        PSS Requirements&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 180;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius PSS Requirements&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_PSS_REQUIREMENTS;&#10;--&#10;PROCEDURE rpt_NSI(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              OM.nsi_id             AS om_id,&#10;              N.offender_id,&#10;              CASE WHEN N.active_flag &#61; 1&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_nsi_type&#39;,&#10;                  p_data_fld &#61;&gt; &#39;CODE&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;nsi_type_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(N.nsi_type_id)) AS om_type_code,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_nsi_type&#39;,&#10;                  p_data_fld &#61;&gt; &#39;DESCRIPTION&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;nsi_type_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(N.nsi_type_id)) AS om_type_desc&#10;              --&#10;            FROM&#10;              nsi_manager OM&#10;                INNER JOIN NSI N ON N.nsi_id &#61; OM.nsi_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; N.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 25, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;NSI Type Code&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 50, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed NSIs - Total Active NSI&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed NSIs - Total Inactive NSI&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Active NSI&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Inactive NSI&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 180;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius NSIs&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_NSI;&#10;--&#10;PROCEDURE rpt_COURT_REPORTS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              OM.court_report_id   AS om_id,&#10;              E.offender_id,&#10;              CASE WHEN R.completed_date IS NULL&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_court_report_type&#39;,&#10;                  p_data_fld &#61;&gt; &#39;CODE&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;court_report_type_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(R.court_report_type_id)) om_type_code,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;r_court_report_type&#39;,&#10;                  p_data_fld &#61;&gt; &#39;DESCRIPTION&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;court_report_type_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(R.court_report_type_id)) om_type_desc&#10;              --&#10;            FROM&#10;              report_manager OM&#10;                INNER JOIN court_report R ON R.court_report_id &#61; OM.court_report_id&#10;                  INNER JOIN court_appearance CA ON CA.court_appearance_id &#61; R.court_appearance_id&#10;                    INNER JOIN event E ON E.event_id &#61; CA.event_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; E.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;Court Report Type&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 23, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed Court Reports -       Total Incomplete         Court Reports&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 23, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed Court Reports -       Total Complete          Court Reports&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 20, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders - Total Incomplete       Court Reports&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Complete           Court Reports&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 200;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Court Reports&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_COURT_REPORTS;&#10;--&#10;PROCEDURE rpt_INST_REPORTS(p_crc VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs IS&#10;        WITH OM1 AS (&#10;            SELECT DISTINCT&#10;              OM.institutional_report_id AS om_id,&#10;              E.offender_id,&#10;              CASE WHEN R.date_completed IS NULL&#10;                  THEN &#39;ACTIVE&#39;&#10;                  ELSE &#39;INACTIVE&#39;&#10;              END                   AS om_status,&#10;              CASE WHEN PA.code &#61; UPPER(TRIM(p_crc))&#10;                  THEN &#39;MANAGED&#39;&#10;                  ELSE &#39;ENGAGED&#39;&#10;              END                   AS om_ownership,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;R_STANDARD_REFERENCE_LIST&#39;,&#10;                  p_data_fld &#61;&gt; &#39;CODE_VALUE&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;standard_reference_list_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(R.institution_report_type_id)) om_type_code,&#10;              --&#10;              PKG_Lookups.funcgetTabRecord_CACHED(&#10;                  p_table &#61;&gt; &#39;R_STANDARD_REFERENCE_LIST&#39;,&#10;                  p_data_fld &#61;&gt; &#39;CODE_DESCRIPTION&#39;,&#10;                  p_ref_col  &#61;&gt; &#39;standard_reference_list_id&#39;,&#10;                  p_ref_val  &#61;&gt; TO_CHAR(R.institution_report_type_id)) om_type_desc&#10;              --&#10;            FROM&#10;              report_manager OM&#10;                INNER JOIN institutional_report R ON R.institutional_report_id &#61; OM.institutional_report_id&#10;                  INNER JOIN custody C ON C.custody_id &#61; R.custody_id&#10;                    INNER JOIN disposal D ON D.disposal_id &#61; C.disposal_id&#10;                      INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;                  INNER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;            WHERE 1&#61;1&#10;              AND OM.active_flag &#61; 1&#10;              AND EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    caseload CL&#10;                      INNER JOIN all_team T1 ON T1.trust_provider_flag &#61; CL.trust_provider_flag AND T1.trust_provider_team_id &#61; CL.trust_provider_team_id&#10;                        INNER JOIN probation_area PA1 ON PA1.probation_area_id &#61; T1.probation_area_id&#10;                  WHERE CL.offender_id &#61; E.offender_id&#10;                    AND PA1.code &#61; UPPER(TRIM(p_crc))&#10;                    AND CL.trust_provider_flag &#61; 0 )&#10;          )&#10;        --&#10;        SELECT&#10;          om_type_code,&#10;          om_type_desc,&#10;          COUNT( DISTINCT offender_id )                 AS num_of_rows_OFF,&#10;          COUNT( DISTINCT om_id )                       AS num_of_rows_OM,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;MANAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_MANAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;ACTIVE&#39;   AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_A_ENGAGED,&#10;          SUM( CASE WHEN om_status &#61; &#39;INACTIVE&#39; AND om_ownership &#61; &#39;ENGAGED&#39; THEN 1 ELSE 0 END ) AS num_of_rows_OM_I_ENGAGED&#10;        FROM OM1&#10;        GROUP BY&#10;          om_type_code,&#10;          om_type_desc&#10;        ORDER BY 1&#10;    ;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_code&#39;, &#39;Institution           Report    Type&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;om_type_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;off_qty&#39;, &#39;Total Offender Records&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 23, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_managed&#39;, &#39;Managed                Institutional Reports -       Total Incomplete Institutional Reports&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 23, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_managed&#39;, &#39;Managed                Institutional Reports -       Total Complete   Institutional Reports&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 22, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_active_engaged&#39;, &#39;Engaged Offenders -   Total Incomplete       Institutional Reports&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 21, &#39;L&#39;, &#39;Y&#39;, &#39;om_qty_inactive_engaged&#39;, &#39;Engaged Offenders -  Total Complete       Institutional Reports&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.om_type_code;&#10;        l_cols_TAB(2).value :&#61; l_rec.om_type_desc;&#10;        l_cols_TAB(3).value :&#61; l_rec.num_of_rows_OFF;&#10;        l_cols_TAB(4).value :&#61; l_rec.num_of_rows_OM_A_MANAGED;&#10;        l_cols_TAB(5).value :&#61; l_rec.num_of_rows_OM_I_MANAGED;&#10;        l_cols_TAB(6).value :&#61; l_rec.num_of_rows_OM_A_ENGAGED;&#10;        l_cols_TAB(7).value :&#61; l_rec.num_of_rows_OM_I_ENGAGED;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 200;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Institution Reports&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_INST_REPORTS;&#10;--&#10;--&#10;--&#10;FUNCTION get_transfer_rejection_reason(p_source_table VARCHAR2) RETURN NUMBER&#10;IS&#10;    l_domain VARCHAR2(100);&#10;    l_ret NUMBER;&#10;BEGIN&#10;    l_domain :&#61;&#10;              CASE&#10;                  WHEN p_source_table &#61; &#39;OFFENDER_TRANSFER&#39;             THEN &#39;OFFENDER AREA TRANSFER REJECTION REASON&#39;&#10;                  WHEN p_source_table &#61; &#39;ORDER_TRANSFER&#39;                THEN &#39;ORDER AREA TRANSFER REJECTION REASON&#39;&#10;                  WHEN p_source_table &#61; &#39;LIC_CONDITION_TRANSFER&#39;        THEN &#39;LICENCE AREA TRANSFER REJECTION REASON&#39;&#10;                  WHEN p_source_table &#61; &#39;RQMNT_TRANSFER&#39;                THEN &#39;REQUIREMENT AREA TRANSFER REJECTION REASON&#39;&#10;                  WHEN p_source_table &#61; &#39;NSI_TRANSFER&#39;                  THEN &#39;NON STATUTORY INTERVENTION AREA TRANSFER REJECTION REASON&#39;&#10;                  WHEN p_source_table &#61; &#39;PSS_RQMNT_TRANSFER&#39;            THEN &#39;PSS AREA TRANSFER REJECTION REASON&#39;&#10;                  WHEN p_source_table &#61; &#39;COURT_REPORT_TRANSFER&#39;         THEN &#39;CR AREA TRANSFER REJECTION REASON&#39;&#10;                  WHEN p_source_table &#61; &#39;INSTITUTIONAL_REPORT_TRANSFER&#39; THEN &#39;IR AREA TRANSFER REJECTION REASON&#39;&#10;              END;&#10;    --&#10;    l_ret :&#61; PKG_Lookups.funcgetStdRefListID(l_domain, &#39;SP&#39;);&#10;    IF l_ret IS NULL THEN&#10;        l_ret :&#61; PKG_Lookups.funcgetStdRefListID(l_domain, &#39;ER&#39;);&#10;    END IF;&#10;    --&#10;    RETURN l_ret;&#10;    --&#10;END get_transfer_rejection_reason;&#10;--&#10;FUNCTION get_transfer_withdrawal_reason(p_source_table VARCHAR2) RETURN NUMBER&#10;IS&#10;    l_domain VARCHAR2(100) :&#61; &#39;TRANSFER WITHDRAWAL REASON&#39;;&#10;    l_ret NUMBER;&#10;BEGIN&#10;    --&#10;    l_ret :&#61; PKG_Lookups.funcgetStdRefListID(l_domain, &#39;SP&#39;);&#10;    IF l_ret IS NULL THEN&#10;        l_ret :&#61; PKG_Lookups.funcgetStdRefListID(l_domain, &#39;ER&#39;);&#10;    END IF;&#10;    --&#10;    RETURN l_ret;&#10;    --&#10;END get_transfer_withdrawal_reason;&#10;--&#10;PROCEDURE rpt_PENDING_TRANSFERS(&#10;    p_crc                     VARCHAR2,&#10;    p_direction               VARCHAR2,&#10;    p_print_header            VARCHAR2 DEFAULT &#39;Y&#39;,&#10;    p_close_pending_transfers VARCHAR2 DEFAULT &#39;N&#39;)&#10;IS&#10;    --&#10;    CURSOR cs (param_crc IN VARCHAR2, param_direction IN VARCHAR2) IS&#10;        WITH pending_transfers AS (&#10;            --&#10;            -- OFFENDER_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              OT.offender_transfer_id                   AS transfer_id,&#10;              &#39;OFFENDER_TRANSFER&#39;                       AS source_table,&#10;              OT.origin_team_id,&#10;              OT.receiving_team_id,&#10;              OT.transfer_status_id,&#10;              --&#10;              OT.request_date                           AS transfer_request_date,&#10;              OT.receiving_staff_id,&#10;              OT.origin_staff_id,&#10;              OT.offender_id,&#10;              OT.offender_transfer_id,&#10;              NULL AS nsi_transfer_id,&#10;              NULL AS nsi_id,&#10;              NULL AS order_transfer_id,&#10;              NULL AS event_id,&#10;              NULL AS rqmnt_transfer_id,&#10;              NULL AS rqmnt_id,&#10;              NULL AS lic_condition_transfer_id,&#10;              NULL AS lic_condition_id,&#10;              NULL AS pss_rqmnt_transfer_id,&#10;              NULL AS pss_rqmnt_id,&#10;              NULL AS institutional_rep_transfer_id,&#10;              NULL AS institutional_report_id,&#10;              NULL AS court_report_transfer_id,&#10;              NULL AS court_report_id,&#10;              --&#10;              OT.allocation_reason_id,&#10;              OT.notes AS transfer_notes&#10;              --&#10;            FROM&#10;              offender_transfer OT&#10;                INNER JOIN r_standard_reference_list r1 ON OT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;                INNER JOIN offender O ON O.offender_id &#61; OT.offender_id&#10;                INNER JOIN offender_manager OM ON OM.offender_id  &#61; OT.offender_id AND OM.active_flag &#61; 1&#10;                LEFT OUTER JOIN master_transfer MT ON OT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;            --&#10;            UNION ALL&#10;            --&#10;            -- ORDER_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              OT.order_transfer_id                      AS transfer_id,&#10;              &#39;ORDER_TRANSFER&#39;                          AS source_table,&#10;              OT.origin_team_id,&#10;              OT.receiving_team_id,&#10;              OT.transfer_status_id,&#10;              --&#10;              OT.request_date                           AS transfer_request_date,&#10;              OT.receiving_staff_id,&#10;              OT.origin_staff_id,&#10;              OT.offender_id,&#10;              NULL AS offender_transfer_id,&#10;              NULL AS nsi_transfer_id,&#10;              NULL AS nsi_id,&#10;              OT.order_transfer_id,&#10;              OT.event_id,&#10;              NULL AS rqmnt_transfer_id,&#10;              NULL AS rqmnt_id,&#10;              NULL AS lic_condition_transfer_id,&#10;              NULL AS lic_condition_id,&#10;              NULL AS pss_rqmnt_transfer_id,&#10;              NULL AS pss_rqmnt_id,&#10;              NULL AS institutional_rep_transfer_id,&#10;              NULL AS institutional_report_id,&#10;              NULL AS court_report_transfer_id,&#10;              NULL AS court_report_id,&#10;              --&#10;              OT.allocation_reason_id,&#10;              OT.notes                                  AS transfer_notes&#10;              --&#10;            FROM&#10;              order_transfer OT&#10;                INNER JOIN r_standard_reference_list r1 ON OT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;                INNER JOIN event E ON E.event_id &#61; OT.event_id&#10;                  INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;                INNER JOIN order_manager OM ON OM.event_id &#61; OT.event_id AND OM.active_flag &#61; 1&#10;                LEFT OUTER JOIN master_transfer mt ON OT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;              AND E.soft_deleted &#61; 0&#10;            --&#10;            UNION ALL&#10;            --&#10;            -- RQMNT_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              RT.rqmnt_transfer_id                      AS transfer_id,&#10;              &#39;RQMNT_TRANSFER&#39;                          AS source_table,&#10;              RT.origin_team_id,&#10;              RT.receiving_team_id,&#10;              RT.transfer_status_id,&#10;              --&#10;              RT.request_date                           AS transfer_request_date,&#10;              RT.receiving_staff_id,&#10;              RT.origin_staff_id,&#10;              RT.offender_id,&#10;              NULL AS offender_transfer_id,&#10;              NULL AS nsi_transfer_id,&#10;              NULL AS nsi_id,&#10;              NULL AS order_transfer_id,&#10;              D.event_id,&#10;              RT.rqmnt_transfer_id,&#10;              RT.rqmnt_id,&#10;              NULL AS lic_condition_transfer_id,&#10;              NULL AS lic_condition_id,&#10;              NULL AS pss_rqmnt_transfer_id,&#10;              NULL AS pss_rqmnt_id,&#10;              NULL AS institutional_rep_transfer_id,&#10;              NULL AS institutional_report_id,&#10;              NULL AS court_report_transfer_id,&#10;              NULL AS court_report_id,&#10;              --&#10;              RT.allocation_reason_id,&#10;              RT.notes                                  AS transfer_notes&#10;              --&#10;            FROM&#10;              rqmnt_transfer RT&#10;                INNER JOIN r_standard_reference_list r1 ON RT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;                INNER JOIN rqmnt R ON R.rqmnt_id &#61; RT.rqmnt_id&#10;                  INNER JOIN disposal D ON D.disposal_id &#61; R.disposal_id&#10;                    INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                      INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;                  INNER JOIN rqmnt_manager OM ON OM.rqmnt_id &#61; R.rqmnt_id AND OM.active_flag &#61; 1&#10;                LEFT OUTER JOIN master_transfer mt ON RT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;              AND R.soft_deleted &#61; 0&#10;            --&#10;            UNION ALL&#10;            --&#10;            -- LIC_CONDITION_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              LCT.lic_condition_transfer_id             AS transfer_id,&#10;              &#39;LIC_CONDITION_TRANSFER&#39;                  AS source_table,&#10;              LCT.origin_team_id,&#10;              LCT.receiving_team_id,&#10;              LCT.transfer_status_id,&#10;              --&#10;              LCT.request_date                          AS transfer_request_date,&#10;              LCT.receiving_staff_id,&#10;              LCT.origin_staff_id,&#10;              LCT.offender_id,&#10;              NULL AS offender_transfer_id,&#10;              NULL AS nsi_transfer_id,&#10;              NULL AS nsi_id,&#10;              NULL AS order_transfer_id,&#10;              D.event_id,&#10;              NULL AS rqmnt_transfer_id,&#10;              NULL AS rqmnt_id,&#10;              LCT.lic_condition_transfer_id,&#10;              LCT.lic_condition_id,&#10;              NULL AS pss_rqmnt_transfer_id,&#10;              NULL AS pss_rqmnt_id,&#10;              NULL AS institutional_rep_transfer_id,&#10;              NULL AS institutional_report_id,&#10;              NULL AS court_report_transfer_id,&#10;              NULL AS court_report_id,&#10;              --&#10;              LCT.allocation_reason_id,&#10;              LCT.notes                                 AS transfer_notes&#10;              --&#10;            FROM&#10;              lic_condition_transfer LCT&#10;                INNER JOIN r_standard_reference_list r1 ON LCT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;                INNER JOIN lic_condition LC ON LC.lic_condition_id &#61; LCT.lic_condition_id&#10;                  INNER JOIN disposal D ON D.disposal_id &#61; LC.disposal_id&#10;                    INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                      INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;                  INNER JOIN lic_condition_manager OM ON OM.lic_condition_id &#61; LC.lic_condition_id AND OM.active_flag &#61; 1&#10;                LEFT OUTER JOIN master_transfer MT ON LCT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;              AND LC.soft_deleted &#61; 0&#10;            --&#10;            UNION ALL&#10;            --&#10;            -- NSI_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              NT.nsi_transfer_id                        AS transfer_id,&#10;              &#39;NSI_TRANSFER&#39;                            AS source_table,&#10;              NT.origin_team_id,&#10;              NT.target_team_id                         AS receiving_team_id,&#10;              NT.transfer_status_id,&#10;              --&#10;              NT.request_date                           AS transfer_request_date,&#10;              NT.target_staff_id,&#10;              NT.origin_staff_id,&#10;              NT.offender_id,&#10;              NULL AS offender_transfer_id,&#10;              NT.nsi_transfer_id,&#10;              NT.nsi_id,&#10;              NULL AS order_transfer_id,&#10;              N.event_id,&#10;              NULL AS rqmnt_transfer_id,&#10;              NULL AS rqmnt_id,&#10;              NULL AS lic_condition_transfer_id,&#10;              NULL AS lic_condition_id,&#10;              NULL AS pss_rqmnt_transfer_id,&#10;              NULL AS pss_rqmnt_id,&#10;              NULL AS institutional_rep_transfer_id,&#10;              NULL AS institutional_report_id,&#10;              NULL AS court_report_transfer_id,&#10;              NULL AS court_report_id,&#10;              --&#10;              NT.allocation_reason_id,&#10;              NT.notes                                  AS transfer_notes&#10;              --&#10;            FROM nsi_transfer NT&#10;              INNER JOIN r_standard_reference_list r1 ON NT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;              INNER JOIN nsi N ON N.nsi_id &#61; NT.nsi_id&#10;                INNER JOIN offender O ON O.offender_id &#61; N.offender_id&#10;                INNER JOIN nsi_manager OM ON OM.nsi_id &#61; N.nsi_id AND OM.active_flag &#61; 1&#10;              LEFT OUTER JOIN master_transfer MT ON NT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;              AND N.soft_deleted &#61; 0&#10;            --&#10;            UNION ALL&#10;            --&#10;            -- PSS_RQMNT_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              PRT.pss_rqmnt_transfer_id                 AS transfer_id,&#10;              &#39;PSS_RQMNT_TRANSFER&#39;                      AS source_table,&#10;              PRT.origin_team_id,&#10;              PRT.receiving_team_id,&#10;              PRT.transfer_status_id,&#10;              --&#10;              PRT.request_date                          AS transfer_request_date,&#10;              PRT.receiving_staff_id,&#10;              PRT.origin_staff_id,&#10;              PRT.offender_id,&#10;              NULL AS offender_transfer_id,&#10;              NULL AS nsi_transfer_id,&#10;              NULL AS nsi_id,&#10;              NULL AS order_transfer_id,&#10;              D.event_id,&#10;              NULL AS rqmnt_transfer_id,&#10;              NULL AS rqmnt_id,&#10;              NULL AS lic_condition_transfer_id,&#10;              NULL AS lic_condition_id,&#10;              PRT.pss_rqmnt_transfer_id,&#10;              PRT.pss_rqmnt_id,&#10;              NULL AS institutional_rep_transfer_id,&#10;              NULL AS institutional_report_id,&#10;              NULL AS court_report_transfer_id,&#10;              NULL AS court_report_id,&#10;              --&#10;              PRT.allocation_reason_id,&#10;              PRT.notes                                 AS transfer_notes&#10;              --&#10;            FROM&#10;              pss_rqmnt_transfer PRT&#10;                INNER JOIN r_standard_reference_list R1 ON PRT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;                INNER JOIN pss_rqmnt PR ON PR.pss_rqmnt_id &#61; PRT.pss_rqmnt_id&#10;                  INNER JOIN custody CUS ON CUS.custody_id &#61; PR.custody_id&#10;                    INNER JOIN disposal D ON D.disposal_id &#61; CUS.disposal_id&#10;                      INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                        INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;                  INNER JOIN pss_rqmnt_manager OM ON OM.pss_rqmnt_id &#61; PR.pss_rqmnt_id AND OM.active_flag &#61; 1&#10;                  LEFT OUTER JOIN master_transfer MT ON PRT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;              AND PR.soft_deleted &#61; 0&#10;            --&#10;            UNION ALL&#10;            --&#10;            -- INSTITUTIONAL_REPORT_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              IRT.institutional_rep_transfer_id         AS transfer_id,&#10;              &#39;INSTITUTIONAL_REPORT_TRANSFER&#39;           AS source_table,&#10;              IRT.origin_team_id,&#10;              IRT.receiving_team_id,&#10;              IRT.transfer_status_id,&#10;              --&#10;              IRT.request_date                          AS transfer_request_date,&#10;              IRT.receiving_staff_id,&#10;              IRT.origin_staff_id,&#10;              IRT.offender_id,&#10;              NULL AS offender_transfer_id,&#10;              NULL AS nsi_transfer_id,&#10;              NULL AS nsi_id,&#10;              NULL AS order_transfer_id,&#10;              D.event_id,&#10;              NULL AS rqmnt_transfer_id,&#10;              NULL AS rqmnt_id,&#10;              NULL AS lic_condition_transfer_id,&#10;              NULL AS lic_condition_id,&#10;              NULL AS pss_rqmnt_transfer_id,&#10;              NULL AS pss_rqmnt_id,&#10;              IRT.institutional_rep_transfer_id,&#10;              IRT.institutional_report_id,&#10;              NULL AS court_report_transfer_id,&#10;              NULL AS court_report_id,&#10;              --&#10;              IRT.allocation_reason_id,&#10;              IRT.notes                                 AS transfer_notes&#10;              --&#10;            FROM&#10;              institutional_report_transfer IRT&#10;                INNER JOIN r_standard_reference_list R1 ON IRT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;                INNER JOIN institutional_report IR ON IR.institutional_report_id &#61; IRT.institutional_report_id&#10;                  INNER JOIN custody CUS ON CUS.custody_id &#61; IR.custody_id&#10;                    INNER JOIN disposal D ON D.disposal_id &#61; CUS.disposal_id&#10;                      INNER JOIN event E ON E.event_id &#61; D.event_id&#10;                        INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;                INNER JOIN report_manager OM ON OM.institutional_report_id &#61; IR.institutional_report_id AND OM.active_flag &#61; 1&#10;                LEFT OUTER JOIN master_transfer MT ON IRT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;              AND IR.soft_deleted &#61; 0&#10;            --&#10;            UNION ALL&#10;            --&#10;            -- COURT_REPORT_TRANSFER&#10;            --&#10;            SELECT&#10;              MT.master_transfer_id,&#10;              MT.transfer_date,&#10;              CRT.court_report_transfer_id              AS transfer_id,&#10;              &#39;COURT_REPORT_TRANSFER&#39;                   AS source_table,&#10;              CRT.origin_team_id,&#10;              CRT.receiving_team_id,&#10;              CRT.transfer_status_id,&#10;              --&#10;              CRT.request_date                          AS transfer_request_date,&#10;              CRT.receiving_staff_id,&#10;              CRT.origin_staff_id,&#10;              CRT.offender_id,&#10;              NULL AS offender_transfer_id,&#10;              NULL AS nsi_transfer_id,&#10;              NULL AS nsi_id,&#10;              NULL AS order_transfer_id,&#10;              CA.event_id,&#10;              NULL AS rqmnt_transfer_id,&#10;              NULL AS rqmnt_id,&#10;              NULL AS lic_condition_transfer_id,&#10;              NULL AS lic_condition_id,&#10;              NULL AS pss_rqmnt_transfer_id,&#10;              NULL AS pss_rqmnt_id,&#10;              NULL AS institutional_rep_transfer_id,&#10;              NULL AS institutional_report_id,&#10;              CRT.court_report_transfer_id,&#10;              CRT.court_report_id,&#10;              --&#10;              CRT.allocation_reason_id,&#10;              CRT.notes AS transfer_notes&#10;              --&#10;            FROM&#10;              court_report_transfer CRT&#10;                INNER JOIN r_standard_reference_list R1 ON CRT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;                INNER JOIN court_report CR ON CR.court_report_id &#61; CRT.court_report_id&#10;                  INNER JOIN court_appearance CA ON CA.court_appearance_id &#61; CR.court_appearance_id&#10;                    INNER JOIN event E ON E.event_id &#61; CA.event_id&#10;                      INNER JOIN offender O ON O.offender_id &#61; E.offender_id&#10;                  INNER JOIN report_manager OM ON OM.court_report_id &#61; CRT.court_report_id AND OM.active_flag &#61; 1&#10;                LEFT OUTER JOIN master_transfer MT ON CRT.master_transfer_id &#61; MT.master_transfer_id&#10;            WHERE O.soft_deleted &#61; 0&#10;              AND CR.soft_deleted &#61; 0&#10;            --&#10;          )&#10;        --&#10;        SELECT&#10;          PT.master_transfer_id,&#10;          PT.transfer_id,&#10;          PT.source_table,&#10;          OTP.code        AS origin_probation_area_code,&#10;          OTP.description AS origin_probation_area_desc,&#10;          CASE WHEN OTP.trust_division_id !&#61; OTP.probation_area_id AND OTP.private &#61; 1 THEN 1 ELSE 0 END AS origin_private,&#10;          RTP.code        AS receiving_probation_area_code,&#10;          RTP.description AS receiving_probation_area_desc,&#10;          CASE WHEN RTP.trust_division_id !&#61; RTP.probation_area_id AND RTP.private &#61; 1 THEN 1 ELSE 0 END AS receiving_private,&#10;          R1.code_description,&#10;          --&#10;          RT.probation_area_id AS target_provider_id,&#10;          OT.probation_area_id AS origin_provider_id,&#10;          transfer_request_date,&#10;          receiving_team_id,&#10;          receiving_staff_id,&#10;          origin_team_id,&#10;          origin_staff_id,&#10;          O.offender_id,&#10;          offender_transfer_id,&#10;          nsi_transfer_id,&#10;          nsi_id,&#10;          order_transfer_id,&#10;          event_id,&#10;          rqmnt_transfer_id,&#10;          rqmnt_id,&#10;          lic_condition_transfer_id,&#10;          lic_condition_id,&#10;          pss_rqmnt_transfer_id,&#10;          pss_rqmnt_id,&#10;          institutional_rep_transfer_id,&#10;          institutional_report_id,&#10;          court_report_transfer_id,&#10;          court_report_id,&#10;          --&#10;          allocation_reason_id,&#10;          transfer_notes,&#10;          --&#10;          O.crn,&#10;          O.surname,&#10;          O.first_name,&#10;          PT.transfer_date&#10;          --&#10;        FROM&#10;          pending_transfers PT&#10;            INNER JOIN offender O ON O.offender_id &#61; PT.offender_id&#10;            INNER JOIN r_standard_reference_list R1 ON PT.transfer_status_id &#61; R1.standard_reference_list_id AND R1.code_value &#61; &#39;PN&#39;&#10;            INNER JOIN team OT ON PT.origin_team_id &#61; OT.team_id&#10;              INNER JOIN probation_area OTP ON OT.probation_area_id &#61; OTP.probation_area_id&#10;              INNER JOIN team RT ON RT.team_id &#61; PT.receiving_team_id&#10;                INNER JOIN probation_area rtp ON RTP.probation_area_id &#61; RT.probation_area_id&#10;        WHERE 1&#61;1&#10;        AND (&#10;              OTP.trust_division_id !&#61; OTP.probation_area_id&#10;              AND OTP.private &#61; 1&#10;            OR&#10;              RTP.trust_division_id !&#61; RTP.probation_area_id&#10;              AND RTP.private &#61; 1&#10;            )&#10;        AND ( CASE&#10;              WHEN (param_direction &#61; &#39;I&#39; AND RTP.code &#61; param_crc) THEN 1&#10;              WHEN (param_direction &#61; &#39;O&#39; AND OTP.code &#61; param_crc) THEN 1&#10;              ELSE 0&#10;              END) &#61; 1&#10;        ORDER BY PT.master_transfer_id, PT.source_table;&#10;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    --l_tab_TYP IS TABLE OF&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;master_transfer_id&#39;, &#39;Master Transfer ID&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;transfer_id&#39;, &#39;Transfer ID&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 30, &#39;L&#39;, &#39;Y&#39;, &#39;source_table&#39;, &#39;Source Transfer&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 35, &#39;L&#39;, &#39;Y&#39;, &#39;origin_probation_area_code&#39;, &#39;Origin Provider&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 35, &#39;L&#39;, &#39;Y&#39;, &#39;receiving_probation_area_code&#39;, &#39;Receiving Provider&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 11, &#39;L&#39;, &#39;Y&#39;, &#39;transfer_date&#39;, &#39;Transfer    Date&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;,  8, &#39;L&#39;, &#39;Y&#39;, &#39;crn&#39;, &#39;Offender CRN&#39;);&#10;        do_add_col_def(l_cols_TAB, 8, &#39;C&#39;, 35, &#39;L&#39;, &#39;Y&#39;, &#39;surname&#39;, &#39;Offender Surname&#39;);&#10;        do_add_col_def(l_cols_TAB, 9, &#39;C&#39;, 35, &#39;L&#39;, &#39;Y&#39;, &#39;forename&#39;, &#39;Offender Forename&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value :&#61; l_rec.master_transfer_id;&#10;        l_cols_TAB(2).value :&#61; l_rec.transfer_id;&#10;        l_cols_TAB(3).value :&#61; l_rec.source_table;&#10;        l_cols_TAB(4).value :&#61; l_rec.origin_probation_area_desc;&#10;        l_cols_TAB(5).value :&#61; l_rec.receiving_probation_area_desc;&#10;        --&#10;        l_cols_TAB(6).value :&#61; TO_CHAR(l_rec.transfer_date, &#39;DD-MON-YYYY&#39;);&#10;        l_cols_TAB(7).value :&#61; l_rec.crn;&#10;        l_cols_TAB(8).value :&#61; l_rec.surname;&#10;        l_cols_TAB(9).value :&#61; l_rec.first_name;&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_close_pending_transfers(p_transfer_table VARCHAR2, p_transfer_id NUMBER, p_master_transfer_id NUMBER)&#10;    IS&#10;        --&#10;        l_SQL                           VARCHAR2(1024);&#10;        l_date                          DATE :&#61; SYSDATE;&#10;        l_id                            NUMBER;&#10;        l_base_table                    VARCHAR2(30);&#10;        l_contact_type_code             VARCHAR2(30);&#10;        l_contact_type_id               NUMBER;&#10;        l_transfer_status_id            NUMBER;&#10;        l_transfer_status_code_desc     VARCHAR2(200);&#10;        l_allocation_reason_code_desc   VARCHAR2(200);&#10;        l_rejection_reason_code_desc    VARCHAR2(200);&#10;        l_target_probation_area_code    VARCHAR2(10);&#10;        l_staff_employee_id             NUMBER;&#10;        --&#10;    BEGIN&#10;        --&#10;        l_transfer_status_id          :&#61; PKG_Lookups.funcgetStdRefListID(&#39;TRANSFER STATUS&#39;, CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;TR&#39; ELSE &#39;TR&#39; END);&#10;        l_transfer_status_code_desc   :&#61; PKG_Lookups.funcgetStdRefListCodeAndDesc(l_transfer_status_id, &#39; &#39;);&#10;        l_allocation_reason_code_desc :&#61; PKG_Lookups.funcgetStdRefListCodeAndDesc(l_rec.allocation_reason_id, &#39; &#39;);&#10;        l_rejection_reason_code_desc  :&#61; PKG_Lookups.funcgetStdRefListCodeAndDesc(&#10;                                             CASE WHEN p_direction &#61; &#39;I&#39; THEN get_transfer_rejection_reason(l_rec.source_table)&#10;                                                  WHEN p_direction &#61; &#39;O&#39; THEN get_transfer_withdrawal_reason(l_rec.source_table)&#10;                                             END,&#10;                                             &#39; &#39;);&#10;        --&#10;        l_target_probation_area_code :&#61;&#10;            PKG_Lookups.funcgetTabRecord_CACHED(&#10;                p_table    &#61;&gt; &#39;PROBATION_AREA&#39;,&#10;                p_ref_col  &#61;&gt; &#39;probation_area_id&#39;,&#10;                p_ref_val  &#61;&gt; l_rec.target_provider_id,&#10;                p_data_fld &#61;&gt; &#39;code&#39; );&#10;        --&#10;        l_staff_employee_id :&#61;&#10;            NVL(&#10;                l_rec.receiving_staff_id,&#10;                PKG_Lookups.funcgetTabRecord_CACHED(&#10;                    p_table    &#61;&gt; &#39;staff&#39;,&#10;                    p_data_fld &#61;&gt; &#39;staff_id&#39;,&#10;                    p_ref_col  &#61;&gt; &#39;officer_code&#39;,&#10;                    p_ref_val  &#61;&gt; l_target_probation_area_code || &#39;UATU&#39; )&#10;            );&#10;        --&#10;        IF l_staff_employee_id IS NULL THEN&#10;            raise_application_error(-20001,&#10;                &#39;ERROR IN do_close_pending_transfers &#39;                  ||&#10;                &#39;[transfer_table&#61;&#39;      || p_transfer_table             || &#39;]&#39; ||&#10;                &#39;[transfer_id&#61;&#39;         || p_transfer_id                || &#39;]&#39; ||&#10;                &#39;[master_transfer_id&#61;&#39;  || p_master_transfer_id         || &#39;]&#39; ||&#10;                &#39;[target_provider&#61;&#39;     || l_target_probation_area_code || &#39;]: &#39; || CHR(10) ||&#10;                &#39;FAILED to identify RECEIVING STAFF record&#39; );&#10;        --ELSE&#10;        --    raise_application_error(-20001, &#39;ERROR IN do_close_pending_transfers: l_staff_employee_id&#61;&#39; || l_staff_employee_id);&#10;        END IF;&#10;        --&#10;        -- DST-1533: Witdrawal Contact Types&#10;        --INTER_PROVIDER_OFFENDER_TRANSFER_WITHDRAWN(&quot;ETOW&quot;),&#10;        --INTER_PROVIDER_ORDER_TRANSFER_WITHDRAWN(&quot;ETORW&quot;),&#10;        --INTER_PROVIDER_NSI_TRANSFER_WITHDRAWN(&quot;ETNW&quot;),&#10;        --INTER_PROVIDER_COMPONENT_TRANSFER_WITHDRAWN(&quot;ETCW&quot;),&#10;        --INTER_PROVIDER_PSS_TRANSFER_WITHDRAWN(&quot;ETPW&quot;),&#10;        --INTER_PROVIDER_COURT_REPORT_TRANSFER_WITHDRAWN(&quot;ETCRW&quot;),&#10;        --INTER_PROVIDER_INSTITUTIONAL_REPORT_TRANSFER_WITHDRAWN(&quot;ETIRW&quot;),&#10;        --&#10;        IF p_transfer_table &#61; &#39;OFFENDER_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;OFFENDER&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;ETTX&#39; ELSE &#39;ETOW&#39; END;&#10;        ELSIF p_transfer_table &#61; &#39;ORDER_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;EVENT&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;ETOX&#39; ELSE &#39;ETORW&#39; END;&#10;        ELSIF p_transfer_table &#61; &#39;NSI_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;NSI&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;NSIX&#39; ELSE &#39;ETNW&#39; END;&#10;        ELSIF p_transfer_table &#61; &#39;RQMNT_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;RQMNT&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;ETCX&#39; ELSE &#39;ETCW&#39; END;&#10;        ELSIF p_transfer_table &#61; &#39;LIC_CONDITION_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;LIC_CONDITION&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;ETCX&#39; ELSE &#39;ETCW&#39; END;&#10;        ELSIF p_transfer_table &#61; &#39;PSS_RQMNT_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;PSS_RQMNT&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;ETPX&#39; ELSE &#39;ETPW&#39; END;&#10;        ELSIF p_transfer_table &#61; &#39;COURT_REPORT_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;COURT_REPORT&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;ETCRX&#39; ELSE &#39;ETCRW&#39; END;&#10;        ELSIF p_transfer_table &#61; &#39;INSTITUTIONAL_REPORT_TRANSFER&#39; THEN&#10;            l_base_table :&#61; &#39;INSTITUTIONAL_REPORT&#39;;&#10;            l_contact_type_code :&#61; CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;ETIRX&#39; ELSE &#39;ETIRW&#39; END;&#10;        END IF;&#10;        --&#10;        SELECT contact_type_id INTO l_contact_type_id&#10;        FROM r_contact_type&#10;        WHERE code &#61; l_contact_type_code;&#10;        --&#10;        l_SQL :&#61;&#10;           &#39;UPDATE &#39; || p_transfer_table || &#39; SET&#10;              transfer_status_id &#61; :p_transfer_status_id,&#10;              &#39; || CASE WHEN p_transfer_table &#61; &#39;COURT_REPORT_TRANSFER&#39; THEN &#39;rejected_reason_id&#39; ELSE &#39;rejection_reason_id&#39; END || &#39; &#61; :p_rejection_reason_id,&#10;              withdrawal_reason_id &#61; :p_withdrawal_reason_id,&#10;              transfer_status_date &#61; :p_SYSDATE,&#10;              last_updated_user_id &#61; 1,&#10;              last_updated_datetime &#61; :p_SYSDATE&#10;            WHERE &#39; || PKG_DynSQL.get_tab_pk_fld_lst(p_transfer_table) || &#39; &#61; :p_transfer_id&#10;            RETURNING &#39; || PKG_DynSQL.get_tab_pk_fld_lst(l_base_table) || &#39;&#10;            INTO :x_ID&#39;;&#10;        --&#10;        EXECUTE IMMEDIATE l_SQL&#10;        USING&#10;          l_transfer_status_id,&#10;          CASE WHEN p_direction &#61; &#39;I&#39; THEN get_transfer_rejection_reason(l_rec.source_table) END,&#10;          CASE WHEN p_direction &#61; &#39;O&#39; THEN get_transfer_withdrawal_reason(l_rec.source_table) END,&#10;          l_date,&#10;          l_date,&#10;          p_transfer_id&#10;        RETURNING INTO l_id;&#10;        --&#10;        l_SQL :&#61;&#10;           &#39;UPDATE &#39; || l_base_table || &#39; SET&#10;              pending_transfer &#61; 0&#10;            WHERE &#39; || PKG_DynSQL.get_tab_pk_fld_lst(l_base_table) || &#39; &#61; :p_id&#39;;&#10;        EXECUTE IMMEDIATE l_SQL USING l_id;&#10;        --&#10;        IF p_direction &#61; &#39;I&#39; THEN&#10;            INSERT INTO rejected_transfer_diary(&#10;              rejected_transfer_diary_id,&#10;              transfer_request_date,&#10;              transfer_status_date,&#10;              target_provider_id,&#10;              target_team_id,&#10;              target_staff_id,&#10;              origin_provider_id,&#10;              origin_team_id,&#10;              origin_staff_id,&#10;              rejection_reason_id,&#10;              offender_id,&#10;              master_transfer_id,&#10;              offender_transfer_id,&#10;              nsi_transfer_id,&#10;              nsi_id,&#10;              order_transfer_id,&#10;              event_id,&#10;              rqmnt_transfer_id,&#10;              rqmnt_id,&#10;              lic_condition_transfer_id,&#10;              lic_condition_id,&#10;              pss_rqmnt_transfer_id,&#10;              pss_rqmnt_id,&#10;              institutional_rep_transfer_id,&#10;              institutional_report_id,&#10;              court_report_transfer_id,&#10;              court_report_id&#10;            )&#10;            SELECT&#10;              REJECTED_TRANSFER_DIARY_ID_SEQ.nextval,&#10;              l_rec.transfer_request_date,&#10;              l_date AS transfer_status_date,&#10;              l_rec.target_provider_id,&#10;              l_rec.receiving_team_id,&#10;              l_rec.receiving_staff_id,&#10;              l_rec.origin_provider_id,&#10;              l_rec.origin_team_id,&#10;              l_rec.origin_staff_id,&#10;              PKG_CRC_RPT.get_transfer_rejection_reason(l_rec.source_table) AS rejection_reason_id,&#10;              l_rec.offender_id,&#10;              l_rec.master_transfer_id,&#10;              l_rec.offender_transfer_id,&#10;              l_rec.nsi_transfer_id,&#10;              l_rec.nsi_id,&#10;              l_rec.order_transfer_id,&#10;              l_rec.event_id,&#10;              l_rec.rqmnt_transfer_id,&#10;              l_rec.rqmnt_id,&#10;              l_rec.lic_condition_transfer_id,&#10;              l_rec.lic_condition_id,&#10;              l_rec.pss_rqmnt_transfer_id,&#10;              l_rec.pss_rqmnt_id,&#10;              l_rec.institutional_rep_transfer_id,&#10;              l_rec.institutional_report_id,&#10;              l_rec.court_report_transfer_id,&#10;              l_rec.court_report_id&#10;            FROM dual;&#10;            --REPEAT (XXX_TRNSFER updates and REJECTED_TRANSFER_DIARY insertions) for OFFENDER_TRANSFER, ORDER_TRANSFER, PSS_RQMNT_TRANSFER, RQMNT_TRANSFER, COURT_REPORT_TRANSFER, INSITUTIONAL_REORT_TRANSFER, LIC_CONDITION_TRANSFER&#10;            --&#10;        END IF;&#10;        --&#10;        UPDATE master_transfer SET&#10;            transfer_status_id &#61; PKG_Lookups.funcgetStdRefListID(&#39;TRANSFER STATUS&#39;, &#39;TCOM&#39;),&#10;            transfer_status_date &#61; SYSDATE,&#10;            last_updated_user_id &#61; 1,&#10;            last_updated_datetime &#61; SYSDATE&#10;        WHERE master_transfer_id &#61; l_rec.master_transfer_id&#10;          --AND transfer_status_id &#61; PKG_Lookups.funcgetStdRefListID(&#39;TRANSFER STATUS&#39;, &#39;TCOM&#39;)&#10;        ;&#10;        --&#10;--        raise_application_error(-20001,&#10;--            &#39;SELECT&#10;--              /*00*/ &#39; || contact_id_SEQ.NEXTVAL || &#39;,&#10;--              /*01*/ &#39; || l_rec.offender_id || &#39;,&#10;--              --&#10;--              /*02*/ &#39; || l_rec.event_id || &#39;,&#10;--              /*03*/ &#39; || l_rec.nsi_id || &#39;,&#10;--              /*04*/ &#39; || l_rec.rqmnt_id || &#39;,&#10;--              /*05*/ &#39; || l_rec.pss_rqmnt_id || &#39;,&#10;--              --&#10;--              /*06*/&#10;--              CASE&#10;--                WHEN &#39;&#39;&#39; || l_base_table || &#39;&#39;&#39; IN (&#39;&#39;INSTITUTIONAL_REPORT&#39;&#39;, &#39;&#39;COURT_REPORT&#39;&#39;) THEN &#39;&#39;&#39; ||  l_base_table || &#39;&#39;&#39;&#10;--              END AS table_name,&#10;--              /*07*/&#10;--              CASE&#10;--                WHEN &#39;&#39;&#39; || l_base_table || &#39;&#39;&#39; &#61; &#39;&#39;INSTITUTIONAL_REPORT&#39;&#39; THEN &#39; || l_rec.institutional_report_id || &#39;&#10;--                WHEN &#39;&#39;&#39; || l_base_table || &#39;&#39;&#39; &#61; &#39;&#39;COURT_REPORT&#39;&#39;         THEN &#39; || l_rec.court_report_id || &#39;&#10;--              END AS primary_key_id,&#10;--              --institutional_report_id,&#10;--              --court_report_id,&#10;--              --&#10;--              /*08*/ TRUNC(SYSDATE) AS contact_date,&#10;--              /*09*/ TO_DATE(&#39;&#39;19700101 &#39;&#39; || TO_CHAR(SYSDATE, &#39;&#39;HH24:MI:SS&#39;&#39;), &#39;&#39;YYYYMMDD HH24:MI:SS&#39;&#39;) AS contact_start_time,&#10;--              /*10*/ &#39; || l_contact_type_id || &#39; AS contact_type_id,&#10;--              --&#10;--              /*11*/ &#39; || l_rec.target_provider_id || &#39; AS probation_area_id,&#10;--              /*12*/ &#39; ||  l_rec.receiving_team_id || &#39;  AS trust_provider_team_id,&#10;--              /*13*/ &#39; ||  l_staff_employee_id     || &#39;      AS staff_employee_id,&#10;--              --&#10;--              /*14*/ 0 AS trust_provider_flag,&#10;--              --&#10;--              /*15*/ PKG_LstUtl.concat(&#10;--                  &#39;&#39;Transfer Status: &#39;&#39;&#39;    || &#39;&#39;&#39;&#39; || l_transfer_status_code_desc || &#39;&#39;&#39;,&#10;--                  &#39;&#39;Transfer Reason: &#39;&#39;&#39;    || &#39;&#39;&#39;&#39; || l_allocation_reason_code_desc || &#39;&#39;&#39;,&#10;--                  &#39;&#39;Rejection Reason: &#39;&#39;&#39;   || &#39;&#39;&#39;&#39; || l_rejection_reason_code_desc || &#39;&#39;&#39;,&#10;--                  p_delim &#61;&gt; CHR(10)&#10;--              ) AS notes,&#10;--              --&#10;--              /*16*/ 1 AS created_by_user_id,&#10;--              /*17*/ SYSDATE AS created_datetime,&#10;--              /*18*/ 1 AS last_updated_user_id,&#10;--              /*19*/ SYSDATE AS last_updated_datetime,&#10;--              --&#10;--              /*20*/ 0 AS partition_area_id,&#10;--              /*21*/ 0 AS row_version,&#10;--              /*22*/ 0 AS soft_deleted&#10;--        FROM dual&#39;);&#10;&#10;        --&#10;        INSERT INTO contact (&#10;          /*00*/ contact_id,&#10;          /*01*/ offender_id,&#10;          --&#10;          /*02*/ event_id,&#10;          /*03*/ nsi_id,&#10;          /*04*/ rqmnt_id,&#10;          /*05*/ pss_rqmnt_id,&#10;          --&#10;          /*06*/ table_name,&#10;          /*07*/ primary_key_id,&#10;          --institutional_report_id,&#10;          --court_report_id,&#10;          --&#10;          /*08*/ contact_date,&#10;          /*09*/ contact_start_time,&#10;          /*10*/ contact_type_id,&#10;          --&#10;          --/*11*/ probation_area_id,&#10;          /*12*/ team_id,&#10;          /*13*/ staff_id,&#10;          --/*14*/ trust_provider_flag,&#10;          --&#10;          /*15*/ notes,&#10;          --&#10;          /*16*/ created_by_user_id,&#10;          /*17*/ created_datetime,&#10;          /*18*/ last_updated_user_id,&#10;          /*19*/ last_updated_datetime,&#10;          --&#10;          /*20*/ partition_area_id,&#10;          /*21*/ row_version,&#10;          /*22*/ soft_deleted&#10;        )&#10;        SELECT&#10;          /*00*/ contact_id_SEQ.NEXTVAL,&#10;          /*01*/ l_rec.offender_id,&#10;          --&#10;          /*02*/ l_rec.event_id,&#10;          /*03*/ l_rec.nsi_id,&#10;          /*04*/ l_rec.rqmnt_id,&#10;          /*05*/ l_rec.pss_rqmnt_id,&#10;          --&#10;          /*06*/&#10;          CASE&#10;            WHEN l_base_table IN (&#39;INSTITUTIONAL_REPORT&#39;, &#39;COURT_REPORT&#39;) THEN l_base_table&#10;          END AS table_name,&#10;          /*07*/&#10;          CASE&#10;            WHEN l_base_table &#61; &#39;INSTITUTIONAL_REPORT&#39; THEN l_rec.institutional_report_id&#10;            WHEN l_base_table &#61; &#39;COURT_REPORT&#39;         THEN l_rec.court_report_id&#10;          END AS primary_key_id,&#10;          --institutional_report_id,&#10;          --court_report_id,&#10;          --&#10;          /*08*/ TRUNC(SYSDATE)    AS contact_date,&#10;          /*09*/ TO_DATE(&#39;19700101 &#39; || TO_CHAR(SYSDATE, &#39;HH24:MI:SS&#39;), &#39;YYYYMMDD HH24:MI:SS&#39;) AS contact_start_time,&#10;          /*10*/ l_contact_type_id AS contact_type_id,&#10;          --&#10;          --/*11*/ l_rec.target_provider_id AS probation_area_id,&#10;          /*12*/ l_rec.receiving_team_id  AS team_id,&#10;          /*13*/ l_staff_employee_id      AS staff_id,&#10;          --&#10;          --/*14*/ 0 AS trust_provider_flag,&#10;          --&#10;          /*15*/&#10;          CASE WHEN p_direction &#61; &#39;I&#39; THEN&#10;              PKG_LstUtl.concat(&#10;                  &#39;Transfer Status: &#39;    || l_transfer_status_code_desc,&#10;                  &#39;Transfer Reason: &#39;    || l_allocation_reason_code_desc,&#10;                  &#39;Rejection Reason:   &#39; || l_rejection_reason_code_desc,&#10;                  &#39;Owning Provider: &#39;    || PKG_Lookups.funcgetTabRecord_CACHED(p_table&#61;&gt;&#39;PROBATION_AREA&#39;, p_ref_col&#61;&gt;&#39;probation_area_id&#39;, p_ref_val&#61;&gt;l_rec.origin_provider_id, p_data_fld&#61;&gt;&#39;code || &#39;&#39; &#39;&#39; || description&#39;),&#10;                  &#39;Receiving Provider: &#39; || PKG_Lookups.funcgetTabRecord_CACHED(p_table&#61;&gt;&#39;PROBATION_AREA&#39;, p_ref_col&#61;&gt;&#39;probation_area_id&#39;, p_ref_val&#61;&gt;l_rec.target_provider_id, p_data_fld&#61;&gt;&#39;code || &#39;&#39; &#39;&#39; || description&#39;),&#10;                  &#39;Notes: &#39;              || CHR(10) || l_rec.transfer_notes || CHR(10),&#10;                  p_delim &#61;&gt; CHR(10) )&#10;          ELSE&#10;              --&#10;              -- ND Java code:&#10;              --builder.append(&quot;Receiving Provider: &quot; + offenderTransfer.getReceivingTeam().getProbationArea().getDescription() + &quot;\n&quot;);&#10;              --builder.append(&quot;Receiving Team: &quot; + offenderTransfer.getReceivingTeam().getDescription() + &quot;\n&quot;);&#10;              --builder.append(&quot;Receiving Staff: &quot; + offenderTransfer.getReceivingStaff().getDisplayName() + &quot;\n&quot;);&#10;              --builder.append(&quot;Withdrawal Reason: &quot; + transfer.getWithdrawalReasonHashMap()&#10;              --        .get(offenderTransfer.getWithdrawalReasonID()).getCodeDescription() + &quot;\n&quot;);&#10;              --&#10;              PKG_LstUtl.concat(&#10;                  &#39;Receiving Provider: &#39; || PKG_Lookups.funcgetTabRecord_CACHED(p_table&#61;&gt;&#39;PROBATION_AREA&#39;, p_ref_col&#61;&gt;&#39;probation_area_id&#39;, p_ref_val&#61;&gt;l_rec.target_provider_id, p_data_fld&#61;&gt;&#39;code || &#39;&#39; &#39;&#39; || description&#39;),&#10;                  &#39;Receiving Team: &#39;     || PKG_Lookups.funcgetTabRecord_CACHED(p_table&#61;&gt;&#39;TEAM&#39;          , p_ref_col&#61;&gt;&#39;team_id&#39;          , p_ref_val&#61;&gt;l_rec.receiving_team_id , p_data_fld&#61;&gt;&#39;code || &#39;&#39; &#39;&#39; || description&#39;),&#10;                  &#39;Receiving Staff: &#39;    || StaffSupport.getStaffDisplayName(l_rec.receiving_staff_id),&#10;                  &#39;Withdrawal Reason: &#39;  || l_rejection_reason_code_desc,&#10;                  --&#39;Notes: &#39;              || CHR(10) || l_rec.transfer_notes || CHR(10),&#10;                  p_delim &#61;&gt; CHR(10) )&#10;          END AS notes,&#10;          --&#10;          /*16*/ 1 AS created_by_user_id,&#10;          /*17*/ SYSDATE AS created_datetime,&#10;          /*18*/ 1 AS last_updated_user_id,&#10;          /*19*/ SYSDATE AS last_updated_datetime,&#10;          --&#10;          /*20*/ 0 AS partition_area_id,&#10;          /*21*/ 0 AS row_version,&#10;          /*22*/ 0 AS soft_deleted&#10;        FROM dual;&#10;    END do_close_pending_transfers;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 250;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc, p_direction);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Pending Transfers - &#39; || CASE WHEN p_direction &#61; &#39;I&#39; THEN &#39;Incoming&#39; ELSE &#39;Outgoing&#39; END);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs(p_crc, p_direction);&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        IF p_close_pending_transfers &#61; &#39;Y&#39; THEN&#10;            do_close_pending_transfers(l_rec.source_table, l_rec.transfer_id, l_rec.master_transfer_id);&#10;        END IF;&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;--EXCEPTION WHEN OTHERS THEN&#10;--    do_print_rpt_title(&#39;ERROR: &#39; || SQLERRM);&#10;--    RAISE;&#10;END rpt_PENDING_TRANSFERS;&#10;--&#10;--&#10;--&#10;FUNCTION get_document_probation_area(p_table_name VARCHAR2, p_primary_key_id NUMBER)&#10;RETURN NUMBER&#10;IS&#10;    l_probation_area_id NUMBER;&#10;BEGIN&#10;    IF p_table_name &#61; &#39;ADDRESSASSESSMENT&#39; THEN&#10;        SELECT NVL(T1.probation_area_id, T.probation_area_id)&#10;        INTO l_probation_area_id&#10;        FROM&#10;          address_assessment AA&#10;            INNER JOIN offender O ON O.offender_id &#61; AA.offender_id&#10;              INNER JOIN offender_manager OM ON OM.offender_id &#61; O.offender_id AND OM.active_flag &#61; 1&#10;                INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;            LEFT OUTER JOIN team T1 ON T1.team_id &#61; AA.team_id&#10;        WHERE AA.address_assessment_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;APPROVED_PREMISES_REFERRAL&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          approved_premises_referral APR&#10;            INNER JOIN event E ON E.event_id &#61; APR.event_id&#10;              INNER JOIN order_manager OM ON OM.event_id &#61; E.event_id AND OM.active_flag &#61; 1&#10;                INNER JOIN team T ON T.team_id &#61; OM.allocation_team_id&#10;        WHERE APR.approved_premises_referral_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;ASSESSMENT&#39; THEN&#10;        SELECT NVL(T1.probation_area_id, T.probation_area_id)&#10;        INTO l_probation_area_id&#10;        FROM&#10;          assessment A&#10;            INNER JOIN offender O ON O.offender_id &#61; A.offender_id&#10;              INNER JOIN offender_manager OM ON OM.offender_id &#61; O.offender_id AND OM.active_flag &#61; 1&#10;                INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;            LEFT OUTER JOIN team T1 ON T1.team_id &#61; A.team_id&#10;        WHERE A.assessment_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;CASE_ALLOCATION&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          case_allocation CA&#10;            INNER JOIN event E ON E.event_id &#61; CA.event_id&#10;              INNER JOIN order_manager OM ON OM.event_id &#61; E.event_id AND OM.active_flag &#61; 1&#10;                INNER JOIN team T ON T.team_id &#61; OM.allocation_team_id&#10;        WHERE CA.case_allocation_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;CONTACT&#39; THEN&#10;        SELECT probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM contact&#10;        WHERE contact_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;COURT_REPORT&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          court_report R&#10;            INNER JOIN report_manager OM ON OM.court_report_id &#61; R.court_report_id AND OM.active_flag &#61; 1&#10;              INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;        WHERE R.court_report_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;INSTITUTIONAL_REPORT&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          institutional_report R&#10;            INNER JOIN report_manager OM ON OM.institutional_report_id &#61; R.institutional_report_id AND OM.active_flag &#61; 1&#10;              INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;        WHERE R.institutional_report_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;EVENT&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          event E&#10;            INNER JOIN order_manager OM ON OM.event_id &#61; E.event_id AND OM.active_flag &#61; 1&#10;              INNER JOIN team T ON T.team_id &#61; OM.allocation_team_id&#10;        WHERE E.event_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;NSI&#39; THEN&#10;        SELECT NVL(T1.probation_area_id, T.probation_area_id)&#10;        INTO l_probation_area_id&#10;        FROM&#10;          NSI N&#10;            INNER JOIN offender_manager OM ON OM.offender_id &#61; N.offender_id AND OM.active_flag &#61; 1&#10;              INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;            LEFT OUTER JOIN event E ON E.event_id &#61; N.event_id&#10;              LEFT OUTER JOIN order_manager OM1 ON OM1.event_id &#61; E.event_id AND OM1.active_flag &#61; 1&#10;                LEFT OUTER JOIN team T1 ON T1.team_id &#61; OM1.allocation_team_id&#10;        WHERE N.nsi_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;OFFENDER&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          offender_manager OM&#10;            INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;        WHERE OM.offender_id &#61; p_primary_key_id&#10;          AND OM.active_flag &#61; 1;&#10;    ELSIF p_table_name &#61; &#39;PERSONALCONTACT&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          personal_contact PC&#10;            INNER JOIN offender_manager OM ON OM.offender_id &#61; PC.offender_id AND OM.active_flag &#61; 1&#10;              INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;        WHERE PC.personal_contact_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;PERSONAL_CIRCUMSTANCE&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          personal_circumstance PC&#10;            INNER JOIN offender_manager OM ON OM.offender_id &#61; PC.offender_id AND OM.active_flag &#61; 1&#10;              INNER JOIN team T ON T.team_id &#61; OM.team_id&#10;        WHERE PC.personal_circumstance_id &#61; p_primary_key_id;&#10;    ELSIF p_table_name &#61; &#39;REFERRAL&#39; THEN&#10;        SELECT T.probation_area_id&#10;        INTO l_probation_area_id&#10;        FROM&#10;          referral R&#10;            INNER JOIN event E ON E.event_id &#61; R.event_id&#10;              INNER JOIN order_manager OM ON OM.event_id &#61; E.event_id AND OM.active_flag &#61; 1&#10;                INNER JOIN team T ON T.team_id &#61; OM.allocation_team_id&#10;        WHERE R.referral_id &#61; p_primary_key_id;&#10;    END IF;&#10;    --&#10;    RETURN l_probation_area_id;&#10;    --&#10;EXCEPTION WHEN NO_DATA_FOUND THEN&#10;    RETURN NULL;&#10;WHEN OTHERS THEN&#10;    raise_application_error(-20001, &#39;ERROR IN get_document_probation_area(&#39; || p_table_name || &#39;, &#39; || p_primary_key_id || &#39;): &#39; || SQLERRM);&#10;END get_document_probation_area;&#10;--&#10;PROCEDURE rpt_DOCUMENTS(p_crc IN VARCHAR2, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs1 IS&#10;      WITH D AS (&#10;        SELECT&#10;          &#39;DOCUMENT&#39; AS doc_table,&#10;          offender_id,&#10;          CASE WHEN ALFRESCO_DOCUMENT_ID IS NULL THEN &#39;ALFRESCO&#39; ELSE &#39;NDELIUS&#39; END AS doc_location,&#10;          0 /*DBMS_LOB.getlength(&quot;DOCUMENT&quot;)*/ AS doc_length&#10;        FROM document&#10;        UNION&#10;        SELECT&#10;          &#39;OFFENDER&#39; AS doc_table,&#10;          O.offender_id,&#10;          CASE WHEN D.ALFRESCO_DOCUMENT_ID IS NULL THEN &#39;ALFRESCO&#39; ELSE &#39;NDELIUS&#39; END AS doc_location,&#10;          0 /*DBMS_LOB.getlength(&quot;PREVIOUS_CONVICTION_DOCUMENT&quot;)*/ AS doc_length&#10;        FROM&#10;          offender O&#10;            INNER JOIN document D ON D.offender_id &#61; O.offender_id&#10;                                 AND D.table_name &#61; &#39;OFFENDER&#39;&#10;                                 AND D.primary_key_id &#61; TO_CHAR(O.offender_id)&#10;                                 AND D.document_type &#61; &#39;PREVIOUS_CONVICTION&#39;&#10;        UNION&#10;        SELECT&#10;          &#39;EVENT&#39; AS doc_table,&#10;          E.offender_id,&#10;          CASE WHEN D.ALFRESCO_DOCUMENT_ID IS NULL THEN &#39;ALFRESCO&#39; ELSE &#39;NDELIUS&#39; END AS doc_location,&#10;          0 /*DBMS_LOB.getlength(&quot;CPS_DOCUMENT&quot;)*/ AS doc_length&#10;        FROM&#10;          event E&#10;            INNER JOIN document D ON D.offender_id &#61; E.offender_id&#10;                                 AND D.table_name &#61; &#39;EVENT&#39;&#10;                                 AND D.primary_key_id &#61; TO_CHAR(E.event_id)&#10;                                 AND D.document_type &#61; &#39;CPS_PACK&#39;&#10;        )&#10;      SELECT&#10;        doc_table,&#10;        doc_location,&#10;        COUNT(1) AS qty_docs,&#10;        COUNT( DISTINCT offender_id) AS qty_offenders,&#10;        ROUND(MAX(doc_length)/1024/1024, 2) AS max_doc_len,&#10;        ROUND(AVG(doc_length)/1024/1024, 2) AS avg_doc_len&#10;      FROM D&#10;      GROUP BY&#10;        doc_table,&#10;        doc_location&#10;      ORDER BY 1,2&#10;      ;&#10;    --&#10;    CURSOR cs2 IS&#10;      WITH D AS (&#10;        SELECT &#39;DOCUMENT&#39; AS table_name, offender_id, PKG_CRC_RPT.get_document_probation_area(table_name, PRIMARY_KEY_ID) AS probation_area_id&#10;        FROM document&#10;        WHERE document_type &#61; &#39;DOCUMENT&#39;&#10;        UNION&#10;        SELECT &#39;OFFENDER&#39; AS table_name, O.offender_id, PKG_CRC_RPT.get_document_probation_area(&#39;OFFENDER&#39;, O.offender_id) AS probation_area_id&#10;        FROM&#10;          offender O&#10;            INNER JOIN document D ON D.offender_id &#61; O.offender_id&#10;                                 AND D.table_name &#61; &#39;OFFENDER&#39;&#10;                                 AND D.primary_key_id &#61; TO_CHAR(O.offender_id)&#10;                                 AND D.document_type &#61; &#39;PREVIOUS_CONVICTION&#39;&#10;        WHERE 0 /*DBMS_LOB.getlength(&quot;PREVIOUS_CONVICTION_DOCUMENT&quot;)*/ &gt; 0 OR D.alfresco_document_id IS NOT NULL&#10;        UNION&#10;        SELECT &#39;EVENT&#39; AS table_name, E.offender_id, PKG_CRC_RPT.get_document_probation_area(&#39;EVENT&#39;, E.event_id) AS probation_area_id&#10;        FROM&#10;          event E&#10;            INNER JOIN document D ON D.offender_id &#61; E.offender_id&#10;                                 AND D.table_name &#61; &#39;EVENT&#39;&#10;                                 AND D.primary_key_id &#61; TO_CHAR(E.event_id)&#10;                                 AND D.document_type &#61; &#39;CPS_PACK&#39;&#10;        WHERE 0 /*DBMS_LOB.getlength(&quot;CPS_DOCUMENT&quot;)*/ &gt; 0 OR D.alfresco_document_id IS NOT NULL )&#10;      SELECT&#10;        --table_name,&#10;        PA.code                       AS area_code,&#10;        PA.description                AS area_desc,&#10;        COUNT( DISTINCT offender_id ) AS qty_offenders,&#10;        COUNT(1)                      AS qty_docs&#10;      FROM D INNER JOIN probation_area PA ON PA.probation_area_id &#61; D.probation_area_id&#10;      GROUP BY&#10;        --table_name,&#10;        PA.code,&#10;        PA.description&#10;      ORDER BY&#10;        --table_name,&#10;        PA.code;&#10;    --&#10;    l_rec1  cs1%ROWTYPE;&#10;    l_rec2  cs2%ROWTYPE;&#10;    --&#10;    l_cols_TAB1  rpt_cols_TAB_TYP;&#10;    l_cols_TAB2  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB1.DELETE;&#10;        l_cols_TAB2.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB1, 1, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;doc_table&#39;, &#39;Documents      Storage Table  within nDelius&#39;);&#10;        do_add_col_def(l_cols_TAB1, 2, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;doc_location&#39;, &#39;nDelius /      Alfresco&#39;);&#10;        do_add_col_def(l_cols_TAB1, 3, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;qty_offenders&#39;, &#39;Total Offenders with Documents&#39;);&#10;        do_add_col_def(l_cols_TAB1, 4, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;qty_docs&#39;, &#39;Total     Documents&#39;);&#10;        do_add_col_def(l_cols_TAB1, 5, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;max_doc_len&#39;, &#39;Maximum   Size (MB)&#39;);&#10;        do_add_col_def(l_cols_TAB1, 6, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;avg_doc_len&#39;, &#39;Average   Size (MB)&#39;);&#10;        --&#10;        do_add_col_def(l_cols_TAB2, 1, &#39;C&#39;, 14, &#39;L&#39;, &#39;Y&#39;, &#39;area_code&#39;, &#39;Probation Area Code&#39;);&#10;        do_add_col_def(l_cols_TAB2, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;area_desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB2, 3, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;qty_offenders&#39;, &#39;Total Offenders with Documents&#39;);&#10;        do_add_col_def(l_cols_TAB2, 4, &#39;C&#39;, 15, &#39;L&#39;, &#39;Y&#39;, &#39;qty_docs&#39;, &#39;Total           Documents&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec1 IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB1(1).value :&#61; l_rec1.doc_table;&#10;        l_cols_TAB1(2).value :&#61; l_rec1.doc_location;&#10;        l_cols_TAB1(3).value :&#61; l_rec1.qty_offenders;&#10;        l_cols_TAB1(4).value :&#61; l_rec1.qty_docs;&#10;        l_cols_TAB1(5).value :&#61; l_rec1.max_doc_len;&#10;        l_cols_TAB1(6).value :&#61; l_rec1.avg_doc_len;&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec2 IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB2(1).value :&#61; l_rec2.area_code;&#10;        l_cols_TAB2(2).value :&#61; l_rec2.area_desc;&#10;        l_cols_TAB2(3).value :&#61; l_rec2.qty_offenders;&#10;        l_cols_TAB2(4).value :&#61; l_rec2.qty_docs;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 132;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(&#39;ALL&#39;);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Count Total Documents - by &quot;location&quot;, ND or Alfresco. nDelius Document Sizes&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB1, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB1, &#39;U&#39;);&#10;    OPEN cs1;&#10;    LOOP&#10;        FETCH cs1 INTO l_rec1;&#10;        EXIT WHEN cs1%NOTFOUND;&#10;        --&#10;        do_fetch_rec1;&#10;        do_print_line_buf(l_cols_TAB1, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs1;&#10;    --&#10;    --do_print_page_hdr(&#39;ALL&#39;);&#10;    do_print_rpt_title(&#39;Count Documents associated with Offenders associated with CRC - by CRC&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB2, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB2, &#39;U&#39;);&#10;    OPEN cs2;&#10;    LOOP&#10;        FETCH cs2 INTO l_rec2;&#10;        EXIT WHEN cs2%NOTFOUND;&#10;        --&#10;        do_fetch_rec2;&#10;        do_print_line_buf(l_cols_TAB2, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs2;&#10;    --&#10;END rpt_DOCUMENTS;&#10;--&#10;PROCEDURE rpt_SPG_ENTITY_VOLUMETRICS(&#10;    p_start_date   DATE DEFAULT TRUNC(SYSDATE)-50,&#10;    p_end_date     DATE DEFAULT TRUNC(SYSDATE) + 1,&#10;    p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    l_start_date DATE :&#61; NVL(p_start_date, TRUNC(SYSDATE)-50);&#10;    l_end_date   DATE :&#61; NVL(p_end_date, TRUNC(SYSDATE)+1);&#10;    --&#10;    CURSOR cs  IS&#10;        WITH T AS (&#10;          SELECT&#10;            TO_CHAR(period_start, &#39;YYYYMMDD&#39;) AS period_start,     -- DATE&#10;            TO_CHAR(period_end, &#39;YYYYMMDD&#39;)   AS period_end,       -- DATE&#10;            entity_name,      -- VARCHAR2(30)&#10;            created_count,    -- INTEGER&#10;            updated_count,    -- INTEGER&#10;            xml_message_size, -- INTEGER&#10;            all_active,       -- INTEGER&#10;            nps_only,         -- INTEGER&#10;            nps_om_crc,       -- INTEGER&#10;            nps_crc_om,       -- INTEGER&#10;            single_crc,       -- INTEGER&#10;            multiple_crc      -- INTEGER&#10;          FROM TABLE( PKG_SPG_VOLUMETRICS.get_entity_volumetrics(&#10;                          period_start_date &#61;&gt; l_start_date,&#10;                          period_end_date   &#61;&gt; l_end_date )&#10;                    )&#10;          )&#10;        SELECT *&#10;        FROM T;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;period_start&#39;, &#39;Period    Start Date&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;period_end&#39;, &#39;Period    End Date&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 30, &#39;L&#39;, &#39;Y&#39;, &#39;entity_name&#39;, &#39;SPG Entity Name&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;created_count&#39;, &#39;Total     Created&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;updated_count&#39;, &#39;Total     Updated&#39;);&#10;        do_add_col_def(l_cols_TAB, 6, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;msg_size&#39;, &#39;Average   Message    Size&#39;);&#10;        do_add_col_def(l_cols_TAB, 7, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;all_active&#39;, &#39;All       Active&#39;);&#10;        do_add_col_def(l_cols_TAB, 8, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;nps_only&#39;, &#39;NPS       Only&#39;);&#10;        do_add_col_def(l_cols_TAB, 9, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;nps_om_crc&#39;, &#39;NPS       OM CRC&#39;);&#10;        do_add_col_def(l_cols_TAB,10, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;nps_crc_om&#39;, &#39;NPS       CRC OM&#39;);&#10;        do_add_col_def(l_cols_TAB,11, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;single_crc&#39;, &#39;Single    CRC&#39;);&#10;        do_add_col_def(l_cols_TAB,12, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;multi_crc&#39;, &#39;Multiple  CRC&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value  :&#61; l_rec.period_start;&#10;        l_cols_TAB(2).value  :&#61; l_rec.period_end;&#10;        l_cols_TAB(3).value  :&#61; l_rec.entity_name;&#10;        l_cols_TAB(4).value  :&#61; l_rec.created_count;&#10;        l_cols_TAB(5).value  :&#61; l_rec.updated_count;&#10;        l_cols_TAB(6).value  :&#61; l_rec.xml_message_size;&#10;        l_cols_TAB(7).value  :&#61; l_rec.all_active;&#10;        l_cols_TAB(8).value  :&#61; l_rec.nps_only;&#10;        l_cols_TAB(9).value  :&#61; l_rec.nps_om_crc;&#10;        l_cols_TAB(10).value :&#61; l_rec.nps_crc_om;&#10;        l_cols_TAB(11).value :&#61; l_rec.single_crc;&#10;        l_cols_TAB(12).value :&#61; l_rec.multiple_crc;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 160;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(&#39;ALL&#39;, p_start_date&#61;&gt;l_start_date, p_end_date&#61;&gt;l_end_date);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius SPG Entity Messages Volumetrics&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_SPG_ENTITY_VOLUMETRICS;&#10;--&#10;PROCEDURE rpt_ACTIVE_USERS(p_crc IN VARCHAR2 DEFAULT &#39;ALL&#39;, p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    CURSOR cs  IS&#10;        WITH T AS (&#10;          SELECT&#10;            O.code                     AS org_code,&#10;            O.description              AS org_desc,&#10;            PA.code                    AS area_code,&#10;            PA.description             AS area_desc,&#10;            COUNT( DISTINCT U.user_id) AS usr_qty&#10;          FROM&#10;            user_ U&#10;              INNER JOIN probation_area_user PAU ON PAU.user_id &#61; U.user_id&#10;                INNER JOIN probation_area PA ON PA.probation_area_id &#61; PAU.probation_area_id&#10;                  INNER JOIN organisation O ON O.organisation_id &#61; PA.organisation_id&#10;          WHERE U.private &#61; 1&#10;            AND O.active_flag &#61; 1&#10;            AND O.private &#61; 1&#10;          GROUP BY&#10;            O.code,&#10;            O.description,&#10;            PA.code,&#10;            PA.description&#10;          )&#10;        SELECT *&#10;        FROM T&#10;        ORDER BY org_code, area_code;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 12, &#39;L&#39;, &#39;Y&#39;, &#39;org_code&#39;, &#39;Organisation Code&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;org_name&#39;, &#39;Name&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 4, &#39;L&#39;, &#39;Y&#39;, &#39;crc_code&#39;, &#39;CRC Code&#39;);&#10;        do_add_col_def(l_cols_TAB, 4, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;crc_desc&#39;, &#39;Name&#39;);&#10;        do_add_col_def(l_cols_TAB, 5, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;usr_count&#39;, &#39;Total     Users&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value  :&#61; l_rec.org_code;&#10;        l_cols_TAB(2).value  :&#61; l_rec.org_desc;&#10;        l_cols_TAB(3).value  :&#61; l_rec.area_code;&#10;        l_cols_TAB(4).value  :&#61; l_rec.area_desc;&#10;        l_cols_TAB(5).value  :&#61; l_rec.usr_qty;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 132;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(p_crc);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius CRC Active Users&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_ACTIVE_USERS;&#10;&#10;PROCEDURE rpt_AUDITED_INTERACTIONS(&#10;    p_start_date   DATE DEFAULT TRUNC(SYSDATE)-30,&#10;    p_end_date     DATE DEFAULT TRUNC(SYSDATE) + 1,&#10;    p_print_header VARCHAR2 DEFAULT &#39;Y&#39;)&#10;IS&#10;    --&#10;    l_start_date DATE :&#61; NVL(p_start_date, TRUNC(SYSDATE)-30);&#10;    l_end_date   DATE :&#61; NVL(p_end_date, TRUNC(SYSDATE)+1);&#10;    --&#10;    CURSOR cs  IS&#10;        WITH T AS (&#10;          SELECT&#10;            BI.business_interaction_code AS bi_code,&#10;            BI.description               AS bi_desc,&#10;            COUNT(1)                     AS trx_qty&#10;          FROM&#10;            audited_interaction AI&#10;              INNER JOIN business_interaction BI ON BI.business_interaction_id &#61; AI.business_interaction_id&#10;          WHERE AI.date_time BETWEEN l_start_date AND l_end_date&#10;            AND BI.business_interaction_code IN (&#39;DMBI071&#39;/*Merge Offender*/, &#39;DMBI073&#39;/*Unmerge Offender*/)&#10;            AND AI.outcome &#61; &#39;P&#39;&#10;          GROUP BY&#10;            BI.business_interaction_code,&#10;            BI.description&#10;          )&#10;        SELECT *&#10;        FROM T&#10;        ORDER BY bi_code;&#10;    --&#10;    l_rec  cs%ROWTYPE;&#10;    --&#10;    l_cols_TAB  rpt_cols_TAB_TYP;&#10;    --&#10;    l_rows INTEGER;&#10;    l_cols INTEGER;&#10;    --&#10;    PROCEDURE do_init_report IS&#10;    BEGIN&#10;        init_report(l_rows, l_cols);&#10;        --&#10;        l_cols_TAB.DELETE;&#10;        --&#10;        do_add_col_def(l_cols_TAB, 1, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;bi_code&#39;, &#39;BI Code&#39;);&#10;        do_add_col_def(l_cols_TAB, 2, &#39;C&#39;, 40, &#39;L&#39;, &#39;Y&#39;, &#39;bi)desc&#39;, &#39;Description&#39;);&#10;        do_add_col_def(l_cols_TAB, 3, &#39;C&#39;, 10, &#39;L&#39;, &#39;Y&#39;, &#39;trx_qty&#39;, &#39;Number of Transactions&#39;);&#10;        --&#10;    END;&#10;    --&#10;    PROCEDURE do_fetch_rec IS&#10;    BEGIN&#10;        --&#10;        l_cols_TAB(1).value  :&#61; l_rec.bi_code;&#10;        l_cols_TAB(2).value  :&#61; l_rec.bi_desc;&#10;        l_cols_TAB(3).value  :&#61; l_rec.trx_qty;&#10;        --&#10;    END;&#10;    --&#10;BEGIN&#10;    l_rows :&#61; 0;&#10;    l_cols :&#61; 80;&#10;    do_init_report;&#10;    --&#10;    IF NVLSTR(p_print_header, &#39;Y&#39;) &#61; &#39;Y&#39; THEN&#10;        do_print_page_hdr(&#39;ALL&#39;, p_start_date&#61;&gt;l_start_date, p_end_date&#61;&gt;l_end_date);&#10;    END IF;&#10;    do_print_rpt_title(&#39;nDelius Merge Offender Transaction (from the Audit File)&#39;);&#10;    --&#10;    do_print_line_buf(l_cols_TAB, &#39;T&#39;);&#10;    do_print_line_buf(l_cols_TAB, &#39;U&#39;);&#10;    OPEN cs;&#10;    LOOP&#10;        FETCH cs INTO l_rec;&#10;        EXIT WHEN cs%NOTFOUND;&#10;        --&#10;        do_fetch_rec;&#10;        do_print_line_buf(l_cols_TAB, &#39;D&#39;);&#10;        --&#10;    END LOOP;&#10;    CLOSE cs;&#10;    --&#10;END rpt_AUDITED_INTERACTIONS;&#10;--&#10;&#10;--&#10;--&#10;--&#10;PROCEDURE run_report(&#10;    p_report             VARCHAR2 DEFAULT &#39;ALL&#39;,&#10;    p_crc                VARCHAR2,&#10;    p_transfer_direction VARCHAR2 DEFAULT NULL,&#10;    p_start_date         DATE DEFAULT TRUNC(SYSDATE) - 50,&#10;    p_end_date           DATE DEFAULT TRUNC(SYSDATE) + 1,&#10;    p_summary_flag       VARCHAR2 DEFAULT &#39;N&#39; )&#10;IS&#10;    --&#10;    l_report    VARCHAR2(30) :&#61; NVLSTR(UPPER(TRIM(p_report)), &#39;ALL&#39;);&#10;    l_crc       VARCHAR2(10) :&#61; UPPER(TRIM(p_crc));&#10;    l_direction VARCHAR2(10) :&#61; UPPER(TRIM(p_transfer_direction));&#10;    --&#10;    l_rep_TAB   T_TAB_ORGANISATIONS;&#10;    --&#10;    PROCEDURE do_run_report(p_rep_name VARCHAR2, p_direction_flag VARCHAR2 DEFAULT &#39;O&#39;)&#10;    IS&#10;        l_SQL VARCHAR2(1024);&#10;    BEGIN&#10;        --&#10;        IF p_rep_name IN ( &#39;SPG_ENTITY_VOLUMETRICS&#39;, &#39;AUDITED_INTERACTIONS&#39; ) THEN&#10;            l_SQL :&#61; &#39;BEGIN PKG_CRC_RPT.rpt_&#39; || p_rep_name || &#39;(:p_start_date, :p_end_date&#39;;&#10;        ELSE&#10;            l_SQL :&#61; &#39;BEGIN PKG_CRC_RPT.rpt_&#39; || p_rep_name || &#39;(:p_crc&#39;;&#10;            IF p_rep_name &#61; &#39;PENDING_TRANSFERS&#39; THEN&#10;                l_SQL :&#61; l_SQL || &#39;, :p_direction&#39;;&#10;            END IF;&#10;        END IF;&#10;        --&#10;        l_SQL :&#61; l_SQL || &#39;, :p_print_hdr_flag); END;&#39;;&#10;        --&#10;        IF p_rep_name &#61; &#39;SPG_ENTITY_VOLUMETRICS&#39; THEN&#10;            EXECUTE IMMEDIATE l_SQL USING p_start_date, p_end_date, &#39;N&#39;;&#10;        ELSIF p_rep_name &#61; &#39;PENDING_TRANSFERS&#39; THEN&#10;            EXECUTE IMMEDIATE l_SQL USING l_crc, p_direction_flag, &#39;N&#39;;&#10;        ELSE&#10;            EXECUTE IMMEDIATE l_SQL USING l_crc, &#39;N&#39;;&#10;        END IF;&#10;        --&#10;        print_line(&#39;&#39;);&#10;        print_line(&#39;&#39;);&#10;        print_line(&#39;&#39;);&#10;        --&#10;    END do_run_report;&#10;    --&#10;BEGIN&#10;    --&#10;    l_rep_TAB :&#61;&#10;        T_TAB_ORGANISATIONS(&#10;            &#39;ALL&#39;,&#10;            &#39;ACTIVE_OFFENDERS&#39;,&#10;            &#39;REGISTRATIONS&#39;,&#10;            &#39;ORDERS&#39;,&#10;            &#39;CUSTODIAL_ORDERS&#39;,&#10;            &#39;REQUIREMENTS&#39;,&#10;            &#39;LIC_CONDITIONS&#39;,&#10;            &#39;PSS_REQUIREMENTS&#39;,&#10;            &#39;NSI&#39;,&#10;            &#39;COURT_REPORTS&#39;,&#10;            &#39;INST_REPORTS&#39;,&#10;            &#39;DOCUMENTS&#39;,&#10;            &#39;PENDING_TRANSFERS&#39;,&#10;            &#39;SPG_ENTITY_VOLUMETRICS&#39;,&#10;            &#39;ACTIVE_USERS&#39;,&#10;            &#39;AUDITED_INTERACTIONS&#39; );&#10;    --&#10;    IF PKG_Common.funcMultisetIntersectIsEmpty(l_rep_TAB, T_TAB_ORGANISATIONS(l_report)) &#61; 1 THEN&#10;        raise_application_error(-20001, &#39;ERROR in PKG_CRC_RPT.run_report: invalid value for the P_REPORT parameter [&#39; || l_report || &#39;]&#39;);&#10;    END IF;&#10;    --&#10;    DBMS_OUTPUT.enable(1000000);&#10;    --&#10;    do_print_page_hdr(p_crc, p_transfer_direction, p_start_date, p_end_date);&#10;    --&#10;    IF l_report &#61; &#39;ALL&#39; THEN&#10;        FOR l_idx IN 1 .. l_rep_TAB.COUNT LOOP&#10;            IF l_rep_TAB(l_idx) &lt;&gt; &#39;ALL&#39; THEN&#10;                IF l_rep_TAB(l_idx) &#61; &#39;PENDING_TRANSFERS&#39; AND NVLSTR(l_direction, &#39;ALL&#39;) IN (&#39;ALL&#39;, &#39;BOTH&#39;) THEN&#10;                    do_run_report(l_rep_TAB(l_idx), &#39;O&#39;);&#10;                    do_run_report(l_rep_TAB(l_idx), &#39;I&#39;);&#10;                ELSE&#10;                    do_run_report(l_rep_TAB(l_idx));&#10;                END IF;&#10;            END IF;&#10;        END LOOP;&#10;    ELSE&#10;        do_run_report(l_report, l_direction);&#10;    END IF;&#10;    --&#10;END run_report;&#10;&#10;--&#10;-- Package Body Initialization block&#10;--&#10;BEGIN&#10;    PKG_Global.do_init;&#10;END pkg_crc_rpt;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>