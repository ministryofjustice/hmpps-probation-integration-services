<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.NSI_SUPPORT_API</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY nsi_support_api&#10;IS&#10;--&#10;PROCEDURE do_set_rbac_levels( OffenderIdIn  NUMBER,&#10;                              L1Out         OUT NUMBER,&#10;                              L2Out         OUT NUMBER,&#10;                              L3Out         OUT NUMBER )&#10;IS&#10;BEGIN&#10;    PKG_SEARCH.do_set_rbac_levels(  p_offender_id &#61;&gt; OffenderIdIn,&#10;                                    p_L1          &#61;&gt; L1Out,&#10;                                    p_L2          &#61;&gt; L2Out,&#10;                                    p_L3          &#61;&gt; L3Out);&#10;END do_set_rbac_levels;&#10;--&#10;--&#10;FUNCTION getNSISummaryListSQL( eventIdIn IN EVENT.event_id%TYPE ) RETURN CLOB&#10;IS&#10;    --&#10;    l_ret CLOB;&#10;    --&#10;BEGIN&#10;  --&#10;  l_ret :&#61;&#10;&#39;SELECT&#10;  N.nsi_id,&#10;  N.offender_id,&#10;  N.event_id,&#10;  N.nsi_type_id,&#10;  RNT.code nsi_type_code,&#10;  RNT.description nsi_type_desc,&#10;  N.length,&#10;  N.referral_date,&#10;  N.actual_start_date,&#10;  N.actual_end_date,&#10;  N.nsi_status_id,&#10;  RNS.code nsi_status_code,&#10;  RNS.description nsi_status_desc,&#10;  N.active_flag,&#10;  E.event_number,&#10;  NULL L1,&#10;  NULL L2,&#10;  NULL L3&#10;FROM&#10;  nsi n&#10;    INNER JOIN r_nsi_type rnt ON N.nsi_type_id &#61; RNT.nsi_type_id&#10;    INNER JOIN r_nsi_status rns ON N.nsi_status_id &#61; RNS.nsi_status_id&#10;    LEFT OUTER JOIN r_standard_reference_list R1 ON N.nsi_sub_type_id &#61; R1.standard_reference_list_id&#10;                                                AND R1.reference_data_master_id IN ( SELECT reference_data_master_id&#10;                                                                                     FROM r_reference_data_master&#10;                                                                                     WHERE code_set_name &#61; &#39;&#39;NSI SUB TYPE&#39;&#39; )&#10;    &#39; || CASE WHEN eventIdIn IS NOT NULL THEN &#39;INNER JOIN event E&#39; ELSE &#39;LEFT OUTER JOIN event E&#39; END || &#39; ON N.event_id &#61; E.event_id&#10;WHERE 1&#61;1&#10;  AND N.offender_id &#61; :offender_id&#10;  AND &#39; || CASE WHEN eventIdIn IS NOT NULL THEN &#39;N.event_id &#61; :event_id&#39; ELSE &#39;:event_id IS NULL&#39; END || &#39;&#10;  AND N.active_flag &#61; :active_flag&#10;  AND N.soft_deleted &#61; :soft_deleted&#10;ORDER BY&#10;  N.nsi_status_date&#39;;&#10;    --&#10;    RETURN l_ret;&#10;    --&#10;END getNSISummaryListSQL;&#10;--&#10;--&#10;FUNCTION getNSISummaryDataTab(  OffenderIdIn  IN nsi.offender_id%TYPE,&#10;                                EventIdIn     IN nsi.event_id%TYPE DEFAULT NULL,&#10;                                ActiveFlagIn  IN nsi.active_flag%TYPE DEFAULT 1,&#10;                                SoftDeletedIn IN nsi.soft_deleted%TYPE DEFAULT 0) RETURN nsi_pipeline.nsi_summary_tab PIPELINED&#10;IS&#10;    --&#10;    l_SQL             CLOB;&#10;    l_ref_cur         SYS_REFCURSOR;&#10;    l_nsi_summary_tab NSI_PIPELINE.nsi_summary_tab;&#10;    l_counter         INTEGER;&#10;    --&#10;BEGIN&#10;    --&#10;    l_counter :&#61; 0;&#10;    --&#10;    l_SQL :&#61; getNSISummaryListSQL(EventIdIn &#61;&gt; EventIdIn);&#10;    --&#10;    OPEN l_ref_cur FOR l_SQL&#10;    USING&#10;      OffenderIdIn,&#10;      EventIdIn,&#10;      ActiveFlagIn,&#10;      SoftDeletedIn;&#10;    --&#10;    LOOP&#10;        --&#10;        FETCH l_ref_cur BULK COLLECT INTO l_nsi_summary_tab LIMIT 100;&#10;        --&#10;        l_counter :&#61; l_counter + l_nsi_summary_tab.COUNT;&#10;        --&#10;        FOR i IN 1 .. l_nsi_summary_tab.COUNT&#10;        LOOP&#10;          --&#10;          do_set_rbac_levels(   OffenderIdIn  &#61;&gt; l_nsi_summary_tab(i).offender_id,&#10;                                L1Out         &#61;&gt; l_nsi_summary_tab(i).L1,&#10;                                L2Out         &#61;&gt; l_nsi_summary_tab(i).L2,&#10;                                L3Out         &#61;&gt; l_nsi_summary_tab(i).L3);&#10;          --&#10;          PIPE ROW (l_nsi_summary_tab(i));&#10;          --&#10;        END LOOP;&#10;        --&#10;        EXIT WHEN l_nsi_summary_tab.COUNT &#61; 0;&#10;        --&#10;    END LOOP;&#10;    CLOSE l_ref_cur;&#10;    --&#10;    RETURN;&#10;END getNSISummaryDataTab;&#10;--&#10;--&#10;PROCEDURE getNSISummaryData(  OffenderIdIn  IN nsi.offender_id%TYPE,&#10;                              EventIdIn     IN nsi.event_id%TYPE DEFAULT NULL,&#10;                              ActiveFlagIn  IN nsi.active_flag%TYPE DEFAULT 1,&#10;                              SoftDeletedIn IN nsi.soft_deleted%TYPE DEFAULT 0,&#10;                              OutCursor     OUT SYS_REFCURSOR)&#10;IS&#10;BEGIN&#10;    OPEN OutCursor FOR&#10;      SELECT&#10;        nsi_id,&#10;        offender_id,&#10;        event_id,&#10;        nsi_type_id,&#10;        nsi_type_code,&#10;        nsi_type_desc,&#10;        length,&#10;        referral_date,&#10;        actual_start_date,&#10;        actual_end_date,&#10;        nsi_status_id,&#10;        nsi_status_code,&#10;        nsi_status_desc,&#10;        active_flag,&#10;        event_number,&#10;        L1,&#10;        L2,&#10;        L3&#10;      FROM TABLE(nsi_support_api.getNSISummaryDataTab(  OffenderIdIn  &#61;&gt; OffenderIdIn,&#10;                                                        EventIdIn     &#61;&gt; EventIdIn,&#10;                                                        ActiveFlagIn  &#61;&gt; ActiveFlagIn,&#10;                                                        SoftDeletedIn &#61;&gt; SoftDeletedIn));&#10;END getNSISummaryData;&#10;--&#10;--&#10;FUNCTION getNSIListSQL( StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                        NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                        NsiSubTypeIdIn          IN nsi.nsi_sub_type_id%TYPE DEFAULT NULL,&#10;                        NsiStatusIdIn           IN nsi.nsi_status_id%TYPE DEFAULT NULL,&#10;                        BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                        DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                        LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                        EventIdIn               IN event.event_id%TYPE DEFAULT NULL,&#10;                        ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                        LevelIn                 IN VARCHAR2 DEFAULT &#39;ALL&#39;,&#10;                        PagedSyntax             IN VARCHAR2 DEFAULT &#39;N&#39; )&#10;RETURN CLOB IS&#10;    --&#10;    l_ret CLOB;&#10;    --&#10;BEGIN&#10;    --&#10;    l_ret :&#61;&#10;    --&#10;&#39;SELECT&#10;  N.nsi_id,&#10;  N.offender_id,&#10;  N.event_id,&#10;  N.nsi_type_id,&#10;  RNT.code          AS nsi_type_code,&#10;  RNT.description   AS nsi_type_desc,&#10;  N.length,&#10;  N.referral_date,&#10;  N.actual_start_date,&#10;  N.actual_end_date,&#10;  N.nsi_status_id,&#10;  RNS.code          AS nsi_status_code,&#10;  RNS.description   AS nsi_status_desc,&#10;  N.pending_transfer,&#10;  N.nsi_status_date,&#10;  N.active_flag,&#10;  NM.probation_area_id,&#10;  PA.code           AS probation_area_code,&#10;  NM.staff_id,&#10;  S.officer_code,&#10;  NM.team_id,&#10;  T.code            AS team_code,&#10;  D.district_id,&#10;  B.code            AS level2_code,&#10;  B.borough_id,&#10;  D.code            AS level3_code,&#10;  LDU.local_delivery_unit_id,&#10;  LDU.code          AS team_type_code,&#10;  E.event_number,&#10;  O.first_name,&#10;  O.second_name,&#10;  O.surname,&#10;  O.third_name,&#10;  O.crn,&#10;  O.current_highest_risk_colour,&#10;  O.current_exclusion,&#10;  O.current_restriction,&#10;  DI.disposal_id,&#10;  DI.termination_date,&#10;  DI.upw,&#10;  RDT.sentence_type,&#10;  RDT.cja2003,&#10;  RDT.pre_cja2003,&#10;  NULL L1,&#10;  NULL L2,&#10;  NULL L3,&#10;  --&#10;  &#39; || CASE&#10;           WHEN PagedSyntax &#61; &#39;Y&#39; THEN&#10;               &#39;ROW_NUMBER() OVER (ORDER BY N.nsi_status_date, N.nsi_id) AS row_number, COUNT(1) OVER() AS total_rows&#39;&#10;           ELSE&#10;               &#39;NULL AS row_number, NULL AS total_rows, NULL AS total_pages&#39;&#10;       END || &#39;,&#10;  --&#10;  N.document_linked,&#10;  NM.start_date,&#10;  NM.nsi_manager_id,&#10;  RNT.RATE_CARD_FLAG          AS nsi_rate_card_flag&#10;FROM&#10;  nsi N&#10;    INNER JOIN offender O ON O.offender_id &#61; N.offender_id&#10;    INNER JOIN nsi_manager nm ON NM.nsi_id &#61; N.nsi_id AND NM.active_flag &#61; 1&#10;      INNER JOIN staff S ON S.staff_id &#61; NM.staff_id&#10;      INNER JOIN team T ON T.team_id &#61; NM.team_id&#10;        INNER JOIN district D ON D.district_id &#61; T.district_id&#10;          INNER JOIN borough B ON B.borough_id &#61; D.borough_id&#10;        INNER JOIN local_delivery_unit LDU ON LDU.local_delivery_unit_id &#61; T.local_delivery_unit_id&#10;      INNER JOIN probation_area PA ON PA.probation_area_id &#61; NM.probation_area_id&#10;    INNER JOIN r_nsi_type RNT ON RNT.nsi_type_id &#61; N.nsi_type_id&#10;    INNER JOIN r_nsi_status rns ON RNS.nsi_status_id &#61; N.nsi_status_id&#10;    &#39; || CASE WHEN EventIdIn IS NOT NULL OR LevelIn IN (&#39;EVENT&#39;) THEN &#39; INNER JOIN event E &#39; ELSE &#39; LEFT OUTER JOIN event E &#39; END || &#39; ON E.event_id &#61; N.event_id&#10;      LEFT OUTER JOIN disposal DI ON DI.event_id &#61; E.event_id&#10;        LEFT OUTER JOIN r_disposal_type RDT ON RDT.disposal_type_id &#61; DI.disposal_type_id&#10;    LEFT OUTER JOIN r_standard_reference_list R1 ON R1.standard_reference_list_id &#61; N.nsi_sub_type_id&#10;                                                AND R1.reference_data_master_id IN ( SELECT reference_data_master_id&#10;                                                                                     FROM r_reference_data_master&#10;                                                                                     WHERE code_set_name &#61; &#39;&#39;NSI SUB TYPE&#39;&#39; )&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted &#61; 0&#10;  AND NM.probation_area_id &#61; :probation_area_id&#10;  AND NM.team_id &#61; :team_id&#10;  --&#10;  AND &#39; || CASE WHEN StaffIdIn             IS NOT NULL THEN &#39;NM.staff_id &#61; :staff_id&#39;                            ELSE &#39;:staff_id IS NULL&#39;               END || &#39;&#10;  AND &#39; || CASE WHEN NsiTypeIdIn           IS NOT NULL THEN &#39;N.nsi_type_id &#61; :nsi_type_id&#39;                       ELSE &#39;:nsi_type_id IS NULL&#39;            END || &#39;&#10;  AND &#39; || CASE WHEN NsiSubTypeIdIn        IS NOT NULL THEN &#39;N.nsi_sub_type_id &#61; :nsi_sub_type_id&#39;               ELSE &#39;:nsi_sub_type_id IS NULL&#39;        END || &#39;&#10;  AND &#39; || CASE WHEN NsiStatusIdIn         IS NOT NULL THEN &#39;N.nsi_status_id &#61; :nsi_status_id&#39;                   ELSE &#39;:nsi_status_id IS NULL&#39;          END || &#39;&#10;  AND &#39; || CASE WHEN BoroughIdIn           IS NOT NULL THEN &#39;D.borough_id &#61; :borough_id&#39;                         ELSE &#39;:borough_id IS NULL&#39;             END || &#39;&#10;  AND &#39; || CASE WHEN DistrictIdIn          IS NOT NULL THEN &#39;D.district_id &#61; :district_id&#39;                       ELSE &#39;:district_id IS NULL &#39;           END || &#39;&#10;  AND &#39; || CASE WHEN LocalDeliveryUnitIdIn IS NOT NULL THEN &#39;T.local_delivery_unit_id &#61; :local_delivery_unit_id&#39; ELSE &#39;:local_delivery_unit_id IS NULL&#39; END || &#39;&#10;  AND &#39; || CASE WHEN EventIdIn             IS NOT NULL THEN &#39;N.event_id &#61; :event_id&#39;                             ELSE &#39;:event_id IS NULL&#39;               END || &#39;&#10;  --&#10;  AND &#39; || CASE WHEN LevelIn &#61; &#39;EVENT&#39; THEN &#39;N.event_id IS NOT NULL&#39; WHEN LevelIn &#61; &#39;OFFENDER&#39; THEN &#39;N.event_id IS NULL&#39; ELSE &#39;1&#61;1&#39; END || &#39;&#10;  --&#10;  AND &#39; || CASE WHEN ActiveFlagIn &#61; 1  THEN &#39;N.active_flag &#61; 1&#39; ELSE &#39;N.active_flag IN ( 0, 1 )&#39; END || &#39;&#10;  --&#10;  AND N.soft_deleted &#61; :soft_deleted&#10;ORDER BY&#10;  N.nsi_status_date,&#10;  N.nsi_id&#39;;&#10;    --&#10;    RETURN l_ret;&#10;    --&#10;END getNSIListSQL;&#10;--&#10;--&#10;FUNCTION getNSIListDataTab( ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE,&#10;                            TeamIdIn                IN team.team_id%TYPE,&#10;                            StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                            NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                            NsiSubTypeIdIn          IN nsi.nsi_sub_type_id%TYPE DEFAULT NULL,&#10;                            NsiStatusIdIn           IN nsi.nsi_status_id%TYPE DEFAULT NULL,&#10;                            BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                            DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                            LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                            EventIdIn               IN event.event_id%TYPE DEFAULT NULL,&#10;                            LevelIn                 IN VARCHAR2 DEFAULT &#39;ALL&#39;,&#10;                            ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                            SoftDeletedIn           IN nsi.soft_deleted%TYPE DEFAULT 0,&#10;                            MaxRowsIn               IN NUMBER DEFAULT -1)&#10;RETURN nsi_pipeline.nsi_list_tab PIPELINED&#10;IS&#10;    --&#10;    l_SQL          CLOB;&#10;    l_ref_cur      SYS_REFCURSOR;&#10;    l_nsi_list_tab NSI_PIPELINE.nsi_list_tab;&#10;    --&#10;    l_counter      INTEGER :&#61; 0;&#10;    --&#10;    l_rows         INTEGER :&#61; 0;&#10;    l_max_rows     INTEGER :&#61; NVL(MaxRowsIn, -1);&#10;    l_exit_flag    BOOLEAN :&#61; FALSE;&#10;    --&#10;BEGIN&#10;    --&#10;    l_SQL :&#61;&#10;        getNSIListSQL(&#10;            StaffIdIn               &#61;&gt; StaffIdIn,&#10;            NsiTypeIdIn             &#61;&gt; NsiTypeIdIn,&#10;            NsiSubTypeIdIn          &#61;&gt; NsiSubTypeIdIn,&#10;            NsiStatusIdIn           &#61;&gt; NsiStatusIdIn,&#10;            BoroughIdIn             &#61;&gt; BoroughIdIn,&#10;            DistrictIdIn            &#61;&gt; DistrictIdIn,&#10;            LocalDeliveryUnitIdIn   &#61;&gt; LocalDeliveryUnitIdIn,&#10;            EventIdIn               &#61;&gt; EventIdIn,&#10;            LevelIn                 &#61;&gt; LevelIn,&#10;            ActiveFlagIn            &#61;&gt; ActiveFlagIn );&#10;    --&#10;    OPEN l_ref_cur FOR l_SQL&#10;    USING&#10;      ProbationAreaIdIn,&#10;      TeamIdIn,&#10;      StaffIdIn,&#10;      NsiTypeIdIn,&#10;      NsiSubTypeIdIn,&#10;      NsiStatusIdIn,&#10;      BoroughIdIn,&#10;      DistrictIdIn,&#10;      LocalDeliveryUnitIdIn,&#10;      EventIdIn,&#10;      SoftDeletedIn;&#10;    --&#10;    LOOP&#10;        --&#10;        FETCH l_ref_cur BULK COLLECT INTO l_nsi_list_tab LIMIT 100;&#10;        --&#10;        l_counter :&#61; l_counter + l_nsi_list_tab.COUNT;&#10;        --&#10;        FOR i IN 1 .. l_nsi_list_tab.COUNT LOOP&#10;            --&#10;            do_set_rbac_levels(&#10;                OffenderIdIn &#61;&gt; l_nsi_list_tab(i).offender_id,&#10;                L1Out        &#61;&gt; l_nsi_list_tab(i).L1,&#10;                L2Out        &#61;&gt; l_nsi_list_tab(i).L2,&#10;                L3Out        &#61;&gt; l_nsi_list_tab(i).L3 );&#10;            --&#10;            PIPE ROW (l_nsi_list_tab(i));&#10;            --&#10;            l_rows :&#61; l_rows + 1;&#10;            IF l_max_rows &gt; 0 AND l_rows &gt;&#61; l_max_rows THEN&#10;                l_exit_flag :&#61; TRUE;&#10;            END IF;&#10;            --&#10;            EXIT WHEN l_exit_flag;&#10;          --&#10;        END LOOP;&#10;        --&#10;        EXIT WHEN l_nsi_list_tab.COUNT &#61; 0 OR l_exit_flag;&#10;        --&#10;    END LOOP;&#10;    CLOSE l_ref_cur;&#10;    --&#10;    RETURN;&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    --&#10;    IF l_ref_cur%ISOPEN THEN CLOSE l_ref_cur; END IF;&#10;    --&#10;    raise_application_error(-20001, &#39;ERROR in getNSIListDataTab: &#39; || SQLERRM || CHR(10) || l_SQL );&#10;    --&#10;END getNSIListDataTab;&#10;--&#10;--&#10;PROCEDURE getNSIListData( ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE,&#10;                          TeamIdIn                IN team.team_id%TYPE,&#10;                          StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                          NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                          NsiSubTypeIdIn          IN nsi.nsi_sub_type_id%TYPE DEFAULT NULL,&#10;                          NsiStatusIdIn           IN nsi.nsi_status_id%TYPE DEFAULT NULL,&#10;                          BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                          DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                          LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                          EventIdIn               IN event.event_id%TYPE DEFAULT NULL,&#10;                          LevelIn             IN VARCHAR2 DEFAULT &#39;ALL&#39;,&#10;                          ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                          SoftDeletedIn           IN nsi.soft_deleted%TYPE DEFAULT 0,&#10;                          MaxRowsIn               IN NUMBER DEFAULT -1,&#10;                          OutCursor               OUT SYS_REFCURSOR)&#10;IS&#10;BEGIN&#10;    OPEN OutCursor FOR&#10;      SELECT&#10;        nsi_id,&#10;        offender_id,&#10;        event_id,&#10;        nsi_type_id,&#10;        nsi_type_code,&#10;        nsi_type_desc,&#10;        length,&#10;        referral_date,&#10;        actual_start_date,&#10;        actual_end_date,&#10;        nsi_status_id,&#10;        nsi_status_code,&#10;        nsi_status_desc,&#10;        pending_transfer,&#10;        nsi_status_date,&#10;        active_flag,&#10;        probation_area_id,&#10;        probation_area_code,&#10;        staff_id,&#10;        officer_code,&#10;        team_id,&#10;        team_code,&#10;        district_id,&#10;        level2_code,&#10;        borough_id,&#10;        level3_code,&#10;        local_delivery_unit_id,&#10;        team_type_code,&#10;        event_number,&#10;        first_name,&#10;        second_name,&#10;        surname,&#10;        third_name,&#10;        crn,&#10;        current_highest_risk_colour,&#10;        current_exclusion,&#10;        current_restriction,&#10;        disposal_id,&#10;        termination_date,&#10;        upw,&#10;        sentence_type,&#10;        cja2003,&#10;        pre_cja2003,&#10;        L1,&#10;        L2,&#10;        L3,&#10;        row_number,&#10;        total_rows,&#10;        total_pages,&#10;        document_linked,&#10;        start_date,&#10;        nsi_manager_id,&#10;        nsi_rate_card_flag&#10;      FROM TABLE(nsi_support_api.getNSIListDataTab( ProbationAreaIdIn       &#61;&gt; ProbationAreaIdIn,&#10;                                                    TeamIdIn                &#61;&gt; TeamIdIn,&#10;                                                    StaffIdIn               &#61;&gt; StaffIdIn,&#10;                                                    NsiTypeIdIn             &#61;&gt; NsiTypeIdIn,&#10;                                                    NsiSubTypeIdIn          &#61;&gt; NsiSubTypeIdIn,&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;&#9;&#9;&#9;&#9;&#9;&#9;NsiStatusIdIn&#9;&#9;&#9;&#61;&gt; NsiStatusIdIn,&#10;                                                    BoroughIdIn             &#61;&gt; BoroughIdIn,&#10;                                                    DistrictIdIn            &#61;&gt; DistrictIdIn,&#10;                                                    LocalDeliveryUnitIdIn   &#61;&gt; LocalDeliveryUnitIdIn,&#10;                                                    EventIdIn               &#61;&gt; EventIdIn,&#10;                                                    LevelIn                 &#61;&gt; LevelIn,&#10;                                                    ActiveFlagIn            &#61;&gt; ActiveFlagIn,&#10;                                                    SoftDeletedIn           &#61;&gt; SoftDeletedIn,&#10;                                                    MaxRowsIn               &#61;&gt; NVL(MaxRowsIn, -1) ));&#10;&#10;END getNSIListData;&#10;--&#10;--&#10;FUNCTION getNSIListData_Paged ( ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE,&#10;                                TeamIdIn                IN team.team_id%TYPE,&#10;                                StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                                NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                                BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                                DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                                LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                                EventIdIn               IN event.event_id%TYPE DEFAULT NULL,&#10;                                LevelIn             IN VARCHAR2 DEFAULT &#39;ALL&#39;,&#10;                                ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                                SoftDeletedIn           IN nsi.soft_deleted%TYPE DEFAULT 0,&#10;                                PageNumberIn            IN NUMBER,&#10;                                PageSizeIn              IN NUMBER) RETURN nsi_pipeline.nsi_list_tab PIPELINED&#10;IS&#10;    l_fetch_size    NUMBER :&#61; 100;&#10;    l_rows          nsi_pipeline.nsi_list_tab;&#10;    l_sql           CLOB;&#10;    l_first_row     NUMBER;&#10;    l_last_row      NUMBER;&#10;    --&#10;    TYPE typ_cur IS REF CURSOR;&#10;    cur             typ_cur;&#10;BEGIN&#10;    --&#10;    l_fetch_size  :&#61; LEAST(l_fetch_size, PageSizeIn);&#10;    l_first_row   :&#61; (PageNumberIn -1) * PageSizeIn + 1;&#10;    l_last_row    :&#61; PageNumberIn * PageSizeIn;&#10;    --&#10;    l_sql :&#61; &#39;SELECT pag.*, CEIL(total_rows/&#39; || PageSizeIn || &#39;) AS total_pages&#10;              FROM ( &#39; || getNSIListSQL(  StaffIdIn               &#61;&gt; StaffIdIn,&#10;                                          NsiTypeIdIn             &#61;&gt; NsiTypeIdIn,&#10;                                          BoroughIdIn             &#61;&gt; BoroughIdIn,&#10;                                          DistrictIdIn            &#61;&gt; DistrictIdIn,&#10;                                          LocalDeliveryUnitIdIn   &#61;&gt; LocalDeliveryUnitIdIn,&#10;                                          EventIdIn               &#61;&gt; EventIdIn,&#10;                                          LevelIn             &#61;&gt; LevelIn,&#10;                                          PagedSyntax             &#61;&gt; &#39;Y&#39;) || &#39; ) pag&#10;              WHERE pag.row_number BETWEEN &#39; || l_first_row || &#39; AND &#39; || l_last_row || &#39; ORDER BY pag.row_number&#39;;&#10;    --&#10;    OPEN cur FOR l_sql&#10;    USING   ProbationAreaIdIn,&#10;            TeamIdIn,&#10;            StaffIdIn,&#10;            NsiTypeIdIn,&#10;            BoroughIdIn,&#10;            DistrictIdIn,&#10;            LocalDeliveryUnitIdIn,&#10;            EventIdIn,&#10;            ActiveFlagIn,&#10;            SoftDeletedIn;&#10;    LOOP&#10;        FETCH cur BULK COLLECT INTO l_rows LIMIT l_fetch_size;&#10;        EXIT WHEN l_rows.COUNT &#61; 0;&#10;        FOR i IN 1 .. l_rows.COUNT&#10;        LOOP&#10;            do_set_rbac_levels(   OffenderIdIn  &#61;&gt; l_rows(i).offender_id,&#10;                                  L1Out         &#61;&gt; l_rows(i).L1,&#10;                                  L2Out         &#61;&gt; l_rows(i).L2,&#10;                                  L3Out         &#61;&gt; l_rows(i).L3);&#10;            --&#10;            PIPE ROW(l_rows(i));&#10;        END LOOP;&#10;    END LOOP;&#10;    CLOSE cur;&#10;    RETURN;&#10;END getNSIListData_Paged;&#10;--&#10;--&#10;PROCEDURE getNSIListData_Paged (  ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE,&#10;                                  TeamIdIn                IN team.team_id%TYPE,&#10;                                  StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                                  NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                                  BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                                  DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                                  LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                                  EventIdIn               IN event.event_id%TYPE DEFAULT NULL,&#10;                                  LevelIn             IN VARCHAR2 DEFAULT &#39;ALL&#39;,&#10;                                  ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                                  SoftDeletedIn           IN nsi.soft_deleted%TYPE DEFAULT 0,&#10;                                  PageNumberIn            IN NUMBER,&#10;                                  PageSizeIn              IN NUMBER,&#10;                                  OutCursor               OUT SYS_REFCURSOR )&#10;IS&#10;BEGIN&#10;    OPEN OutCursor FOR&#10;      SELECT&#10;        nsi_id,&#10;        offender_id,&#10;        event_id,&#10;        nsi_type_id,&#10;        nsi_type_code,&#10;        nsi_type_desc,&#10;        length,&#10;        referral_date,&#10;        actual_start_date,&#10;        actual_end_date,&#10;        nsi_status_id,&#10;        nsi_status_code,&#10;        nsi_status_desc,&#10;        pending_transfer,&#10;        nsi_status_date,&#10;        active_flag,&#10;        probation_area_id,&#10;        probation_area_code,&#10;        staff_id,&#10;        officer_code,&#10;        team_id,&#10;        team_code,&#10;        district_id,&#10;        level2_code,&#10;        borough_id,&#10;        level3_code,&#10;        local_delivery_unit_id,&#10;        team_type_code,&#10;        event_number,&#10;        first_name,&#10;        second_name,&#10;        surname,&#10;        third_name,&#10;        crn,&#10;        current_highest_risk_colour,&#10;        current_exclusion,&#10;        current_restriction,&#10;        disposal_id,&#10;        termination_date,&#10;        upw,&#10;        sentence_type,&#10;        cja2003,&#10;        pre_cja2003,&#10;        L1,&#10;        L2,&#10;        L3,&#10;        row_number,&#10;        total_rows,&#10;        total_pages&#10;      FROM TABLE(nsi_support_api.getNSIListData_Paged(  ProbationAreaIdIn       &#61;&gt; ProbationAreaIdIn,&#10;                                                        TeamIdIn                &#61;&gt; TeamIdIn,&#10;                                                        StaffIdIn               &#61;&gt; StaffIdIn,&#10;                                                        NsiTypeIdIn             &#61;&gt; NsiTypeIdIn,&#10;                                                        BoroughIdIn             &#61;&gt; BoroughIdIn,&#10;                                                        DistrictIdIn            &#61;&gt; DistrictIdIn,&#10;                                                        LocalDeliveryUnitIdIn   &#61;&gt; LocalDeliveryUnitIdIn,&#10;                                                        EventIdIn               &#61;&gt; EventIdIn,&#10;                                                        LevelIn             &#61;&gt; LevelIn,&#10;                                                        ActiveFlagIn            &#61;&gt; ActiveFlagIn,&#10;                                                        SoftDeletedIn           &#61;&gt; SoftDeletedIn,&#10;                                                        PageNumberIn            &#61;&gt; PageNumberIn,&#10;                                                        PageSizeIn              &#61;&gt; PageSizeIn));&#10;END getNSIListData_Paged;&#10;--&#10;--&#10;FUNCTION getBreachRecallSQL ( TeamIdIn                IN team.team_id%TYPE DEFAULT NULL,&#10;                              StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                              NSITypeIdIn             IN r_nsi_type.nsi_type_id%TYPE DEFAULT NULL,&#10;                              NsiStatusIdIn           IN r_nsi_status.nsi_status_id%TYPE DEFAULT NULL,&#10;                              ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE DEFAULT NULL,&#10;                              BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                              DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                              LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                              PagedSyntax IN VARCHAR2 DEFAULT &#39;N&#39; ) RETURN CLOB&#10;IS&#10;    --&#10;    l_ret CLOB;&#10;    --&#10;BEGIN&#10;    --&#10;    l_ret :&#61;&#10;&#39;SELECT&#10;  N.nsi_id,&#10;  N.offender_id,&#10;  N.event_id,&#10;  N.nsi_type_id,&#10;  RNT.code nsi_type_code,&#10;  RNT.description nsi_type_desc,&#10;  N.length,&#10;  N.referral_date,&#10;  N.actual_start_date,&#10;  N.actual_end_date,&#10;  N.nsi_status_id,&#10;  RNS.code nsi_status_code,&#10;  RNS.description nsi_status_desc,&#10;  N.pending_transfer,&#10;  N.nsi_status_date,&#10;  N.active_flag,&#10;  NM.probation_area_id,&#10;  PA.code probation_area_code,&#10;  NM.staff_id,&#10;  S.officer_code,&#10;  NM.team_id,&#10;  T.code team_code,&#10;  D.district_id,&#10;  B.code level2_code,&#10;  B.borough_id,&#10;  D.code level3_code,&#10;  LDU.local_delivery_unit_id,&#10;  LDU.code team_type_code,&#10;  O.first_name,&#10;  O.second_name,&#10;  O.surname,&#10;  O.third_name,&#10;  O.crn,&#10;  O.current_highest_risk_colour,&#10;  O.current_exclusion,&#10;  O.current_restriction,&#10;  NULL L1,&#10;  NULL L2,&#10;  NULL L3,&#10;  &#39; || CASE WHEN PagedSyntax &#61; &#39;Y&#39;&#10;           THEN &#39;ROW_NUMBER() OVER (ORDER BY N.nsi_status_date, N.nsi_id) AS row_number, COUNT(1) OVER() AS total_rows&#39;&#10;           ELSE &#39;NULL AS row_number, NULL AS total_rows, NULL AS total_pages&#39;&#10;       END || &#39;&#10;FROM&#10;  nsi N&#10;    INNER JOIN r_nsi_type RNT ON N.nsi_type_id &#61; RNT.nsi_type_id AND RNT.enforcement_type &#61; 1&#10;    LEFT OUTER JOIN r_standard_reference_list R1 ON N.nsi_sub_type_id &#61; R1.standard_reference_list_id&#10;                                                AND R1.reference_data_master_id IN ( SELECT reference_data_master_id&#10;                                                                                     FROM r_reference_data_master&#10;                                                                                     WHERE code_set_name &#61; &#39;&#39;NSI SUB TYPE&#39;&#39; )&#10;    INNER JOIN r_nsi_status RNS ON N.nsi_status_id &#61; RNS.nsi_status_id&#10;    INNER JOIN offender O ON N.offender_id &#61; O.offender_id&#10;    INNER JOIN nsi_manager NM ON N.nsi_id &#61; NM.nsi_id AND NM.active_flag &#61; 1&#10;      INNER JOIN staff S ON NM.staff_id &#61; S.staff_id&#10;      INNER JOIN team T  ON NM.team_id &#61; T.team_id&#10;        INNER JOIN district D ON T.district_id &#61; D.district_id&#10;          INNER JOIN borough B ON D.borough_id &#61; B.borough_id&#10;        INNER JOIN local_delivery_unit LDU ON T.local_delivery_unit_id &#61; LDU.local_delivery_unit_id&#10;      INNER JOIN probation_area PA ON NM.probation_area_id &#61; PA.probation_area_id&#10;WHERE 1&#61;1&#10;  AND O.soft_deleted &#61; 0&#10;  AND N.active_flag &#61; :active_flag&#10;  AND N.soft_deleted &#61; :soft_deleted&#10;  AND &#39; || CASE WHEN TeamIdIn IS NOT NULL              THEN &#39;NM.team_id &#61; :team_id&#39;                              ELSE &#39;:team_id IS NULL&#39;                END || &#39;&#10;  AND &#39; || CASE WHEN StaffIdIn IS NOT NULL             THEN &#39;NM.staff_id &#61; :staff_id&#39;                            ELSE &#39;:staff_id IS NULL&#39;               END || &#39;&#10;  AND &#39; || CASE WHEN NsiTypeIdIn IS NOT NULL           THEN &#39;N.nsi_type_id &#61; :nsi_type_id&#39;                       ELSE &#39;:nsi_type_id IS NULL&#39;            END || &#39;&#10;  AND &#39; || CASE WHEN NsiStatusIdIn IS NOT NULL         THEN &#39;N.nsi_status_id &#61; :nsi_status_id&#39;                   ELSE &#39;:nsi_status_id IS NULL&#39;          END || &#39;&#10;  AND &#39; || CASE WHEN ProbationAreaIdIn IS NOT NULL     THEN &#39;NM.probation_area_id &#61; :probation_area_id&#39;          ELSE &#39;:probation_area_id IS NULL&#39;      END || &#39;&#10;  AND &#39; || CASE WHEN BoroughIdIn IS NOT NULL           THEN &#39;D.borough_id &#61; :borough_id&#39;                         ELSE &#39;:borough_id IS NULL&#39;             END || &#39;&#10;  AND &#39; || CASE WHEN DistrictIdIn IS NOT NULL          THEN &#39;D.district_id &#61; :district_id&#39;                       ELSE &#39;:district_id IS NULL&#39;            END || &#39;&#10;  AND &#39; || CASE WHEN LocalDeliveryUnitIdIn IS NOT NULL THEN &#39;T.local_delivery_unit_id &#61; :local_delivery_unit_id&#39; ELSE &#39;:local_delivery_unit_id IS NULL&#39; END || &#39;&#10;ORDER BY&#10;  N.nsi_status_date&#39;;&#10;    --&#10;    RETURN l_ret;&#10;END getBreachRecallSQL;&#10;--&#10;--&#10;FUNCTION getBreachRecallInterventions(  TeamIdIn                IN team.team_id%TYPE DEFAULT NULL,&#10;                                        StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                                        NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                                        NsiStatusIdIn           IN nsi.nsi_status_id%TYPE DEFAULT NULL,&#10;                                        ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE DEFAULT NULL,&#10;                                        BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                                        DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                                        LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                                        ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                                        SoftDeletedIn           IN nsi.soft_deleted%TYPE DEFAULT 0) RETURN nsi_pipeline.nsi_bcreachrecall_tab PIPELINED&#10;IS&#10;    --&#10;    l_SQL          CLOB;&#10;    l_ref_cur      SYS_REFCURSOR;&#10;    l_nsi_list_tab NSI_PIPELINE.nsi_bcreachrecall_tab;&#10;    l_counter      INTEGER;&#10;    --&#10;BEGIN&#10;    --&#10;    l_counter :&#61; 0;&#10;    --&#10;    l_SQL :&#61;&#10;        getBreachRecallSQL(&#10;            TeamIdIn              &#61;&gt; TeamIdIn,&#10;            StaffIdIn             &#61;&gt; StaffIdIn,&#10;            NsiTypeIdIn           &#61;&gt; NsiTypeIdIn,&#10;            NsiStatusIdIn         &#61;&gt; NsiStatusIdIn,&#10;            ProbationAreaIdIn     &#61;&gt; ProbationAreaIdIn,&#10;            BoroughIdIn           &#61;&gt; BoroughIdIn,&#10;            DistrictIdIn          &#61;&gt; DistrictIdIn,&#10;            LocalDeliveryUnitIdIn &#61;&gt; LocalDeliveryUnitIdIn );&#10;    --&#10;    OPEN l_ref_cur FOR l_SQL&#10;    USING&#10;      ActiveFlagIn,&#10;      SoftDeletedIn,&#10;      TeamIdIn,&#10;      StaffIdIn,&#10;      NsiTypeIdIn,&#10;      NsiStatusIdIn,&#10;      ProbationAreaIdIn,&#10;      BoroughIdIn,&#10;      DistrictIdIn,&#10;      LocalDeliveryUnitIdIn;&#10;    --&#10;    LOOP&#10;        --&#10;        FETCH l_ref_cur BULK COLLECT INTO l_nsi_list_tab LIMIT 100;&#10;        --&#10;        l_counter :&#61; l_counter + l_nsi_list_tab.COUNT;&#10;        --&#10;        FOR i IN 1 .. l_nsi_list_tab.COUNT&#10;        LOOP&#10;          --&#10;          do_set_rbac_levels(   OffenderIdIn  &#61;&gt; l_nsi_list_tab(i).offender_id,&#10;                                L1Out         &#61;&gt; l_nsi_list_tab(i).L1,&#10;                                L2Out         &#61;&gt; l_nsi_list_tab(i).L2,&#10;                                L3Out         &#61;&gt; l_nsi_list_tab(i).L3);&#10;          --&#10;          PIPE ROW (l_nsi_list_tab(i));&#10;        END LOOP;&#10;        --&#10;        EXIT WHEN l_nsi_list_tab.COUNT &#61; 0;&#10;        --&#10;    END LOOP;&#10;    CLOSE l_ref_cur;&#10;    --&#10;    RETURN;&#10;    --&#10;END getBreachRecallInterventions;&#10;--&#10;--&#10;PROCEDURE getBreachRecallInterventions( TeamIdIn                IN team.team_id%TYPE DEFAULT NULL,&#10;                                        StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                                        NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                                        NsiStatusIdIn           IN nsi.nsi_status_id%TYPE DEFAULT NULL,&#10;                                        ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE DEFAULT NULL,&#10;                                        BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                                        DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                                        LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                                        ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                                        SoftDeletedIn           IN nsi.soft_deleted%TYPE DEFAULT 0,&#10;                                        OutCursor               OUT SYS_REFCURSOR)&#10;IS&#10;BEGIN&#10;    OPEN OutCursor FOR&#10;      SELECT&#10;          nsi_id,&#10;          offender_id,&#10;          event_id,&#10;          nsi_type_id,&#10;          nsi_type_code,&#10;          nsi_type_desc,&#10;          length,&#10;          referral_date,&#10;          actual_start_date,&#10;          actual_end_date,&#10;          nsi_status_id,&#10;          nsi_status_code,&#10;          nsi_status_desc,&#10;          pending_transfer,&#10;          nsi_status_date,&#10;          active_flag,&#10;          probation_area_id,&#10;          probation_area_code,&#10;          staff_id,&#10;          officer_code,&#10;          team_id,&#10;          team_code,&#10;          district_id,&#10;          level2_code,&#10;          borough_id,&#10;          level3_code,&#10;          local_delivery_unit_id,&#10;          team_type_code,&#10;          first_name,&#10;          second_name,&#10;          surname,&#10;          third_name,&#10;          crn,&#10;          current_highest_risk_colour,&#10;          current_exclusion,&#10;          current_restriction,&#10;          L1,&#10;          L2,&#10;          L3,&#10;          row_number,&#10;          total_rows,&#10;          total_pages&#10;      FROM TABLE(nsi_support_api.getBreachRecallInterventions(  TeamIdIn                &#61;&gt; TeamIdIn,&#10;                                                                StaffIdIn               &#61;&gt; StaffIdIn,&#10;                                                                NsiTypeIdIn             &#61;&gt; NsiTypeIdIn,&#10;                                                                NsiStatusIdIn           &#61;&gt; NsiStatusIdIn,&#10;                                                                ProbationAreaIdIn       &#61;&gt; ProbationAreaIdIn,&#10;                                                                BoroughIdIn             &#61;&gt; BoroughIdIn,&#10;                                                                DistrictIdIn            &#61;&gt; DistrictIdIn,&#10;                                                                LocalDeliveryUnitIdIn   &#61;&gt; LocalDeliveryUnitIdIn,&#10;                                                                ActiveFlagIn            &#61;&gt; ActiveFlagIn,&#10;                                                                SoftDeletedIn           &#61;&gt; SoftDeletedIn));&#10;END getBreachRecallInterventions;&#10;--&#10;--&#10;FUNCTION getBreachRecall_Paged (  TeamIdIn                IN team.team_id%TYPE DEFAULT NULL,&#10;                                  StaffIdIn               IN staff.staff_id%TYPE DEFAULT NULL,&#10;                                  NsiTypeIdIn             IN nsi.nsi_type_id%TYPE DEFAULT NULL,&#10;                                  NsiStatusIdIn           IN nsi.nsi_status_id%TYPE DEFAULT NULL,&#10;                                  ProbationAreaIdIn       IN probation_area.probation_area_id%TYPE DEFAULT NULL,&#10;                                  BoroughIdIn             IN borough.borough_id%TYPE DEFAULT NULL,&#10;                                  DistrictIdIn            IN district.district_id%TYPE DEFAULT NULL,&#10;                                  LocalDeliveryUnitIdIn   IN local_delivery_unit.local_delivery_unit_id%TYPE DEFAULT NULL,&#10;                                  ActiveFlagIn            IN nsi.active_flag%TYPE DEFAULT 1,&#10;                                  SoftDeletedIn           IN nsi.soft_deleted%TYPE DEFAULT 0,&#10;                                  PageNumberIn            IN NUMBER,&#10;                                  PageSizeIn              IN NUMBER) RETURN nsi_pipeline.nsi_bcreachrecall_tab PIPELINED&#10;IS&#10;    l_fetch_size    NUMBER :&#61; 100;&#10;    l_rows          nsi_pipeline.nsi_bcreachrecall_tab;&#10;    l_sql           CLOB;&#10;    l_first_row     NUMBER;&#10;    l_last_row      NUMBER;&#10;    --&#10;    TYPE typ_cur IS REF CURSOR;&#10;    cur             typ_cur;&#10;BEGIN&#10;    --&#10;    l_fetch_size  :&#61; LEAST(l_fetch_size, PageSizeIn);&#10;    l_first_row   :&#61; (PageNumberIn -1) * PageSizeIn + 1;&#10;    l_last_row    :&#61; PageNumberIn * PageSizeIn;&#10;    --&#10;    l_sql :&#61; &#39;SELECT pag.*, CEIL(total_rows/&#39; || PageSizeIn || &#39;) AS total_pages&#10;              FROM ( &#39; || getBreachRecallSQL( TeamIdIn                &#61;&gt; TeamIdIn,&#10;                                              StaffIdIn               &#61;&gt; StaffIdIn,&#10;                                              NsiTypeIdIn             &#61;&gt; NsiTypeIdIn,&#10;                                              NsiStatusIdIn           &#61;&gt; NsiStatusIdIn,&#10;                                              ProbationAreaIdIn       &#61;&gt; ProbationAreaIdIn,&#10;                                              BoroughIdIn             &#61;&gt; BoroughIdIn,&#10;                                              DistrictIdIn            &#61;&gt; DistrictIdIn,&#10;                                              LocalDeliveryUnitIdIn   &#61;&gt; LocalDeliveryUnitIdIn,&#10;                                              PagedSyntax             &#61;&gt; &#39;Y&#39;) || &#39; ) pag&#10;              WHERE pag.row_number BETWEEN &#39; || l_first_row || &#39; AND &#39; || l_last_row || &#39; ORDER BY pag.row_number&#39;;&#10;    --&#10;    OPEN cur FOR l_sql&#10;    USING&#10;      ActiveFlagIn,&#10;      SoftDeletedIn,&#10;      TeamIdIn,&#10;      StaffIdIn,&#10;      NsiTypeIdIn,&#10;      NsiStatusIdIn,&#10;      ProbationAreaIdIn,&#10;      BoroughIdIn,&#10;      DistrictIdIn,&#10;      LocalDeliveryUnitIdIn;&#10;    --&#10;    LOOP&#10;        FETCH cur BULK COLLECT INTO l_rows LIMIT l_fetch_size;&#10;        EXIT WHEN l_rows.COUNT &#61; 0;&#10;        FOR i IN 1 .. l_rows.COUNT&#10;        LOOP&#10;            do_set_rbac_levels(   OffenderIdIn  &#61;&gt; l_rows(i).offender_id,&#10;                                  L1Out         &#61;&gt; l_rows(i).L1,&#10;                                  L2Out         &#61;&gt; l_rows(i).L2,&#10;                                  L3Out         &#61;&gt; l_rows(i).L3);&#10;            --&#10;            PIPE ROW(l_rows(i));&#10;        END LOOP;&#10;    END LOOP;&#10;    CLOSE cur;&#10;    RETURN;&#10;END getBreachRecall_Paged;&#10;--&#10;--&#10;END nsi_support_api;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>