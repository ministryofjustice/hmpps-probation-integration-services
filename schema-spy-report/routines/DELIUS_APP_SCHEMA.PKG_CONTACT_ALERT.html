<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.PKG_CONTACT_ALERT</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY pkg_contact_alert&#10;AS&#10;--&#10;--&#10;--&#10;--&#10;&#10;--&#10;-- Global variables&#10;--&#10;    --g_package_version CONSTANT VARCHAR2(30) :&#61; GC_VERSION;&#10;    g_component_code  CONSTANT VARCHAR2(3)  :&#61; &#39;ALR&#39;;&#10;    g_package_name    CONSTANT VARCHAR2(30) :&#61; &#39;PKG_CONTACT_ALERT&#39;;&#10;    --&#10;    g_procedure_name  VARCHAR2(30)  :&#61; &#39;initial_value&#39;;&#10;    --g_label           VARCHAR2(6)   :&#61; &#39;000000&#39;;&#10;&#10;    g_label VARCHAR2(100);&#10;&#10;    -- message type&#10;    mt_information    CONSTANT NUMBER :&#61; 1;&#10;    mt_warning        CONSTANT NUMBER :&#61; 2;&#10;    mt_error          CONSTANT NUMBER :&#61; 3;&#10;    mt_fatal_error    CONSTANT NUMBER :&#61; 4;&#10;&#10;--&#10;--&#10;-- PKG_COMMON wrappers&#10;--&#10;PROCEDURE procDebug(p_msg CLOB) IS&#10;BEGIN&#10;    PKG_Debug.procDebug(p_msg);&#10;END procDebug;&#10;&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level INTEGER DEFAULT 0) IS&#10;BEGIN&#10;    PKG_Common.print_message(&#10;        p_msg         &#61;&gt; p_msg,&#10;        p_trace_level &#61;&gt; NVL(p_trace_level, PKG_Common.GC_TRACE_LEVEL),&#10;        p_label       &#61;&gt; g_label );&#10;END message;&#10;--&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;--&#10;PROCEDURE raise_error(p_err_msg VARCHAR2, p_proc VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    PKG_Common.raise_error( p_err_msg, p_proc, p_label );&#10;END raise_error;&#10;--&#10;--&#10;--&#10;-- Used to populate mtt_message_log with information type message&#10;PROCEDURE info(message_in VARCHAR2) IS&#10;BEGIN&#10;    IF SPGConfig.SPGInfoActive THEN&#10;        SPGConfig.insert_message_log(&#10;            message_type_id_in &#61;&gt; mt_information,&#10;            component_code_in  &#61;&gt; g_component_code,&#10;            package_name_in    &#61;&gt; g_package_name,&#10;            procedure_name_in  &#61;&gt; g_procedure_name,&#10;            label_in           &#61;&gt; g_label,&#10;            message_text_in    &#61;&gt; message_in );&#10;    END IF;&#10;END info;&#10;--&#10;-- Will populate mtt_message_log with warning message - will populate mtt_error_log if result of exception&#10;PROCEDURE warn(message_in VARCHAR2) IS&#10;BEGIN&#10;    IF SPGConfig.SPGWarnActive THEN&#10;        SPGConfig.record_error(&#10;            message_type_id_in &#61;&gt; mt_warning,&#10;            component_code_in  &#61;&gt; g_component_code,&#10;            package_name_in    &#61;&gt; g_package_name,&#10;            procedure_name_in  &#61;&gt; g_procedure_name,&#10;            label_in           &#61;&gt; g_label,&#10;            message_text_in    &#61;&gt; message_in );&#10;    END IF;&#10;END warn;&#10;--&#10;-- Will populate mtt_message_log with error message and populate mtt_error_log with exception - used for log and continue&#10;PROCEDURE error(message_in VARCHAR2) IS&#10;BEGIN&#10;    SPGConfig.record_error(&#10;        message_type_id_in &#61;&gt; mt_error,&#10;        component_code_in  &#61;&gt; g_component_code,&#10;        package_name_in    &#61;&gt; g_package_name,&#10;        procedure_name_in  &#61;&gt; g_procedure_name,&#10;        label_in           &#61;&gt; g_label,&#10;        message_text_in    &#61;&gt; message_in );&#10;END error;&#10;--&#10;-- Will populate mtt_message_log, mtt_error_log with error message and raise exception - used for log and halt&#10;PROCEDURE fatal(message_in VARCHAR2) IS&#10;BEGIN&#10;    SPGConfig.record_error(&#10;        message_type_id_in &#61;&gt; mt_fatal_error,&#10;        component_code_in  &#61;&gt; g_component_code,&#10;        package_name_in    &#61;&gt; g_package_name,&#10;        procedure_name_in  &#61;&gt; g_procedure_name,&#10;        label_in           &#61;&gt; g_label,&#10;        message_text_in    &#61;&gt; message_in,&#10;        raise_error_in     &#61;&gt; TRUE );&#10;END fatal;&#10;--&#10;&#10;--&#10;-- OM Alert Clear subroutines&#10;--&#10;PROCEDURE submit_om_alert_clear_batch(&#10;    p_contact_id_lst            CLOB,&#10;    p_requested_date            DATE     DEFAULT SYSDATE,&#10;    p_excl_already_cleared_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_incl_already_cleared_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_debug_flag                VARCHAR2 DEFAULT &#39;N&#39;,&#10;    p_async_flag                VARCHAR2 DEFAULT &#39;N&#39; )&#10;IS&#10;    --&#10;    lc_proc CONSTANT VARCHAR2(30) :&#61; &#39;SUBMIT_OM_ALERT_CLEAR_BATCH&#39;;&#10;    --&#10;    TYPE l_rec_TYP IS RECORD(&#10;      contact_alert_clear_id NUMBER,&#10;      contact_id             NUMBER,&#10;      offender_id            NUMBER,&#10;      offender_manager_id    NUMBER,&#10;      probation_area_id      NUMBER,&#10;      soft_deleted           SMALLINT,&#10;      alert_active           VARCHAR2(1),&#10;      spg_interest           SMALLINT,&#10;--      spg_active             VARCHAR2(10),&#10;      spg_notification_id    NUMBER,&#10;      contact_date           DATE,&#10;      requested_date         DATE,&#10;      last_updated_user_id   NUMBER,&#10;      last_updated_datetime  DATE );&#10;    TYPE l_tab_TYP IS TABLE OF l_rec_TYP;&#10;    --&#10;    l_idx INTEGER;&#10;    l_rec l_rec_TYP;&#10;    l_TAB l_tab_TYP;&#10;    --&#10;    l_lock_name   VARCHAR2(30) :&#61; &#39;ND_OM_ALERT_CLEAR_LOCK&#39;;&#10;    l_lock_handle VARCHAR2(128);&#10;    l_dummy       PLS_INTEGER;&#10;    --&#10;    l_rows_created NUMBER;&#10;    --&#10;    l_user_id     NUMBER :&#61; PKG_LOOKUPS.GetUserID(p_distinguished_name &#61;&gt; NVLSTR(SYS_CONTEXT(&#39;USERENV&#39;, &#39;CLIENT_IDENTIFIER&#39;), &#39;DELIUS_SYSTEM_USER&#39;));&#10;    --&#10;    PROCEDURE do_allocate_soft_lock IS&#10;    BEGIN&#10;        DBMS_LOCK.allocate_unique(l_lock_name, l_lock_handle);&#10;        l_dummy :&#61; DBMS_LOCK.request(l_lock_handle, DBMS_LOCK.x_mode, DBMS_LOCK.maxwait, FALSE);&#10;    END do_allocate_soft_lock;&#10;    --&#10;    PROCEDURE do_release_soft_lock IS&#10;    BEGIN&#10;        l_dummy :&#61; DBMS_LOCK.release(l_lock_handle);&#10;    END do_release_soft_lock;&#10;    --&#10;    PROCEDURE do_create_bg_process&#10;    IS&#10;        --&#10;        l_status INTEGER;&#10;        --&#10;        l_proc CONSTANT VARCHAR2(30) :&#61; &#39;DO_CREATE_BG_PROCESS&#39;;&#10;        l_prog_name VARCHAR2(100)    :&#61; &#39;OM_ALERT_CLEAR_PROG&#39;;&#10;        l_job_name  VARCHAR2(100);&#10;        --&#10;    BEGIN&#10;        --&#10;        -- Create DBMS_SCHEDULE job&#10;        l_job_name :&#61; DBMS_SCHEDULER.generate_job_name(&#39;OM_ALERT_CLEAR_&#39;);&#10;        --&#10;        DBMS_SCHEDULER.create_job(&#10;            job_name      &#61;&gt; l_job_name,&#10;            program_name  &#61;&gt; l_prog_name,&#10;            start_date    &#61;&gt; SYSDATE,&#10;            enabled       &#61;&gt; FALSE,&#10;            comments      &#61;&gt; &#39;OM_ALERT_CLEAR_JOB&#39;);&#10;        --&#10;        DBMS_SCHEDULER.set_job_argument_value(job_name &#61;&gt; l_job_name, argument_name &#61;&gt; &#39;p_contact_id_lst&#39;           , argument_value &#61;&gt; p_contact_id_lst);&#10;        DBMS_SCHEDULER.set_job_argument_value(job_name &#61;&gt; l_job_name, argument_name &#61;&gt; &#39;p_requested_date&#39;           , argument_value &#61;&gt; p_requested_date);&#10;        DBMS_SCHEDULER.set_job_argument_value(job_name &#61;&gt; l_job_name, argument_name &#61;&gt; &#39;p_excl_already_cleared_flag&#39;, argument_value &#61;&gt; p_excl_already_cleared_flag);&#10;        DBMS_SCHEDULER.set_job_argument_value(job_name &#61;&gt; l_job_name, argument_name &#61;&gt; &#39;p_incl_already_cleared_flag&#39;, argument_value &#61;&gt; p_incl_already_cleared_flag);&#10;        DBMS_SCHEDULER.set_job_argument_value(job_name &#61;&gt; l_job_name, argument_name &#61;&gt; &#39;p_debug_flag&#39;               , argument_value &#61;&gt; p_debug_flag);&#10;        --DBMS_SCHEDULER.set_job_argument_value(job_name &#61;&gt; l_job_name, argument_name &#61;&gt; &#39;p_async_flag&#39;               , argument_value &#61;&gt; &#39;N&#39;);&#10;        --&#10;        DBMS_SCHEDULER.enable(l_job_name);&#10;        --&#10;    END do_create_bg_process;&#10;    --&#10;    PROCEDURE do_create_batch&#10;    IS&#10;        --&#10;        l_contact_id_LST CLOB;&#10;        --l_contact_alert_TAB T_TAB_ORGANISATIONS :&#61; T_TAB_ORGANISATIONS();&#10;        --&#10;    BEGIN&#10;        --&#10;        l_contact_id_LST :&#61; REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(p_contact_id_lst, CHR(10), &#39;&#39;), CHR(13), &#39;&#39;), CHR(9), &#39; &#39;), &#39; &#39;, &#39;&#39;), &#39;;&#39;, &#39;,&#39;);&#10;        --l_contact_alert_TAB :&#61; PKG_LstUtl.get_list_2_array(p_clob&#61;&gt;p_contact_id_lst, p_delim&#61;&gt;&#39;,&#39;, p_distinct_values_flag&#61;&gt;&#39;Y&#39;);&#10;        --&#10;        INSERT INTO contact_alert_clear (&#10;          contact_alert_clear_ID,&#10;          offender_ID,&#10;          contact_ID,&#10;          --&#10;          submitted_datetime,&#10;          processed_datetime,&#10;          --&#10;          processed_flag,&#10;          error_flag,&#10;          error_message,&#10;          --&#10;          row_version,&#10;          created_by_user_id,&#10;          created_datetime,&#10;          last_updated_user_id,&#10;          last_updated_datetime )&#10;        SELECT&#10;          contact_alert_clear_ID_SEQ.nextval,&#10;          C.offender_id,&#10;          C.contact_id,&#10;          --&#10;          NVL(p_requested_date, SYSDATE) AS submitted_datetime,&#10;          NULL                           AS processed_datetime,&#10;          --&#10;          0                              AS processed_flag,&#10;          0                              AS error_flag,&#10;          NULL                           AS error_message,&#10;          --&#10;          0                              AS row_version,&#10;          l_user_id                      AS created_by_user_id,&#10;          SYSDATE                        AS created_datetime,&#10;          l_user_id                      AS last_updated_user_id,&#10;          SYSDATE                        AS last_updated_datetime&#10;        FROM&#10;          contact C&#10;            INNER JOIN contact_alert CA ON CA.contact_id &#61; C.contact_id&#10;        WHERE C.alert_active &#61; &#39;Y&#39;&#10;          AND C.soft_deleted &#61; 0&#10;          AND C.contact_id IN (&#10;              SELECT * FROM TABLE( PKG_LstUtl.get_list_2_array(p_clob&#61;&gt;l_contact_id_LST, p_delim&#61;&gt;&#39;,&#39;, p_distinct_values_flag&#61;&gt;&#39;Y&#39;) )&#10;              --SELECT TO_NUMBER(TRIM(REGEXP_SUBSTR(l_contact_id_LST, &#39;[^,]+&#39;, 1, LEVEL))) contact_id FROM dual CONNECT BY LEVEL &lt;&#61; REGEXP_COUNT(l_contact_id_LST, &#39;,&#39;) + 1&#10;              )&#10;          AND NOT EXISTS(&#10;                SELECT 1 FROM contact_alert_clear&#10;                WHERE contact_id &#61; C.contact_id&#10;                  AND processed_flag &#61; 0 )&#10;          AND ( ( NVL(p_excl_already_cleared_flag, &#39;N&#39;) !&#61; &#39;Y&#39; )&#10;                OR&#10;                ( p_excl_already_cleared_flag &#61; &#39;Y&#39; AND&#10;                  NOT EXISTS(&#10;                    SELECT 1 FROM contact_alert_clear&#10;                    WHERE contact_id &#61; C.contact_id&#10;                      AND processed_flag &#61; 1&#10;                      AND error_flag &#61; 0 )&#10;                )&#10;              )&#10;          AND ( ( NVL(p_incl_already_cleared_flag, &#39;N&#39;) !&#61; &#39;Y&#39; )&#10;                OR&#10;                ( p_incl_already_cleared_flag &#61; &#39;Y&#39; AND&#10;                  EXISTS(&#10;                    SELECT 1 FROM contact_alert_clear&#10;                    WHERE contact_id &#61; C.contact_id&#10;                      AND processed_flag &#61; 1&#10;                      AND error_flag &#61; 0 )&#10;                )&#10;              )&#10;        ;&#10;        --&#10;        l_rows_created :&#61; NVL(SQL%ROWCOUNT,0);&#10;        info(&#39;CONTACT_ALERT_CLEAR: &#39; || l_rows_created || &#39; rows created&#39;);&#10;        --&#10;    END do_create_batch;&#10;    --&#10;    PROCEDURE do_clear_om_alert(p_idx INTEGER)&#10;    IS&#10;        --&#10;        lc_bi_1004 VARCHAR2(30) :&#61; &#39;SPGBI038&#39;;&#10;        --&#10;        PROCEDURE do_submit_spg_1004(p_bi_code VARCHAR2, p_offender_id NUMBER, p_unique_id NUMBER DEFAULT NULL, p_area_id NUMBER, x_spg_notification_id IN OUT NUMBER)&#10;        IS&#10;        BEGIN&#10;            --&#10;            info(&#10;                &#39;do_clear_om_alert.do_submit_spg_1004 [&#39; ||&#10;                p_bi_code               || &#39;]&#39; ||&#10;                &#39;[&#39; || p_offender_id    || &#39;]&#39; ||&#10;                &#39;[&#39; || p_unique_id      || &#39;]&#39; ||&#10;                &#39;[&#39; || PKG_Lookups.funcgetTabRecord_CACHED(p_table&#61;&gt;&#39;PROBATION_AREA&#39;, p_ref_col&#61;&gt;&#39;probation_area_id&#39;, p_ref_val&#61;&gt;p_area_id, p_data_fld&#61;&gt;&#39;code&#39;) );&#10;            --&#10;            INSERT INTO spg_notification (&#10;              spg_notification_id, business_interaction_id, offender_id, unique_id, date_created, message_direction,&#10;              sender_identity_id, receiver_identity_id,&#10;              control_reference&#10;              --receiver_control_reference&#10;            ) VALUES (&#10;              spg_notification_id_seq.NEXTVAL,&#10;              PKG_LOOKUPS.funcGetBusinessInteractionID(p_bi_code),&#10;              p_offender_id,&#10;              NVL(p_unique_id, p_offender_id),&#10;              SYSDATE,&#10;              &#39;O&#39;,&#10;              PKG_Lookups.funcgetTabRecord_CACHED(p_table&#61;&gt;&#39;PROBATION_AREA&#39;, p_ref_col&#61;&gt;&#39;code&#39;, p_ref_val&#61;&gt;&#39;N00&#39;, p_data_fld&#61;&gt;&#39;probation_area_ID&#39;),&#10;              p_area_id,&#10;              SPGConfig.getnextcontrolreference(&#39;N00&#39;)&#10;            )&#10;            RETURNING spg_notification_id&#10;            INTO x_spg_notification_id;&#10;            --&#10;        END do_submit_spg_1004;&#10;        --&#10;        PROCEDURE do_update_contact_alert_clear(&#10;            p_contact_alert_clear_id NUMBER,&#10;            p_processed_flag         NUMBER,&#10;            p_error_flag             NUMBER,&#10;            p_error_message          VARCHAR2,&#10;            p_spg_notification_id    NUMBER DEFAULT NULL )&#10;        IS&#10;        BEGIN&#10;            --&#10;            UPDATE contact_alert_clear SET&#10;              spg_notification_id &#61; NVL(p_spg_notification_id, spg_notification_id),&#10;              --&#10;              processed_flag     &#61; p_processed_flag,&#10;              processed_datetime &#61; SYSDATE,&#10;              error_flag         &#61; p_error_flag,&#10;              error_message      &#61; PKG_LstUtl.concat( error_message, p_error_message, p_max_len&#61;&gt;4000 ),&#10;              --&#10;              row_version        &#61; row_version + 1&#10;            WHERE contact_alert_clear_id &#61; p_contact_alert_clear_id;&#10;            --&#10;        END do_update_contact_alert_clear;&#10;        --&#10;    BEGIN&#10;        --&#10;        l_rec :&#61; l_TAB(p_idx);&#10;        --&#10;        IF l_rec.soft_deleted &#61; 1 THEN&#10;            do_update_contact_alert_clear(l_rec.contact_alert_clear_id, 1, 1, &#39;CONTACT [id&#61;&#39; || l_rec.contact_id || &#39;] has SOFT_DELETED flag set to 1&#39;);&#10;        ELSIF NVL(TRIM(l_rec.alert_active), &#39;N&#39;) &lt;&gt; &#39;Y&#39; THEN&#10;            do_update_contact_alert_clear(l_rec.contact_alert_clear_id, 1, 1, &#39;CONTACT [id&#61;&#39; || l_rec.contact_id || &#39;] does not have ALERT_ACTIVE flag set to Y&#39;);&#10;        ELSIF p_requested_date &lt; l_rec.last_updated_datetime THEN&#10;            do_update_contact_alert_clear(l_rec.contact_alert_clear_id, 1, 1,&#10;                &#39;CONTACT [id&#61;&#39; || l_rec.contact_id || &#39;]: CONTACT_LAST_UPDATED_DATE [&#39; || l_rec.last_updated_datetime || &#39;] &gt; Requested Date [&#39; || p_requested_date || &#39;]&#39;);&#10;        ELSE&#10;            IF NVL(p_debug_flag, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;                do_update_contact_alert_clear(l_rec.contact_alert_clear_id, 1, 0, &#39;Warning: DEBUG_MODE&#61;Y&#39;);&#10;            ELSE&#10;                UPDATE contact SET&#10;                  alert_active          &#61; NULL,&#10;                  --&#10;                  notes                 &#61;&#10;                      PKG_LstUtl.concat_CLOB(&#10;                          notes,&#10;                          &#39;----------------------------&#39;,&#10;                          &#39;Alert flag cleared using an automated process on &#39; || TO_CHAR(SYSDATE, &#39;DD-MON-YYYY HH24:MI:SS&#39;) || &#39; by &#39; || PKG_Lookups.getUserName(l_rec.last_updated_user_id),&#10;                          p_delim&#61;&gt;CHR(10) || CHR(10) ),&#10;--                  notes &#61; notes || chr(10) || &#39;----------------------------&#39; || chr(10) || chr(10) || &#39;Alert flag cleared using an automated process on &#39; ||&#10;--                 TO_CHAR(sysdate, &#39;DD-MON-YYYY HH24:MI:SS&#39;) || &#39; by &#39;||&#10;--                  (SELECT PKG_LOOKUPS.getusername(p_user_id &#61;&gt; l_rec.last_updated_user_id) from dual)&#10;                  --&#10;                  last_updated_user_id  &#61; l_rec.last_updated_user_id,&#10;                  last_updated_datetime &#61; SYSDATE,&#10;                  row_version           &#61; row_version + 1&#10;                WHERE contact_id &#61; l_rec.contact_id;&#10;                --&#10;                DELETE FROM contact_alert&#10;                WHERE contact_id &#61; l_rec.contact_id;&#10;                --&#10;                IF l_rec.spg_interest &#61; 1&#10;--                   AND l_rec.spg_active IN (&#39;A&#39;,&#39;T&#39;,&#39;M&#39;)&#10;                THEN&#10;                    --&#10;                    DECLARE&#10;                        --&#10;                        l_area_rec              PKG_Search.trecInterestedAreas;&#10;                        l_area_tab              PKG_Search.ttabInterestedAreas;&#10;                        l_spg_notification_id   NUMBER;&#10;                        --&#10;                    BEGIN&#10;                        --&#10;                        SELECT * BULK COLLECT INTO l_area_tab&#10;                        FROM TABLE( PKG_Search.procGetInterestedCRCsTAB( TO_CHAR(l_rec.offender_id) ) );&#10;                        --&#10;                        info(&#10;                            &#39;do_clear_om_alert &#39; ||&#10;                            &#39;[&#39; || lc_bi_1004           || &#39;]&#39; ||&#10;                            &#39;[&#39; || l_rec.offender_id    || &#39;]&#39; ||&#10;                            &#39;[&#39; || l_rec.contact_id     || &#39;]&#39; ||&#10;                            &#39;[&#39; || &#39;Number of interested CRCs &#61; &#39; || l_area_tab.COUNT || &#39;]&#39; );&#10;                        --&#10;                        FOR l_idx IN 1 .. l_area_tab.COUNT LOOP&#10;                            --&#10;                            l_area_rec :&#61; l_area_tab(l_idx);&#10;                            --&#10;                            do_submit_spg_1004(&#10;                                p_bi_code     &#61;&gt; lc_bi_1004,&#10;                                p_offender_id &#61;&gt; l_rec.offender_id,&#10;                                p_unique_id   &#61;&gt; l_rec.contact_id,&#10;                                p_area_id     &#61;&gt; l_area_rec.probation_area_id,&#10;                                --&#10;                                x_spg_notification_id &#61;&gt; l_spg_notification_id );&#10;                            --&#10;                            IF l_idx &#61; 1 THEN&#10;                                l_rec.spg_notification_id :&#61; l_spg_notification_id;&#10;                            END IF;&#10;                            --&#10;                        END LOOP;&#10;                    END;&#10;                    --&#10;                END IF;&#10;                --&#10;                do_update_contact_alert_clear(l_rec.contact_alert_clear_id, 1, 0, &#39;&#39;, l_rec.spg_notification_id);&#10;                --&#10;            END IF; --IF p_debug_flag &#61; Y&#10;            --&#10;        END IF;&#10;        --&#10;    END do_clear_om_alert;&#10;    --&#10;BEGIN&#10;    --&#10;    g_procedure_name :&#61; lc_proc;&#10;    g_label :&#61; CASE WHEN p_async_flag &#61; &#39;N&#39; THEN &#39;00010&#39; ELSE &#39;00020&#39; END;&#10;    --&#10;    info(&#10;        &#39;Create OM Alert Clear Batch &#39; ||&#10;        &#39;(contact_id_LST&#61;&#39;  || SUBSTR(p_contact_id_lst, 1, 1024) || &#39;)&#39; ||&#10;        &#39;(requested date&#61;&#39;  || p_requested_date                  || &#39;)&#39; ||&#10;&#10;        &#39;(exclude cleared&#61;&#39; || p_excl_already_cleared_flag       || &#39;)&#39; ||&#10;        &#39;(include cleared&#61;&#39; || p_incl_already_cleared_flag       || &#39;)&#39; ||&#10;        --&#10;        &#39;(debug&#61;&#39;           || p_debug_flag                      || &#39;)&#39; ||&#10;        &#39;(bg flag&#61;&#39;         || p_async_flag                      || &#39;)&#39; );&#10;    --&#10;    g_label :&#61; &#39;00050&#39;;&#10;    --&#10;    IF p_async_flag &#61; &#39;Y&#39; THEN&#10;        do_create_bg_process;&#10;        RETURN;&#10;    END IF;&#10;    --&#10;    g_label :&#61; &#39;00060&#39;;&#10;    --&#10;    do_allocate_soft_lock;&#10;    --&#10;    g_label :&#61; &#39;00070&#39;;&#10;    --&#10;    do_create_batch;&#10;    --&#10;    IF l_rows_created &#61; 0 THEN&#10;        --&#10;        do_release_soft_lock;&#10;        --&#10;        RETURN;&#10;    END IF;&#10;    --&#10;    SELECT&#10;      CAC.contact_alert_clear_id,&#10;      CAC.contact_id,&#10;      C.offender_id,&#10;      CA.offender_manager_id,&#10;      T.probation_area_id,&#10;      C.soft_deleted,&#10;      C.alert_active,&#10;      CT.spg_interest,&#10;--      R1.code_value     AS spg_active,&#10;      NULL              AS spg_notification_id,&#10;      C.contact_date,&#10;      p_requested_date,&#10;      CAC.last_updated_user_id,&#10;      C.last_updated_datetime&#10;    BULK COLLECT INTO l_TAB&#10;    FROM&#10;      contact_alert_clear CAC&#10;        LEFT OUTER JOIN contact C ON C.contact_id &#61; CAC.contact_id&#10;          LEFT OUTER JOIN r_contact_type CT ON CT.contact_type_id &#61; C.contact_type_id&#10;          LEFT OUTER JOIN contact_alert CA ON CA.contact_id &#61; C.contact_id&#10;            LEFT OUTER JOIN offender_manager OM ON OM.offender_manager_id &#61; CA.offender_manager_id&#10;              LEFT OUTER JOIN all_team T ON T.trust_provider_flag &#61; OM.trust_provider_flag AND T.trust_provider_team_id &#61; OM.trust_provider_team_id&#10;                LEFT OUTER JOIN probation_area PA ON PA.probation_area_id &#61; T.probation_area_id&#10;                  LEFT OUTER JOIN r_standard_reference_list R1 ON R1.standard_reference_list_id &#61; PA.spg_active_id&#10;    WHERE processed_flag &#61; 0;&#10;    --&#10;    g_label :&#61; &#39;00080&#39;;&#10;    --&#10;    FOR l_idx IN 1 .. l_TAB.COUNT LOOP&#10;        do_clear_om_alert(l_idx);&#10;    END LOOP;&#10;    --&#10;    g_label :&#61; &#39;00090&#39;;&#10;    --&#10;    info(&#39;PKG_CONTACT_ALERT.submit_om_alert_clear_batch: Offender Export Batch has been created succussfully&#39;);&#10;    --&#10;    do_release_soft_lock;&#10;    --&#10;    g_label :&#61; &#39;00100&#39;;&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    --&#10;    do_release_soft_lock;&#10;    --&#10;    fatal(&#39;PKG_CONTACT_ALERT.submit_om_alert_clear_batch ERROR: &#39; || SQLERRM);&#10;END submit_om_alert_clear_batch;&#10;&#10;--&#10;--&#10;-- Initialise package variables block&#10;--&#10;PROCEDURE do_init&#10;IS&#10;BEGIN&#10;    NULL;&#10;END do_init;&#10;&#10;--&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;-- Package Body initialisation block&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;BEGIN&#10;    --&#10;    PKG_Global.do_init;&#10;    --&#10;    do_init;&#10;    --&#10;    -----------------------------------------------------------------&#10;    -- Cache reference values to be used within package procedures --&#10;    -----------------------------------------------------------------&#10;    --&#10;    --&#10;END pkg_contact_alert;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>