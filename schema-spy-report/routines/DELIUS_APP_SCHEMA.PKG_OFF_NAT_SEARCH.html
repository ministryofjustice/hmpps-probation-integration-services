<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.PKG_OFF_NAT_SEARCH</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY pkg_off_nat_search&#10;AS&#10;--&#10;--&#10;--&#10;--&#10;&#10;--&#10;-- Global variables&#10;--&#10;    -- message type&#10;    mt_information    CONSTANT NUMBER :&#61; 1;&#10;    mt_warning        CONSTANT NUMBER :&#61; 2;&#10;    mt_error          CONSTANT NUMBER :&#61; 3;&#10;    mt_fatal_error    CONSTANT NUMBER :&#61; 4;&#10;&#10;    g_component_code  CONSTANT VARCHAR2(3)  :&#61; &#39;NAT&#39;;&#10;    g_package_name    CONSTANT VARCHAR2(30) :&#61; &#39;PKG_OFF_NAT_SEARCH&#39;;&#10;    g_procedure_name  VARCHAR2(30)  :&#61; &#39;initial_value&#39;;&#10;    g_label           VARCHAR2(30)  :&#61; &#39;00000&#39;;&#10;&#10;    --&#10;    g_limit           NUMBER :&#61; NULL;&#10;    g_o_criteria_flag BOOLEAN;&#10;    --&#10;    --&#10;    TYPE g_rank_details_rec_TYP IS RECORD(&#10;      offender_id  NUMBER,&#10;      rank_details VARCHAR2(4000) );&#10;    g_rank_details_rec g_rank_details_rec_TYP;&#10;&#10;--&#10;--&#10;-- PKG_COMMON wrappers&#10;--&#10;PROCEDURE procDebug(p_msg CLOB) IS&#10;BEGIN&#10;    PKG_Debug.procDebug(p_msg);&#10;END procDebug;&#10;&#10;FUNCTION funcgetDebugMode RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Debug.funcgetDebugMode;&#10;END funcgetDebugMode;&#10;--&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level INTEGER DEFAULT 0) IS&#10;BEGIN&#10;    PKG_Common.print_message(&#10;        p_msg         &#61;&gt; p_msg,&#10;        p_trace_level &#61;&gt; NVL(p_trace_level, PKG_Common.GC_TRACE_LEVEL),&#10;        p_label       &#61;&gt; g_label );&#10;END message;&#10;--&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;--&#10;FUNCTION concat(&#10;    p_val1  VARCHAR2,&#10;    p_val2  VARCHAR2,&#10;    p_val3  VARCHAR2 DEFAULT NULL,&#10;    p_val4  VARCHAR2 DEFAULT NULL,&#10;    p_val5  VARCHAR2 DEFAULT NULL,&#10;    p_val6  VARCHAR2 DEFAULT NULL,&#10;    p_val7  VARCHAR2 DEFAULT NULL,&#10;    p_val8  VARCHAR2 DEFAULT NULL,&#10;    p_val9  VARCHAR2 DEFAULT NULL,&#10;    p_val10 VARCHAR2 DEFAULT NULL,&#10;    p_delim VARCHAR2 DEFAULT &#39;&#39;)&#10;RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN&#10;        PKG_LstUtl.concat(&#10;            p_val1  &#61;&gt; p_val1,&#10;            p_val2  &#61;&gt; p_val2,&#10;            p_val3  &#61;&gt; p_val3,&#10;            p_val4  &#61;&gt; p_val4,&#10;            p_val5  &#61;&gt; p_val5,&#10;            p_val6  &#61;&gt; p_val6,&#10;            p_val7  &#61;&gt; p_val7,&#10;            p_val8  &#61;&gt; p_val8,&#10;            p_val9  &#61;&gt; p_val9,&#10;            p_val10 &#61;&gt; p_val10,&#10;            p_delim &#61;&gt; p_delim );&#10;END concat;&#10;--&#10;PROCEDURE raise_error(p_err_msg VARCHAR2, p_proc VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    PKG_Common.raise_error( p_err_msg, p_proc, p_label );&#10;END raise_error;&#10;--&#10;&#10;--&#10;--***************************************************&#10;-- Helpers                                          *&#10;--***************************************************&#10;--&#10;-- Used to populate mtt_message_log with information type message&#10;PROCEDURE info (message_in VARCHAR2)&#10;IS&#10;BEGIN&#10;    IF SPGConfig.SPGInfoActive THEN&#10;        SPGConfig.insert_message_log(&#10;            message_type_id_in  &#61;&gt; mt_information,&#10;            component_code_in   &#61;&gt; g_component_code,&#10;            package_name_in     &#61;&gt; g_package_name,&#10;            procedure_name_in   &#61;&gt; g_procedure_name,&#10;            label_in            &#61;&gt; g_label,&#10;            message_text_in     &#61;&gt; message_in );&#10;    END IF;&#10;END info;&#10;--&#10;-- Will populate mtt_message_log with warning message - will populate mtt_error_log if result of exception&#10;PROCEDURE warn(message_in VARCHAR2) IS&#10;BEGIN&#10;    IF SPGConfig.SPGWarnActive THEN&#10;        SPGConfig.record_error(&#10;            message_type_id_in    &#61;&gt; mt_warning,&#10;            component_code_in     &#61;&gt; g_component_code,&#10;            package_name_in       &#61;&gt; g_package_name,&#10;            procedure_name_in     &#61;&gt; g_procedure_name,&#10;            label_in              &#61;&gt; g_label,&#10;            message_text_in       &#61;&gt; message_in );&#10;    END IF;&#10;END warn;&#10;--&#10;-- Will populate mtt_message_log with error message and populate mtt_error_log with exception - used for log and continue&#10;PROCEDURE error (message_in VARCHAR2)&#10;IS&#10;BEGIN&#10;    SPGConfig.record_error(&#10;        message_type_id_in    &#61;&gt; mt_error,&#10;        component_code_in     &#61;&gt; g_component_code,&#10;        package_name_in       &#61;&gt; g_package_name,&#10;        procedure_name_in     &#61;&gt; g_procedure_name,&#10;        label_in              &#61;&gt; g_label,&#10;        message_text_in       &#61;&gt; message_in);&#10;END error;&#10;--&#10;-- Will populate mtt_message_log, mtt_error_log with error message and raise exception - used for log and halt&#10;PROCEDURE fatal (message_in VARCHAR2)&#10;IS&#10;BEGIN&#10;    SPGConfig.record_error(&#10;        message_type_id_in    &#61;&gt; mt_fatal_error,&#10;        component_code_in     &#61;&gt; g_component_code,&#10;        package_name_in       &#61;&gt; g_package_name,&#10;        procedure_name_in     &#61;&gt; g_procedure_name,&#10;        label_in              &#61;&gt; g_label,&#10;        message_text_in       &#61;&gt; message_in,&#10;        raise_error_in        &#61;&gt; TRUE );&#10;END fatal;&#10;--&#10;--&#10;&#10;&#10;--&#10;-- Search OFFENDER&#10;--&#10;FUNCTION TO_CHAR1(p_val BOOLEAN) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN CASE WHEN p_val THEN &#39;Y&#39; ELSE &#39;N&#39; END;&#10;END TO_CHAR1;&#10;--&#10;FUNCTION do_add_o(p_criteria VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    g_o_criteria_flag :&#61; TRUE;&#10;    RETURN p_criteria;&#10;END do_add_o;&#10;--&#10;FUNCTION funcFindOffendersTAB(&#10;    p_first_name             OFFENDER.first_name%TYPE  DEFAULT NULL,&#10;    p_middle_name            OFFENDER.second_name%TYPE DEFAULT NULL,&#10;    p_last_name              OFFENDER.surname%TYPE     DEFAULT NULL,&#10;    p_alias_first_name       ALIAS.first_name%TYPE     DEFAULT NULL,&#10;    p_alias_second_name      ALIAS.second_name%TYPE    DEFAULT NULL,&#10;    p_alias_third_name       ALIAS.third_name%TYPE     DEFAULT NULL,&#10;    p_alias_surname          ALIAS.surname%TYPE        DEFAULT NULL,&#10;    p_gender                 OFFENDER.gender_id%TYPE   DEFAULT NULL,&#10;    p_other_identifier_type  VARCHAR2                  DEFAULT NULL,&#10;    p_other_identifier       VARCHAR2                  DEFAULT NULL,&#10;    p_national_search        VARCHAR2                  DEFAULT &#39;Y&#39;,&#10;    p_trust                  PROBATION_AREA.code%TYPE  DEFAULT NULL,&#10;    --&#10;    p_crn                    OFFENDER.CRN%TYPE         DEFAULT NULL,&#10;    p_noms_number            OFFENDER.noms_number%TYPE DEFAULT NULL,&#10;    p_pnc_number             OFFENDER.pnc_number%TYPE  DEFAULT NULL,&#10;    p_date_of_birth          DATE                      DEFAULT NULL,&#10;    --&#10;    p_dob_ranking_flag       VARCHAR2                  DEFAULT &#39;Y&#39;,&#10;    p_gender_ranking_flag    VARCHAR2                  DEFAULT &#39;Y&#39;,&#10;    --&#10;    p_custodial_search       VARCHAR2                  DEFAULT &#39;N&#39;,&#10;    p_institution_id         NUMBER                    DEFAULT NULL,&#10;    --&#10;    p_lor_flag               VARCHAR2                  DEFAULT &#39;Y&#39;,&#10;    --&#10;    p_exclude_inactive_flag  VARCHAR2                  DEFAULT &#39;N&#39;,&#10;    --&#10;    p_include_preferred_name VARCHAR2                  DEFAULT &#39;N&#39;,&#10;    --&#10;    p_resultset_limit_flag   VARCHAR2                  DEFAULT &#39;Y&#39;,&#10;    p_max_rows               INTEGER DEFAULT           100000 )&#10;RETURN ttabOffenders PIPELINED&#10;IS&#10;    lc_proc CONSTANT VARCHAR2(30) :&#61; &#39;funcFundOffendersTAB&#39;;&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    --&#10;    l_cur l_cur_TYP;&#10;    l_SQL CLOB;&#10;    --&#10;    l_rec trecOffender;&#10;    l_tab ttabOffenders;&#10;    l_row INTEGER :&#61; 0;&#10;    l_i   INTEGER;&#10;    --&#10;    l_wildcard_char            VARCHAR2(1) :&#61; &#39;%&#39;;&#10;    --&#10;    l_vx_search1               VARCHAR2(4000);&#10;    l_vx_search2               VARCHAR2(4000);&#10;    --&#10;    l_wildcard_last_name_flag  BOOLEAN :&#61; FALSE;&#10;    l_wildcard_first_name_flag BOOLEAN :&#61; FALSE;&#10;    --&#10;    l_soundex_search1_flag     BOOLEAN :&#61; FALSE; --SOUNDEX Search 1 No Wildcard used in surname or firstname and NO alias entered&#10;    l_soundex_search2_flag     BOOLEAN :&#61; FALSE; --SOUNDEX Search 2 No Wildcard used in surname or firstname and alias could be entered&#10;    l_soundex_search3_flag     BOOLEAN :&#61; FALSE; --SOUNDEX Search 3 No Wildcard used in surname and alias could be entered&#10;    l_soundex_search_flag      BOOLEAN :&#61; FALSE; --TRUE when at least one of l_soundex_search[x]_flag is TRUE&#10;    --&#10;    l_exact_last_name_flag     BOOLEAN :&#61; FALSE;&#10;    l_exact_first_name_flag    BOOLEAN :&#61; FALSE;&#10;    l_exact_second_name_flag   BOOLEAN :&#61; FALSE;&#10;    l_exact_third_name_flag    BOOLEAN :&#61; FALSE;&#10;    l_exact_flag               BOOLEAN :&#61; FALSE;&#10;    --&#10;    l_filter_wildcard          VARCHAR2(1);&#10;    --&#10;    l_alias_criteria_flag      BOOLEAN;&#10;    l_alias_flag               BOOLEAN;&#10;    l_crn_via_ai_flag          BOOLEAN;&#10;    l_ai_flag                  BOOLEAN;&#10;    --&#10;    l_custody_flag             BOOLEAN;&#10;    l_rank_null_flag           BOOLEAN;&#10;    --&#10;    l_crn           OFFENDER.CRN%TYPE;&#10;    l_noms_number   OFFENDER.noms_number%TYPE;&#10;    l_pnc_number    OFFENDER.pnc_number%TYPE;&#10;    l_pnc_number1   OFFENDER.pnc_number%TYPE;&#10;    --&#10;    l_date_of_birth DATE;&#10;    --&#10;    l_lor_flag BOOLEAN :&#61; (NVLSTR(p_lor_flag, &#39;Y&#39;) &#61; &#39;Y&#39;);&#10;    --&#10;    l_search_mode VARCHAR2(100);&#10;    --&#10;    l_max_rows INTEGER;&#10;    --&#10;BEGIN&#10;    --&#10;    g_o_criteria_flag :&#61; FALSE;&#10;    --&#10;    g_procedure_name :&#61; lc_proc;&#10;    --&#10;    IF NOT ( EMPTY2NULL(p_first_name)            IS NOT NULL OR&#10;             EMPTY2NULL(p_middle_name)           IS NOT NULL OR&#10;             EMPTY2NULL(p_last_name)             IS NOT NULL OR&#10;             ( EMPTY2NULL(p_other_identifier_type) IS NOT NULL AND EMPTY2NULL(p_other_identifier) IS NOT NULL ) OR&#10;             --&#10;             EMPTY2NULL(p_crn)                   IS NOT NULL OR&#10;             EMPTY2NULL(p_noms_number)           IS NOT NULL OR&#10;             EMPTY2NULL(p_pnc_number)            IS NOT NULL OR&#10;             p_date_of_birth                     IS NOT NULL OR&#10;             --&#10;             p_institution_id IS NOT NULL )&#10;    THEN&#10;        raise_application_error(-20001, &#39;Error in &#39; || lc_proc || &#39;: insufficient number of parameters specified &#39; ||&#10;            &#39;(p_first_name&#61;&#39;             || p_first_name             || &#39;)&#39; ||&#10;            &#39;(p_middle_name&#61;&#39;            || p_middle_name            || &#39;)&#39; ||&#10;            &#39;(p_last_name&#61;&#39;              || p_last_name              || &#39;)&#39; ||&#10;            &#39;(p_alias_first_name&#61;&#39;       || p_alias_first_name       || &#39;)&#39; ||&#10;            &#39;(p_alias_second_name&#61;&#39;      || p_alias_second_name      || &#39;)&#39; ||&#10;            &#39;(p_alias_third_name&#61;&#39;       || p_alias_third_name       || &#39;)&#39; ||&#10;            &#39;(p_alias_surname&#61;&#39;          || p_alias_surname          || &#39;)&#39; ||&#10;            &#39;(p_gender&#61;&#39;                 || p_gender                 || &#39;)&#39; ||&#10;            &#39;(p_other_identifier_type&#61;&#39;  || p_other_identifier_type  || &#39;)&#39; ||&#10;            &#39;(p_other_identifier&#61;&#39;       || p_other_identifier       || &#39;)&#39; ||&#10;            &#39;(p_national_search&#61;&#39;        || p_national_search        || &#39;)&#39; ||&#10;            &#39;(p_trust&#61;&#39;                  || p_trust                  || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_crn&#61;&#39;                    || p_crn                    || &#39;)&#39; ||&#10;            &#39;(p_noms_number&#61;&#39;            || p_noms_number            || &#39;)&#39; ||&#10;            &#39;(p_pnc_number&#61;&#39;             || p_pnc_number             || &#39;)&#39; ||&#10;            &#39;(p_date_of_birth&#61;&#39;          || p_date_of_birth          || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_custodial_search&#61;&#39;       || p_custodial_search       || &#39;)&#39; ||&#10;            &#39;(p_institution_id&#61;&#39;         || p_institution_id         || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_include_preferred_name&#61;&#39; || p_include_preferred_name || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_max_rows&#61;&#39;               || p_max_rows               || &#39;)&#39; );&#10;        RETURN /*ttabOffenders()*/;&#10;    END IF;&#10;    --&#10;    IF UPPER(NVLSTR(TRIM(p_resultset_limit_flag), &#39;Y&#39;)) &#61; &#39;Y&#39; THEN&#10;        l_max_rows :&#61; PKG_Lookups.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;OFFENDER_SEARCH_MAX_RESULTS&#39;, p_default_value &#61;&gt; 100);&#10;    ELSE&#10;        l_max_rows :&#61; NVL(p_max_rows, 10000);&#10;    END IF;&#10;    --&#10;    l_ai_flag :&#61;  ( NVL(p_other_identifier_type, &#39;X&#39;) IN ( &#39;CRONumber&#39;, &#39;NINumber&#39;, &#39;PrisonerNumber&#39;, &#39;AdditionalIdentifier&#39; ) );&#10;    --&#10;    IF p_other_identifier_type &#61; &#39;DateOfBirth&#39; THEN -- 12-AUG-70 &#61; 1970-08-12 00:00:00.0&#10;        l_date_of_birth :&#61; TO_DATE(SUBSTR(p_other_identifier, 1, 10), &#39;YYYY-MM-DD&#39;);&#10;    ELSE&#10;        l_date_of_birth :&#61; p_date_of_birth;&#10;    END IF;&#10;    --&#10;    IF p_other_identifier_type &#61; &#39;CRN&#39; THEN&#10;        l_crn :&#61; p_other_identifier;&#10;    ELSE&#10;        l_crn :&#61; p_crn;&#10;    END IF;&#10;    --&#10;    IF p_other_identifier_type &#61; &#39;NOMSNumber&#39; THEN&#10;        l_noms_number :&#61; UPPER(p_other_identifier);&#10;    ELSE&#10;        l_noms_number :&#61; UPPER(p_noms_number);&#10;    END IF;&#10;    --&#10;    IF p_other_identifier_type &#61; &#39;PNCNumber&#39; THEN&#10;        l_pnc_number :&#61; UPPER(p_other_identifier);&#10;    ELSE&#10;        l_pnc_number :&#61; UPPER(p_pnc_number);&#10;    END IF;&#10;&#10;    --&#10;    l_alias_criteria_flag :&#61; ( PKG_Common.empty2null(p_alias_first_name)  IS NOT NULL OR&#10;                               PKG_Common.empty2null(p_alias_second_name) IS NOT NULL OR&#10;                               PKG_Common.empty2null(p_alias_third_name)  IS NOT NULL OR&#10;                               PKG_Common.empty2null(p_alias_surname)     IS NOT NULL&#10;                             );&#10;    --&#10;    l_custody_flag :&#61; ( UPPER(TRIM(p_custodial_search)) &#61; &#39;Y&#39; OR p_institution_id IS NOT NULL );&#10;    --&#10;    IF LENGTH(REPLACE(TRIM(p_last_name), l_wildcard_char, &#39;&#39;))   &#61; 1 AND SUBSTR(TRIM(p_last_name), 1, 1)   &lt;&gt; l_wildcard_char THEN&#10;        l_exact_last_name_flag :&#61; TRUE;&#10;    END IF;&#10;    IF LENGTH(REPLACE(TRIM(p_first_name), l_wildcard_char, &#39;&#39;))  &#61; 1 AND SUBSTR(TRIM(p_first_name), 1, 1)  &lt;&gt; l_wildcard_char THEN&#10;        l_exact_first_name_flag :&#61; TRUE;&#10;    END IF;&#10;    IF LENGTH(REPLACE(TRIM(p_middle_name), l_wildcard_char, &#39;&#39;)) &#61; 1 AND SUBSTR(TRIM(p_middle_name), 1, 1) &lt;&gt; l_wildcard_char THEN&#10;        l_exact_second_name_flag :&#61; TRUE;&#10;        l_exact_third_name_flag  :&#61; TRUE;&#10;    END IF;&#10;    --&#10;    -- DST-4167: A special case when (for Custodial Search only) LAST_NAME is not specified&#10;    IF l_custody_flag AND EMPTY2NULL(REPLACE(TRIM(p_last_name), l_wildcard_char, &#39;&#39;)) IS NULL THEN&#10;        --&#10;        IF EMPTY2NULL(REPLACE(TRIM(p_first_name), l_wildcard_char, &#39;&#39;)) IS NOT NULL AND&#10;           INSTR(p_first_name, l_wildcard_char) &#61; 0&#10;        THEN&#10;            l_exact_first_name_flag :&#61; TRUE;&#10;        END IF;&#10;        --&#10;        IF EMPTY2NULL(REPLACE(TRIM(p_middle_name), l_wildcard_char, &#39;&#39;)) IS NOT NULL AND&#10;           INSTR(p_middle_name, l_wildcard_char) &#61; 0&#10;        THEN&#10;            l_exact_second_name_flag :&#61; TRUE;&#10;            l_exact_third_name_flag  :&#61; TRUE;&#10;        END IF;&#10;        --&#10;    END IF;&#10;    --&#10;    l_exact_flag :&#61; ( l_exact_last_name_flag OR l_exact_first_name_flag OR l_exact_second_name_flag OR l_exact_third_name_flag );&#10;    --&#10;    l_wildcard_first_name_flag :&#61; ( EMPTY2NULL(p_first_name) IS NOT NULL AND INSTR(NVLSTR(p_first_name, &#39; &#39;), l_wildcard_char) &lt;&gt; 0 );&#10;    --&#10;    IF EMPTY2NULL(p_last_name) IS NOT NULL AND INSTR(NVLSTR(p_last_name , &#39; &#39;), l_wildcard_char) &lt;&gt; 0 THEN&#10;        l_wildcard_last_name_flag :&#61; TRUE;&#10;    ELSIF ( EMPTY2NULL(p_last_name) IS NOT NULL /*OR EMPTY2NULL(p_last_name) IS NOT NULL*/ ) AND&#10;          ( INSTR(NVLSTR(p_last_name, &#39; &#39;), l_wildcard_char) &#61; 0 AND INSTR(NVLSTR(p_first_name, &#39; &#39;), l_wildcard_char) &#61; 0 )&#10;    THEN&#10;        IF NOT l_alias_criteria_flag THEN&#10;            --&#10;            -- SOUNDEX Search 1 No Wildcard used in surname or firstname and NO alias entered&#10;            l_soundex_search1_flag :&#61; TRUE;&#10;        ELSE&#10;            --&#10;            -- SOUNDEX Search 2 No Wildcard used in surname or firstname and alias could be entered&#10;            l_soundex_search2_flag :&#61; TRUE;&#10;        END IF;&#10;    ELSIF ( ( EMPTY2NULL(p_last_name) IS NOT NULL AND INSTR(NVLSTR(p_last_name, &#39; &#39;), l_wildcard_char) &#61; 0 )&#10;            /* NDD-4108: Wildcard on first name + SOUNDEX(last name) returns no result AND ( l_alias_criteria_flag )*/&#10;          )&#10;        --&#10;        -- SOUNDEX Search 3 No Wildcard used in surname and alias could be entered&#10;        THEN l_soundex_search3_flag :&#61; TRUE;&#10;    END IF;&#10;    --&#10;    l_soundex_search_flag :&#61; ( l_soundex_search1_flag OR l_soundex_search2_flag OR l_soundex_search3_flag );&#10;    --&#10;    IF ( p_other_identifier_type &#61; &#39;DateOfBirth&#39; ) OR l_wildcard_last_name_flag OR l_wildcard_first_name_flag THEN&#10;        l_filter_wildcard :&#61; l_wildcard_char;&#10;    END IF;&#10;    --&#10;    IF EMPTY2NULL(l_crn) IS NOT NULL THEN&#10;        l_crn_via_ai_flag :&#61; (EMPTY2NULL(p_crn) IS NOT NULL);&#10;    ELSE&#10;        l_crn_via_ai_flag :&#61; FALSE;&#10;    END IF;&#10;    --&#10;    l_alias_flag :&#61; ( ( ( p_other_identifier_type IN ( &#39;DateOfBirth&#39; ) OR ( l_date_of_birth IS NOT NULL AND NVLSTR(p_dob_ranking_flag, &#39;Y&#39;) &lt;&gt; &#39;Y&#39; ) ) AND NOT (l_alias_criteria_flag) )&#10;                      OR&#10;                      ( l_wildcard_last_name_flag AND l_alias_criteria_flag )&#10;                      OR&#10;                      ( l_wildcard_first_name_flag AND l_alias_criteria_flag )&#10;                      OR&#10;                      l_soundex_search2_flag&#10;                      OR&#10;                      ( l_soundex_search3_flag  AND l_alias_criteria_flag   )&#10;                    );&#10;    --&#10;    l_rank_null_flag :&#61; NOT ( ( l_date_of_birth IS NOT NULL AND NVLSTR(p_dob_ranking_flag   , &#39;Y&#39;) &#61; &#39;Y&#39; ) OR&#10;                              ( p_gender        IS NOT NULL AND NVLSTR(p_gender_ranking_flag, &#39;Y&#39;) &#61; &#39;Y&#39; ) OR&#10;                              l_wildcard_last_name_flag                                                    OR&#10;                              l_wildcard_first_name_flag                                                   OR&#10;                              l_soundex_search_flag                                                        OR&#10;                              EMPTY2NULL(TRIM(l_crn))         IS NOT NULL                                  OR&#10;                              EMPTY2NULL(TRIM(l_noms_number)) IS NOT NULL                                  OR&#10;                              EMPTY2NULL(TRIM(l_pnc_number))  IS NOT NULL&#10;                            );&#10;    --&#10;    IF EMPTY2NULL(p_other_identifier_type) IS NOT NULL THEN&#10;        l_search_mode :&#61; &#39;OTH_&#39; || p_other_identifier_type;&#10;    ELSIF l_wildcard_last_name_flag /*OR l_wildcard_first_name_flag*/ THEN&#10;        l_search_mode :&#61; &#39;WILDCARD&#39;;&#10;    ELSIF l_soundex_search1_flag THEN&#10;        l_search_mode :&#61; &#39;SOUNDEX1&#39;;&#10;    ELSIF l_soundex_search2_flag THEN&#10;        l_search_mode :&#61; &#39;SOUNDEX2&#39;;&#10;    ELSIF l_soundex_search3_flag THEN&#10;        l_search_mode :&#61; &#39;SOUNDEX3&#39;;&#10;    END IF;&#10;    --&#10;    IF l_exact_last_name_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;EXACT_SNAME&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF l_exact_first_name_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;EXACT_1NAME&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF l_exact_second_name_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;EXACT_2NAME&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF l_exact_third_name_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;EXACT_3NAME&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    --&#10;    IF EMPTY2NULL(l_crn) IS NOT NULL AND (NVLSTR(p_other_identifier_type, &#39;X&#39;) &lt;&gt; &#39;CRN&#39;) THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;CRN&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF EMPTY2NULL(l_noms_number) IS NOT NULL AND (NVLSTR(p_other_identifier_type, &#39;X&#39;) &lt;&gt; &#39;NOMSNumber&#39;) THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;NOMS&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF EMPTY2NULL(l_pnc_number) IS NOT NULL AND (NVLSTR(p_other_identifier_type, &#39;X&#39;) &lt;&gt; &#39;PNCNumber&#39;) THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;PNC&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF ( l_date_of_birth IS NOT NULL AND NVLSTR(p_dob_ranking_flag, &#39;Y&#39;) &lt;&gt; &#39;Y&#39; ) AND&#10;       ( NVLSTR(p_other_identifier_type, &#39;X&#39;) &lt;&gt; &#39;DateOfBirth&#39; )&#10;    THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;DOB&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF l_crn_via_ai_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;CRN_VIA_AI&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF l_alias_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;ALIAS&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF l_custody_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;CUSTODY&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    IF NOT l_rank_null_flag THEN&#10;        l_search_mode :&#61; concat(l_search_mode, &#39;RANKING&#39;, p_delim&#61;&gt;&#39;,&#39;);&#10;    END IF;&#10;    --&#10;    --&#10;    ----------------------------------&#10;    -- l_vx_search1 is used of firstname&#10;    ----------------------------------&#10;    CASE&#10;      WHEN empty2null(p_first_name) IS NULL         THEN l_vx_search1 :&#61; &#39;#&#39; ;                                   -- dont find anything&#10;      WHEN INSTR(p_first_name, l_wildcard_char) &#61; 0 THEN l_vx_search1 :&#61; &#39;#&#39; || SOUNDEX(p_first_name);           -- e.g. #J12&#10;      ELSE                                               l_vx_search1 :&#61; &#39;@&#39; || REPLACE(p_first_name, &#39;%&#39;, &#39;.*&#39;); -- e.g.@Jon.*&#10;    END CASE;&#10;&#10;    -------------------------------------&#10;    -- l_vx_search2 is used for middle name&#10;    -------------------------------------&#10;    CASE&#10;      WHEN empty2null(p_middle_name) IS NULL         THEN l_vx_search2 :&#61; &#39;#&#39; ;                                    -- don&#39;t find anything&#10;      WHEN INSTR(p_middle_name, l_wildcard_char) &#61; 0 THEN l_vx_search2 :&#61; &#39;#&#39; || SOUNDEX(p_middle_name);           -- e.g. #E34&#10;      ELSE                                                l_vx_search2 :&#61; &#39;@&#39; || REPLACE(p_middle_name, &#39;%&#39;, &#39;.*&#39;); -- @Eric*&#10;    END CASE;&#10;    --&#10;    --&#10;    --&#10;    l_pnc_number1 :&#61; l_pnc_number;&#10;&#10;&#10;    l_SQL :&#61;&#10;    --&#10;&#39;WITH&#10;--&#10;-- Offender Identifiers (Base query)&#10;--&#10;&#10;&#10;OI0 AS (&#10;  SELECT DISTINCT offender_id, oth_id_type&#10;  FROM (&#10;        &#39; || Concat(&#10;        &#39;-- CRN&#10;        &#39; ||&#10;        CASE WHEN EMPTY2NULL(l_crn) IS NOT NULL AND NVLSTR(p_other_identifier_type, &#39;X&#39;) &lt;&gt; &#39;CRN&#39; THEN&#10;            &#39;SELECT offender_id, &#39;&#39;CRN&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(crn) &#61; LOWER(:p_crn1)&#39;&#10;        ELSE&#10;            &#39;SELECT NULL AS offender_id, &#39;&#39;CRN&#39;&#39; AS oth_id_type FROM dual WHERE 1&lt;&gt;1 AND :p_crn1 IS NULL&#39;&#10;        END,&#10;&#39;        -- CRN (via the ADDITIONAL_IDENTIFIR - DOFF/MFCRN/MTCRN/PCRN)&#10;        &#39; ||&#10;        CASE WHEN l_crn_via_ai_flag THEN&#10;            &#39;SELECT offender_id, &#39;&#39;CRN_VIA_AI&#39;&#39; AS oth_id_type&#10;             FROM&#10;               additional_identifier A2&#10;                 INNER JOIN r_standard_reference_list RAI ON RAI.standard_reference_list_id &#61; A2.identifier_name_id AND&#10;                   RAI.code_value IN ( &#39;&#39;DOFF&#39;&#39; /*duplicate offender CRN*/, &#39;&#39;MFCRN&#39;&#39; /*Merged From CRN*/, &#39;&#39;MTCRN&#39;&#39; /*Merged To CRN*/, &#39;&#39;PCRN&#39;&#39; /*Other Previous CRN*/ )&#10;             WHERE A2.soft_deleted &#61; 0&#10;               AND UPPER(A2.identifier) &#61; UPPER(:p_crn1)&#39;&#10;        ELSE&#10;            &#39;SELECT NULL AS offender_id, &#39;&#39;CRN_VIA_AI&#39;&#39; AS oth_id_type FROM dual WHERE 1&lt;&gt;1 AND :p_crn1 IS NULL&#39;&#10;        END,&#10;&#39;        -- NOMS Number&#10;        &#39; ||&#10;        CASE WHEN EMPTY2NULL(l_noms_number) IS NOT NULL THEN&#10;            &#39;SELECT offender_id, &#39;&#39;NOMS&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(noms_number) &#61; LOWER(:p_noms_number1) AND soft_deleted &#61; 0&#39;&#10;        ELSE&#10;            &#39;SELECT NULL AS offender_id, &#39;&#39;NOMS&#39;&#39; AS oth_id_type FROM dual WHERE 1&lt;&gt;1 AND :p_noms_number1 IS NULL&#39;&#10;        END,&#10; &#39;      -- PNC Number -- DST 10140&#10;        &#39; ||&#10;        CASE&#10;        WHEN EMPTY2NULL(l_pnc_number) IS NOT NULL AND LENGTH(TRIM(l_pnc_number)) &gt; 8 THEN&#10;            --there is a year Prefix ie 9999/nnnnnnnX&#10;            &#39;/* A */SELECT offender_id, &#39;&#39;PNC&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(pnc_number) &#61; LOWER(:l_pnc_number) AND soft_deleted &#61; 0 UNION&#10;             SELECT offender_id, &#39;&#39;PNC&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(pnc_number) &#61; LOWER(SUBSTR(:l_pnc_number1, 1, 12) || &#39;&#39; &#39;&#39;) AND soft_deleted &#61; 0 &#39;&#10;        WHEN EMPTY2NULL(l_pnc_number) IS NOT NULL AND SUBSTR(TRIM(l_pnc_number), LENGTH(TRIM(l_pnc_number)), 1) BETWEEN &#39;A&#39; AND &#39;Z&#39; THEN&#10;            -- search contains a check character (eg 1234X) search for %00001234X and %0001234(Blank)&#10;            &#39;/* B */ SELECT offender_id, &#39;&#39;PNC&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(REVERSE(TRIM(pnc_number))) LIKE LOWER(RPAD(REVERSE(TRIM(:l_pnc_number)), 8, &#39;&#39;0&#39;&#39;)) || &#39;&#39;%&#39;&#39; AND soft_deleted &#61; 0 UNION&#10;            SELECT offender_id, &#39;&#39;PNC&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(REVERSE(TRIM(pnc_number))) LIKE SUBSTR(LOWER(RPAD(REVERSE(TRIM(:l_pnc_number1)), 8, &#39;&#39;0&#39;&#39;)), 2, 13) || &#39;&#39;%&#39;&#39; AND soft_deleted &#61; 0 &#39;&#10;        WHEN EMPTY2NULL(l_pnc_number) IS NOT NULL and substr(trim(l_pnc_number),length(trim(l_pnc_number)),1) not between &#39;A&#39; and &#39;Z&#39; THEN&#10;            -- search does not contain a check character&#10;            &#39;/* C */ SELECT offender_id, &#39;&#39;PNC&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(REVERSE(TRIM(pnc_number))) LIKE LOWER(RPAD(REVERSE(TRIM(:l_pnc_number)), 7, &#39;&#39;0&#39;&#39;)) || &#39;&#39;%&#39;&#39; AND soft_deleted &#61; 0 UNION&#10;            SELECT offender_id, &#39;&#39;PNC&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(REVERSE(TRIM(pnc_number))) LIKE &#39;&#39;_&#39;&#39; || SUBSTR(LOWER(RPAD(REVERSE(TRIM(:l_pnc_number1)), 7, &#39;&#39;0&#39;&#39;)), 1, 13) || &#39;&#39;%&#39;&#39; AND soft_deleted &#61; 0 &#39;&#10;        ELSE&#10;            &#39;/* D */ SELECT NULL AS offender_id, &#39;&#39;PNC&#39;&#39; AS oth_id_type FROM dual WHERE 1&lt;&gt;1 AND :l_pnc_number1 IS NULL and :l_pnc_number is null&#39;&#10;        END,&#10;&#39;        -- Other Identifier&#10;        &#39; ||&#10;        CASE WHEN p_other_identifier_type &#61; &#39;CRN&#39;                  THEN&#10;            &#39;SELECT offender_id, &#39;&#39;CRN&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(CRN) &#61; LOWER(:p_CRN) AND soft_deleted &#61; 0&#39;&#10;        WHEN p_other_identifier_type &#61; &#39;CRONumber&#39;            THEN&#10;            &#39;SELECT offender_id, &#39;&#39;CRO&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(cro_number) &#61; LOWER(:p_cro_number) AND soft_deleted &#61; 0&#39;&#10;        WHEN p_other_identifier_type &#61; &#39;NINumber&#39;             THEN&#10;            &#39;SELECT offender_id, &#39;&#39;NI&#39;&#39; AS oth_id_type FROM offender WHERE LOWER(ni_number) &#61; LOWER(:p_ni_number) AND soft_deleted &#61; 0&#39;&#10;        -- NOMS Search: Already implemented above&#10;        --WHEN p_other_identifier_type &#61; &#39;NOMSNumber&#39;           THEN&#10;        --    &#39;SELECT offender_id FROM offender WHERE LOWER(noms_number) &#61; LOWER(:p_noms_number) AND soft_deleted &#61; 0&#39;&#10;        -- PNC Search: Already implemented above&#10;        --WHEN p_other_identifier_type &#61; &#39;PNCNumber&#39;            THEN&#10;        --    &#39;SELECT offender_id FROM offender WHERE LOWER(pnc_number) &#61; LOWER(:p_pnc_number) AND soft_deleted &#61; 0&#39;&#10;        WHEN p_other_identifier_type &#61; &#39;PrisonerNumber&#39;       THEN&#10;            &#39;SELECT offender_id, &#39;&#39;PRN&#39;&#39; AS oth_id_type FROM offender_prisoner WHERE prisoner_number &#61; :p_pr_num&#39;&#10;        WHEN p_other_identifier_type &#61; &#39;AdditionalIdentifier&#39; THEN&#10;            &#39;SELECT offender_id, &#39;&#39;AI&#39;&#39; AS oth_id_type FROM additional_identifier WHERE UPPER(identifier) &#61; UPPER(:p_add_identifier) AND soft_deleted &#61; 0&#39;&#10;        ELSE&#10;            &#39;SELECT NULL AS offender_id, &#39;&#39;AI&#39;&#39; AS oth_id_type FROM dual WHERE 1&lt;&gt;1 AND :p_other_identifier IS NULL&#39;&#10;        END,&#10;        --&#10;        -- End of CONCAT()&#10;        p_delim &#61;&gt; CHR(10) || &#39;        &#39; || (CASE WHEN l_lOR_flag &#61; TRUE THEN &#39;UNION&#39; ELSE &#39;INTERSECT&#39; END) || CHR(10) ) || &#39;&#10;       ) -- End of the nested FROM()&#10;  WHERE offender_id IS NOT NULL ),&#10;--&#10;-- Offender Names / D.O.B. (base query)&#10;--&#10;O0 AS (&#10;  SELECT DISTINCT O.offender_id&#10;  FROM&#10;    offender O&#10;  WHERE 1&#61;1&#10;    AND O.soft_deleted &#61; 0&#10;    --&#10;    AND ( /* START of OFFENDER Search Criteria */&#10;          --&#10;          -- Offender Names, other&#10;          --&#10;          &#39; || &#39;@SQL_OFFENDER_NAMES_OTH&#10;          --&#10;          &#39; || CASE WHEN p_institution_id IS NOT NULL THEN &#39;-- National Custody Search criteria - please see the T2 sub-query below&#39; END || &#39;&#10;          --&#10;          &#39; || CASE&#10;               WHEN l_exact_last_name_flag     THEN do_add_o(&#39;SUBSTR(LOWER(O.surname), 1, 1) &#61; SUBSTR(LOWER(:p_last_name), 1, 1)&#39;)&#10;               WHEN l_wildcard_last_name_flag  THEN do_add_o(&#39;SUBSTR(LOWER(O.surname), 1, 2) &#61; SUBSTR(LOWER(:p_last_name), 1, 2)&#39;)&#10;               WHEN l_soundex_search_flag AND EMPTY2NULL(p_last_name) IS NOT NULL&#10;                                               THEN do_add_o(&#39;O.surname_soundex &#61; SOUNDEX(:p_last_name)&#39;)&#10;                                               ELSE &#39;PKG_Common.NVLSTR(:p_last_name, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;               END || &#39;&#10;          --&#10;          AND &#39; || CASE&#10;                   WHEN l_date_of_birth IS NOT NULL AND NVLSTR(p_dob_ranking_flag, &#39;Y&#39;) &lt;&gt; &#39;Y&#39; THEN do_add_o(&#39;O.date_of_birth_date &#61; :p_dob&#39;)&#10;                   ELSE                                                                             &#39;NVL(:p_dob, SYSDATE) IS NOT NULL&#39;&#10;                   END || &#39;&#10;          --&#10;          -- NEW: A Single Character Search for Offender Names&#10;          --&#10;          AND &#39; || CASE WHEN l_exact_last_name_flag   THEN do_add_o(&#39;LOWER(O.surname) LIKE LOWER(:p_last_name1)&#39;)       ELSE &#39;PKG_Common.NVLSTR(:p_last_name1, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;   END || &#39;&#10;          AND &#39; ||&#10;              CASE WHEN l_exact_first_name_flag THEN do_add_o(&#10;                  CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN&#10;                      &#39;( LOWER(O.first_name) LIKE LOWER(:p_first_name1) OR LOWER(O.preferred_name) LIKE LOWER(:p_first_name1) )&#39;&#10;                  ELSE&#10;                      &#39;( LOWER(O.first_name) LIKE LOWER(:p_first_name1) OR :p_first_name1||&#39;&#39;a&#39;&#39; &#61; &#39;&#39;xyz&#39;&#39; )&#39;&#10;                  END )&#10;              ELSE&#10;                  &#39;:p_first_name1||:p_first_name1||&#39;&#39;x&#39;&#39; IS NOT NULL&#39;&#10;              END || &#39;&#10;          --&#10;          AND &#39; || CASE WHEN l_exact_second_name_flag THEN do_add_o(&#39;( LOWER(O.second_name) LIKE LOWER(:p_second_name1) OR LOWER(O.third_name) LIKE LOWER(:p_third_name1) )&#39;) ELSE &#39;PKG_Common.NVLSTR(:p_second_name1 || :p_third_name1, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39; END || &#39;&#10;          --&#10;          -- Filter Statement&#10;          --&#10;          &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; OR l_wildcard_last_name_flag THEN&#10;          --&#10;         &#39;AND &#39; || CASE WHEN PKG_Common.empty2null(p_last_name) IS NOT NULL THEN do_add_o(&#39;LOWER(O.surname) LIKE LOWER(:p_last_name) || &#39;&#39;&#39; || l_filter_wildcard || &#39;&#39;&#39;&#39;) ELSE &#39;PKG_Common.empty2null(:p_last_name) IS NULL&#39; END&#10;              --&#10;              ELSE&#10;              --&#10;         &#39;AND PKG_Common.NVLSTR(:p_last_name, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;              --&#10;              END || &#39;&#10;          --&#10;          &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; OR l_wildcard_first_name_flag THEN&#10;          --&#10;         &#39;AND &#39; ||&#10;              CASE WHEN PKG_Common.empty2null(p_first_name) IS NOT NULL THEN do_add_o(&#10;                  CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN&#10;                      &#39;( LOWER(O.first_name) LIKE LOWER(:p_first_name1) || &#39;&#39;&#39; || l_filter_wildcard || &#39;&#39;&#39; OR LOWER(O.preferred_name) LIKE LOWER(:p_first_name1) || &#39;&#39;&#39; || l_filter_wildcard || &#39;&#39;&#39; )&#39;&#10;                  ELSE&#10;                      &#39;( LOWER(O.first_name) LIKE LOWER(:p_first_name1) || &#39;&#39;&#39; || l_filter_wildcard || &#39;&#39;&#39; OR :p_first_name1||&#39;&#39;a&#39;&#39; &#61; &#39;&#39;xyz&#39;&#39; )&#39;&#10;                  END )&#10;              ELSE&#10;                  &#39;:p_first_name1||:p_first_name1||&#39;&#39;x&#39;&#39; IS NOT NULL&#39;&#10;              END&#10;              --&#10;              ELSE&#10;              --&#10;         &#39;AND :p_first_name1||:p_first_name1||&#39;&#39;x&#39;&#39; IS NOT NULL&#39;&#10;              --&#10;              END || &#39;&#10;          --&#10;          &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; OR l_wildcard_last_name_flag OR l_wildcard_first_name_flag OR l_soundex_search_flag OR l_exact_flag THEN&#10;              --&#10;         &#39;AND &#39; || CASE WHEN p_gender IS NOT NULL AND NVLSTR(p_gender_ranking_flag, &#39;X&#39;) &lt;&gt; &#39;Y&#39; THEN do_add_o(&#39;O.gender_id &#61; :p_gender&#39;) ELSE &#39;NVL(:p_gender, -1) IS NOT NULL&#39; END&#10;              --&#10;              ELSE&#10;              --&#10;         &#39;AND NVL(:p_gender, -1) IS NOT NULL&#39;&#10;              --&#10;              END || &#39;&#10;         --&#10;          &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; THEN&#10;              --&#10;do_add_o(&#39;AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || O.first_name || &#39; || (CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39;&#39;&#39;@&#39;&#39; || O.preferred_name || &#39; END) || &#39;&#39;&#39;@&#39;&#39; || O.second_name || &#39;&#39;@&#39;&#39; || O.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(O.first_name) || &#39; || (CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39;&#39;&#39;#&#39;&#39; || SOUNDEX(O.preferred_name) || &#39; END) || &#39;&#39;&#39;#&#39;&#39; || SOUNDEX(O.second_name) || &#39;&#39;+&#39;&#39; || SOUNDEX(O.third_name), :p_vx_search1, &#39;&#39;i&#39;&#39; )&#10;          AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || O.first_name || &#39; || (CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39;&#39;&#39;@&#39;&#39; || O.preferred_name || &#39; END) || &#39;&#39;&#39;@&#39;&#39; || O.second_name || &#39;&#39;@&#39;&#39; || O.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(O.first_name) || &#39; || (CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39;&#39;&#39;#&#39;&#39; || SOUNDEX(O.preferred_name) || &#39; END) || &#39;&#39;&#39;#&#39;&#39; || SOUNDEX(O.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(O.third_name), :p_vx_search2, &#39;&#39;i&#39;&#39; )&#39;)&#10;              --&#10;              WHEN l_wildcard_last_name_flag /*OR l_wildcard_first_name_flag*/ THEN&#10;do_add_o(&#39;AND PKG_Common.NVLSTR(:p_vx_search1, &#39;&#39;X&#39;&#39;) IS NOT NULL&#10;          AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || O.second_name || &#39;&#39;@&#39;&#39; || O.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(O.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(O.third_name), :p_vx_search2, &#39;&#39;i&#39;&#39;)&#39;)&#10;              --&#10;              WHEN l_soundex_search1_flag OR l_soundex_search2_flag THEN&#10;do_add_o(&#39;AND REGEXP_LIKE( &#39;&#39;#&#39;&#39; || SOUNDEX(O.first_name)&#39; || (CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39; || &#39;&#39;#&#39;&#39; || SOUNDEX(O.preferred_name)&#39; END) || &#39;, :p_vx_search1, &#39;&#39;i&#39;&#39;)&#10;          AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || O.second_name || &#39;&#39;@&#39;&#39; || O.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(O.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(O.third_name), :p_vx_search2, &#39;&#39;i&#39;&#39;)&#39;)&#10;              --&#10;              WHEN l_soundex_search3_flag THEN&#10;do_add_o(&#39;AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || O.first_name || &#39; || (CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39;&#39;&#39;@&#39;&#39; || O.preferred_name || &#39; END) || &#39;&#39;&#39;@&#39;&#39; || O.second_name || &#39;&#39;@&#39;&#39; || O.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(O.first_name) || &#39; || (CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39;&#39;&#39;#&#39;&#39; || SOUNDEX(O.preferred_name) || &#39; END) || &#39;&#39;&#39;#&#39;&#39; || SOUNDEX(O.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(O.third_name), :p_vx_search1, &#39;&#39;i&#39;&#39;)&#10;          AND PKG_Common.NVLSTR(:p_vx_search2, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;)&#10;               ELSE&#10;               --&#10;         &#39;AND PKG_Common.NVLSTR(:p_vx_search1, &#39;&#39;X&#39;&#39;) IS NOT NULL AND PKG_Common.NVLSTR(:p_vx_search2, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;               --&#10;               END || &#39;&#10;        ) /* END of OFFENDER Search Criteria */&#10;),&#10;--&#10;-- Offender Names + Offender Identifiers (Base query)&#10;--&#10;OI0_O0 AS (&#10;  SELECT DISTINCT offender_id&#10;  FROM (&#10;    SELECT DISTINCT offender_id FROM OI0&#10;    &#39; || CASE WHEN l_lOR_flag &#61; TRUE THEN &#39;UNION&#39; ELSE &#39;INTERSECT&#39; END || &#39;&#10;    SELECT offender_id FROM O0 ) ),&#10;--&#10;-- Offender Names + Offender Identifiers (Main query)&#10;--&#10;O1 AS (&#10;  SELECT&#10;    O.offender_id,&#10;    O.crn,&#10;    O.noms_number,&#10;    O.pnc_number,&#10;    O.first_name,&#10;    O.preferred_name,&#10;    O.second_name,&#10;    O.third_name,&#10;    O.surname,&#10;    --&#10;    O.date_of_birth_date          AS date_of_birth,&#10;    O.current_highest_risk_colour AS risk,&#10;    RG.code_description           AS gender,&#10;    --&#10;    CASE WHEN ( O.current_exclusion   &#61; 1 ) THEN &#39;&#39;Y&#39;&#39; END AS current_exclusion,&#10;    CASE WHEN ( O.current_restriction &#61; 1 ) THEN &#39;&#39;Y&#39;&#39; END AS current_restriction,&#10;    --&#10;    PA.code         AS trust_code,&#10;    PA.description  AS trust,&#10;    S.forename      AS officer_forename,&#10;    S.forename2     AS officer_forename2,&#10;    S.surname       AS officer_surname,&#10;    --&#10;    CASE WHEN ( O.current_disposal ) &#61; 1 THEN &#39;&#39;Y&#39;&#39; ELSE &#39;&#39;N&#39;&#39; END AS current_disposal,&#10;    --&#10;    NULL    AS alias_id,&#10;    --&#10;    PKG_OFF_NAT_SEARCH.funcRankOffenderName(&#10;        p_NULL_flag      &#61;&gt; &#39;&#39;&#39; || TO_CHAR1(l_rank_null_flag) || &#39;&#39;&#39;,&#10;        p_first_name     &#61;&gt; :p_first_name,&#10;        p_secondname     &#61;&gt; :p_middle_name,&#10;        p_thirdname      &#61;&gt; NULL,&#10;        p_surname        &#61;&gt; :p_last_name,&#10;        p_dob            &#61;&gt; :p_date_Of_Birth,&#10;        p_gender         &#61;&gt; :p_gender,&#10;        p_noms_number    &#61;&gt; :p_noms,&#10;        p_pnc_number     &#61;&gt; :p_pnc,&#10;        p_crn            &#61;&gt; :p_crn,&#10;        p_act_firstname  &#61;&gt; O.first_name,&#10;        --&#10;        p_act_preferred_name &#61;&gt; O.preferred_name, p_include_preferred_name &#61;&gt; &#39;&#39;&#39; || p_include_preferred_name || &#39;&#39;&#39;,&#10;        --&#10;        p_act_secondname &#61;&gt; O.second_name,&#10;        p_act_thirdname  &#61;&gt; O.third_name,&#10;        p_act_surname    &#61;&gt; O.surname,&#10;        p_act_dob        &#61;&gt; O.date_of_birth_date,&#10;        p_act_gender     &#61;&gt; O.gender_id,&#10;        p_act_noms_number&#61;&gt; O.noms_number,&#10;        p_act_pnc_number &#61;&gt; O.pnc_number,&#10;        p_act_crn        &#61;&gt; O.crn,&#10;        p_act_offender_id&#61;&gt; O.offender_id,&#10;        p_disposal       &#61;&gt; &#39; || CASE WHEN l_soundex_search_flag OR l_exact_flag OR l_crn_via_ai_flag THEN &#39;O.current_disposal&#39; ELSE &#39;NULL&#39; END || &#39;,&#10;        p_alias          &#61;&gt; NULL,&#10;        --&#10;        p_oth_ai_matches &#61;&gt; ( SELECT COUNT(1) FROM OI0 WHERE offender_id &#61; OI0_O0.offender_id AND oth_id_type IN ( &#39;&#39;CRO&#39;&#39;, &#39;&#39;NI&#39;&#39;, &#39;&#39;PRN&#39;&#39;, &#39;&#39;AI&#39;&#39; ) )&#10;    ) AS rank,&#10;    --&#10;    PKG_OFF_NAT_SEARCH.funcGetRankDetails(O.offender_id) AS rank_details&#10;    --&#10;  FROM&#10;    OI0_O0&#10;      INNER JOIN offender O ON O.offender_id &#61; OI0_O0.offender_id&#10;        INNER JOIN r_standard_reference_list RG ON RG.standard_reference_list_id &#61; O.gender_id&#10;        INNER JOIN offender_manager OM ON OM.offender_id &#61; O.offender_id AND OM.active_flag &#61; 1&#10;          INNER JOIN officer S ON S.trust_provider_flag &#61; OM.trust_provider_flag AND S.staff_employee_id &#61; OM.staff_employee_id&#10;          INNER JOIN probation_area PA ON PA.probation_area_id &#61; OM.probation_area_id&#10;  WHERE O.soft_deleted &#61; 0 ),&#10;--&#10;-- Offender Aliases&#10;--&#10;A1 AS (&#10;  SELECT&#10;    O.offender_id,&#10;    O.crn,&#10;    O.noms_number,&#10;    O.pnc_number,&#10;    O.first_name,&#10;    O.preferred_name,&#10;    O.second_name,&#10;    O.third_name,&#10;    O.surname,&#10;    --&#10;    O.date_of_birth_date          AS date_of_birth,&#10;    O.current_highest_risk_colour AS risk,&#10;    RG.code_description           AS gender,&#10;    --&#10;    CASE WHEN ( O.current_exclusion   &#61; 1 ) THEN &#39;&#39;Y&#39;&#39; END AS current_exclusion,&#10;    CASE WHEN ( O.current_restriction &#61; 1 ) THEN &#39;&#39;Y&#39;&#39; END AS current_restriction,&#10;    --&#10;    PA.code         AS trust_code,&#10;    PA.description  AS trust,&#10;    S.forename      AS officer_forename,&#10;    S.forename2     AS officer_forename2,&#10;    S.surname       AS officer_surname,&#10;    --&#10;    CASE WHEN ( O.current_disposal ) &#61; 1 THEN &#39;&#39;Y&#39;&#39; ELSE &#39;&#39;N&#39;&#39; END AS current_disposal,&#10;    --&#10;    A.alias_id,&#10;    --&#10;    PKG_OFF_NAT_SEARCH.funcRankOffenderName(&#10;        p_NULL_flag      &#61;&gt; &#39;&#39;&#39; || TO_CHAR1(l_rank_null_flag) || &#39;&#39;&#39;,&#10;        p_first_name     &#61;&gt; :p_first_name,&#10;        p_secondname     &#61;&gt; :p_middle_name,&#10;        p_thirdname      &#61;&gt; NULL,&#10;        p_surname        &#61;&gt; :p_last_name,&#10;        p_dob            &#61;&gt; :p_date_Of_Birth,&#10;        p_gender         &#61;&gt; :p_gender,&#10;        p_noms_number    &#61;&gt; :p_noms,&#10;        p_pnc_number     &#61;&gt; :p_pnc,&#10;        p_crn            &#61;&gt; :p_crn,&#10;        p_act_firstname  &#61;&gt; A.first_name,&#10;        --&#10;        p_act_preferred_name &#61;&gt; NULL, p_include_preferred_name &#61;&gt; NULL,&#10;        --&#10;        p_act_secondname &#61;&gt; A.second_name,&#10;        p_act_thirdname  &#61;&gt; A.third_name,&#10;        p_act_surname    &#61;&gt; A.surname,&#10;        p_act_dob        &#61;&gt; A.date_of_birth_date,&#10;        p_act_gender     &#61;&gt; A.gender_id,&#10;        p_act_noms_number&#61;&gt; NULL,&#10;        p_act_pnc_number &#61;&gt; NULL,&#10;        p_act_crn        &#61;&gt; NULL,&#10;        p_act_offender_id&#61;&gt; O.offender_id,&#10;        p_disposal       &#61;&gt; &#39; || CASE WHEN l_soundex_search_flag OR l_wildcard_last_name_flag /*OR l_wildcard_first_name_flag*/ OR l_exact_flag THEN &#39;O.current_disposal&#39; ELSE &#39;NULL&#39; END || &#39;,&#10;        p_alias          &#61;&gt; &#39;&#39;A&#39;&#39;,&#10;        --&#10;        p_oth_ai_matches &#61;&gt; NULL&#10;    ) AS rank,&#10;    --&#10;    PKG_OFF_NAT_SEARCH.funcGetRankDetails(O.offender_id) AS rank_details&#10;    --&#10;  FROM&#10;    offender O&#10;      INNER JOIN r_standard_reference_list RG ON RG.standard_reference_list_id &#61; O.gender_id&#10;      INNER JOIN offender_manager OM ON OM.offender_id &#61; O.offender_id AND OM.active_flag &#61; 1&#10;        INNER JOIN officer S ON S.trust_provider_flag &#61; OM.trust_provider_flag AND S.staff_employee_id &#61; OM.staff_employee_id&#10;        INNER JOIN probation_area PA ON PA.probation_area_id &#61; OM.probation_area_id&#10;      INNER JOIN alias A ON A.offender_id &#61; O.offender_id&#10;  WHERE &#39; || CASE WHEN l_alias_flag THEN &#39;1&#61;1&#39; ELSE &#39;1&lt;&gt;1 /*switch ALIAS sub-union OFF*/&#39; END || &#39;&#10;    AND O.soft_deleted &#61; 0&#10;    AND A.soft_deleted &#61; 0&#10;    --&#10;    -- Access Statement&#10;    --&#10;    AND &#39; || CASE&#10;               WHEN l_exact_last_name_flag    THEN&#10;                 &#39;SUBSTR(LOWER(A.surname), 1, 1) &#61; SUBSTR(LOWER(:p_last_name), 1, 1)&#39;&#10;               WHEN l_wildcard_last_name_flag THEN&#10;                 &#39;SUBSTR(LOWER(A.surname), 1, 2) &#61; SUBSTR(LOWER(:p_last_name), 1, 2)&#39;&#10;               WHEN l_soundex_search_flag THEN&#10;                 &#39;A.surname_soundex &#61; SOUNDEX(:p_last_name)&#39;&#10;               ELSE&#10;                &#39;PKG_Common.NVLSTR(:p_last_name, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;             END || &#39;&#10;    --&#10;    AND &#39; || CASE WHEN l_date_of_birth IS NOT NULL AND NVLSTR(p_dob_ranking_flag, &#39;Y&#39;) &lt;&gt; &#39;Y&#39;&#10;             THEN &#39;A.date_of_birth_date &#61; :p_dob&#39;&#10;             ELSE &#39;NVL(:p_dob, SYSDATE) IS NOT NULL&#39; END || &#39;&#10;    --&#10;    -- NEW: A Single Character Search for Offender Names (A)&#10;    --&#10;    AND &#39; || CASE WHEN l_exact_last_name_flag   THEN &#39;LOWER(A.surname) LIKE LOWER(:p_last_name1)&#39;       ELSE &#39;PKG_Common.NVLSTR(:p_last_name1, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;   END || &#39;&#10;    AND &#39; || CASE WHEN l_exact_first_name_flag  THEN &#39;LOWER(A.first_name) LIKE LOWER(:p_first_name1)&#39;   ELSE &#39;PKG_Common.NVLSTR(:p_first_name1, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;  END || &#39;&#10;    --&#10;    AND &#39; || CASE WHEN l_exact_second_name_flag THEN &#39;( LOWER(A.second_name) LIKE LOWER(:p_second_name1) OR LOWER(A.third_name) LIKE LOWER(:p_third_name1) )&#39; ELSE &#39;PKG_Common.NVLSTR(:p_second_name1 || :p_third_name1, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39; END || &#39;&#10;    --&#10;    -- Filter Statement&#10;    --&#10;   &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; OR l_wildcard_last_name_flag THEN&#10;        --&#10;   &#39;AND &#39; || CASE WHEN PKG_Common.empty2null(p_last_name)  IS NOT NULL THEN &#39;LOWER(A.surname) LIKE LOWER(:p_last_name)  || &#39;&#39;&#39; || l_filter_wildcard || &#39;&#39;&#39;&#39;  ELSE &#39;PKG_Common.empty2null(:p_last_name) IS NULL&#39; END&#10;        --&#10;        ELSE&#10;        --&#10;   &#39;AND PKG_Common.NVLSTR(:p_last_name, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;        END || &#39;&#10;    --&#10;   &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; OR l_wildcard_first_name_flag THEN&#10;        --&#10;   &#39;AND &#39; || CASE WHEN PKG_Common.empty2null(p_first_name)  IS NOT NULL THEN &#39;LOWER(A.first_name) LIKE LOWER(:p_first_name)  || &#39;&#39;&#39; || l_filter_wildcard || &#39;&#39;&#39;&#39;  ELSE &#39;PKG_Common.empty2null(:p_first_name) IS NULL&#39; END&#10;        --&#10;        ELSE&#10;        --&#10;   &#39;AND PKG_Common.NVLSTR(:p_first_name, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;        END || &#39;&#10;    --&#10;   &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; OR l_wildcard_last_name_flag OR l_wildcard_first_name_flag OR l_soundex_search_flag OR l_exact_flag THEN&#10;&#10;   &#39;AND &#39; || CASE WHEN p_gender IS NOT NULL AND NVLSTR(p_gender_ranking_flag, &#39;X&#39;) &lt;&gt; &#39;Y&#39; THEN &#39;A.gender_id &#61; :p_gender&#39; ELSE &#39;NVL(:p_gender, -1) IS NOT NULL&#39; END&#10;        --&#10;        ELSE&#10;        --&#10;   &#39;AND NVL(:p_gender, -1)                 IS NOT NULL&#39;&#10;        --&#10;        END || &#39;&#10;        --&#10;   &#39; || CASE WHEN p_other_identifier_type &#61; &#39;DateOfBirth&#39; THEN&#10;        --&#10;   &#39;AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || A.first_name || &#39;&#39;@&#39;&#39; || A.second_name || &#39;&#39;@&#39;&#39; || A.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(A.first_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.third_name), :p_vx_search1, &#39;&#39;i&#39;&#39; )&#10;    AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || A.first_name || &#39;&#39;@&#39;&#39; || A.second_name || &#39;&#39;@&#39;&#39; || A.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(A.first_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.third_name), :p_vx_search2, &#39;&#39;i&#39;&#39; )&#39;&#10;        --&#10;        WHEN l_wildcard_last_name_flag /*OR l_wildcard_first_name_flag*/ THEN&#10;   &#39;AND PKG_Common.NVLSTR(:p_vx_search1, &#39;&#39;X&#39;&#39;) IS NOT NULL&#10;    AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || A.second_name || &#39;&#39;@&#39;&#39; || A.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(A.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.third_name), :p_vx_search2, &#39;&#39;i&#39;&#39;)&#39;&#10;        --&#10;        WHEN l_soundex_search1_flag OR l_soundex_search2_flag THEN&#10;   &#39;AND REGEXP_LIKE( &#39;&#39;#&#39;&#39; || SOUNDEX(A.first_name), :p_vx_search1, &#39;&#39;i&#39;&#39;)&#10;    AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || A.second_name || &#39;&#39;@&#39;&#39; || A.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(A.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.third_name), :p_vx_search2, &#39;&#39;i&#39;&#39;)&#39;&#10;         --&#10;        WHEN l_soundex_search3_flag THEN&#10;   &#39;AND REGEXP_LIKE( &#39;&#39;@&#39;&#39; || A.first_name || &#39;&#39;@&#39;&#39; || A.second_name || &#39;&#39;@&#39;&#39; || A.third_name || &#39;&#39;#&#39;&#39; || SOUNDEX(A.first_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.second_name) || &#39;&#39;#&#39;&#39; || SOUNDEX(A.third_name), :p_vx_search1, &#39;&#39;i&#39;&#39;)&#10;    AND PKG_Common.NVLSTR(:p_vx_search2, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;         --&#10;        ELSE&#10;        --&#10;   &#39;AND PKG_Common.NVLSTR(:p_vx_search1, &#39;&#39;X&#39;&#39;) IS NOT NULL AND PKG_Common.NVLSTR(:p_vx_search2, &#39;&#39;X&#39;&#39;) IS NOT NULL&#39;&#10;          --&#10;          END || &#39;&#10;         --&#10;  ),&#10;--&#10;-- Resulting Query&#10;--&#10;T1 AS (&#10;  -- Offender sub-query&#10;  SELECT DISTINCT * FROM O1 WHERE 1&#61;1&#10;  --&#10;  --&#10;  -- Alias sub-query&#10;  &#39; || CASE WHEN NOT l_alias_flag THEN &#39;-- L_ALIAS_FLAG is set to FALSE: &#39; END ||&#10;  &#39; UNION SELECT DISTINCT * FROM A1 WHERE A1.offender_id NOT IN ( SELECT offender_id FROM O1 )&#10;  ),&#10;--&#10;-- National Custody Search&#10;--&#10;T2 AS (&#10;  SELECT DISTINCT&#10;    T1.*,&#10;    -- National Custody Search&#39; || CHR(10) ||&#10;        CASE WHEN l_custody_flag THEN&#10;    &#39;CUS.institution_id, I.code AS institution_code, I.description AS institution_name, CUS.location_change_date&#39;&#10;        ELSE&#10;    &#39;NULL AS institution_id, NULL AS institution_code, NULL AS institution_name, NULL AS location_change_date&#39;&#10;        END || &#39;&#10;    --&#10;  FROM&#10;    T1&#39; ||&#10;    --&#10;    CASE WHEN l_custody_flag THEN &#39;&#10;      -- National Custody Search&#10;      INNER JOIN event E ON E.offender_id &#61; T1.offender_id AND E.soft_deleted &#61; 0&#10;        INNER JOIN disposal D ON D.event_id &#61; E.event_id AND D.active_flag &#61; 1 AND D.soft_deleted &#61; 0&#10;          INNER JOIN custody CUS ON CUS.disposal_id &#61; D.disposal_id AND CUS.soft_deleted &#61; 0&#10;            LEFT OUTER JOIN r_institution I ON I.institution_id &#61; CUS.institution_id&#10;            INNER JOIN r_standard_reference_list R ON R.standard_reference_list_id &#61; CUS.custodial_status_id&#10;                                                  AND R.code_value NOT IN (&#10;                                                      --&#39;&#39;-1&#39;&#39; /* Code not found in Migration */,&#10;                                                      --&#39;&#39;A&#39;&#39;  /* Sentenced - In Custody */,&#10;                                                        &#39;&#39;AT&#39;&#39; /* Auto Terminated */,&#10;                                                      --&#39;&#39;B&#39;&#39;  /* Released - On Licence */,&#10;                                                      --&#39;&#39;C&#39;&#39;  /* Recalled */,&#10;                                                      --&#39;&#39;D&#39;&#39;  /* In Custody */,&#10;                                                      --&#39;&#39;I&#39;&#39;  /* In Custody - IRC */,&#10;                                                        &#39;&#39;P&#39;&#39;  /* Post Sentence Supervision */,&#10;                                                      --&#39;&#39;R&#39;&#39;  /* In Custody - RoTL */,&#10;                                                        &#39;&#39;T&#39;&#39;  /* Terminated */ )&#39;&#10;    END || &#39;&#10;  --&#10;  WHERE 1&#61;1&#10;    AND &#39; || CASE WHEN PKG_Common.empty2null(p_trust) IS NOT NULL THEN &#39;trust_code &#61; :p_trust&#39; ELSE &#39;PKG_Common.empty2null(:p_trust) IS NULL&#39; END || &#39;&#10;    AND &#39; || CASE WHEN l_custody_flag AND p_institution_id IS NOT NULL&#10;               THEN &#39;CUS.institution_id &#61; :p_institution_id&#39;&#10;               ELSE &#39;:p_institution_id IS NULL&#39; END || &#39;&#10;    -- Exclude Inactive Cases (1&#61;1 to include)&#10;    AND &#39; || CASE WHEN p_exclude_inactive_flag &#61; &#39;Y&#39;&#10;               THEN &#39;EXISTS( SELECT 1 FROM event E1 INNER JOIN disposal D1 ON D1.event_id &#61; E1.event_id WHERE E1.offender_id &#61; T1.offender_id AND D1.termination_date IS NULL )&#39;&#10;               ELSE &#39;1&#61;1&#39; END || &#39;&#10;  )&#10;--&#10;-- Main Query&#10;--&#10;SELECT DISTINCT&#10;  /*00*/ offender_ID,&#10;  /*01*/ crn,&#10;  /*02*/ first_name,&#10;  /*03*/ second_name,&#10;  /*04*/ third_name,&#10;  /*05*/ surname,&#10;  /*06*/ date_of_birth,&#10;  /*07*/ risk,&#10;  /*08*/ gender,&#10;  /*09*/ current_exclusion,&#10;  /*10*/ current_restriction,&#10;  /*11*/ trust,&#10;  /*12*/ officer_forename,&#10;  /*13*/ officer_forename2,&#10;  /*14*/ officer_surname,&#10;  /*15*/ current_disposal,&#10;  /*16*/ alias_id,&#10;  /*17*/ rank,&#10;  /*18*/ institution_id,&#10;  /*19*/ institution_code,&#10;  /*20*/ institution_name,&#10;  /*21*/ location_change_date,&#10;  /*22*/ noms_number,&#10;  /*23*/ preferred_name,&#10;  /*24*/ TO_NUMBER(PKG_Lookups.funcgetTabRecord(&#10;             p_table       &#61;&gt; &#39;&#39;nsi N INNER JOIN r_nsi_type NT ON NT.nsi_type_id &#61; N.nsi_type_id&#39;&#39;,&#10;             p_data_fld    &#61;&gt; &#39;&#39;1&#39;&#39;,&#10;             p_default_val &#61;&gt; &#39;&#39;0&#39;&#39;,&#10;             p_ref_col     &#61;&gt; &#39;&#39;N.offender_id&#39;&#39;,&#10;             p_ref_val     &#61;&gt; offender_ID,&#10;             p_where       &#61;&gt; &#39;&#39;N.active_flag &#61; 1 AND N.soft_deleted &#61; 0 AND NT.code &#61; :p_nsi_type&#39;&#39;,&#10;             p_bind_var1   &#61;&gt; &#39;&#39;REC&#39;&#39;&#10;         )) AS nsi_active_recall_flag,&#10;  /*25*/ PKG_Lookups.funcgetTabRecord(&#10;             p_table       &#61;&gt; &#39;&#39;event&#39;&#39;,&#10;             p_data_fld    &#61;&gt; &#39;&#39;event_number&#39;&#39;,&#10;             p_ref_col     &#61;&gt; &#39;&#39;offender_id&#39;&#39;,&#10;             p_ref_val     &#61;&gt; offender_ID,&#10;             p_where       &#61;&gt; &#39;&#39;soft_deleted &#61; 0 AND in_breach &#61; 1&#39;&#39;,&#10;             p_all_records &#61;&gt; &#39;&#39;Y&#39;&#39;,&#10;             p_delim       &#61;&gt; &#39;&#39;,&#39;&#39;&#10;         ) AS events_in_breach,&#10;  --&#10;  /*26*/ rank_details&#10;FROM T2&#10;WHERE 1&#61;1&#10;  --AND ROWNUM &lt;&#61; 1 + PKG_Lookups.funcgetNDParameterValue(p_par_name &#61;&gt; &#39;&#39;OFFENDER_SEARCH_MAX_RESULTS&#39;&#39;, p_default_value &#61;&gt; 10)&#10;ORDER BY&#10;  rank               DESC,&#10;  UPPER(surname)     ASC,&#10;  UPPER(first_name)  ASC,&#39; || CASE WHEN p_include_preferred_name &#61; &#39;Y&#39; THEN &#39; UPPER(preferred_name),&#39; END || &#39;&#10;  UPPER(second_name) ASC,&#10;  UPPER(third_name)  ASC,&#10;  current_disposal&#39; || CASE WHEN p_other_identifier_type IN ( &#39;PNCNumber&#39;, &#39;NOMSNumber&#39;, &#39;PrisonerNumber&#39;, &#39;AdditionalIdentifier&#39; ) THEN &#39;&#39; ELSE &#39; DESC&#39; END&#10;;&#10;    --&#10;    l_SQL :&#61;&#10;        REPLACE(&#10;            l_SQL, &#39;@SQL_OFFENDER_NAMES_OTH&#39;,&#10;            CASE WHEN l_lOR_flag &#61; TRUE AND g_o_criteria_flag &#61; FALSE&#10;                THEN &#39;1&lt;&gt;1 AND /*cancel out the dummy bind variable checks WHEN ALL of the (Offender Names, ... and other) are either not specified or are NULL*/&#39;&#10;                ELSE &#39;--&#39;&#10;            END );&#10;    -- dbms_output.put_line(l_sql);&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      --&#10;      --&#10;      -- Offender Identifiers (OI0)&#10;      l_crn,&#10;      -- ADDITIONAL_IDENTIFIER sub-union&#10;      l_crn,&#10;      --&#10;      l_noms_number,&#10;      l_pnc_number,&#10;      l_pnc_number1,&#10;      --&#10;      p_other_identifier,&#10;      --&#10;      -- Offender Names (O0)&#10;      p_last_name,&#10;      l_date_of_birth,&#10;      -- NEW: A Single Character Search for Offender Names&#10;      p_last_name,&#10;      p_first_name, p_first_name,&#10;      p_middle_name,&#10;      p_middle_name,&#10;      -- Filter Statement (O)&#10;      p_last_name,&#10;      p_first_name, p_first_name,&#10;      p_gender,&#10;      -- VX Search (O)&#10;      l_vx_search1,&#10;      l_vx_search2,&#10;      --&#10;      -- Offender Names+Identifiers (O1)&#10;      -- funcRankOffenderName (O1)&#10;      p_first_name,&#10;      p_middle_name,&#10;      p_last_name,&#10;      l_date_of_birth,&#10;      p_gender,&#10;      l_noms_number,&#10;      l_pnc_number,&#10;      l_crn,&#10;      --&#10;      -- ALIAS sub-union&#10;      --&#10;      -- funcRankOffenderName (A)&#10;      p_first_name,&#10;      p_middle_name,&#10;      p_last_name,&#10;      l_date_of_birth,&#10;      p_gender,&#10;      l_noms_number,&#10;      l_pnc_number,&#10;      l_crn,&#10;      -- Access Statement (A)&#10;      p_last_name,&#10;      l_date_of_birth,&#10;      -- NEW: A Single Character Search for Offender Names (A)&#10;      p_last_name,&#10;      p_first_name,&#10;      p_middle_name,&#10;      p_middle_name,&#10;      -- Filter Statement (A)&#10;      p_last_name,&#10;      p_first_name,&#10;      p_gender,&#10;      -- VX Search (A)&#10;      l_vx_search1,&#10;      l_vx_search2,&#10;      --&#10;      -- T2 (Offender Search) sub-query&#10;      p_trust,&#10;      --&#10;      -- National Custody Search&#10;      p_institution_id&#10;    ;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab LIMIT NVL(l_max_rows+1, 10000);&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_row :&#61; l_row + 1;&#10;        --EXIT WHEN l_row &gt; NVL(l_max_rows, 100000);&#10;        --&#10;        --PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;l_tab(l_i).offender_id, p_L1&#61;&gt;l_tab(l_i).L1, p_L2&#61;&gt;l_tab(l_i).L2, p_L3&#61;&gt;l_tab(l_i).L3);&#10;        --&#10;        PIPE ROW (l_tab(l_i));&#10;    END LOOP;&#10;    --&#10;    procDebug(lc_proc || &#39; (&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;        &#39;(mode&#61;&#39;                      || l_search_mode            || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(num_of_rows&#61;&#39;               || l_row                    || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_resultset_limit_flag&#61;&#39;    || p_resultset_limit_flag   || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_max_rows&#61;&#39;                || l_max_rows               || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(off_cache_HITS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;        &#39;(off_cache_MISS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(p_first_name&#61;&#39;              || p_first_name             || &#39;)&#39; ||&#10;        &#39;(p_include_preferred_name&#61;&#39;  || p_include_preferred_name || &#39;)&#39; ||&#10;        &#39;(p_last_name&#61;&#39;               || p_last_name              || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_alias_first_name&#61;&#39;        || p_alias_first_name       || &#39;)&#39; ||&#10;        &#39;(p_alias_second_name&#61;&#39;       || p_alias_second_name      || &#39;)&#39; ||&#10;        &#39;(p_alias_third_name&#61;&#39;        || p_alias_third_name       || &#39;)&#39; ||&#10;        &#39;(p_alias_surname&#61;&#39;           || p_alias_surname          || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_gender&#61;&#39;                  || p_gender                 || &#39;)&#39; ||&#10;        &#39;(p_other_identifier_type&#61;&#39;   || p_other_identifier_type  || &#39;)&#39; ||&#10;        &#39;(p_other_identifier&#61;&#39;        || p_other_identifier       || &#39;)&#39; ||&#10;        &#39;(p_national_search&#61;&#39;         || p_national_search        || &#39;)&#39; ||&#10;        &#39;(p_trust&#61;&#39;                   || p_trust                  || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(p_crn&#61;&#39;                     || p_crn                    || &#39;)&#39; ||&#10;        &#39;(p_noms_number&#61;&#39;             || p_noms_number            || &#39;)&#39; ||&#10;        &#39;(p_pnc_number&#61;&#39;              || p_pnc_number             || &#39;)&#39; ||&#10;        &#39;(p_date_of_birth&#61;&#39;           || p_date_of_birth          || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(p_custodial_search&#61;&#39;        || p_custodial_search       || &#39;)&#39; ||&#10;        &#39;(p_institution_id&#61;&#39;          || p_institution_id         || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(l_crn_via_ai_flag&#61;&#39;         || TO_CHAR1(l_crn_via_ai_flag)         || &#39;)&#39; ||&#10;        &#39;(l_ai_flag&#61;&#39;                 || TO_CHAR1(l_ai_flag)                 || &#39;)&#39; ||&#10;        --&#10;        &#39;(l_alias_criteria_flag&#61;&#39;     || TO_CHAR1(l_alias_criteria_flag)     || &#39;)&#39; ||&#10;        &#39;(l_alias_flag&#61;&#39;              || TO_CHAR1(l_alias_flag)              || &#39;)&#39; ||&#10;        &#39;(l_custody_flag&#61;&#39;            || TO_CHAR1(l_custody_flag)            || &#39;)&#39; ||&#10;        &#39;(l_wildcard_last_name_flag&#61;&#39; || TO_CHAR1(l_wildcard_last_name_flag) || &#39;)&#39; ||&#10;        &#39;(l_wildcard_first_name_flag&#61;&#39;|| TO_CHAR1(l_wildcard_first_name_flag)|| &#39;)&#39; ||&#10;        &#39;(l_soundex_search1_flag&#61;&#39;    || TO_CHAR1(l_soundex_search1_flag)    || &#39;)&#39; ||&#10;        &#39;(l_soundex_search2_flag&#61;&#39;    || TO_CHAR1(l_soundex_search2_flag)    || &#39;)&#39; ||&#10;        &#39;(l_soundex_search3_flag&#61;&#39;    || TO_CHAR1(l_soundex_search3_flag)    || &#39;)&#39; ||&#10;        --&#10;        &#39;(l_exact_last_name_flag&#61;&#39;    || TO_CHAR1(l_exact_last_name_flag)    || &#39;)&#39; ||&#10;        &#39;(l_exact_first_name_flag&#61;&#39;   || TO_CHAR1(l_exact_first_name_flag)   || &#39;)&#39; ||&#10;        &#39;(l_exact_second_name_flag&#61;&#39;  || TO_CHAR1(l_exact_second_name_flag)  || &#39;)&#39; ||&#10;        &#39;(l_exact_third_name_flag&#61;&#39;   || TO_CHAR1(l_exact_third_name_flag)   || &#39;)&#39; ||&#10;        --&#10;        &#39;(l_filter_wildcard&#61;&#39;         || l_filter_wildcard                   || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        --&#10;        &#39;(l_vx_search1&#61;&#39;               || l_vx_search1                       || &#39;)&#39; ||&#10;        &#39;(l_vx_search2&#61;&#39;               || l_vx_search2                       || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(dob_ranking&#61;&#39;               || p_dob_ranking_flag                  || &#39;)&#39; ||&#10;        &#39;(gender_ranking&#61;&#39;            || p_gender_ranking_flag               || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(LOR_flag&#61;&#39;                  || TO_CHAR1(l_lor_flag)                || &#39;)&#39; ||&#10;        &#39;(o_criteria_flag&#61;&#39;           || TO_CHAR1(g_o_criteria_flag)         || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        l_SQL );&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(lc_proc || &#39; ERROR: &#39; || SQLERRM || CHR(10) ||&#10;        &#39;(mode&#61;&#39;                    || l_search_mode            || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(num_of_rows&#61;&#39;             || l_row                    || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_resultset_limit_flag&#61;&#39;  || p_resultset_limit_flag   || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_max_rows&#61;&#39;              || l_max_rows               || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(off_cache_HITS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;        &#39;(off_cache_MISS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(p_first_name&#61;&#39;              || p_first_name             || &#39;)&#39; ||&#10;        &#39;(p_include_preferred_name&#61;&#39;  || p_include_preferred_name || &#39;)&#39; ||&#10;        &#39;(p_middle_name&#61;&#39;             || p_middle_name            || &#39;)&#39; ||&#10;        &#39;(p_last_name&#61;&#39;               || p_last_name              || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_alias_first_name&#61;&#39;        || p_alias_first_name       || &#39;)&#39; ||&#10;        &#39;(p_alias_second_name&#61;&#39;       || p_alias_second_name      || &#39;)&#39; ||&#10;        &#39;(p_alias_third_name&#61;&#39;        || p_alias_third_name       || &#39;)&#39; ||&#10;        &#39;(p_alias_surname&#61;&#39;           || p_alias_surname          || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_gender&#61;&#39;                  || p_gender                 || &#39;)&#39; ||&#10;        &#39;(p_other_identifier_type&#61;&#39;   || p_other_identifier_type  || &#39;)&#39; ||&#10;        &#39;(p_other_identifier&#61;&#39;        || p_other_identifier       || &#39;)&#39; ||&#10;        &#39;(p_national_search&#61;&#39;         || p_national_search        || &#39;)&#39; ||&#10;        &#39;(p_trust&#61;&#39;                   || p_trust                  || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(p_crn&#61;&#39;                     || p_crn                    || &#39;)&#39; ||&#10;        &#39;(p_noms_number&#61;&#39;             || p_noms_number            || &#39;)&#39; ||&#10;        &#39;(p_pnc_number&#61;&#39;              || p_pnc_number             || &#39;)&#39; ||&#10;        &#39;(p_date_of_birth&#61;&#39;           || p_date_of_birth          || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(p_custodial_search&#61;&#39;        || p_custodial_search       || &#39;)&#39; ||&#10;        &#39;(p_institution_id&#61;&#39;          || p_institution_id         || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(l_crn_via_ai_flag&#61;&#39;         || TO_CHAR1(l_crn_via_ai_flag)         || &#39;)&#39; ||&#10;        &#39;(l_ai_flag&#61;&#39;                 || TO_CHAR1(l_ai_flag)                 || &#39;)&#39; ||&#10;        --&#10;        &#39;(l_alias_criteria_flag&#61;&#39;     || TO_CHAR1(l_alias_criteria_flag)     || &#39;)&#39; ||&#10;        &#39;(l_alias_flag&#61;&#39;              || TO_CHAR1(l_alias_flag)              || &#39;)&#39; ||&#10;        &#39;(l_custody_flag&#61;&#39;            || TO_CHAR1(l_custody_flag)            || &#39;)&#39; ||&#10;        &#39;(l_wildcard_last_name_flag&#61;&#39; || TO_CHAR1(l_wildcard_last_name_flag) || &#39;)&#39; ||&#10;        &#39;(l_wildcard_first_name_flag&#61;&#39;|| TO_CHAR1(l_wildcard_first_name_flag)|| &#39;)&#39; ||&#10;        &#39;(l_soundex_search1_flag&#61;&#39;    || TO_CHAR1(l_soundex_search1_flag)    || &#39;)&#39; ||&#10;        &#39;(l_soundex_search2_flag&#61;&#39;    || TO_CHAR1(l_soundex_search2_flag)    || &#39;)&#39; ||&#10;        &#39;(l_soundex_search3_flag&#61;&#39;    || TO_CHAR1(l_soundex_search3_flag)    || &#39;)&#39; ||&#10;        --&#10;        &#39;(l_exact_last_name_flag&#61;&#39;    || TO_CHAR1(l_exact_last_name_flag)    || &#39;)&#39; ||&#10;        &#39;(l_exact_first_name_flag&#61;&#39;   || TO_CHAR1(l_exact_first_name_flag)   || &#39;)&#39; ||&#10;        &#39;(l_exact_second_name_flag&#61;&#39;  || TO_CHAR1(l_exact_second_name_flag)  || &#39;)&#39; ||&#10;        &#39;(l_exact_third_name_flag&#61;&#39;   || TO_CHAR1(l_exact_third_name_flag)   || &#39;)&#39; ||&#10;        --&#10;        &#39;(l_filter_wildcard&#61;&#39;         || l_filter_wildcard                   || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(l_vx_search1&#61;&#39;              || l_vx_search1                        || &#39;)&#39; ||&#10;        &#39;(l_vx_search2&#61;&#39;              || l_vx_search2                        || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(dob_ranking&#61;&#39;    || p_dob_ranking_flag                             || &#39;)&#39; ||&#10;        &#39;(gender_ranking&#61;&#39; || p_gender_ranking_flag                          || &#39;)&#39; || CHR(10) ||&#10;        --&#10;        &#39;(LOR_flag&#61;&#39;        || TO_CHAR1(l_lor_flag)                          || &#39;)&#39; ||&#10;        &#39;(o_criteria_flag&#61;&#39; || TO_CHAR1(g_o_criteria_flag)                   || &#39;)&#39; ||&#10;        --&#10;        &#39;[&#39; || DBMS_UTILITY.format_error_backtrace         || &#39;]&#39;  || CHR(10) ||&#10;        --&#39;[&#39; || DBMS_UTILITY.format_call_stack      || &#39;]: &#39; || CHR(10) ||&#10;        l_SQL );&#10;    RAISE;&#10;END funcFindOffendersTAB;&#10;--&#10;--&#10;--&#10;-- Description: A procedure for finding offender summary detail feeding a SearchDTO via refcursor&#10;-- Input Paramaters : Passed in from java in the format below&#10;-- Output Parameters : A refcursor with variables names as expected by Java&#10;-- Author : Gordon Stutchbury&#10;-- ----------------------------------------------------------------------------------&#10;FUNCTION funcGetOffenderSummaryTAB(&#10;    p_offender_id        NUMBER,&#10;    p_national_search    VARCHAR2 )&#10;RETURN ttabOffenderSummary PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_typ  IS REF CURSOR;&#10;    l_cur       l_cur_typ;&#10;    l_SQL       VARCHAR2(32767);&#10;    --&#10;    l_rows      INTEGER :&#61; 0;&#10;    l_tab           ttabOffenderSummary;&#10;    l_rec           trecOffenderSummary;&#10;    l_dummy       VARCHAR2(200);&#10;    p_max_rows  INTEGER :&#61; 101;&#10;    --&#10;BEGIN&#10;    l_SQL :&#61;&#10;    --&#10;&#39;SELECT&#10;  /*00*/ OFFENDER.offender_id       AS offenderID,&#10;  /*01*/ ALIAS.first_name           AS aliasFirstName,&#10;  /*02*/ ALIAS.second_name          AS aliasSecondName,&#10;  /*03*/ ALIAS.third_name           AS aliasThirdName,&#10;  /*04*/ ALIAS.surname              AS aliasSurname,&#10;  /*05*/ NULL                       AS buildingName,&#10;  /*06*/ NULL                       AS addressNumber,&#10;  /*07*/ NULL                       AS streetName,&#10;  /*08*/ NULL                       AS district,&#10;  /*09*/ NULL                       AS town,&#10;  /*10*/ NULL                       AS county,&#10;  /*11*/ NULL                       AS postcode,&#10;  /*12*/ OFFENDER.cro_number        AS croNumber,&#10;  /*13*/ OFFENDER.ni_number         AS niNumber,&#10;  /*14*/ OFFENDER.noms_number       AS nomsNumber,&#10;  /*15*/ OFFENDER.pnc_number        AS pncNumber,&#10;  /*16*/ OFFENDER.most_recent_prisoner_number                                                                                      AS prisoner_number,&#10;  /*17*/ ADDITIONAL_IDENTIFIER.identifier                                                                                          AS identifier,&#10;  /*18*/ R_STANDARD_REFERENCE_LIST.code_description                                                                                AS offenderIdentifierType,&#10;  /*19*/ CASE WHEN (OFFENDER.current_disposal) &#61; 1 THEN    &#39;&#39;Y&#39;&#39; ELSE &#39;&#39;N&#39;&#39; END                                                    AS current_flag,&#10;  /*20*/ NULL                                                                                                                      AS transferInProgress,&#10;  /*21*/ NULL                                                                                                                      AS ethnicity,&#10;  /*22*/ NULL                                                                                                                      AS nationality,&#10;  /*23*/ NULL                                                                                                                      AS disabilitiesRecorded,&#10;  /*24*/ R_INSTITUTION.institution_name                                                                                            AS prisonLocation,&#10;  /*25*/ PKG_Common.nvl2(DISTRICT.description, &#39;&#39;&#39;&#39;)                                                                               AS level3,&#10;  /*26*/ ALL_TEAM.description                                                                                                      AS team,&#10;  /*27*/ ALL_TEAM.telephone                                                                                                        AS teamTelephoneNumber,&#10;  /*28*/ CASE WHEN OFFENDER.current_exclusion &#61; 1   THEN PKG_Common.nvl2(OFFENDER.exclusion_message, &#39;&#39;__LAO__&#39;&#39;)   ELSE NULL END  AS laoExclusionMessage,&#10;  /*29*/ CASE WHEN OFFENDER.current_restriction &#61; 1 THEN PKG_Common.nvl2(OFFENDER.restriction_message, &#39;&#39;__LAO__&#39;&#39;) ELSE NULL END  AS laoRestrictionMessage,&#10;  /*30*/ NULL                                                                                                                      AS v_event_number,&#10;  /*31*/ OFFENDER.offender_details,&#10;  /*32*/ PKG_Common.nvl2(BOROUGH.description, &#39;&#39;&#39;&#39;)                                                                                AS level2,&#10;  /*33*/ OFFENDER.ethnicity_description AS ethnicity_description,&#10;  /*34*/ OFFICER.forename AS officer_forename,&#10;  /*35*/ OFFICER.forename2 AS officer_forename2,&#10;  /*36*/ OFFICER.surname AS officer_surname,&#10;  /*37*/ NULL AS preferred_language,&#10;  /*38*/ OFFENDER.disability,&#10;  /*39*/ OFFENDER.learning,&#10;  /*40*/ OFFENDER.mental_health,&#10;  /*41*/ OFFENDER.disability_answer_id,&#10;  /*42*/ OFFENDER.medical_condition_id,&#10;  /*43*/ OFFENDER.additional_needs&#10;FROM&#10;  offender,&#10;  alias,&#10;  offender_manager,&#10;  all_team,&#10;  district,&#10;  borough,&#10;  additional_identifier,&#10;  r_standard_reference_list,&#10;  r_institution,&#10;  officer&#10;WHERE 1&#61;1&#10;  AND OFFENDER.offender_id                                    &#61; :p_offenderid&#10;  AND ALIAS.offender_id(+)                                    &#61; OFFENDER.offender_id&#10;  AND OFFENDER_MANAGER.offender_id                            &#61; OFFENDER.offender_id&#10;  -- PDM v0.39: use ACTIVE_FLAG instead: 1 if NULL ELSE 0&#10;  --OFFENDER_MANAGER.end_date                                 IS NULL&#10;  AND OFFENDER_MANAGER.active_flag                            &#61; 1&#10;  AND ALL_TEAM.trust_provider_flag                            &#61; OFFENDER_MANAGER.trust_provider_flag&#10;  AND ALL_TEAM.trust_provider_team_id                         &#61; OFFENDER_MANAGER.trust_provider_team_id&#10;  AND DISTRICT.district_id(+)                                 &#61; ALL_TEAM.district_id&#10;  AND BOROUGH.borough_id(+)                                   &#61; DISTRICT.borough_id&#10;  AND ADDITIONAL_IDENTIFIER.offender_id(+)                    &#61; OFFENDER.offender_id&#10;  AND R_STANDARD_REFERENCE_LIST.standard_reference_list_id(+) &#61; ADDITIONAL_IDENTIFIER.identifier_name_id&#10;  AND R_INSTITUTION.institution_id(+)                         &#61; OFFENDER.institution_id&#10;  AND OFFICER.staff_employee_id                               &#61; OFFENDER_MANAGER.staff_employee_id&#10;  AND OFFICER.trust_provider_flag                             &#61; OFFENDER_MANAGER.trust_provider_flag&#39;;&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    OPEN l_cur FOR l_SQL USING p_offender_id;&#10;    FETCH l_cur BULK COLLECT INTO l_tab LIMIT p_max_rows;&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_rows :&#61; l_rows + 1;&#10;        EXIT WHEN l_rows &gt; p_max_rows;&#10;        --&#10;        l_rec :&#61; l_tab(l_i);&#10;        --&#10;        procFindMainAddress(&#10;          l_rec.offenderID,&#10;          l_rec.oa_buildingName,&#10;          l_rec.oa_addressNumber,&#10;          l_rec.oa_streetName,&#10;          l_rec.oa_district,&#10;          l_rec.oa_town,&#10;          l_rec.oa_county,&#10;          l_rec.oa_postcode );&#10;        --&#10;        l_rec.transferInProgress :&#61; funcIsTransferInProgress(p_offenderid &#61;&gt; l_rec.offenderID);&#10;        l_rec.ethnicity :&#61; funcFindEthnicity(p_offenderid &#61;&gt; l_rec.offenderID);&#10;        l_rec.nationality :&#61; funcFindNationality(l_rec.offenderID);&#10;        l_rec.preferred_language :&#61; funcFindLanguage(l_rec.offenderID);&#10;        procCurrentlyDisabled(l_rec.offenderID, l_dummy, l_rec.disabilitiesRecorded);&#10;        --&#10;        --l_tab(l_i) :&#61; l_rec;&#10;        --&#10;        PIPE ROW ( l_rec );&#10;        --&#10;    END LOOP;&#10;    --&#10;    procDebug(&#10;        &#39;funcGetOffenderSummaryTAB (rows&#61;&#39; || l_rows  || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;        &#39;(p_offenderid&#61;&#39;      || p_offender_id     || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_national_search&#61;&#39; || p_national_search || &#39;)&#39; || CHR(10) ||&#10;        l_SQL );&#10;    --&#10;    --RETURN l_tab;&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    --&#10;    procDebug(&#10;        &#39;funcGetOffenderSummaryTAB (rows&#61;&#39; || l_rows  || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;        &#39;(p_offenderid&#61;&#39;      || p_offender_id     || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_national_search&#61;&#39; || p_national_search || &#39;)&#39; || CHR(10) ||&#10;        &#39;ERROR: &#39;             || SQLERRM           || CHR(10) ||&#10;        l_SQL );&#10;    --&#10;    RAISE;&#10;    --&#10;END funcGetOffenderSummaryTAB;&#10;&#10;-- Description: A function to identify whether a fender is subject to a transfer&#10;-- Input Paramaters : Passed in from java in the format below&#10;-- Output Parameters : A refcursor with variables names as expected by Java&#10;-- Author : Gordon Stutchbury&#10;-- ----------------------------------------------------------------------------------&#10;FUNCTION funcIsTransferInProgress(p_offenderid NUMBER) RETURN CHAR&#10;IS&#10;    --&#10;    l_num_rows  NUMBER :&#61; 0;&#10;    l_ret_Value CHAR   :&#61; &#39;N&#39;;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT COUNT(1) INTO l_num_rows&#10;    FROM offender_transfer&#10;    WHERE offender_id &#61; p_offenderid&#10;      AND transfer_status_id &#61; PKG_Lookups.funcgetStdRefListID(p_code_set &#61;&gt; &#39;TRANSFER STATUS&#39;, p_code &#61;&gt; &#39;PN&#39;);&#10;    --&#10;    IF l_num_rows &gt; 0 THEN&#10;      l_ret_Value :&#61; &#39;Y&#39; ;&#10;    END IF;&#10;    --&#10;    RETURN l_ret_Value;&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;funcIsTransferInProgress: No rows found&#39;);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;funcIsTransferInProgress: other error: &#39; || SQLCODE || &#39; &#39; || SQLERRM);&#10;END funcIsTransferInProgress;&#10;&#10;-- Description: A function to find an offenders ethnicity&#10;-- Input Paramaters : Offender identity&#10;-- Output Parameters : A description of a prisoners ethnicity&#10;-- Author : Gordon Stutchbury&#10;-- ----------------------------------------------------------------------------------&#10;FUNCTION funcFindEthnicity(p_offenderid NUMBER) RETURN VARCHAR2&#10;IS&#10;    --&#10;    l_code_desc R_STANDARD_REFERENCE_LIST.code_description%TYPE :&#61; &#39;NONE&#39;;&#10;    --&#10;BEGIN&#10;    --&#10;    l_code_desc :&#61; &#39;&#39;;&#10;    --&#10;    SELECT R.code_description INTO l_code_desc&#10;    FROM&#10;      offender O,&#10;      r_standard_reference_list R&#10;    WHERE O.offender_id &#61; p_offenderid&#10;      AND O.ethnicity_id &#61; R.standard_reference_list_id;&#10;    --&#10;    RETURN(l_code_desc);&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;funcFindEthnicity: No rows found&#39;);&#10;        RETURN(l_code_desc);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;funcFindEthnicity: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM);&#10;        RETURN(l_code_desc);&#10;END funcFindEthnicity;&#10;&#10;&#10;-- Description: A function to locate a&#10;-- Input Paramaters : Passed in from java in the format below&#10;-- Output Parameters : A refcursor with variables names as expected by Java&#10;-- Author : Gordon Stutchbury&#10;-- ----------------------------------------------------------------------------------&#10;FUNCTION funcFindNationality(p_offenderid NUMBER) RETURN VARCHAR2&#10;IS&#10;    --&#10;    l_code_desc R_STANDARD_REFERENCE_LIST.code_description%TYPE :&#61; &#39;NONE&#39;;&#10;    --&#10;BEGIN&#10;    --&#10;    l_code_desc :&#61; &#39;&#39;;&#10;    --&#10;    SELECT R.code_description INTO l_code_desc&#10;    FROM&#10;      offender O,&#10;      r_standard_reference_list R&#10;    WHERE O.offender_id &#61; p_offenderid&#10;      AND O.nationality_id &#61; R.standard_reference_list_id;&#10;    --&#10;    RETURN(l_code_desc);&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;funcFindNationality: No rows found&#39;);&#10;        RETURN(l_code_desc);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;funcFindNationality: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM  );&#10;        RETURN(l_code_desc);&#10;END funcFindNationality;&#10;--&#10;FUNCTION funcFindLanguage(p_offenderid NUMBER) RETURN VARCHAR2&#10;IS&#10;    --&#10;    l_code_desc R_STANDARD_REFERENCE_LIST.code_description%TYPE :&#61; &#39;NONE&#39;;&#10;    --&#10;BEGIN&#10;    --&#10;    l_code_desc :&#61; &#39;&#39;;&#10;    --&#10;    SELECT R.code_description INTO l_code_desc&#10;    FROM&#10;      offender O,&#10;      r_standard_reference_list R&#10;    WHERE O.offender_id &#61; p_offenderid&#10;      AND O.language_id &#61; R.standard_reference_list_id;&#10;    --&#10;    RETURN(l_code_desc);&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;funcFindLanguage: No rows found&#39;);&#10;        RETURN(l_code_desc);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;funcFindLanguage: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM);&#10;        RETURN(l_code_desc);&#10;END funcFindLanguage;&#10;--&#10;PROCEDURE procCurrentlyDisabled(p_offenderid NUMBER, p_disabilityDesc OUT NOCOPY NUMBER, p_isDisabled OUT NOCOPY CHAR) IS&#10;BEGIN&#10;    --&#10;    p_disabilityDesc :&#61; 0;&#10;    p_isDisabled :&#61; &#39;N&#39;;&#10;    -- take for granted that the offender_id is in the offender table, so we miss out a join&#10;    SELECT DISTINCT COUNT(1) INTO p_disabilityDesc&#10;    FROM&#10;      disability D,&#10;      r_standard_reference_list R&#10;    WHERE D.offender_id &#61; p_offenderid&#10;      AND D.finish_date IS NULL&#10;      AND D.disability_type_id &#61; R.standard_reference_list_id&#10;      AND R.reference_data_master_id &#61;&#10;          PKG_Lookups.funcgetTabRecord_CACHED(&#10;              p_table &#61;&gt; &#39;R_REFERENCE_DATA_MASTER&#39;,&#10;              p_data_fld &#61;&gt; &#39;REFERENCE_DATA_MASTER_ID&#39;,&#10;              p_ref_col &#61;&gt; &#39;code_set_name&#39;,&#10;              p_ref_val &#61;&gt; &#39;DISABILITY TYPE&#39; );&#10;    --&#10;    IF p_disabilityDesc &gt; 0 THEN&#10;        p_isDisabled :&#61; &#39;Y&#39;;&#10;    END IF;&#10;   -- Do not raise an error on failure data issues get handled in the caller&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;procCurrentlyDisabled: No rows found&#39;);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;procCurrentlyDisabled: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM  );&#10;END procCurrentlyDisabled;&#10;&#10;-- Description  : A function to locate an offenders descriptive detail&#10;--              : Note if an offender has no events we can&#39;t locate any further details&#10;--              : so return values will be null&#10;-- Input Paramaters : Offender id Passed in from java in the format below&#10;-- Output Parameters : Parameters below&#10;-- Author : Gordon Stutchbury&#10;-- ----------------------------------------------------------------------------------&#10;PROCEDURE procFindDescription(&#10;    p_offenderid          NUMBER,&#10;    p_district            OUT NOCOPY DISTRICT.description%type,&#10;    p_telephone           OUT NOCOPY TEAM.telephone%TYPE,&#10;    p_trust               OUT NOCOPY PROBATION_AREA.description%TYPE,&#10;    p_eventnum            OUT NOCOPY EVENT.event_number%TYPE,&#10;    p_eventReferralDate   OUT NOCOPY DATE,&#10;    p_eventType           OUT NOCOPY VARCHAR2,&#10;    p_disposalLength      OUT NOCOPY DISPOSAL.length%TYPE,&#10;    p_disposalDate        OUT NOCOPY DATE,&#10;    p_releaseDate         OUT NOCOPY DATE,&#10;    p_dispTerminationDate OUT NOCOPY DATE,&#10;    p_teamDesc            OUT NOCOPY TEAM.description%TYPE,&#10;    p_forename            OUT NOCOPY USER_.forename%TYPE,&#10;    p_forename2           OUT NOCOPY USER_.forename2%TYPE,&#10;    p_surname             OUT NOCOPY USER_.surname%TYPE )&#10;IS&#10;BEGIN&#10;    --&#10;    WITH T AS (&#10;     SELECT&#10;       DISTRICT.description AS ddescription,&#10;       TEAM.telephone,&#10;       PROBATION_AREA.description AS pdescription,&#10;       EVENT.event_number,&#10;       EVENT.referral_date,&#10;       -- an event is either a disposal or court so one of this IS NOT null&#10;       NVL2(DISPOSAL.event_id, r_disposal_type.description, R_STANDARD_REFERENCE_LIST.code_description) AS descript,&#10;       NVL2(DISPOSAL.event_id, DISPOSAL.length, 0) AS length,&#10;      -- these are NULL if the outer join is empty&#10;      DISPOSAL.disposal_date,&#10;      RELEASE.actual_release_date,&#10;      DISPOSAL.termination_date,&#10;      TEAM.description,&#10;      -- user details come via a provider or a staff member&#10;      USER_.forename,&#10;      USER_.forename2,&#10;      USER_.surname&#10;    FROM&#10;      offender,&#10;      event,&#10;      offender_manager,&#10;      team,&#10;      district,&#10;      disposal,&#10;      court_appearance,&#10;      release,&#10;      custody,&#10;      user_,&#10;      r_standard_reference_list r,&#10;      r_disposal_type,&#10;      r_standard_reference_list,&#10;      probation_area,&#10;      staff,&#10;      restriction,&#10;      exclusion,&#10;      provider_team,&#10;      provider_employee,&#10;      -- find most recent event&#10;      ( SELECT MAX(DISPOSAL.disposal_id) disp_id&#10;        FROM&#10;          disposal,&#10;          event&#10;        WHERE EVENT.soft_deleted &#61; 0&#10;          AND EVENT.offender_id &#61;  p_offenderid&#10;          AND DISPOSAL.event_id &#61; EVENT.event_id ) disp&#10;    WHERE OFFENDER.offender_id &#61; p_offenderid&#10;      AND EVENT.offender_id(+) &#61; OFFENDER.offender_id&#10;      AND DISPOSAL.disposal_id &#61; DISP.disp_id(+)&#10;      AND EVENT.event_id &#61; DISPOSAL.event_id(+)&#10;      AND exclusion.offender_id(+) &#61; OFFENDER.offender_id&#10;      AND restriction.offender_id(+) &#61; OFFENDER.offender_id&#10;      AND EVENT.event_id &#61; court_appearance.event_id(+) -- find current events, disposals or court we already have disposal if it exists&#10;      AND CUSTODY.disposal_id(+) &#61; DISPOSAL.disposal_id&#10;      AND RELEASE.custody_id &#61; CUSTODY.custody_id&#10;      AND OFFENDER.gender_id &#61; r.standard_reference_list_id(+)&#10;      AND -- see disposal below for correlated subquery join&#10;          OFFENDER_MANAGER.offender_id &#61; OFFENDER.offender_id&#10;      AND -- Find the probation description by&#10;         (&#10;           ( OFFENDER_MANAGER.team_id &#61; TEAM.team_id AND TEAM.probation_area_id &#61; PROBATION_AREA.probation_area_id ) OR&#10;           ( OFFENDER_MANAGER.provider_team_id &#61; PROVIDER_TEAM.provider_team_id AND PROVIDER_TEAM.probation_area_id &#61; PROBATION_AREA.probation_area_id )&#10;         )&#10;      AND -- Note the team has a district but the provider_team does not&#10;          DISTRICT.district_id(+) &#61; TEAM.district_id&#10;      AND -- locate the user from one of two staff type&#10;          (&#10;            ( OFFENDER_MANAGER.allocation_staff_id &#61; staff.staff_id(+) ) AND&#10;            ( OFFENDER_MANAGER.provider_employee_id &#61; provider_employee.provider_employee_id(+) )&#10;          )&#10;&#10;    )&#10;    --&#10;    SELECT&#10;      ddescription,&#10;      telephone,&#10;      pdescription,&#10;      event_number,&#10;      referral_date,&#10;      descript,&#10;      length,&#10;      disposal_date,&#10;      actual_release_date,&#10;      termination_date,&#10;      description,&#10;      forename,&#10;      forename2,&#10;      surname&#10;    INTO&#10;      p_district,&#10;      p_telephone,&#10;      p_trust,&#10;      p_eventnum,&#10;      p_eventReferralDate,&#10;      p_eventType,&#10;      p_disposalLength,&#10;      p_disposalDate,&#10;      p_releaseDate,&#10;      p_dispTerminationDate,&#10;      p_teamDesc,&#10;      p_forename,&#10;      p_forename2,&#10;      p_surname&#10;    FROM T&#10;    WHERE rownum &lt; 101;&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;procFindDescription: No rows found&#39;);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;procFindDescription: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM  );&#10;END procFindDescription;&#10;&#10;&#10;-- Description: A function to find a first name and surname from user id&#10;-- Input Paramaters : User id&#10;-- Output Parameters : Initial and Surname eg G Stutchbury, space inbetween&#10;-- Author : Gordon Stutchbury&#10;-- ----------------------------------------------------------------------------------&#10;FUNCTION  funcUserInitialSurname(userid NUMBER) RETURN VARCHAR2&#10;IS&#10;    --&#10;    l_iSurname VARCHAR(50) ;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT SUBSTR(forename, 1, 1) || &#39; &#39; || surname INTO l_iSurname&#10;    FROM user_&#10;    WHERE USER_.user_id &#61; userid;&#10;    --&#10;    RETURN(l_iSurname);&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;funcInitialSurname: No rows found&#39;);&#10;        RETURN(null);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;funcInitialSurname: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM);&#10;        RETURN(null);&#10;END funcUserInitialSurname;&#10;&#10;-- useful unit test routine&#10;PROCEDURE procWildCardFindOffenders(&#10;    p_first_name        OFFENDER.first_name%TYPE,&#10;    p_middle_name       OFFENDER.second_name%TYPE,&#10;    p_last_name         OFFENDER.surname%TYPE,&#10;    p_alias_first_name  ALIAS.first_name%TYPE,&#10;    p_alias_second_name ALIAS.second_name%TYPE,&#10;    p_alias_third_name  ALIAS.third_name%TYPE,&#10;    p_alias_surname     ALIAS.surname%TYPE,&#10;    p_outcursor         IN OUT SYS_REFCURSOR )&#10;IS&#10;    --&#10;    l_wildcard_char CHAR :&#61; &#39;%&#39;;&#10;    --&#10;BEGIN&#10;    --&#10;    IF empty2null(p_first_name) IS NULL AND&#10;       empty2null(p_middle_name) IS NULL AND&#10;       empty2null(p_last_name) IS NULL AND&#10;       empty2null(p_alias_first_name) IS NULL AND&#10;       empty2null(p_alias_second_name) IS NULL AND&#10;       empty2null(p_alias_third_name) IS NULL AND&#10;       empty2null(p_alias_surname) IS NULL&#10;    THEN -- quit&#10;        RAISE_APPLICATION_ERROR(-20003,&#39;All values passed to search are null&#39;);&#10;    END IF;&#10;    --&#10;    -- dbms_output.put_line(&#39;About to search&#39;);&#10;    OPEN p_outcursor FOR&#10;      SELECT /*+ FIRST_ROWS(100) */ o.*&#10;      FROM&#10;        offender O,&#10;        alias&#10;      WHERE 1&#61;1&#10;        AND ( PKG_Common.empty2null(p_first_name)        IS NULL OR ((INSTR(p_first_name,l_wildcard_char) &lt;&gt; 0)        AND LOWER(o.first_name)      LIKE LOWER(p_first_name))        OR ((INSTR(p_first_name,l_wildcard_char) &#61; 0)        AND SOUNDEX(LOWER(o.first_name))      &#61; SOUNDEX(p_first_name))        )&#10;        AND ( PKG_Common.empty2null(p_middle_name)       IS NULL OR ((INSTR(p_middle_name,l_wildcard_char) &lt;&gt; 0)       AND LOWER(o.second_name)     LIKE LOWER(p_middle_name))       OR ((INSTR(p_middle_name,l_wildcard_char) &#61; 0)       AND SOUNDEX(LOWER(o.second_name))     &#61; SOUNDEX(p_middle_name))       )&#10;        AND ( PKG_Common.empty2null(p_last_name)         IS NULL OR ((INSTR(p_last_name,l_wildcard_char) &lt;&gt; 0)         AND LOWER(o.surname)         LIKE LOWER(p_last_name))         OR ((INSTR(p_last_name,l_wildcard_char) &#61; 0)         AND SOUNDEX(LOWER(o.surname))         &#61; SOUNDEX(p_last_name))         )&#10;        AND ( PKG_Common.empty2null(p_alias_first_name)  IS NULL OR ((INSTR(p_alias_first_name,l_wildcard_char) &lt;&gt; 0)  AND LOWER(ALIAS.first_name)  LIKE LOWER(p_alias_first_name))  OR ((INSTR(p_alias_first_name,l_wildcard_char) &#61; 0)  AND SOUNDEX(LOWER(ALIAS.first_name))  &#61; SOUNDEX(p_alias_first_name))  )&#10;        AND ( PKG_Common.empty2null(p_alias_second_name) IS NULL OR ((INSTR(p_alias_second_name,l_wildcard_char) &lt;&gt; 0) AND LOWER(ALIAS.second_name) LIKE LOWER(p_alias_second_name)) OR ((INSTR(p_alias_second_name,l_wildcard_char) &#61; 0) AND SOUNDEX(LOWER(ALIAS.second_name)) &#61; SOUNDEX(p_alias_second_name)) )&#10;        AND ( PKG_Common.empty2null(p_alias_third_name)  IS NULL OR ((INSTR(p_alias_third_name,l_wildcard_char) &lt;&gt; 0)  AND LOWER(ALIAS.third_name)  LIKE LOWER(p_alias_third_name))  OR ((INSTR(p_alias_third_name,l_wildcard_char) &#61; 0)  AND SOUNDEX(LOWER(ALIAS.third_name))  &#61; SOUNDEX(p_alias_third_name))  )&#10;        AND ( PKG_Common.empty2null(p_alias_surname)     IS NULL OR ((INSTR(p_alias_surname,l_wildcard_char) &lt;&gt; 0)     AND LOWER(ALIAS.surname)     LIKE LOWER(p_alias_surname))     OR ((INSTR(p_alias_surname,l_wildcard_char) &#61; 0)     AND SOUNDEX(LOWER(ALIAS.surname))     &#61; SOUNDEX(p_alias_surname))     )&#10;        --&#10;        AND ALIAS.offender_id(+) &#61; o.offender_id&#10;        AND rownum &lt; 101&#10;      ORDER BY&#10;        PKG_Common.NVL2(o.first_name,ALIAS.first_name),&#10;        PKG_Common.NVL2(o.second_name,ALIAS.second_name),&#10;        PKG_Common.NVL2(o.surname,ALIAS.surname);&#10;    --&#10;    -- if you close this cursor the caller cannot use it &#39;invalid cursor&#39; messages occur&#10;    --CLOSE p_outcursor;&#10;&#10;    -- dbms_output.put_line(&#39;Searched&#39;);&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;procWildCardFindOffenders: No rows found&#39;);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;procWildCardFindOffenders: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM);&#10;END procWildCardFindOffenders;&#10;&#10;&#10;-- Description: A function to find the main address for a prisoner&#10;-- Input Paramaters : Offender id&#10;-- Output Parameters : building_name, address_number, street_name, district, town_city, county, postcode&#10;-- Author : David Reid&#10;-- ----------------------------------------------------------------------------------&#10;PROCEDURE  procFindMainAddress(&#10;    p_offenderid     NUMBER,&#10;    p_building_name  OUT offender_address.building_name%TYPE,&#10;    p_address_number OUT offender_address.address_number%TYPE,&#10;    p_street_name    OUT offender_address.street_name%TYPE,&#10;    p_district       OUT offender_address.district%TYPE,&#10;    p_town_city      OUT offender_address.town_city%TYPE,&#10;    p_county         OUT offender_address.county%TYPE,&#10;    p_postcode       OUT offender_address.postcode%TYPE )&#10;IS&#10;BEGIN&#10;    --&#10;    SELECT&#10;      building_name,&#10;      address_number,&#10;      street_name,&#10;      district,&#10;      town_city,&#10;      county,&#10;      postcode&#10;    INTO&#10;      p_building_name,&#10;      p_address_number,&#10;      p_street_name,&#10;      p_district,&#10;      p_town_city,&#10;      p_county,&#10;      p_postcode&#10;    FROM offender_address&#10;    WHERE offender_id &#61; p_offenderid&#10;      AND address_status_id &#61; PKG_Lookups.funcgetStdRefListID( p_code_set &#61;&gt; &#39;ADDRESS STATUS&#39;, p_code &#61;&gt; &#39;M&#39; );&#10;    --&#10;EXCEPTION&#10;    WHEN NO_DATA_FOUND THEN&#10;        procDebug(&#39;procFindMainAddress: No rows found&#39;);&#10;    WHEN OTHERS THEN&#10;        procDebug(&#39;procFindMainAddress: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM);&#10;END procFindMainAddress;&#10;--&#10;--&#10;--&#10;-- Description: A function to Rank a Name against the Search Parameter&#10;-- Input Paramaters : Old and New Parameters&#10;-- Output Parameters : rank (highest is closest match)&#10;-- Author :  Roy Pilmoor&#10;-- ----------------------------------------------------------------------------------&#10;FUNCTION funcGetRankDetails(p_offender_id NUMBER) RETURN VARCHAR2 IS&#10;BEGIN&#10;    --&#10;    RETURN&#10;        --CASE WHEN g_rank_details_rec.offender_id &#61; p_offender_id THEN g_rank_details_rec.rank_details ELSE &#39;&#39; END&#10;        SUBSTR(&#10;            &#39;[act_off_id&#61;&#39; || p_offender_id                   || &#39;]&#39; ||&#10;            &#39;[off_id&#61;&#39;     || g_rank_details_rec.offender_id  || &#39;]&#39; || CHR(10) ||&#10;            &#39;[&#39;            || g_rank_details_rec.rank_details || &#39;]&#39;,&#10;            --&#10;            1, 4000)&#10;      ;&#10;    --&#10;END funcGetRankDetails;&#10;--&#10;FUNCTION funcRankOffenderName(&#10;    p_first_name             OFFENDER.first_name%TYPE,&#10;    p_secondname             OFFENDER.second_name%TYPE,&#10;    p_thirdname              OFFENDER.third_name%TYPE,&#10;    p_surname                OFFENDER.surname%TYPE,&#10;    p_dob                    OFFENDER.date_of_birth_date%TYPE,&#10;    p_gender                 OFFENDER.gender_id%TYPE,&#10;    p_noms_number            OFFENDER.noms_number%TYPE,&#10;    p_pnc_number             OFFENDER.pnc_number%TYPE,&#10;    p_crn                    OFFENDER.crn%TYPE,&#10;    P_act_firstname          OFFENDER.first_name%TYPE,&#10;    p_act_preferred_name     OFFENDER.preferred_name%TYPE,&#10;    p_act_secondname         OFFENDER.second_name%TYPE,&#10;    p_act_thirdname          OFFENDER.third_name%TYPE,&#10;    p_act_surname            OFFENDER.surname%TYPE,&#10;    p_act_dob                OFFENDER.date_of_birth_date%TYPE,&#10;    p_act_gender             OFFENDER.gender_id%TYPE,&#10;    p_act_noms_number        OFFENDER.noms_number%TYPE,&#10;    p_act_pnc_number         OFFENDER.pnc_number%TYPE,&#10;    p_act_crn                OFFENDER.crn%TYPE,&#10;    --&#10;    p_act_offender_id        NUMBER,&#10;    --&#10;    p_disposal               OFFENDER.current_disposal%TYPE,&#10;    p_alias                  CHAR,&#10;    --&#10;    p_oth_ai_matches         INTEGER DEFAULT NULL,&#10;    --&#10;    p_include_preferred_name VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_NULL_flag              VARCHAR2 DEFAULT &#39;N&#39; )&#10;RETURN NUMBER&#10;IS&#10;    --&#10;    l_RANK NUMBER :&#61; 0;&#10;    --&#10;    l_flag BOOLEAN :&#61; FALSE;&#10;    --&#10;    l_first_name       OFFENDER.first_name%TYPE;&#10;    l_second_name      OFFENDER.second_name%TYPE;&#10;    l_third_name       OFFENDER.third_name%TYPE;&#10;    l_surname          OFFENDER.surname%TYPE;&#10;    l_act_first_name   OFFENDER.first_name%TYPE;&#10;    l_act_pref_name    OFFENDER.preferred_name%TYPE;&#10;    l_act_second_name  OFFENDER.second_name%TYPE;&#10;    l_act_third_name   OFFENDER.third_name%TYPE;&#10;    l_act_surname      OFFENDER.surname%TYPE;&#10;    --&#10;    PROCEDURE do_add_RANK(p_sub_RANK NUMBER, p_RANK_name VARCHAR2) IS&#10;    BEGIN&#10;        --&#10;        IF g_rank_details_rec.offender_id IS NULL THEN&#10;            g_rank_details_rec.offender_id :&#61; -1;&#10;        END IF;&#10;        --&#10;        IF p_sub_RANK &lt;&gt; 0 THEN&#10;            --&#10;            l_RANK :&#61; l_RANK + p_sub_RANK;&#10;            --&#10;            IF g_rank_details_rec.offender_id &lt;&gt; p_act_offender_id THEN&#10;                g_rank_details_rec.offender_id :&#61; p_act_offender_id;&#10;                g_rank_details_rec.rank_details :&#61; &#39;&#39;;&#10;            END IF;&#10;            --&#10;            g_rank_details_rec.rank_details :&#61; PKG_LstUtl.concat(g_rank_details_rec.rank_details, p_rank_name || &#39;: &#39; || p_sub_RANK, p_delim&#61;&gt;CHR(10), p_max_len&#61;&gt;4000);&#10;            --&#10;        END IF;&#10;        --&#10;    END do_add_RANK;&#10;    --&#10;BEGIN&#10;    --&#10;    IF p_NULL_flag &#61; &#39;Y&#39; THEN&#10;        RETURN NULL;&#10;    END IF;&#10;    --&#10;    IF p_include_preferred_name &#61; &#39;Y&#39; THEN&#10;        l_flag :&#61; TRUE;&#10;    END IF;&#10;    --&#10;    l_first_name      :&#61; UPPER(p_first_name);&#10;    l_second_name     :&#61; UPPER(p_secondname);&#10;    l_third_name      :&#61; UPPER(p_thirdname);&#10;    l_surname         :&#61; UPPER(p_surname);&#10;    --&#10;    l_act_first_name  :&#61; UPPER(p_act_firstname);&#10;    l_act_pref_name   :&#61; UPPER(p_act_preferred_name);&#10;    l_act_second_name :&#61; UPPER(p_act_secondname);&#10;    l_act_third_name  :&#61; UPPER(p_act_thirdname);&#10;    l_act_surname     :&#61; UPPER(p_act_surname);&#10;    --&#10;    -- Surname Match Length&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN l_surname &#61; l_act_surname                             THEN 10000&#10;            WHEN l_surname &#61; RTRIM(l_act_surname, &#39;S&#39;)                 THEN 9500&#10;            WHEN SUBSTR(l_surname, 1, 9) &#61; SUBSTR(l_act_surname, 1, 9) THEN 9000&#10;            WHEN SUBSTR(l_surname, 1, 8) &#61; SUBSTR(l_act_surname, 1, 8) THEN 9500&#10;            WHEN SUBSTR(l_surname, 1, 7) &#61; SUBSTR(l_act_surname, 1, 7) THEN 8000&#10;            WHEN SUBSTR(l_surname, 1, 6) &#61; SUBSTR(l_act_surname, 1, 6) THEN 8500&#10;            WHEN SUBSTR(l_surname, 1, 5) &#61; SUBSTR(l_act_surname, 1, 5) THEN 7500&#10;            WHEN SUBSTR(l_surname, 1, 4) &#61; SUBSTR(l_act_surname, 1, 4) THEN 6500&#10;            WHEN SUBSTR(l_surname, 1, 3) &#61; SUBSTR(l_act_surname, 1, 3) THEN 5000&#10;            WHEN SUBSTR(l_surname, 1, 2) &#61; SUBSTR(l_act_surname, 1, 2) THEN 2500&#10;            WHEN SUBSTR(l_surname, 1, 1) &#61; SUBSTR(l_act_surname, 1, 1) THEN 2000&#10;            ELSE 0&#10;        END,&#10;        &#39;LAST_NAME&#39; );&#10;&#10;    --Check trailing Characters&#10;    IF SUBSTR(l_surname, 1, -3) &#61; SUBSTR(l_act_surname, 1, -3) THEN&#10;        do_add_RANK( 3000, &#39;LAST_NAME_TRAILING&#39; );&#10;    END IF;&#10;&#10;    -- Firstname Match Length&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN l_first_name &#61; l_act_first_name OR ( l_flag AND l_first_name &#61; l_act_pref_name )                                                         THEN 1000&#10;            WHEN SUBSTR(l_first_name, 1, 5) &#61; SUBSTR(l_act_first_name, 1, 5) OR ( l_flag AND SUBSTR(l_first_name, 1, 5) &#61; SUBSTR(l_act_pref_name, 1, 5) ) THEN 800&#10;            WHEN SUBSTR(l_first_name, 1, 4) &#61; SUBSTR(l_act_first_name, 1, 4) OR ( l_flag AND SUBSTR(l_first_name, 1, 4) &#61; SUBSTR(l_act_pref_name, 1, 4) ) THEN 600&#10;            WHEN SUBSTR(l_first_name, 1, 3) &#61; SUBSTR(l_act_first_name, 1, 3) OR ( l_flag AND SUBSTR(l_first_name, 1, 3) &#61; SUBSTR(l_act_pref_name, 1, 3) ) THEN 400&#10;            WHEN SUBSTR(l_first_name, 1, 2) &#61; SUBSTR(l_act_first_name, 1, 2) OR ( l_flag AND SUBSTR(l_first_name, 1, 2) &#61; SUBSTR(l_act_pref_name, 1, 2) ) THEN 200&#10;            WHEN SUBSTR(l_first_name, 1, 1) &#61; SUBSTR(l_act_first_name, 1, 1) OR ( l_flag AND SUBSTR(l_first_name, 1, 1) &#61; SUBSTR(l_act_pref_name, 1, 1) ) THEN 150&#10;            ELSE 0&#10;        END,&#10;        &#39;FIRST_NAME&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN l_first_name &#61; l_act_second_name                             THEN 800&#10;            WHEN SUBSTR(l_first_name, 1, 5) &#61; SUBSTR(l_act_second_name, 1, 5) THEN 600&#10;            WHEN SUBSTR(l_first_name, 1, 4) &#61; SUBSTR(l_act_second_name, 1, 4) THEN 400&#10;            WHEN SUBSTR(l_first_name, 1, 3) &#61; SUBSTR(l_act_second_name, 1, 3) THEN 300&#10;            WHEN SUBSTR(l_first_name, 1, 2) &#61; SUBSTR(l_act_second_name, 1, 2) THEN 150&#10;            WHEN SUBSTR(l_first_name, 1, 1) &#61; SUBSTR(l_act_second_name, 1, 1) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;FIRST_NAME_2&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN l_first_name &#61; l_act_third_name                             THEN 600&#10;            WHEN SUBSTR(l_first_name, 1, 5) &#61; SUBSTR(l_act_third_name, 1, 5) THEN 400&#10;            WHEN SUBSTR(l_first_name, 1, 4) &#61; SUBSTR(l_act_third_name, 1, 4) THEN 300&#10;            WHEN SUBSTR(l_first_name, 1, 3) &#61; SUBSTR(l_act_third_name, 1, 3) THEN 200&#10;            WHEN SUBSTR(l_first_name, 1, 2) &#61; SUBSTR(l_act_third_name, 1, 2) THEN 100&#10;            WHEN SUBSTR(l_first_name, 1, 1) &#61; SUBSTR(l_act_third_name, 1, 1) THEN 80&#10;            ELSE 0&#10;        END,&#10;        &#39;FIRST_NAME_3&#39; );&#10;&#10;    -- Secondname Match Length&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN l_second_name &#61; l_act_first_name                             THEN 1000&#10;            WHEN SUBSTR(l_second_name, 1, 5) &#61; SUBSTR(l_act_first_name, 1, 5) THEN 800&#10;            WHEN SUBSTR(l_second_name, 1, 4) &#61; SUBSTR(l_act_first_name, 1, 4) THEN 600&#10;            WHEN SUBSTR(l_second_name, 1, 3) &#61; SUBSTR(l_act_first_name, 1, 3) THEN 400&#10;            WHEN SUBSTR(l_second_name, 1, 2) &#61; SUBSTR(l_act_first_name, 1, 2) THEN 200&#10;            WHEN SUBSTR(l_second_name, 1, 1) &#61; SUBSTR(l_act_first_name, 1, 1) THEN 150&#10;            ELSE 0&#10;        END,&#10;        &#39;SECOND_NAME_1&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN l_second_name &#61; l_act_second_name                             THEN 800&#10;            WHEN SUBSTR(l_second_name, 1, 5) &#61; SUBSTR(l_act_second_name, 1, 5) THEN 600&#10;            WHEN SUBSTR(l_second_name, 1, 4) &#61; SUBSTR(l_act_second_name, 1, 4) THEN 400&#10;            WHEN SUBSTR(l_second_name, 1, 3) &#61; SUBSTR(l_act_second_name, 1, 3) THEN 300&#10;            WHEN SUBSTR(l_second_name, 1, 2) &#61; SUBSTR(l_act_second_name, 1, 2) THEN 150&#10;            WHEN SUBSTR(l_second_name, 1, 1) &#61; SUBSTR(l_act_second_name, 1, 1) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;SECOND_NAME&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN l_second_name &#61; l_act_third_name                             THEN 600&#10;            WHEN SUBSTR(l_second_name, 1, 5) &#61; SUBSTR(l_act_third_name, 1, 5) THEN 400&#10;            WHEN SUBSTR(l_second_name, 1, 4) &#61; SUBSTR(l_act_third_name, 1, 4) THEN 300&#10;            WHEN SUBSTR(l_second_name, 1, 3) &#61; SUBSTR(l_act_third_name, 1, 3) THEN 200&#10;            WHEN SUBSTR(l_second_name, 1, 2) &#61; SUBSTR(l_act_third_name, 1, 2) THEN 100&#10;            WHEN SUBSTR(l_second_name, 1, 1) &#61; SUBSTR(l_act_third_name, 1, 1) THEN 80&#10;            ELSE 0&#10;        END,&#10;        &#39;SECOND_NAME_3&#39; );&#10;&#10;    -- Soundex Match on Surname&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN SOUNDEX(l_surname) &#61; SOUNDEX(l_act_surname)                             THEN 6000&#10;            WHEN SOUNDEX(SUBSTR(l_surname, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_surname, 2, 1)) THEN 1000&#10;            WHEN SOUNDEX(SUBSTR(l_surname, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_surname, 2, 2)) THEN 3000&#10;            ELSE  0&#10;        END,&#10;        &#39;SOUNDEX_LAST_NAME&#39; );&#10;&#10;    -- Soundex Match on Fornames&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN SOUNDEX(l_first_name) &#61; SOUNDEX(l_act_first_name) OR ( l_flag AND SOUNDEX(l_first_name) &#61; SOUNDEX(l_act_pref_name) )                                                         THEN 600&#10;            WHEN SOUNDEX(SUBSTR(l_first_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_first_name, 2, 2)) OR ( l_flag AND SOUNDEX(SUBSTR(l_first_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_pref_name, 2, 2)) ) THEN 300&#10;            WHEN SOUNDEX(SUBSTR(l_first_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_first_name, 2, 1)) OR ( l_flag AND SOUNDEX(SUBSTR(l_first_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_pref_name, 2, 1)) ) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;SOUNDEX_FIRST_NAME&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN SOUNDEX(l_first_name) &#61; SOUNDEX(l_act_second_name)                             THEN 400&#10;            WHEN SOUNDEX(SUBSTR(l_first_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_second_name, 2, 2)) THEN 200&#10;            WHEN SOUNDEX(SUBSTR(l_first_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_second_name, 2, 1)) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;SOUNDEX_FIRST_NAME_2&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN SOUNDEX(l_first_name) &#61; SOUNDEX(l_act_third_name)                             THEN 400&#10;            WHEN SOUNDEX(SUBSTR(l_first_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_third_name, 2, 2)) THEN 200&#10;            WHEN SOUNDEX(SUBSTR(l_first_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_third_name, 2, 1)) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;SOUNDEX_FIRST_NAME_3&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN SOUNDEX(l_second_name) &#61; SOUNDEX(l_act_first_name) OR ( l_flag AND SOUNDEX(l_second_name) &#61; SOUNDEX(l_act_pref_name) )                                                         THEN 400&#10;            WHEN SOUNDEX(SUBSTR(l_second_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_first_name, 2, 2)) OR ( l_flag AND SOUNDEX(SUBSTR(l_second_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_pref_name, 2, 2)) ) THEN 200&#10;            WHEN SOUNDEX(SUBSTR(l_second_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_first_name, 2, 1)) OR ( l_flag AND SOUNDEX(SUBSTR(l_second_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_pref_name, 2, 1)) ) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;SOUNDEX_SECOND_NAME_1&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN SOUNDEX(l_second_name) &#61; SOUNDEX(l_act_second_name)                             THEN 600&#10;            WHEN SOUNDEX(SUBSTR(l_second_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_second_name, 2, 2)) THEN 300&#10;            WHEN SOUNDEX(SUBSTR(l_second_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_second_name, 2, 1)) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;SOUNDEX_SECOND_NAME&#39; );&#10;&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN SOUNDEX(l_second_name) &#61; SOUNDEX(l_act_third_name)                             THEN 400&#10;            WHEN SOUNDEX(SUBSTR(l_second_name, 2, 2)) &#61; SOUNDEX(SUBSTR(l_act_third_name, 2, 2)) THEN 200&#10;            WHEN SOUNDEX(SUBSTR(l_second_name, 2, 1)) &#61; SOUNDEX(SUBSTR(l_act_third_name, 2, 1)) THEN 100&#10;            ELSE 0&#10;        END,&#10;        &#39;SOUNDEX_SECOND_NAME_3&#39; );&#10;&#10;    -- Date of Birth Match&#10;    do_add_RANK(&#10;        CASE&#10;            WHEN p_dob &#61; p_act_dob                           THEN 9000&#10;            WHEN TRUNC(p_dob, &#39;MM&#39;) &#61; TRUNC(p_act_dob, &#39;MM&#39;) THEN 1000&#10;            WHEN TRUNC(p_dob, &#39;Y&#39; ) &#61; TRUNC(p_act_dob, &#39;Y&#39; ) THEN 500&#10;            ELSE 0&#10;        END,&#10;        &#39;DOB&#39; );&#10;&#10;    -- Gender&#10;    IF p_gender &#61; p_act_gender THEN&#10;        do_add_RANK( 500, &#39;GENDER&#39; );&#10;    END IF;&#10;&#10;    -- NOMS Number&#10;    IF LOWER(p_noms_number) &#61; LOWER(p_act_noms_number) THEN&#10;        do_add_RANK( 50000, &#39;NOMS_NUMBER&#39; );&#10;    END IF;&#10;&#10;    -- PNC Number&#10;    IF LOWER(p_pnc_number) &#61; LOWER(p_act_pnc_number) THEN&#10;        do_add_RANK( 50000, &#39;PNC_NUMBER&#39; );&#10;    END IF;&#10;&#10;    -- CRN Number&#10;    IF p_crn IS NOT NULL THEN&#10;        --&#10;        IF LOWER(p_crn) &#61; LOWER(p_act_crn) THEN&#10;            --&#10;            do_add_RANK( 1000000, &#39;CRN_NUMBER&#39; );&#10;            --&#10;        ELSE&#10;            --&#10;            DECLARE&#10;                --&#10;                l_found_flag VARCHAR2(1);&#10;                --&#10;            BEGIN&#10;                --&#10;                SELECT &#39;Y&#39; INTO l_found_flag&#10;                FROM dual&#10;                WHERE EXISTS(&#10;                  SELECT 1&#10;                  FROM&#10;                    additional_identifier A2,&#10;                    r_standard_reference_list S&#10;                  WHERE A2.offender_id &#61; p_act_offender_id&#10;                    AND UPPER(A2.identifier) &#61; UPPER(p_crn)&#10;                    AND S.standard_reference_list_id &#61; A2.identifier_name_id&#10;                    AND S.code_value IN (&#10;                        &#39;DOFF&#39; /*duplicate offender CRN*/,&#10;                        &#39;MFCRN&#39; /*Merged From CRN*/,&#10;                        &#39;MTCRN&#39; /*Merged To CRN*/,&#10;                        &#39;PCRN&#39; /*Other Previous CRN*/ )&#10;                    AND A2.soft_deleted &#61; 0 );&#10;                --&#10;                do_add_RANK( 900000, &#39;CRN_NUMBER_1&#39; );&#10;                --&#10;            EXCEPTION WHEN NO_DATA_FOUND THEN&#10;                --&#10;                NULL;&#10;                --&#10;            END;&#10;            --&#10;        END IF;&#10;        --&#10;    END IF;&#10;&#10;    -- CRO/NI/PRN/AI Numbers&#10;    IF p_oth_ai_matches &gt; 0 THEN&#10;        do_add_RANK( 45000, &#39;CRO_NI_PRN_OTH_NUMBER&#39; );&#10;    END IF;&#10;&#10;    -- Current Disposal&#10;    IF p_disposal &#61; 1 THEN&#10;        do_add_RANK( 10, &#39;CURR_DISPOSAL&#39; );&#10;    END IF;&#10;&#10;    IF empty2null(p_alias) IS NOT NULL THEN&#10;        do_add_RANK( -550, &#39;ALIAS&#39; );&#10;    END IF;&#10;    --&#10;--    procDebug(&#39;PKG_OFF_NAT_SEARCH.funcRankOffenderName &#39; ||&#10;--        &#39;(RANK&#61;&#39;              || l_RANK             || &#39;)&#39; || CHR(10) ||&#10;--        &#39;(p_NULL_flag&#61;&#39;       || p_NULL_flag        || &#39;)&#39; ||&#10;--        &#39;(p_first_name&#61;&#39;      || p_first_name       || &#39;)&#39; ||&#10;--        &#39;(p_secondname&#61;&#39;      || p_secondname       || &#39;)&#39; ||&#10;--        &#39;(p_thirdname&#61;&#39;       || p_thirdname        || &#39;)&#39; ||&#10;--        &#39;(p_surname&#61;&#39;         || p_surname          || &#39;)&#39; ||&#10;--        &#39;(p_dob&#61;&#39;             || p_dob              || &#39;)&#39; ||&#10;--        &#39;(p_gender&#61;&#39;          || p_gender           || &#39;)&#39; ||&#10;--        &#39;(p_noms_number&#61;&#39;     || p_noms_number      || &#39;)&#39; ||&#10;--        &#39;(p_pnc_number&#61;&#39;      || p_pnc_number       || &#39;)&#39; ||&#10;--        &#39;(p_crn&#61;&#39;             || p_crn              || &#39;)&#39; || CHR(10) ||&#10;--        --&#10;--        &#39;(p_act_firstname&#61;&#39;   || p_act_firstname    || &#39;)&#39; ||&#10;--        &#39;(p_act_preferred_name&#61;&#39;    || p_act_preferred_name || &#39;)&#39; ||&#10;--        &#39;(p_include_preferred_name&#61;&#39; || p_include_preferred_name || &#39;)&#39; ||&#10;--        &#39;(p_act_secondname&#61;&#39;  || p_act_secondname   || &#39;)&#39; ||&#10;--        &#39;(p_act_thirdname&#61;&#39;   || p_act_thirdname    || &#39;)&#39; ||&#10;--        &#39;(p_act_surname&#61;&#39;     || p_act_surname      || &#39;)&#39; ||&#10;--        &#39;(p_act_dob&#61;&#39;         || p_act_dob          || &#39;)&#39; ||&#10;--        &#39;(p_act_gender&#61;&#39;      || p_act_gender       || &#39;)&#39; ||&#10;--        &#39;(p_act_noms_number&#61;&#39; || p_act_noms_number  || &#39;)&#39; ||&#10;--        &#39;(p_act_pnc_number&#61;&#39;  || p_act_pnc_number   || &#39;)&#39; ||&#10;--        &#39;(p_act_crn&#61;&#39;         || p_act_crn          || &#39;)&#39; ||&#10;--        &#39;(p_act_offender_id&#61;&#39; || p_act_offender_id  || &#39;)&#39; ||&#10;--        &#39;(p_disposal&#61;&#39;        || p_disposal         || &#39;)&#39; ||&#10;--        &#39;(p_alias&#61;&#39;           || p_alias            || &#39;)&#39;&#10;--    );&#10;&#10;    RETURN(l_RANK);&#10;&#10;--EXCEPTION&#10;--    WHEN NO_DATA_FOUND THEN&#10;--        procDebug(&#39;funcRankOffenderName: No Data Found&#39;);&#10;--        RETURN(null);&#10;--    WHEN OTHERS THEN&#10;--        procDebug(&#39;funcRankOffenderName: ERROR: &#39; || SQLCODE || &#39; &#39; || SQLERRM  );&#10;--        RETURN(null);&#10;END funcRankOffenderName;&#10;--&#10;--&#10;--&#10;PROCEDURE generate_nat_search_result (&#10;    p_surname             VARCHAR2,&#10;    p_first_name          VARCHAR2,&#10;    p_second_name         VARCHAR2,&#10;    p_date_of_birth_date  VARCHAR2,&#10;    p_gender_id           VARCHAR2,&#10;    p_crn                 VARCHAR2,&#10;    p_pnc_number          VARCHAR2,&#10;    p_cro_number          VARCHAR2,&#10;    p_noms_number         VARCHAR2,&#10;    p_ni_number           VARCHAR2,&#10;    p_search_request_id   OUT NUMBER )&#10;IS&#10;    PRAGMA AUTONOMOUS_TRANSACTION;&#10;    --&#10;    p_crc_request_id    SPG_SEARCH_REQUEST.crc_search_id%TYPE;&#10;    p_sequence_count    NUMBER;&#10;    p_search_max        NUMBER;&#10;    --&#10;    CURSOR search_params(p_spg_search_request_id NUMBER) IS&#10;      SELECT&#10;        surname,&#10;        first_name,&#10;        second_name,&#10;        date_of_birth_date,&#10;        gender_id,&#10;        crn,&#10;        pnc_number,&#10;        cro_number,&#10;        noms_number,&#10;        ni_number,&#10;        last_updated_user_id,&#10;        spg_search_nil,&#10;        spg_search_count,&#10;        spg_search_excess,&#10;        spg_search_lao&#10;      FROM spg_search_request&#10;      WHERE spg_search_request_id &#61; p_spg_search_request_id;&#10;    --&#10;BEGIN&#10;    --&#10;    SELECT nd_value INTO p_search_max&#10;    FROM nd_parameter&#10;    WHERE nd_parameter &#61; &#39;OFFENDER_SEARCH_MAX_RESULTS&#39;;&#10;    --&#10;    p_search_max :&#61; NVL(p_search_max, 10000);&#10;    --&#10;    p_search_request_id :&#61; spg_search_request_id_seq.NEXTVAL;&#10;    p_crc_request_id :&#61; spg_search_request_id_seq.NEXTVAL;&#10;    --&#10;    INSERT INTO spg_search_request(&#10;      spg_search_request_id,&#10;      crc_search_id,&#10;      surname,&#10;      first_name,&#10;      second_name,&#10;      date_of_birth_date,&#10;      gender_id,&#10;      crn,&#10;      pnc_number,&#10;      cro_number,&#10;      noms_number,&#10;      ni_number,&#10;      last_updated_user_id,&#10;      spg_search_nil,&#10;      spg_search_count,&#10;      spg_search_excess,&#10;      spg_search_lao&#10;    ) VALUES (&#10;      p_search_request_id,&#10;      p_crc_request_id,&#10;      p_surname,&#10;      p_first_name,&#10;      p_second_name,&#10;      p_date_of_birth_date,&#10;      p_gender_id,&#10;      p_crn,&#10;      p_pnc_number,&#10;      p_cro_number,&#10;      p_noms_number,&#10;      p_ni_number,&#10;      1,&#10;      NULL,&#10;      NULL,&#10;      NULL,&#10;      NULL );&#10;    --&#10;    FOR search_param IN search_params(p_search_request_id) LOOP&#10;        --&#10;        INSERT INTO spg_search_offender(&#10;          spg_search_request_id,&#10;          spg_search_sequence,&#10;          offender_id )&#10;        SELECT&#10;          p_search_request_id,&#10;          ROWNUM,&#10;          offender_id&#10;        FROM&#10;          TABLE(&#10;              PKG_SEARCH.funcFindOffendersTAB(&#10;                  p_firstname           &#61;&gt; search_param.first_name,&#10;                  p_middlename          &#61;&gt; search_param.second_name,&#10;                  p_lastname            &#61;&gt; search_param.surname,&#10;                  p_aliasfirstname      &#61;&gt; NULL,&#10;                  p_aliassecondname     &#61;&gt; NULL,&#10;                  p_aliasthirdname      &#61;&gt; NULL,&#10;                  p_aliassurname        &#61;&gt; NULL,&#10;                  p_gender              &#61;&gt; search_param.gender_id,&#10;                  p_otheridentifierType &#61;&gt; NULL,&#10;                  p_otheridentifier     &#61;&gt; NULL,&#10;                  p_nationalsearch      &#61;&gt; &#39;Y&#39;,&#10;                  p_trust               &#61;&gt; NULL,&#10;                  --&#10;                  p_crn                 &#61;&gt; search_param.crn,&#10;                  p_pnc_number          &#61;&gt; search_param.pnc_number,&#10;                  p_date_of_birth       &#61;&gt; search_param.date_of_birth_date ) );&#10;        --&#10;        p_sequence_count :&#61; SQL%ROWCOUNT;&#10;        --&#10;        UPDATE spg_search_request SET&#10;          spg_search_nil &#61; CASE WHEN p_sequence_count &#61; 0 THEN &#39;Y&#39; ELSE &#39;N&#39; END,&#10;          spg_search_count &#61; p_sequence_count,&#10;          spg_search_excess &#61; CASE WHEN p_sequence_count &gt; p_search_max THEN &#39;Y&#39; ELSE &#39;N&#39; END&#10;        WHERE spg_search_request_id &#61; p_search_request_id;&#10;        --&#10;    END LOOP;&#10;    --&#10;    COMMIT;&#10;    --&#10;END generate_nat_search_result;&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;-- Package Body initialisation block&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;BEGIN&#10;    --&#10;    PKG_Global.do_init;&#10;    --&#10;END pkg_off_nat_search;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>