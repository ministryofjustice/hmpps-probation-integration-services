<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>TSTNDA.DELIUS_APP_SCHEMA</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../index.html" class="navbar-brand"><b>TSTNDA</b></a><span class="navbar-brand" style="padding-left: 0">.DELIUS_APP_SCHEMA</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>DELIUS_APP_SCHEMA.PKG_CONTACTLOG</h1><br />
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">PACKAGE BODY PKG_ContactLog&#10;AS&#10;--&#10;--&#10;--&#10;--&#10;&#10;--&#10;-- Global variables&#10;--&#10;g_label VARCHAR2(100);&#10;&#10;g_limit                 NUMBER :&#61; NULL;&#10;&#10;--&#10;--&#10;-- PKG_COMMON wrappers&#10;--&#10;PROCEDURE procDebug(p_msg CLOB) IS&#10;BEGIN&#10;    PKG_Debug.procDebug(p_msg);&#10;END procDebug;&#10;&#10;FUNCTION funcgetDebugMode RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Debug.funcgetDebugMode;&#10;END funcgetDebugMode;&#10;--&#10;PROCEDURE message(p_msg VARCHAR2, p_trace_level INTEGER DEFAULT 0) IS&#10;BEGIN&#10;    PKG_Common.print_message(&#10;        p_msg         &#61;&gt; p_msg,&#10;        p_trace_level &#61;&gt; NVL(p_trace_level, PKG_Common.GC_TRACE_LEVEL),&#10;        p_label       &#61;&gt; g_label );&#10;END message;&#10;--&#10;FUNCTION is_str_empty(p_str VARCHAR2, p_ignore_spaces_and_zeroes VARCHAR2 DEFAULT &#39;N&#39;) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.is_str_empty( p_str, p_ignore_spaces_and_zeroes );&#10;END is_str_empty;&#10;--&#10;FUNCTION empty2null(p_str VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.empty2null(p_str);&#10;END empty2null;&#10;&#10;FUNCTION nvlstr(p_str1 VARCHAR2, p_str2 VARCHAR2) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.NVLSTR(p_str1, p_str2);&#10;END nvlstr;&#10;--&#10;FUNCTION bool_2_char(p_val BOOLEAN) RETURN VARCHAR2 IS&#10;BEGIN&#10;    RETURN PKG_Common.bool_2_char(p_val);&#10;END bool_2_char;&#10;--&#10;PROCEDURE raise_error(p_err_msg VARCHAR2, p_proc VARCHAR2, p_label VARCHAR2 DEFAULT NULL) IS&#10;BEGIN&#10;    PKG_Common.raise_error( p_err_msg, p_proc, p_label );&#10;END raise_error;&#10;--&#10;--&#10;--&#10;&#10;FUNCTION get_default_contact_time(p_contact_time DATE) RETURN DATE IS&#10;BEGIN&#10;    --&#10;    RETURN&#10;        CASE WHEN NVL(p_contact_time, TO_DATE(&#39;19700101 00:00&#39;, &#39;YYYYMMDD HH24:MI&#39;)) &#61; TO_DATE(&#39;19700101 00:00&#39;, &#39;YYYYMMDD HH24:MI&#39;)&#10;        THEN&#10;            TO_DATE(&#39;19700101 &#39; || TO_CHAR(SYSDATE, &#39;HH24:MI:SS&#39;), &#39;YYYYMMDD HH24:MI:SS&#39;)&#10;        ELSE&#10;            p_contact_time&#10;        END;&#10;    --&#10;END get_default_contact_time;&#10;&#10;--&#10;-- Contact List&#10;--&#10;--&#10;-- CONTACT Log List Search procedure&#10;--&#10;FUNCTION procGetContactsTAB(&#10;    p_offenderID           NUMBER,&#10;    p_eventID              NUMBER,&#10;    p_licconID             NUMBER,&#10;    p_rqmntID              NUMBER,&#10;    p_StartDate            DATE,&#10;    p_EndDate              DATE,&#10;    p_filter_type          VARCHAR2,&#10;    p_category             NUMBER,&#10;    p_offenderNsiID        NUMBER,&#10;    p_allOffenderNsi       NUMBER,&#10;    p_eventNsiID           NUMBER,&#10;    p_allEventNsi          NUMBER,&#10;    p_pssRqmntID           NUMBER,&#10;    p_exact_match_flag     VARCHAR2,&#10;    p_exclude_sgc_flag     VARCHAR2,&#10;    --&#10;    /*&#10;    DST-8256 changes:&#10;      - System Generated contacts (If true returns contacts where the contact type has flag System Generated &#61; &#39;Y&#39;, false Returns contacts which are &#39;N&#39; system generated)&#10;&#9;  - Attended (if true return contacts with attended flag &#61; &#39;Y&#39;,  opposite for &#39;N&#39;, if it&#39;s blank contacts with null attended flag only should be returned)&#10;&#9;  - Complied (Same as attended but using the attended flag on the contact table )&#10;      - Outcome Overdue contacts (If true returns contacts where the contact type has Contact_Outcome_flag &#61; &#39;Y&#39; and the contact_outcome_type_id is null, and the contact date is before system date. If it&#39;s false ignore this criteria)&#10;    */&#10;    p_sgc_flag             VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_attended_flag        VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_complied_flag        VARCHAR2 DEFAULT &#39;X&#39;,&#10;    p_outcome_overdue_flag VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_drug_test_view_flag  VARCHAR2 DEFAULT &#39;N&#39;,&#10;    --&#10;    p_max_rows             INTEGER DEFAULT 100000,&#10;    p_limit_rows_flag      VARCHAR2 DEFAULT &#39;Y&#39; )&#10;RETURN ttabContacts PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    l_SQL VARCHAR2(32000);&#10;    --&#10;    --&#10;    l_limit_flag BOOLEAN;&#10;    --&#10;    l_rows NUMBER :&#61; 0;&#10;    l_tab ttabContacts;&#10;    l_rec trecContacts;&#10;    --&#10;    l_all_contacts    BOOLEAN :&#61; FALSE;&#10;    --&#10;    l_contact_type    VARCHAR2(1024);&#10;    l_contact_outcome VARCHAR2(1024);&#10;    l_staff           VARCHAR2(1024);&#10;    l_provider        VARCHAR2(1024);&#10;    l_lc_cat          VARCHAR2(1024);&#10;    l_rqmnt_cat       VARCHAR2(1024);&#10;    l_ad_rqmnt_cat    VARCHAR2(1024);&#10;    l_pss_rqmnt_cat   VARCHAR2(1024);&#10;    --&#10;    TYPE l_rec_EVENT_TYP IS RECORD(&#10;        event_number                 NUMBER,&#10;        disposal_type                VARCHAR2(100),&#10;        disposal_date                DATE,&#10;        latest_court_appearance_date DATE&#10;        );&#10;    TYPE l_tab_EVENT_TYP IS TABLE OF l_rec_EVENT_TYP INDEX BY VARCHAR2(100);&#10;    --&#10;    l_event_id_CHAR VARCHAR2(100);&#10;    l_event_STR     VARCHAR2(200);&#10;    l_tab_EVENT     l_tab_EVENT_TYP;&#10;    l_rec_event     l_rec_EVENT_TYP;&#10;    --&#10;    -- /*32*/ LC.comp_length,&#10;    -- /*40*/ LC.lic_cond_type_main_cat_id,&#10;    -- /*43*/ LC.lic_cond_type_sub_cat_id,&#10;    TYPE l_rec_LC_TYP IS RECORD(&#10;        comp_length               NUMBER,&#10;        lic_cond_type_main_cat_id NUMBER,&#10;        lic_cond_type_sub_cat_id  NUMBER);&#10;    TYPE l_tab_LC_TYP IS TABLE OF l_rec_LC_TYP INDEX BY VARCHAR2(100);&#10;    --&#10;    l_lic_condition_id_CHAR VARCHAR2(100);&#10;    l_lc_STR                VARCHAR2(1024);&#10;    --&#10;    l_rec_LC l_rec_LC_TYP;&#10;    l_tab_LC l_tab_LC_TYP;&#10;    --&#10;    -- /*32*/ RQ.comp_length,&#10;    -- /*41*/ R.rqmnt_type_main_category_id,&#10;    -- /*42*/ R.ad_rqmnt_type_main_category_id,&#10;    -- /*44*/ R.rqmnt_type_sub_category_id,&#10;    -- /*45*/ R.ad_rqmnt_type_sub_category_id&#10;    TYPE l_rec_RQ_TYP IS RECORD(&#10;        comp_length                     NUMBER,&#10;        rqmnt_type_main_category_id     NUMBER,&#10;        ad_rqmnt_type_main_category_id  NUMBER,&#10;        rqmnt_type_sub_category_id      NUMBER,&#10;        ad_rqmnt_type_sub_category_id   NUMBER);&#10;    TYPE l_tab_RQ_TYP IS TABLE OF l_rec_RQ_TYP INDEX BY VARCHAR2(100);&#10;    --&#10;    l_rqmnt_id_CHAR VARCHAR2(100);&#10;    l_rq_STR        VARCHAR2(1024);&#10;    --&#10;    l_rec_RQ l_rec_RQ_TYP;&#10;    l_tab_RQ l_tab_RQ_TYP;&#10;    --&#10;    TYPE l_rec_NSI_TYP IS RECORD(&#10;        nsi_length      NUMBER,&#10;        nsi_type_id     NUMBER,&#10;        nsi_sub_type_id  NUMBER&#10;        );&#10;    TYPE l_tab_NSI_TYP IS TABLE OF l_rec_NSI_TYP INDEX BY VARCHAR2(100);&#10;    --&#10;    l_nsi_id_CHAR VARCHAR2(100);&#10;    l_nsi_STR                VARCHAR2(1024);&#10;    --&#10;    l_tab_NSI     l_tab_NSI_TYP;&#10;    l_rec_nsi     l_rec_NSI_TYP;&#10;    --&#10;    TYPE l_rec_PSS_TYP IS RECORD(&#10;        pss_length      NUMBER,&#10;        PSS_RQMNT_TYPE_MAIN_CAT_ID     NUMBER,&#10;        pss_rqmnt_type_sub_category_id  NUMBER&#10;        );&#10;    TYPE l_tab_PSS_TYP IS TABLE OF l_rec_PSS_TYP INDEX BY VARCHAR2(100);&#10;    --&#10;    l_pss_rqmnt_id_CHAR VARCHAR2(100);&#10;    l_pss_STR                VARCHAR2(1024);&#10;    --&#10;    l_tab_PSS     l_tab_PSS_TYP;&#10;    l_rec_pss     l_rec_PSS_TYP;&#10;    --&#10;    l_off_CNT INTEGER :&#61; 0;&#10;    l_ev_CNT  INTEGER :&#61; 0;&#10;    l_lc_CNT  INTEGER :&#61; 0;&#10;    l_rq_CNT  INTEGER :&#61; 0;&#10;    l_nsi_CNT INTEGER :&#61; 0;&#10;    l_pss_CNT INTEGER :&#61; 0;&#10;    --&#10;    lc_delim CONSTANT VARCHAR2(3) :&#61; &#39;#|#&#39;;&#10;    --&#10;    l_dbg_msg CLOB;&#10;    --&#10;    l_offender_level_FLAG       BOOLEAN :&#61; FALSE;&#10;    l_event_level_FLAG          BOOLEAN :&#61; FALSE;&#10;    l_component_level_FLAG      BOOLEAN :&#61; FALSE;&#10;    --&#10;    l_exclude_offender_nsi_FLAG BOOLEAN :&#61; FALSE;&#10;    l_exclude_event_nsi_FLAG    BOOLEAN :&#61; FALSE;&#10;    --&#10;    l_offender_nsi_only_FLAG    BOOLEAN :&#61; FALSE;&#10;    l_event_nsi_only_FLAG       BOOLEAN :&#61; FALSE;&#10;    --&#10;    lc_FILTER_ALL               CONSTANT VARCHAR2(30) :&#61; &#39;FILTER_ALL&#39;;&#10;    lc_FILTER_OFFENDER_NSI      CONSTANT VARCHAR2(30) :&#61; &#39;FILTER_OFFENDER_NSI&#39;;&#10;    lc_FILTER_EVENT_NSI         CONSTANT VARCHAR2(30) :&#61; &#39;FILTER_EVENT_NSI&#39;;&#10;    lc_FILTER_OFFENDER_CONTACT  CONSTANT VARCHAR2(30) :&#61; &#39;FILTER_OFFENDER_CONTACT&#39;;&#10;    lc_FILTER_EVENT_CONTACT     CONSTANT VARCHAR2(30) :&#61; &#39;FILTER_EVENT_CONTACT&#39;;&#10;    lc_FILTER_COMPONENT_CONTACT CONSTANT VARCHAR2(30) :&#61; &#39;FILTER_COMPONENT_CONTACT&#39;;&#10;    --&#10;    l_filter_type VARCHAR2(30);&#10;    --&#10;    l_exact_match_flag VARCHAR2(1) :&#61; CASE WHEN UPPER(TRIM(p_exact_match_flag)) &#61; &#39;Y&#39; THEN &#39;Y&#39; ELSE &#39;N&#39; END;&#10;    --&#10;BEGIN&#10;    --&#10;    l_filter_type :&#61; NVLSTR(UPPER(TRIM(p_filter_type)), lc_FILTER_ALL);&#10;    --&#10;    IF p_offenderID IS NULL THEN&#10;        raise_application_error(-20001, &#39;Error in procGetContactsTAB: insufficient number of parameters specified (p_offender_ID IS NULL)&#39;);&#10;    ELSIF NVLSTR(l_exact_match_flag, &#39;N&#39;) NOT IN (&#39;Y&#39;, &#39;N&#39;) THEN&#10;        raise_application_error(-20001, &#39;Error in procGetContactsTAB: an invalid parameter value specified (p_exact_match_flag&#61;&#39; || p_exact_match_flag || &#39;)&#39;);&#10;    ELSIF l_filter_type NOT IN (lc_FILTER_ALL, lc_FILTER_OFFENDER_NSI, lc_FILTER_EVENT_NSI, lc_FILTER_OFFENDER_CONTACT, lc_FILTER_EVENT_CONTACT, lc_FILTER_COMPONENT_CONTACT) THEN&#10;        raise_application_error(-20001, &#39;Error in procGetContactsTAB: an invalid parameter value specified (p_filter_type&#61;&#39; || p_filter_type || &#39;)&#39;);&#10;    END IF;&#10;    --&#10;    IF (&#10;         ( l_exact_match_flag &#61; &#39;Y&#39; AND l_filter_type IN( lc_FILTER_ALL/*, lc_FILTER_OFFENDER_CONTACT*/ ) ) OR&#10;         ( l_exact_match_flag &#61; &#39;N&#39; AND l_filter_type NOT IN (lc_FILTER_OFFENDER_CONTACT, lc_FILTER_OFFENDER_NSI, lc_FILTER_EVENT_NSI, lc_FILTER_EVENT_CONTACT, lc_FILTER_COMPONENT_CONTACT) )&#10;       )                        AND&#10;       p_eventID        IS NULL AND&#10;       p_licconID       IS NULL AND&#10;       p_rqmntID        IS NULL AND&#10;       p_offenderNsiID  IS NULL AND&#10;       p_eventNsiID     IS NULL AND&#10;       NVL(p_allOffenderNsi, 0) &#61; 0 AND&#10;       NVL(p_allEventNsi   , 0) &#61; 0&#10;    THEN&#10;        -- A single SQL (all CONTACTS for the specified OFFENDER)&#10;        l_all_contacts :&#61; TRUE;&#10;        --&#10;        l_offender_level_FLAG       :&#61; TRUE;&#10;        l_event_level_FLAG          :&#61; TRUE;&#10;        l_component_level_FLAG      :&#61; TRUE;&#10;        --&#10;        l_exclude_offender_nsi_FLAG :&#61; FALSE;&#10;        l_exclude_event_nsi_FLAG    :&#61; FALSE;&#10;        --&#10;        l_offender_nsi_only_FLAG    :&#61; FALSE;&#10;        l_event_nsi_only_FLAG       :&#61; FALSE;&#10;        --&#10;    ELSE&#10;        --&#10;        l_all_contacts :&#61; FALSE;&#10;        --&#10;        l_offender_level_FLAG :&#61;&#10;            CASE WHEN ( l_exact_match_flag &#61; &#39;Y&#39; AND l_filter_type IN ( lc_FILTER_EVENT_NSI, lc_FILTER_EVENT_CONTACT, lc_FILTER_COMPONENT_CONTACT ) )&#10;                      --( l_exact_match_flag &#61; &#39;N&#39; AND ( 1&#61;1 /*OR p_eventNsiID IS NOT NULL OR p_eventID IS NOT NULL OR p_allEventNsi &#61; 1*/ )        )&#10;                THEN FALSE&#10;                ELSE TRUE&#10;            END;&#10;        --&#10;        l_event_level_FLAG :&#61;&#10;            CASE WHEN ( l_exact_match_flag &#61; &#39;Y&#39; AND l_filter_type IN ( lc_FILTER_OFFENDER_CONTACT, lc_FILTER_OFFENDER_NSI, lc_FILTER_COMPONENT_CONTACT ) )&#10;                      OR&#10;                      ( l_exact_match_flag &#61; &#39;N&#39; AND ( ( l_filter_type IN ( lc_FILTER_OFFENDER_CONTACT ) )&#10;                                                       OR&#10;                                                       ( l_filter_type IN ( lc_FILTER_OFFENDER_NSI )&#10;                                                         AND&#10;                                                         ( p_offenderNsiID IS NOT NULL OR p_allOffenderNsi &#61; 1 )&#10;                                                       )&#10;                                                     )&#10;                      )&#10;                THEN FALSE&#10;                ELSE TRUE&#10;            END;&#10;        --&#10;        l_component_level_FLAG :&#61;&#10;            CASE WHEN ( l_exact_match_flag &#61; &#39;Y&#39; AND l_filter_type IN ( lc_FILTER_OFFENDER_CONTACT, lc_FILTER_OFFENDER_NSI, lc_FILTER_EVENT_NSI, lc_FILTER_EVENT_CONTACT ) )&#10;                      OR&#10;                      ( l_exact_match_flag &#61; &#39;N&#39; AND ( ( l_filter_type IN ( lc_FILTER_OFFENDER_CONTACT ) )&#10;                                                       OR&#10;                                                       ( l_filter_type IN ( lc_FILTER_OFFENDER_NSI, lc_FILTER_EVENT_NSI )&#10;                                                         AND&#10;                                                         ( p_offenderNsiID IS NOT NULL OR&#10;                                                           p_eventNsiID    IS NOT NULL OR&#10;                                                           p_allOffenderNsi &#61; 1        OR&#10;                                                           p_allEventNsi    &#61; 1 )&#10;                                                       )&#10;                                                     )&#10;                      )&#10;                THEN FALSE&#10;                ELSE TRUE&#10;            END;&#10;        --&#10;        l_exclude_offender_nsi_FLAG :&#61;&#10;            CASE WHEN ( l_exact_match_flag &#61; &#39;Y&#39; AND ( NOT ( l_filter_type &#61; lc_FILTER_OFFENDER_NSI /*OR p_allOffenderNsi &#61; 1 OR p_offenderNsiID IS NOT NULL*/ ) ) ) OR&#10;                      ( l_exact_match_flag &#61; &#39;N&#39; AND ( ( l_filter_type IN ( lc_FILTER_OFFENDER_CONTACT ) )&#10;                                                       OR&#10;                                                       ( l_filter_type &#61; lc_FILTER_EVENT_NSI&#10;                                                         AND&#10;                                                         ( p_allEventNsi &#61; 1 OR p_eventNsiID IS NOT NULL )&#10;                                                       )&#10;                                                     )&#10;                      )&#10;                      --DST-1170: Include Offender NSI for Component context search&#10;                      --( l_exact_match_flag &#61; &#39;N&#39; AND ( l_filter_type &#61; lc_FILTER_COMPONENT_CONTACT AND ( p_eventID  IS NOT NULL OR&#10;                      --                                                                                   p_licconID IS NOT NULL OR&#10;                      --                                                                                   p_rqmntID  IS NOT NULL OR&#10;                      --                                                                                   p_pssRqmntID IS NOT NULL ) )                              )&#10;                THEN TRUE&#10;                ELSE FALSE&#10;            END;&#10;        --&#10;        l_exclude_event_nsi_FLAG :&#61;&#10;            CASE WHEN ( l_exact_match_flag &#61; &#39;Y&#39; AND ( NOT ( l_filter_type &#61; lc_FILTER_EVENT_NSI /*OR p_allEventNsi &#61; 1 OR p_eventNsiID IS NOT NULL*/ ) ) )&#10;                      OR&#10;                      ( l_exact_match_flag &#61; &#39;N&#39; AND ( l_filter_type IN ( lc_FILTER_OFFENDER_CONTACT ) )&#10;                        --OR ( l_exact_match_flag &#61; &#39;N&#39; AND ( p_offenderNsiID IS NOT NULL OR p_allOffenderNsi &#61; 1 ) )&#10;                        --OR ( l_exact_match_flag &#61; &#39;N&#39; AND ( l_filter_type &#61; lc_FILTER_COMPONENT_CONTACT )         )&#10;                      )&#10;                THEN TRUE&#10;                ELSE FALSE&#10;            END;&#10;        --&#10;        l_offender_nsi_only_FLAG :&#61;&#10;            CASE WHEN ( l_exact_match_flag &#61; &#39;Y&#39; AND ( l_filter_type &#61; lc_FILTER_OFFENDER_NSI /*OR p_allOffenderNsi &#61; 1*/ ) )&#10;                THEN TRUE&#10;                ELSE FALSE&#10;            END;&#10;        --&#10;        l_event_nsi_only_FLAG :&#61;&#10;            CASE WHEN ( l_exact_match_flag &#61; &#39;Y&#39; AND ( l_filter_type &#61; lc_FILTER_EVENT_NSI /*OR p_allEventNsi &#61; 1*/ ) )&#10;                THEN TRUE&#10;                ELSE FALSE&#10;            END;&#10;        --&#10;    END IF;&#10;    --&#10;    l_SQL :&#61;&#10;&#39;--&#10;-- Initial pre-selected records from CONTACT&#10;WITH C AS (&#10;  SELECT&#10;    /*xx*/ CASE&#10;               WHEN C.event_id IS NULL THEN&#10;                  &#39;&#39;O&#39;&#39;&#10;               WHEN ( C.event_id IS NOT NULL AND (C.lic_condition_id IS NULL AND C.rqmnt_id IS NULL AND C.pss_rqmnt_id IS NULL) ) THEN&#10;                  &#39;&#39;E&#39;&#39;&#10;               WHEN ( C.event_id IS NOT NULL AND (C.lic_condition_id IS NOT NULL OR C.rqmnt_id IS NOT NULL OR C.pss_rqmnt_id IS NOT NULL) ) THEN&#10;                  &#39;&#39;C&#39;&#39;&#10;           END AS contact_level,&#10;    /*00*/ C.offender_id,&#10;    /*01*/ C.row_version,&#10;    /*02*/ C.linked_contact_id,&#10;    /*03*/ C.contact_id,&#10;    /*04*/ C.contact_date,&#10;    /*05*/ C.contact_start_time,&#10;    /*06*/ C.contact_end_time,&#10;    /*07*/ C.contact_type_id,&#10;    /*08*/ NULL contact_type_code,&#10;    /*09*/ NULL contact_type_desc,&#10;    /*10*/ NULL contact_outcome_desc,&#10;    /*11*/ C.contact_outcome_type_id,&#10;    --&#10;    /*12*/ NULL staff_id,&#10;    /*13*/ NULL officer_code,&#10;    /*14*/ NULL staff_forename,&#10;    /*15*/ NULL staff_forename2,&#10;    /*16*/ NULL staff_surname,&#10;    /*17*/ NULL provider_employee_id,&#10;    /*18*/ NULL provider_emp_code,&#10;    /*19*/ NULL provider_emp_forename,&#10;    /*20*/ NULL provider_emp_forename2,&#10;    /*21*/ NULL provider_emp_surname,&#10;    --&#10;    /*22*/ C.EVENT_ID,&#10;    /*23*/ NULL event_number,&#10;    --&#10;    /*24*/ NULL disposal_type,&#10;    --&#10;    /*25*/ C.LIC_CONDITION_ID,&#10;    /*26*/ C.RQMNT_ID,&#10;    --&#10;    /*27*/ NULL comp_main_cat_id,&#10;    /*28*/ NULL comp_main_cat_desc,&#10;    /*29*/ NULL comp_unit_desc,&#10;    /*30*/ NULL comp_sub_id,&#10;    /*31*/ NULL comp_sub_desc,&#10;    /*32*/ NULL comp_length,&#10;    /*33*/ NULL ad_main_cat_id,&#10;    /*34*/ NULL ad_main_cat_desc,&#10;    /*35*/ NULL ad_unit_desc,&#10;    /*36*/ NULL ad_sub_id,&#10;    /*37*/ NULL ad_sub_desc,&#10;    --&#10;    /*38*/ C.trust_provider_flag,&#10;    /*39*/ C.staff_employee_id,&#10;    --&#10;    /*40*/ NULL lic_cond_type_main_cat_id,&#10;    /*41*/ NULL rqmnt_type_main_category_id,&#10;    /*42*/ NULL ad_rqmnt_type_main_category_id,&#10;    --&#10;    /*43*/ NULL lic_cond_type_sub_cat_id,&#10;    /*44*/ NULL rqmnt_type_sub_category_id,&#10;    /*45*/ NULL ad_rqmnt_type_sub_category_id,&#10;    --&#10;    /*46*/ C.attended,&#10;    /*47*/ C.complied,&#10;    /*48*/ C.DOCUMENT_LINKED,&#10;    /*49*/ NULL user_editable,&#10;    --&#10;    /*50*/ C.NSI_ID nsi_id,&#10;    /*51*/ NULL nsi_type_id,&#10;    /*52*/ NULL nsi_type_desc,&#10;    /*53*/ NULL nsi_sub_type_id,&#10;    /*54*/ NULL nsi_sub_type_desc,&#10;    /*55*/ NULL nsi_length,&#10;    /*56*/ NULL nsi_length_unit_desc,&#10;    --&#10;    /*57*/ C.PSS_RQMNT_ID pss_rqmnt_id,&#10;    /*58*/ NULL pss_rqmnt_type_id,&#10;    /*59*/ NULL pss_rqmnt_type_desc,&#10;    /*60*/ NULL pss_rqmnt_sub_type_id,&#10;    /*61*/ NULL pss_rqmnt_sub_type_desc,&#10;    /*62*/ NULL pss_rqmnt_length,&#10;    /*63*/ NULL pss_rqmnt_length_unit_desc,&#10;    --&#10;    /*64*/ NULL sgc_flag,&#10;    /*65*/ created_datetime AS contact_created_datetime,&#10;    --&#10;    /*66*/ NULL disposal_date,&#10;    /*67*/ NULL latest_court_appearance_date,&#10;    /*68*/ C.description,&#10;    /*69*/ NULL drug_test_view,&#10;    /*70*/ NULL drug_view_type,&#10;    /*71*/ C.TABLE_NAME  TABLE_NAME,&#10;    /*72*/ C.PRIMARY_KEY_ID PRIMARY_KEY_ID ,&#10;    /*73*/ NULL document_linked_entity&#10;    --&#10;  FROM CONTACT C&#10;  WHERE 1&#61;1&#10;    AND C.soft_deleted &#61; 0&#10;    AND C.offender_id &#61; :p_offender_ID&#10;    AND C.contact_date BETWEEN TRUNC(:p_Start_Date) AND TRUNC(:p_End_Date) + (1 - 1/24/60/60)&#10;    --&#10;    AND &#39; || CASE WHEN p_category IS NOT NULL THEN&#10;        &#39;EXISTS(SELECT 1 FROM R_contact_typeContact_category WHERE standard_reference_list_id &#61; :p_category AND contact_type_id &#61; C.contact_type_id)&#39;&#10;             ELSE&#10;        &#39;:p_category IS NULL&#39;&#10;             END || &#39;&#10;    --&#39;&#10;  || &#39;&#10;  --&#10;  ),&#10;  --&#10;  -- Three sub-UNION SQL Queries&#10;  --&#10;C_OFF AS (&#10;  -- OFFENDER level CONTACT records for the spefified OFFENDER_ID&#10;  --Include Offender Level NSI&#10;  SELECT&#10;    /*xx*/ C.contact_level,&#10;    /*00*/ C.offender_id,&#10;    /*01*/ C.row_version,&#10;    /*02*/ C.linked_contact_id,&#10;    /*03*/ C.contact_id,&#10;    /*04*/ C.contact_date,&#10;    /*05*/ C.contact_start_time,&#10;    /*06*/ C.contact_end_time,&#10;    /*07*/ C.contact_type_id,&#10;    /*08*/ NULL contact_type_code,&#10;    /*09*/ NULL contact_type_desc,&#10;    /*10*/ NULL contact_outcome_desc,&#10;    /*11*/ C.contact_outcome_type_id,&#10;    --&#10;    /*12*/ NULL staff_id,&#10;    /*13*/ NULL officer_code,&#10;    /*14*/ NULL staff_forename,&#10;    /*15*/ NULL staff_forename2,&#10;    /*16*/ NULL staff_surname,&#10;    /*17*/ NULL provider_employee_id,&#10;    /*18*/ NULL provider_emp_code,&#10;    /*19*/ NULL provider_emp_forename,&#10;    /*20*/ NULL provider_emp_forename2,&#10;    /*21*/ NULL provider_emp_surname,&#10;    --&#10;    /*22*/ NULL EVENT_ID,&#10;    /*23*/ NULL event_number,&#10;    --&#10;    /*24*/ NULL disposal_type,&#10;    --&#10;    /*25*/ NULL LIC_CONDITION_ID,&#10;    /*26*/ NULL RQMNT_ID,&#10;    --&#10;    /*27*/ NULL comp_main_cat_id,&#10;    /*28*/ NULL comp_main_cat_desc,&#10;    /*29*/ NULL comp_unit_desc,&#10;    /*30*/ NULL comp_sub_id,&#10;    /*31*/ NULL comp_sub_desc,&#10;    /*32*/ NULL comp_length,&#10;    /*33*/ NULL ad_main_cat_id,&#10;    /*34*/ NULL ad_main_cat_desc,&#10;    /*35*/ NULL ad_unit_desc,&#10;    /*36*/ NULL ad_sub_id,&#10;    /*37*/ NULL ad_sub_desc,&#10;    --&#10;    /*38*/ C.trust_provider_flag,&#10;    /*39*/ C.staff_employee_id,&#10;    --&#10;    /*40*/ NULL lic_cond_type_main_cat_id,&#10;    /*41*/ NULL rqmnt_type_main_category_id,&#10;    /*42*/ NULL ad_rqmnt_type_main_category_id,&#10;    --&#10;    /*43*/ NULL lic_cond_type_sub_cat_id,&#10;    /*44*/ NULL rqmnt_type_sub_category_id,&#10;    /*45*/ NULL ad_rqmnt_type_sub_category_id,&#10;    --&#10;    /*46*/ C.attended,&#10;    /*47*/ C.complied,&#10;    /*48*/ C.DOCUMENT_LINKED,&#10;    /*49*/ NULL user_editable,&#10;    --&#10;    /*50*/ C.NSI_ID nsi_id,&#10;    /*51*/ NULL nsi_type_id,&#10;    /*52*/ NULL nsi_type_desc,&#10;    /*53*/ NULL nsi_sub_type_id,&#10;    /*54*/ NULL nsi_sub_type_desc,&#10;    /*55*/ NULL nsi_length,&#10;    /*56*/ NULL nsi_length_unit_desc,&#10;    --&#10;    /*57*/ NULL pss_rqmnt_id,&#10;    /*58*/ NULL pss_rqmnt_type_id,&#10;    /*59*/ NULL pss_rqmnt_type_desc,&#10;    /*60*/ NULL pss_rqmnt_sub_type_id,&#10;    /*61*/ NULL pss_rqmnt_sub_type_desc,&#10;    /*62*/ NULL pss_rqmnt_length,&#10;    /*63*/ NULL pss_rqmnt_length_unit_desc,&#10;    --&#10;    /*64*/ NULL sgc_flag,&#10;    /*65*/ contact_created_datetime,&#10;    --&#10;    /*66*/ C.disposal_date,&#10;    /*67*/ C.latest_court_appearance_date,&#10;    /*68*/ C.description,&#10;    /*69*/ NULL drug_test_view,&#10;    /*70*/ NULL drug_view_type,&#10;    /*71*/ C.TABLE_NAME TABLE_NAME,&#10;    /*72*/ C.PRIMARY_KEY_ID PRIMARY_KEY_ID,&#10;    /*73*/ NULL document_linked_entity&#10;&#10;    --&#10;  FROM C&#10;  WHERE 1&#61;1&#10;    -- OFFENDER level contacts only&#10;    AND C.contact_level &#61; &#39;&#39;O&#39;&#39;&#10;    --&#10;    --Offender NSI selected requires filtering - All Offender NSIs&#10;    AND &#39; || CASE WHEN l_offender_nsi_only_FLAG THEN &#39;C.nsi_id IS NOT NULL&#39; ELSE &#39;1&#61;1&#39; END || &#39;&#10;    --Exclude Offender NSI for the filtered search&#10;    AND &#39; || CASE WHEN l_exclude_offender_nsi_FLAG THEN &#39;C.nsi_id IS NULL&#39; ELSE &#39;1&#61;1&#39; END || &#39;&#10;    --Offender NSI selected requires filtering - Specific event NSI&#10;    AND &#39; || CASE WHEN p_offenderNsiID IS NOT NULL THEN&#10;                     CASE WHEN l_exact_match_flag &#61; &#39;Y&#39;&#10;                          THEN &#39;C.nsi_id &#61; :p_offender_NSI_ID&#39;&#10;                          ELSE &#39;(C.nsi_id &#61; :p_offender_NSI_ID OR C.nsi_id IS NULL)&#39;&#10;                     END&#10;                  ELSE &#39;:p_offender_NSI_ID IS NULL&#39;&#10;             END || &#39;&#10;  --&#10;  ),&#10;  --&#10;C_EV AS (&#10;  --&#10;  -- 2nd sub-UNION query: EVENT level CONTACTS (where EVENT_ID IS NOT NULL and both RQMNT_ID and LIC_CONDITION_ID are NULL)&#10;  -- Include Event Level NSI&#10;  SELECT&#10;    /*xx*/ C.contact_level,&#10;    /*00*/ C.offender_id,&#10;    /*01*/ C.row_version,&#10;    /*02*/ C.linked_contact_id,&#10;    /*03*/ C.contact_id,&#10;    /*04*/ C.contact_date,&#10;    /*05*/ C.contact_start_time,&#10;    /*06*/ C.contact_end_time,&#10;    /*07*/ C.contact_type_id,&#10;    /*08*/ NULL contact_type_code,&#10;    /*09*/ NULL contact_type_desc,&#10;    /*10*/ NULL contact_outcome_desc,&#10;    /*11*/ C.contact_outcome_type_id,&#10;    --&#10;    /*12*/ NULL staff_id,&#10;    /*13*/ NULL officer_code,&#10;    /*14*/ NULL staff_forename,&#10;    /*15*/ NULL staff_forename2,&#10;    /*16*/ NULL staff_surname,&#10;    /*17*/ NULL provider_employee_id,&#10;    /*18*/ NULL provider_emp_code,&#10;    /*19*/ NULL provider_emp_forename,&#10;    /*20*/ NULL provider_emp_forename2,&#10;    /*21*/ NULL provider_emp_surname,&#10;    --&#10;    /*22*/ C.EVENT_ID,&#10;    /*23*/ NULL event_number,&#10;    --&#10;    /*24*/ NULL AS disposal_type,&#10;    --&#10;    /*25*/ NULL LIC_CONDITION_ID,&#10;    /*26*/ NULL RQMNT_ID,&#10;    --&#10;    /*27*/ NULL comp_main_cat_id,&#10;    /*28*/ NULL comp_main_cat_desc,&#10;    /*29*/ NULL comp_unit_desc,&#10;    /*30*/ NULL comp_sub_id,&#10;    /*31*/ NULL comp_sub_desc,&#10;    /*32*/ NULL comp_length,&#10;    /*33*/ NULL ad_main_cat_id,&#10;    /*34*/ NULL ad_main_cat_desc,&#10;    /*35*/ NULL ad_unit_desc,&#10;    /*36*/ NULL ad_sub_id,&#10;    /*37*/ NULL ad_sub_desc,&#10;    --&#10;    /*38*/ C.trust_provider_flag,&#10;    /*39*/ C.staff_employee_id,&#10;    --&#10;    /*40*/ NULL lic_cond_type_main_cat_id,&#10;    /*41*/ NULL rqmnt_type_main_category_id,&#10;    /*42*/ NULL ad_rqmnt_type_main_category_id,&#10;    --&#10;    /*43*/ NULL lic_cond_type_sub_cat_id,&#10;    /*44*/ NULL rqmnt_type_sub_category_id,&#10;    /*45*/ NULL ad_rqmnt_type_sub_category_id,&#10;    --&#10;    /*46*/ C.attended,&#10;    /*47*/ C.complied,&#10;    /*48*/ C.DOCUMENT_LINKED,&#10;    /*49*/ NULL user_editable,&#10;    --&#10;    /*50*/ C.NSI_ID nsi_id,&#10;    /*51*/ NULL nsi_type_id,&#10;    /*52*/ NULL nsi_type_desc,&#10;    /*53*/ NULL nsi_sub_type_id,&#10;    /*54*/ NULL nsi_sub_type_desc,&#10;    /*55*/ NULL nsi_length,&#10;    /*56*/ NULL nsi_length_unit_desc,&#10;    --&#10;    /*57*/ NULL pss_rqmnt_id,&#10;    /*58*/ NULL pss_rqmnt_type_id,&#10;    /*59*/ NULL pss_rqmnt_type_desc,&#10;    /*60*/ NULL pss_rqmnt_sub_type_id,&#10;    /*61*/ NULL pss_rqmnt_sub_type_desc,&#10;    /*62*/ NULL pss_rqmnt_length,&#10;    /*63*/ NULL pss_rqmnt_length_unit_desc,&#10;    --&#10;    /*64*/ NULL sgc_flag,&#10;    /*65*/ contact_created_datetime,&#10;    --&#10;    /*66*/ C.disposal_date,&#10;    /*67*/ C.latest_court_appearance_date,&#10;    /*68*/ C.description,&#10;    /*69*/ NULL drug_test_view,&#10;    /*70*/ NULL drug_view_type,&#10;    /*71*/ C.TABLE_NAME TABLE_NAME,&#10;    /*72*/ C.PRIMARY_KEY_ID PRIMARY_KEY_ID,&#10;    /*73*/ NULL document_linked_entity&#10;&#10;    --&#10;  FROM C&#10;  WHERE 1&#61;1&#10;    -- EVENT level contacts only&#10;    AND C.contact_level &#61; &#39;&#39;E&#39;&#39;&#10;    --&#10;    AND &#39; || CASE WHEN p_eventID IS NOT NULL THEN &#39;C.event_id &#61; :p_event_id&#39; ELSE &#39;:p_event_id IS NULL&#39; END || &#39;&#10;    --&#10;    -- Event NSI selected requires filtering - All Event NSIs&#10;    AND &#39; || CASE WHEN l_event_nsi_only_FLAG THEN &#39;C.nsi_id IS NOT NULL&#39; ELSE &#39;1&#61;1&#39; END || &#39;&#10;    --Exclude Event NSI for the filtered search&#10;    AND &#39; || CASE WHEN l_exclude_event_nsi_FLAG THEN &#39;C.nsi_id IS NULL&#39; ELSE &#39;1&#61;1&#39; END || &#39;&#10;    -- Event NSI selected requires filtering - Specific event NSI and parent (just event)&#10;    AND &#39; || CASE WHEN p_eventNsiID IS NOT NULL THEN&#10;                     CASE WHEN l_exact_match_flag &#61; &#39;Y&#39;&#10;                          THEN &#39;C.nsi_id &#61; :p_event_NSI_ID&#39;&#10;                          ELSE &#39;(C.nsi_id &#61; :p_event_NSI_ID OR C.nsi_id IS NULL)&#39;&#10;                     END&#10;                  ELSE &#39;:p_event_NSI_ID IS NULL&#39;&#10;             END || &#39;&#10;    -- Component Level means no NSI&#10;    AND &#39; || CASE WHEN p_rqmntID IS NOT NULL OR p_licconID IS NOT NULL OR p_pssRqmntID IS NOT NULL THEN &#39;C.nsi_id IS NULL&#39; ELSE &#39;1&#61;1&#39; END || &#39;&#10;  --&#10;  ),&#10;  --&#10;C_COMP AS (&#10;  --&#10;  -- 3rd sub-UNION query: RQMNT / LIC_CONDITION / PSS RQMNT level CONTACTS (where EVENT_ID IS NOT NULL and either of RQMNT_ID or LIC_CONDITION_ID or PSS_RQMNT_ID are NOT NULL)&#10;  SELECT&#10;    /*xx*/ C.contact_level,&#10;    /*00*/ C.offender_id,&#10;    /*01*/ C.row_version,&#10;    /*02*/ C.linked_contact_id,&#10;    /*03*/ C.contact_id,&#10;    /*04*/ C.contact_date,&#10;    /*05*/ C.contact_start_time,&#10;    /*06*/ C.contact_end_time,&#10;    /*07*/ C.contact_type_id,&#10;    /*08*/ NULL contact_type_code,&#10;    /*09*/ NULL contact_type_desc,&#10;    /*10*/ null contact_outcome_desc,&#10;    /*11*/ C.contact_outcome_type_id,&#10;    --&#10;    /*12*/ NULL staff_id,&#10;    /*13*/ NULL officer_code,&#10;    /*14*/ NULL staff_forename,&#10;    /*15*/ NULL staff_forename2,&#10;    /*16*/ NULL staff_surname,&#10;    /*17*/ NULL provider_employee_id,&#10;    /*18*/ NULL provider_emp_code,&#10;    /*19*/ NULL provider_emp_forename,&#10;    /*20*/ NULL provider_emp_forename2,&#10;    /*21*/ NULL provider_emp_surname,&#10;    --&#10;    /*22*/ C.EVENT_ID,&#10;    /*23*/ NULL event_number,&#10;    --&#10;    /*24*/ NULL AS disposal_type,&#10;    --&#10;    /*25*/ C.LIC_CONDITION_ID,&#10;    /*26*/ C.RQMNT_ID,&#10;    --&#10;    /*27*/ NULL comp_main_cat_id,&#10;    /*28*/ NULL comp_main_cat_desc,&#10;    /*29*/ NULL comp_unit_desc,&#10;    /*30*/ NULL comp_sub_id,&#10;    /*31*/ NULL comp_sub_desc,&#10;    --&#10;    /*32*/ NULL comp_length,&#10;    /*33*/ NULL ad_main_cat_id,&#10;    /*34*/ NULL ad_main_cat_desc,&#10;    /*35*/ NULL ad_unit_desc,&#10;    /*36*/ NULL ad_sub_id,&#10;    /*37*/ NULL ad_sub_desc,&#10;    --&#10;    --&#10;    /*38*/ C.trust_provider_flag,&#10;    /*39*/ C.staff_employee_id,&#10;    --&#10;    /*40*/ NULL lic_cond_type_main_cat_id,&#10;    /*41*/ NULL rqmnt_type_main_category_id,&#10;    /*42*/ NULL ad_rqmnt_type_main_category_id,&#10;    --&#10;    /*43*/ NULL lic_cond_type_sub_cat_id,&#10;    /*44*/ NULL rqmnt_type_sub_category_id,&#10;    /*45*/ NULL ad_rqmnt_type_sub_category_id,&#10;    --&#10;    /*46*/ C.attended,&#10;    /*47*/ C.complied,&#10;    /*48*/ C.DOCUMENT_LINKED,&#10;    /*49*/ NULL user_editable,&#10;    --&#10;    /*50*/ NULL nsi_id,&#10;    /*51*/ NULL nsi_type_id,&#10;    /*52*/ NULL nsi_type_desc,&#10;    /*53*/ NULL nsi_sub_type_id,&#10;    /*54*/ NULL nsi_sub_type_desc,&#10;    /*55*/ NULL nsi_length,&#10;    /*56*/ NULL nsi_length_unit_desc,&#10;    --&#10;    /*57*/ C.PSS_RQMNT_ID pss_rqmnt_id,&#10;    /*58*/ NULL pss_rqmnt_type_id,&#10;    /*59*/ NULL pss_rqmnt_type_desc,&#10;    /*60*/ NULL pss_rqmnt_sub_type_id,&#10;    /*61*/ NULL pss_rqmnt_sub_type_desc,&#10;    /*62*/ NULL pss_rqmnt_length,&#10;    /*63*/ NULL pss_rqmnt_length_unit_desc,&#10;    --&#10;    /*64*/ NULL sgc_flag,&#10;    /*65*/ contact_created_datetime,&#10;    --&#10;    /*66*/ C.disposal_date,&#10;    /*67*/ C.latest_court_appearance_date,&#10;    /*68*/ C.description,&#10;    /*69*/ NULL drug_test_view,&#10;    /*70*/ NULL drug_view_type,&#10;    /*71*/ C.TABLE_NAME TABLE_NAME,&#10;    /*72*/ C.PRIMARY_KEY_ID PRIMARY_KEY_ID,&#10;    /*73*/ NULL document_linked_entity&#10;&#10;    --&#10;  FROM C&#10;  WHERE 1&#61;1&#10;    -- LC / RQ level contacts only&#10;    AND C.contact_level &#61; &#39;&#39;C&#39;&#39;&#10;    --&#10;    AND &#39; || CASE WHEN p_eventID       IS NOT NULL THEN &#39;C.event_id &#61; :p_event_id&#39;            ELSE &#39;:p_event_id IS NULL&#39;      END || &#39;&#10;    AND &#39; || CASE WHEN p_licconID      IS NOT NULL THEN &#39;C.lic_condition_id &#61; :p_lic_con_ID&#39;  ELSE &#39;:p_lic_con_ID IS NULL&#39;    END || &#39;&#10;    AND &#39; || CASE WHEN p_rqmntID       IS NOT NULL THEN &#39;C.rqmnt_id &#61; :p_rqmnt_ID&#39;            ELSE &#39;:p_rqmnt_ID IS NULL&#39;      END || &#39;&#10;    AND &#39; || CASE WHEN p_pssRqmntID    IS NOT NULL THEN &#39;C.pss_rqmnt_id &#61; :p_pssRqmntID&#39;      ELSE &#39;:p_pss_Rqmnt_ID IS NULL&#39;  END || &#39;&#10;  --&#10;  ),&#10;  --&#10;C1 AS (&#10;  --&#10;  &#39; || PKG_LstUtl.concat(&#10;           CASE WHEN l_offender_level_FLAG  THEN &#39;SELECT * FROM C_OFF&#39;  ELSE NULL END,&#10;           CASE WHEN l_event_level_FLAG     THEN &#39;SELECT * FROM C_EV&#39;   ELSE NULL END,&#10;           CASE WHEN l_component_level_FLAG THEN &#39;SELECT * FROM C_COMP&#39; ELSE NULL END,&#10;           p_delim &#61;&gt; CHR(10) || &#39;UNION ALL&#39; || CHR(10)&#10;       ) || &#39;&#10;  --&#10;  )&#10;--&#10;--&#10;SELECT&#10;  /*xx*/ C1.contact_level,&#10;  /*00*/ offender_id,&#10;  /*01*/ C1.row_version,&#10;  /*02*/ linked_contact_id,&#10;  /*03*/ contact_id,&#10;  /*04*/ contact_date,&#10;  /*05*/ contact_start_time,&#10;  /*06*/ contact_end_time,&#10;  /*07*/ CT.contact_type_id,&#10;  /*08*/ CT.CODE        AS contact_type_code,&#10;  /*09*/ CT.DESCRIPTION AS contact_type_desc,&#10;  /*10*/ null contact_outcome_desc,&#10;  /*11*/ contact_outcome_type_id,&#10;  --&#10;  /*12*/ staff_id,&#10;  /*13*/ officer_code,&#10;  /*14*/ staff_forename,&#10;  /*15*/ staff_forename2,&#10;  /*16*/ staff_surname,&#10;  /*17*/ provider_employee_id,&#10;  /*18*/ provider_emp_code,&#10;  /*19*/ provider_emp_forename,&#10;  /*20*/ provider_emp_forename2,&#10;  /*21*/ provider_emp_surname,&#10;  --&#10;  /*22*/ event_id,&#10;  /*23*/ event_number,&#10;  --&#10;  /*24*/ disposal_type,&#10;  --&#10;  /*25*/ lic_condition_id,&#10;  /*26*/ rqmnt_id,&#10;  --&#10;  /*27*/ comp_main_cat_id,&#10;  /*28*/ comp_main_cat_desc,&#10;  /*29*/ comp_unit_desc,&#10;  /*30*/ comp_sub_id,&#10;  /*31*/ comp_sub_desc,&#10;  --&#10;  /*32*/ comp_length,&#10;  /*33*/ ad_main_cat_id,&#10;  /*34*/ ad_main_cat_desc,&#10;  /*35*/ ad_unit_desc,&#10;  /*36*/ ad_sub_id,&#10;  /*37*/ ad_sub_desc,&#10;  --&#10;  /*38*/ trust_provider_flag,&#10;  /*39*/ staff_employee_id,&#10;  --&#10;  /*40*/ lic_cond_type_main_cat_id,&#10;  /*41*/ rqmnt_type_main_category_id,&#10;  /*42*/ ad_rqmnt_type_main_category_id,&#10;  --&#10;  /*43*/ lic_cond_type_sub_cat_id,&#10;  /*44*/ rqmnt_type_sub_category_id,&#10;  /*45*/ ad_rqmnt_type_sub_category_id,&#10;  --&#10;  /*46*/ attended,&#10;  /*47*/ complied,&#10;  /*48*/ document_linked,&#10;  /*49*/ CT.EDITABLE AS user_editable,&#10;  --&#10;  /*50*/ nsi_id,&#10;  /*51*/ nsi_type_id,&#10;  /*52*/ nsi_type_desc,&#10;  /*53*/ nsi_sub_type_id,&#10;  /*54*/ nsi_sub_type_desc,&#10;  /*55*/ nsi_length,&#10;  /*56*/ nsi_length_unit_desc,&#10;  --&#10;  /*57*/ pss_rqmnt_id,&#10;  /*58*/ pss_rqmnt_type_id,&#10;  /*59*/ pss_rqmnt_type_desc,&#10;  /*60*/ pss_rqmnt_sub_type_id,&#10;  /*61*/ pss_rqmnt_sub_type_desc,&#10;  /*62*/ pss_rqmnt_length,&#10;  /*63*/ pss_rqmnt_length_unit_desc,&#10;  --&#10;  /*64*/ CT.SGC_FLAG AS sgc_flag,&#10;  /*65*/ contact_created_datetime,&#10;  --&#10;  /*66*/ C1.disposal_date,&#10;  /*67*/ C1.latest_court_appearance_date,&#10;  /*68*/ C1.description,&#10;  /*69*/ CT.drug_test_view as drug_test_view,&#10;  /*70*/ CT.drug_view_type as drug_view_type,&#10;  /*71*/ TABLE_NAME ,&#10;  /*72*/ PRIMARY_KEY_ID   ,&#10;  /*73*/ decode( CT.drug_test_view,&#39;&#39;Y&#39;&#39;,decode(PKG_Lookups.funcgetTabRecord(p_table &#61;&gt; &#39;&#39;DOCUMENT&#39;&#39;,&#10;                                         p_ref_col     &#61;&gt; &#39;&#39;PRIMARY_KEY_ID&#39;&#39;,&#10;                                         p_ref_val     &#61;&gt; PRIMARY_KEY_ID,&#10;                                         p_data_fld    &#61;&gt; &#39;&#39;1&#39;&#39;,&#10;                                         p_default_val &#61;&gt; &#39;&#39;0&#39;&#39;,&#10;                                         p_where       &#61;&gt; &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;|| NVL(TABLE_NAME,&#39;&#39;xxx&#39;&#39;) || &#39;&#39;&#39;&#39;&#39;&#39; &#61; TABLE_NAME&#39;&#39;),1,&#39;&#39;Y&#39;&#39;,&#39;&#39;N&#39;&#39;),&#39;&#39;N&#39;&#39;)  document_linked_entity&#10;  --&#10;FROM&#10;  C1&#10;    INNER JOIN r_contact_type CT ON CT.contact_type_id &#61; C1.contact_type_id&#10;WHERE 1&#61;1&#10;&#39; || CASE WHEN UPPER(TRIM(p_exclude_sgc_flag))     &#61; &#39;Y&#39; THEN &#39;  AND NVL(CT.sgc_flag, 0) &#61; 0&#39;    END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_sgc_flag))             &#61; &#39;Y&#39; THEN &#39;  AND NVL(CT.sgc_flag, 0) &#61; 1&#39;    END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_sgc_flag))             &#61; &#39;N&#39; THEN &#39;  AND NVL(CT.sgc_flag, 0) &#61; 0&#39;    END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_attended_flag))        &#61; &#39;Y&#39; THEN &#39;  AND C1.attended &#61; &#39;&#39;Y&#39;&#39;&#39;        END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_attended_flag))        &#61; &#39;N&#39; THEN &#39;  AND C1.attended &#61; &#39;&#39;N&#39;&#39;&#39;        END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_attended_flag))        &#61; &#39;Z&#39; THEN &#39;  AND C1.attended IS NULL&#39;        END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_complied_flag))        &#61; &#39;Y&#39; THEN &#39;  AND C1.complied &#61; &#39;&#39;Y&#39;&#39;&#39;        END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_complied_flag))        &#61; &#39;N&#39; THEN &#39;  AND C1.complied &#61; &#39;&#39;N&#39;&#39;&#39;        END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_complied_flag))        &#61; &#39;Z&#39; THEN &#39;  AND C1.complied IS NULL&#39;        END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_drug_test_view_flag))  &#61; &#39;Y&#39; THEN &#39;  AND CT.drug_test_view &#61; &#39;&#39;Y&#39;&#39;&#39;  END || &#39;&#10;&#39; || CASE WHEN UPPER(TRIM(p_outcome_overdue_flag)) &#61; &#39;Y&#39; THEN &#39;  AND ( CT.contact_outcome_flag &#61; &#39;&#39;Y&#39;&#39; AND C1.contact_outcome_type_id IS NULL AND C1.contact_date &lt; TRUNC(SYSDATE) )&#39;  END || &#39;&#10;  --&#10;ORDER BY&#10;  contact_date DESC,&#10;  NVL(contact_start_time, TO_DATE(&#39;&#39;19700101 00:00&#39;&#39;, &#39;&#39;YYYYMMDD HH24:MI&#39;&#39;)) DESC,&#10;  --contact_start_time DESC,&#10;  contact_created_datetime DESC,&#10;  contact_id DESC&#39;;&#10;    --&#10;    IF PKG_Debug.funcgetDebugMode &#61; 1 THEN&#10;        PKG_Debug.procrecordDbStats_START;&#10;    END IF;&#10;&#10;    OPEN l_cur FOR l_SQL USING&#10;      -- Main CONTACT sub-query&#10;      p_offenderID,&#10;      p_StartDate,&#10;      p_EndDate,&#10;      p_category,&#10;      --&#10;      -- 1st Sub-query: OFFENDER level&#10;      p_offenderNsiID,&#10;      -- 2nd Sub-query: EVENT level&#10;      p_eventID,&#10;      p_eventNsiID,&#10;      --&#10;      -- 3rd Sub-query: RQMNT/LC level&#10;      p_eventID,&#10;      p_licconID,&#10;      p_rqmntID,&#10;      p_pssRqmntID;&#10;    --&#10;    IF p_limit_rows_flag &#61; &#39;N&#39; THEN&#10;        l_limit_flag :&#61; FALSE;&#10;    ELSE&#10;        l_limit_flag :&#61; TRUE;&#10;    END IF;&#10;    --&#10;    IF l_limit_flag THEN&#10;        FETCH l_cur BULK COLLECT INTO l_tab LIMIT p_max_rows;&#10;    ELSE&#10;        FETCH l_cur BULK COLLECT INTO l_tab;&#10;    END IF;&#10;    CLOSE l_cur;&#10;    --&#10;    IF PKG_Debug.funcgetDebugMode &#61; 1 THEN&#10;        l_dbg_msg :&#61;&#10;            &#39;procGetContactsTAB (step1)&#39; || &#39;(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;            &#39;(p_offenderID&#61;&#39;        || p_offenderID       || &#39;)&#39; ||&#10;            &#39;(p_eventID&#61;&#39;           || p_eventID          || &#39;)&#39; ||&#10;            &#39;(p_licconID&#61;&#39;          || p_licconID         || &#39;)&#39; ||&#10;            &#39;(p_rqmntID&#61;&#39;           || p_rqmntID          || &#39;)&#39; ||&#10;            &#39;(p_pssRqmntID&#61;&#39;        || p_pssRqmntID       || &#39;)&#39; ||&#10;            &#39;(p_StartDate&#61;&#39;         || p_StartDate        || &#39;)&#39; ||&#10;            &#39;(p_EndDate&#61;&#39;           || p_EndDate          || &#39;)&#39; || CHR(10) ||&#10;            &#39;(p_offenderNsiID&#61;&#39;     || p_offenderNsiID    || &#39;)&#39; ||&#10;            &#39;(p_allOffenderNsi&#61;&#39;    || p_allOffenderNsi   || &#39;)&#39; ||&#10;            &#39;(p_eventNsiID&#61;&#39;        || p_eventNsiID       || &#39;)&#39; ||&#10;            &#39;(p_allEventNsi&#61;&#39;       || p_allEventNsi      || &#39;)&#39; || CHR(10) ||&#10;            &#39;(p_category&#61;&#39;          || p_category         || &#39;)&#39; ||&#10;            &#39;(p_exact_match_flag&#61;&#39;  || p_exact_match_flag || &#39;)&#39; ||&#10;            &#39;(p_exclude_sgc_flag&#61;&#39;  || p_exclude_sgc_flag || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_sgc_flag&#61;&#39;          || p_sgc_flag         || &#39;)&#39; ||&#10;            &#39;(p_attended_flag&#61;&#39;     || p_attended_flag    || &#39;)&#39; ||&#10;            &#39;(p_complied_flag&#61;&#39;     || p_complied_flag    || &#39;)&#39; ||&#10;            &#39;(p_outcome_overdue_flag&#61;&#39; || p_outcome_overdue_flag || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_drug_test_view_flag&#61;&#39; || p_drug_test_view_flag || &#39;)&#39; ||&#10;            &#39;(p_filter_type&#61;&#39;       || p_filter_type      || &#39;)&#39; ||&#10;            --&#10;            &#39;(all_contacts_FLAG&#61;&#39;   || bool_2_char(l_all_contacts)         || &#39;)&#39; ||&#10;            &#39;(offender_level_FLAG&#61;&#39; || bool_2_char(l_offender_level_FLAG)  || &#39;)&#39; ||&#10;            &#39;(event_level_FLAG&#61;&#39;    || bool_2_char(l_event_level_FLAG)     || &#39;)&#39; ||&#10;            &#39;(comp_level_FLAG&#61;&#39;     || bool_2_char(l_component_level_FLAG) || &#39;)&#39; ||&#10;            --&#10;            &#39;(exclude_offender_nsi_FLAG&#61;&#39; || bool_2_char(l_exclude_offender_nsi_FLAG) || &#39;)&#39; ||&#10;            &#39;(exclude_event_nsi_FLAG&#61;&#39;    || bool_2_char(l_exclude_event_nsi_FLAG)    || &#39;)&#39; ||&#10;            --&#10;            &#39;(offender_nsi_only_FLAG&#61;&#39;    || bool_2_char(l_offender_nsi_only_FLAG)    || &#39;)&#39; ||&#10;            &#39;(event_nsi_only_FLAG&#61;&#39;       || bool_2_char(l_event_nsi_only_FLAG)       || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_max_rows&#61;&#39;                || p_max_rows                               || &#39;)&#39; ||&#10;            &#39;(p_limit_rows_flag&#61;&#39;         || p_limit_rows_flag                        || &#39;)&#39; ||&#10;            &#39;(off_cache_HITS&#61;&#39;            || PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;            &#39;(off_cache_MISS&#61;&#39;            || PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39; || CHR(10) ||&#10;            l_SQL;&#10;        --l_dbg_msg :&#61; l_dbg_msg || CHR(10) || get_sql_xplain_plan(l_SQL);&#10;    END IF;&#10;    --&#10;    IF PKG_Debug.funcgetDebugMode &#61; 1 THEN&#10;        procDebug(l_dbg_msg);&#10;        PKG_Debug.procrecordDbStats_START;&#10;    END IF;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        --&#10;        l_rows :&#61; l_rows + 1;&#10;        EXIT WHEN l_limit_flag AND l_rows &gt; p_max_rows;&#10;        --&#10;        l_rec :&#61; l_tab(l_i);&#10;        --&#10;        l_contact_type :&#61;&#10;            PKG_Lookups.funcGetContactTypeRecord(&#10;                l_rec.contact_type_id,&#10;                &#39;CODE || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || DESCRIPTION || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || EDITABLE || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || SGC_FLAG&#39; );&#10;        l_rec.contact_type_code :&#61; PKG_LstUtl.list_next_elem(l_contact_type, lc_delim);&#10;        l_rec.contact_type_desc :&#61; PKG_LstUtl.list_next_elem(l_contact_type, lc_delim);&#10;        l_rec.user_editable     :&#61; PKG_LstUtl.list_next_elem(l_contact_type, lc_delim);&#10;        l_rec.sgc_flag          :&#61; l_contact_type;&#10;        --&#10;        IF l_rec.event_id IS NULL THEN&#10;            IF l_rec.nsi_id IS NULL THEN&#10;                l_off_CNT :&#61; l_off_CNT + 1;&#10;            ELSE&#10;                l_nsi_CNT :&#61; l_nsi_CNT + 1;&#10;            END IF;&#10;        ELSE -- EVENT_ID IS NOT NULL&#10;            --&#10;            IF l_rec.lic_condition_id IS NULL AND l_rec.rqmnt_id IS NULL AND l_rec.nsi_id IS NULL AND l_rec.pss_rqmnt_id IS NULL THEN&#10;                l_ev_CNT :&#61; l_ev_CNT + 1;&#10;            END IF;&#10;            --&#10;            IF l_rec.lic_condition_id IS NULL AND l_rec.rqmnt_id IS NULL AND l_rec.pss_rqmnt_id IS NULL AND l_rec.nsi_id IS NOT NULL THEN&#10;                l_nsi_CNT :&#61; l_nsi_CNT + 1;&#10;            END IF;&#10;            --&#10;            l_event_id_CHAR :&#61; TO_CHAR(l_rec.event_id);&#10;            --&#10;            IF NOT l_tab_EVENT.EXISTS(l_event_id_CHAR) THEN&#10;                l_event_STR :&#61;&#10;                    PKG_Lookups.funcgetTabRecord(&#10;                        p_table    &#61;&gt; &#39;EVENT E, DISPOSAL D, R_DISPOSAL_TYPE DT&#39;,&#10;                        p_ref_col  &#61;&gt; &#39;E.event_id&#39;,&#10;                        p_ref_val  &#61;&gt; TO_CHAR(L_REC.EVENT_ID),&#10;                        p_where    &#61;&gt; &#39;D.event_id(+) &#61; E.event_id AND DT.disposal_type_id(+) &#61; D.disposal_type_id&#39;,&#10;                        --&#10;                        p_data_fld &#61;&gt;&#10;                           &#39;NVL(E.event_number, 0)                 || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; ||&#10;                            DT.description                         || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; ||&#10;                            TO_CHAR(D.disposal_date, &#39;&#39;YYYYMMDD&#39;&#39;)&#39;,&#10;                        p_order_by &#61;&gt;&#10;                           &#39;D.active_flag   DESC,&#10;                            D.disposal_date DESC,&#10;                            D.disposal_id   DESC&#39;&#10;                    );&#10;                --&#10;                l_rec_event.event_number  :&#61; PKG_LstUtl.list_next_elem(l_event_STR, lc_delim);&#10;                l_rec_event.disposal_type :&#61; PKG_LstUtl.list_next_elem(l_event_STR, lc_delim);&#10;                l_rec_event.disposal_date :&#61; TO_DATE(PKG_LstUtl.list_next_elem(l_event_STR, lc_delim), &#39;YYYYMMDD&#39;);&#10;                --&#10;                l_rec_event.latest_court_appearance_date :&#61;&#10;                    TO_DATE(PKG_Lookups.funcgetTabRecord(&#10;                        p_table    &#61;&gt; &#39;COURT_APPEARANCE&#39;,&#10;                        p_ref_col  &#61;&gt; &#39;event_id&#39;,&#10;                        p_ref_val  &#61;&gt; TO_CHAR(L_REC.EVENT_ID),&#10;                        p_where    &#61;&gt; &#39;&#39;,&#10;                        --&#10;                        p_data_fld &#61;&gt; &#39;TO_CHAR(appearance_date, &#39;&#39;YYYYMMDD&#39;&#39;)&#39;,&#10;                        p_order_by &#61;&gt;&#10;                           &#39;appearance_date       DESC,&#10;                            created_datetime      DESC,&#10;                            last_updated_datetime DESC,&#10;                            court_appearance_id   DESC&#39;&#10;                    ), &#39;YYYYMMDD&#39;);&#10;                --&#10;                l_tab_EVENT(l_event_id_CHAR) :&#61; l_rec_event;&#10;                --&#10;            ELSE&#10;                l_rec_event :&#61; l_tab_EVENT(l_event_id_CHAR);&#10;            END IF;&#10;            --&#10;            l_rec.event_number                 :&#61; l_rec_event.event_number;&#10;            l_rec.disposal_type                :&#61; l_rec_event.disposal_type;&#10;            l_rec.disposal_date                :&#61; l_rec_event.disposal_date;&#10;            l_rec.latest_court_appearance_date :&#61; l_rec_event.latest_court_appearance_date;&#10;            --&#10;        END IF;&#10;        --&#10;        IF l_rec.contact_outcome_type_id IS NOT NULL THEN&#10;            l_rec.contact_outcome_desc :&#61;&#10;                PKG_Lookups.funcgetTabRecord_CACHED(&#10;                    p_table   &#61;&gt; &#39;R_CONTACT_OUTCOME_TYPE&#39;,&#10;                    p_ref_col &#61;&gt; &#39;CONTACT_OUTCOME_TYPE_ID&#39;,&#10;                    p_ref_val &#61;&gt; TO_CHAR(l_rec.contact_outcome_type_id),&#10;                    p_data_fld&#61;&gt; &#39;DESCRIPTION&#39;);&#10;        END IF;&#10;        --&#10;        IF l_rec.trust_provider_flag &#61; 0 THEN&#10;            l_rec.staff_id :&#61; l_rec.staff_employee_id;&#10;            --&#10;            l_staff :&#61;&#10;                PKG_Lookups.funcgetTabRecord_CACHED(&#10;                    p_table   &#61;&gt; &#39;STAFF&#39;,&#10;                    p_ref_col &#61;&gt; &#39;STAFF_ID&#39;,&#10;                    p_ref_val &#61;&gt; TO_CHAR(l_rec.staff_employee_id),&#10;                    --&#10;                    p_data_fld&#61;&gt; &#39;OFFICER_CODE || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                 &#39;FORENAME     || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                 &#39;FORENAME2    || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                 &#39;SURNAME&#39;&#10;                );&#10;            --&#10;            l_rec.officer_code    :&#61; PKG_LstUtl.list_next_elem(l_staff, lc_delim);&#10;            l_rec.staff_forename  :&#61; PKG_LstUtl.list_next_elem(l_staff, lc_delim);&#10;            l_rec.staff_forename2 :&#61; PKG_LstUtl.list_next_elem(l_staff, lc_delim);&#10;            l_rec.staff_surname   :&#61; PKG_LstUtl.list_next_elem(l_staff, lc_delim);&#10;            --&#10;        END IF;&#10;        --&#10;        IF l_rec.trust_provider_flag &#61; 1 THEN&#10;            l_rec.provider_employee_id :&#61; l_rec.staff_employee_id;&#10;            --&#10;            l_provider :&#61;&#10;                PKG_Lookups.funcgetTabRecord_CACHED(&#10;                    p_table   &#61;&gt; &#39;PROVIDER_EMPLOYEE&#39;,&#10;                    p_ref_col &#61;&gt; &#39;PROVIDER_EMPLOYEE_ID&#39;,&#10;                    p_ref_val &#61;&gt; TO_CHAR(l_rec.staff_employee_id),&#10;                    --&#10;                    p_data_fld&#61;&gt; &#39;CODE || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                 &#39;FORENAME     || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                 &#39;FORENAME2    || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                 &#39;SURNAME&#39;&#10;                );&#10;            --&#10;            l_rec.provider_emp_code      :&#61; PKG_LstUtl.list_next_elem(l_provider, lc_delim);&#10;            l_rec.provider_emp_forename  :&#61; PKG_LstUtl.list_next_elem(l_provider, lc_delim);&#10;            l_rec.provider_emp_forename2 :&#61; PKG_LstUtl.list_next_elem(l_provider, lc_delim);&#10;            l_rec.provider_emp_surname   :&#61; PKG_LstUtl.list_next_elem(l_provider, lc_delim);&#10;            --&#10;        END IF;&#10;        --&#10;        IF l_rec.lic_condition_id IS NOT NULL THEN&#10;            --&#10;            l_lc_CNT :&#61; l_lc_CNT + 1;&#10;            --&#10;            -- /*32*/ LC.comp_length,&#10;            -- /*40*/ LC.lic_cond_type_main_cat_id,&#10;            -- /*43*/ LC.lic_cond_type_sub_cat_id,&#10;            l_lic_condition_id_CHAR :&#61; TO_CHAR(l_rec.lic_condition_id);&#10;            --&#10;            IF NOT l_tab_LC.EXISTS(l_lic_condition_id_CHAR) THEN&#10;                l_lc_STR :&#61;&#10;                    PKG_Lookups.funcgetTabRecord(&#10;                        p_table   &#61;&gt; &#39;LIC_CONDITION&#39;,&#10;                        p_ref_col &#61;&gt; &#39;LIC_CONDITION_ID&#39;,&#10;                        p_ref_val &#61;&gt; TO_CHAR(l_rec.LIC_CONDITION_ID),&#10;                        --&#10;                        p_data_fld&#61;&gt; &#39;length || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || lic_cond_type_main_cat_id || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || lic_cond_type_sub_cat_id&#39;);&#10;                --&#10;                l_rec_LC.comp_length               :&#61; PKG_LstUtl.list_next_elem(l_LC_STR, lc_delim);&#10;                l_rec_LC.lic_cond_type_main_cat_id :&#61; PKG_LstUtl.list_next_elem(l_LC_STR, lc_delim);&#10;                l_rec_LC.lic_cond_type_sub_cat_id  :&#61; l_LC_STR;&#10;                --&#10;                l_tab_LC(l_lic_condition_id_CHAR) :&#61; l_rec_LC;&#10;                --&#10;            ELSE&#10;                l_rec_LC :&#61; l_tab_LC(l_lic_condition_id_CHAR);&#10;            END IF;&#10;            --&#10;            l_rec.comp_length               :&#61; l_rec_LC.comp_length;&#10;            l_rec.lic_cond_type_main_cat_id :&#61; l_rec_LC.lic_cond_type_main_cat_id;&#10;            l_rec.lic_cond_type_sub_cat_id  :&#61; l_rec_LC.lic_cond_type_sub_cat_id;&#10;            --&#10;            l_rec.comp_main_cat_id :&#61; l_rec.lic_cond_type_main_cat_id;&#10;            l_rec.comp_sub_id      :&#61; l_rec.lic_cond_type_sub_cat_id;&#10;            --&#10;            l_lc_cat :&#61; PKG_Lookups.funcgetTabRecord_CACHED(&#10;                            p_table     &#61;&gt; &#39;R_LIC_COND_TYPE_MAIN_CAT LCAT, R_STANDARD_REFERENCE_LIST LCATU&#39;,&#10;                            p_ref_col   &#61;&gt; &#39;LCAT.lic_cond_type_main_cat_id&#39;,&#10;                            p_ref_val   &#61;&gt; TO_CHAR(l_rec.lic_cond_type_main_cat_id),&#10;                            p_where     &#61;&gt; &#39;LCATU.standard_reference_list_id(+) &#61; LCAT.units_id&#39;,&#10;                            --&#10;                            p_data_fld&#61;&gt; &#39;LCAT.description || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || LCATU.code_description&#39;&#10;                );&#10;            --&#10;            l_rec.comp_main_cat_desc :&#61; PKG_LstUtl.list_next_elem(l_lc_cat, lc_delim);&#10;            l_rec.comp_unit_desc     :&#61; PKG_LstUtl.list_next_elem(l_lc_cat, lc_delim);&#10;            l_rec.comp_sub_desc      :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(l_rec.lic_cond_type_sub_cat_id);&#10;            --&#10;        END IF;&#10;        --&#10;        IF l_rec.rqmnt_id IS NOT NULL THEN&#10;            --&#10;            l_rq_CNT :&#61; l_rq_CNT + 1;&#10;            --&#10;            -- /*32*/ RQ.comp_length,&#10;            -- /*41*/ R.rqmnt_type_main_category_id,&#10;            -- /*42*/ R.ad_rqmnt_type_main_category_id,&#10;            -- /*44*/ R.rqmnt_type_sub_category_id,&#10;            -- /*45*/ R.ad_rqmnt_type_sub_category_id&#10;            l_rqmnt_id_CHAR :&#61; TO_CHAR(l_rec.rqmnt_id);&#10;            --&#10;            IF NOT l_tab_RQ.EXISTS(l_rqmnt_id_CHAR) THEN&#10;                l_rq_STR :&#61;&#10;                    PKG_Lookups.funcgetTabRecord(&#10;                        p_table   &#61;&gt; &#39;RQMNT&#39;,&#10;                        p_ref_col &#61;&gt; &#39;RQMNT_ID&#39;,&#10;                        p_ref_val &#61;&gt; TO_CHAR(l_rec.RQMNT_ID),&#10;                        --&#10;                        p_data_fld&#61;&gt; &#39;length&#39;                         || &#39; || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                     &#39;rqmnt_type_main_category_id&#39;    || &#39; || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                     &#39;ad_rqmnt_type_main_category_id&#39; || &#39; || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                     &#39;rqmnt_type_sub_category_id&#39;     || &#39; || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                     &#39;ad_rqmnt_type_sub_category_id&#39;&#10;                    );&#10;                --&#10;                l_rec_RQ.comp_length                    :&#61; PKG_LstUtl.list_next_elem(l_RQ_STR, lc_delim);&#10;                l_rec_RQ.rqmnt_type_main_category_id    :&#61; PKG_LstUtl.list_next_elem(l_RQ_STR, lc_delim);&#10;                l_rec_RQ.ad_rqmnt_type_main_category_id :&#61; PKG_LstUtl.list_next_elem(l_RQ_STR, lc_delim);&#10;                l_rec_RQ.rqmnt_type_sub_category_id     :&#61; PKG_LstUtl.list_next_elem(l_RQ_STR, lc_delim);&#10;                l_rec_RQ.ad_rqmnt_type_sub_category_id   :&#61; l_RQ_STR;&#10;                --&#10;                l_tab_RQ(l_rqmnt_id_CHAR) :&#61; l_rec_RQ;&#10;                --&#10;            ELSE&#10;                l_rec_RQ :&#61; l_tab_RQ(l_rqmnt_id_CHAR);&#10;            END IF;&#10;            --&#10;            l_rec.comp_length                    :&#61; l_rec_RQ.comp_length;&#10;            l_rec.rqmnt_type_main_category_id    :&#61; l_rec_RQ.rqmnt_type_main_category_id;&#10;            l_rec.ad_rqmnt_type_main_category_id :&#61; l_rec_RQ.ad_rqmnt_type_main_category_id;&#10;            l_rec.rqmnt_type_sub_category_id     :&#61; l_rec_RQ.rqmnt_type_sub_category_id;&#10;            l_rec.ad_rqmnt_type_sub_category_id  :&#61; l_rec_RQ.ad_rqmnt_type_sub_category_id;&#10;            --&#10;            l_rec.comp_main_cat_id :&#61; l_rec.rqmnt_type_main_category_id;&#10;            l_rec.comp_sub_id      :&#61; l_rec.rqmnt_type_sub_category_id;&#10;            --&#10;            IF l_rec.comp_main_cat_id IS NOT NULL THEN&#10;                l_rqmnt_cat :&#61; PKG_Lookups.funcgetTabRecord_CACHED(&#10;                                   p_table     &#61;&gt; &#39;R_RQMNT_TYPE_MAIN_CATEGORY RTC, R_STANDARD_REFERENCE_LIST RTCU&#39;,&#10;                                   p_ref_col   &#61;&gt; &#39;RTC.rqmnt_type_main_category_id&#39;,&#10;                                   p_ref_val   &#61;&gt; TO_CHAR(l_rec.rqmnt_type_main_category_id),&#10;                                   p_where     &#61;&gt; &#39;RTCU.standard_reference_list_id(+) &#61; RTC.units_id&#39;,&#10;                                   --&#10;                                   p_data_fld&#61;&gt; &#39;RTC.description || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || RTCU.code_description&#39;);&#10;                --&#10;                l_rec.comp_main_cat_desc :&#61; PKG_LstUtl.list_next_elem(l_rqmnt_cat, lc_delim);&#10;                l_rec.comp_unit_desc     :&#61; PKG_LstUtl.list_next_elem(l_rqmnt_cat, lc_delim);&#10;                l_rec.comp_sub_desc      :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(l_rec.rqmnt_type_sub_category_id);&#10;            ELSIF l_rec.ad_rqmnt_type_main_category_id IS NOT NULL THEN&#10;                l_rec.ad_main_cat_id :&#61; l_rec.ad_rqmnt_type_main_category_id;&#10;                l_rec.ad_sub_id      :&#61; l_rec.ad_rqmnt_type_sub_category_id;&#10;                --&#10;                l_ad_rqmnt_cat :&#61; PKG_Lookups.funcgetTabRecord_CACHED(&#10;                                      p_table     &#61;&gt; &#39;R_AD_RQMNT_TYPE_MAIN_CATEGORY RATC, R_STANDARD_REFERENCE_LIST RATCU&#39;,&#10;                                      p_ref_col   &#61;&gt; &#39;RATC.ad_rqmnt_type_main_category_id&#39;,&#10;                                      p_ref_val   &#61;&gt; TO_CHAR(l_rec.ad_rqmnt_type_main_category_id),&#10;                                      p_where     &#61;&gt; &#39;RATCU.standard_reference_list_id (+) &#61; RATC.units_id&#39;,&#10;                                      --&#10;                                      p_data_fld&#61;&gt; &#39;RATC.description || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || RATCU.code_description&#39;);&#10;                --&#10;                l_rec.ad_main_cat_desc :&#61; PKG_LstUtl.list_next_elem(l_ad_rqmnt_cat, lc_delim);&#10;                l_rec.ad_unit_desc     :&#61; PKG_LstUtl.list_next_elem(l_ad_rqmnt_cat, lc_delim);&#10;                l_rec.comp_sub_desc    :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(l_rec.ad_rqmnt_type_sub_category_id);&#10;                --&#10;            END IF;&#10;            --&#10;        END IF;&#10;        --&#10;        IF l_rec.nsi_id IS NOT NULL THEN&#10;            --&#10;            --/*50*/ nsi_id&#10;            --/*51*/ nsi_type_id&#10;            --/*52*/ nsi_type_desc&#10;            --/*53*/ nsi_sub_type_id&#10;            --/*54*/ nsi_sub_type_desc&#10;            --/*55*/ nsi_length&#10;            -- /*56*/ nsi_length_unit_desc&#10;            l_nsi_id_CHAR :&#61; TO_CHAR(l_rec.nsi_id);&#10;            --&#10;            IF NOT l_tab_NSI.EXISTS(l_nsi_id_CHAR) THEN&#10;                l_nsi_STR :&#61;&#10;                    PKG_Lookups.funcgetTabRecord(&#10;                        p_table   &#61;&gt; &#39;NSI&#39;,&#10;                        p_ref_col &#61;&gt; &#39;NSI_ID&#39;,&#10;                        p_ref_val &#61;&gt; TO_CHAR(l_rec.NSI_ID),&#10;                        --&#10;                        p_data_fld&#61;&gt; &#39;length || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || nsi_type_id || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || nsi_sub_type_id&#39;);&#10;                --&#10;                l_rec_NSI.nsi_length               :&#61; PKG_LstUtl.list_next_elem(l_NSI_STR, lc_delim);&#10;                l_rec_NSI.nsi_type_id :&#61; PKG_LstUtl.list_next_elem(l_NSI_STR, lc_delim);&#10;                l_rec_NSI.nsi_sub_type_id  :&#61; l_NSI_STR;&#10;                --&#10;                l_tab_NSI(l_nsi_id_CHAR) :&#61; l_rec_NSI;&#10;                --&#10;            ELSE&#10;                l_rec_NSI :&#61; l_tab_NSI(l_nsi_id_CHAR);&#10;            END IF;&#10;            --&#10;            l_rec.nsi_length       :&#61; l_rec_NSI.nsi_length;&#10;            l_rec.nsi_type_id      :&#61; l_rec_NSI.nsi_type_id;&#10;            l_rec.nsi_sub_type_id  :&#61; l_rec_NSI.nsi_sub_type_id;&#10;            --&#10;            l_lc_cat :&#61; PKG_Lookups.funcgetTabRecord_CACHED(&#10;                            p_table     &#61;&gt; &#39;R_NSI_TYPE NSIT, R_STANDARD_REFERENCE_LIST NSITU&#39;,&#10;                            p_ref_col   &#61;&gt; &#39;NSIT.nsi_type_id&#39;,&#10;                            p_ref_val   &#61;&gt; TO_CHAR(l_rec.nsi_type_id),&#10;                            p_where     &#61;&gt; &#39;NSITU.standard_reference_list_id(+) &#61; NSIT.units_id&#39;,&#10;                            --&#10;                            p_data_fld&#61;&gt; &#39;NSIT.description || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || NSITU.code_description&#39;&#10;                );&#10;            --&#10;            l_rec.nsi_type_desc :&#61; PKG_LstUtl.list_next_elem(l_lc_cat, lc_delim);&#10;            l_rec.nsi_length_unit_desc   :&#61; PKG_LstUtl.list_next_elem(l_lc_cat, lc_delim);&#10;            l_rec.nsi_sub_type_desc      :&#61; PKG_Lookups.funcgetStdRefListCodeDesc(l_rec.nsi_sub_type_id);&#10;            --&#10;        END IF;&#10;        --&#10;        IF l_rec.pss_rqmnt_id IS NOT NULL THEN&#10;            --&#10;            l_pss_CNT :&#61; l_pss_CNT + 1;&#10;            --&#10;            --/*57*/ pss_rqmnt_id,&#10;            --/*58*/ pss_rqmnt_type_id,&#10;            --/*59*/ pss_rqmnt_type_desc,&#10;            --/*60*/ pss_rqmnt_sub_type_id,&#10;            --/*61*/ pss_rqmnt_sub_type_desc,&#10;            --/*62*/ pss_rqmnt_length,&#10;            --/*63*/ pss_rqmnt_length_unit_desc&#10;            l_pss_rqmnt_id_CHAR :&#61; TO_CHAR(l_rec.pss_rqmnt_id);&#10;            --&#10;            IF NOT l_tab_PSS.EXISTS(l_pss_rqmnt_id_CHAR) THEN&#10;                l_pss_STR :&#61;&#10;                    PKG_Lookups.funcgetTabRecord(&#10;                        p_table   &#61;&gt; &#39;PSS_RQMNT&#39;,&#10;                        p_ref_col &#61;&gt; &#39;PSS_RQMNT_ID&#39;,&#10;                        p_ref_val &#61;&gt; TO_CHAR(l_rec.PSS_RQMNT_ID),&#10;                        --&#10;                        p_data_fld&#61;&gt; &#39;length&#39;                         || &#39; || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                     &#39;PSS_RQMNT_TYPE_MAIN_CAT_ID&#39;    || &#39; || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || &#39; ||&#10;                                     &#39;PSS_RQMNT_TYPE_SUB_CAT_ID&#39;&#10;                    );&#10;                --&#10;                l_rec_PSS.pss_length                    :&#61; PKG_LstUtl.list_next_elem(l_pss_STR, lc_delim);&#10;                l_rec_PSS.PSS_RQMNT_TYPE_MAIN_CAT_ID :&#61; PKG_LstUtl.list_next_elem(l_pss_STR, lc_delim);&#10;                l_rec_PSS.pss_rqmnt_type_sub_category_id   :&#61; l_pss_STR;&#10;                --&#10;                l_tab_PSS(l_pss_rqmnt_id_CHAR) :&#61; l_rec_PSS;&#10;                --&#10;            ELSE&#10;                l_rec_PSS :&#61; l_tab_PSS(l_pss_rqmnt_id_CHAR);&#10;            END IF;&#10;            --&#10;            l_rec.pss_rqmnt_length                    :&#61; l_rec_PSS.pss_length;&#10;            l_rec.pss_rqmnt_type_id    :&#61; l_rec_PSS.PSS_RQMNT_TYPE_MAIN_CAT_ID;&#10;            l_rec.pss_rqmnt_sub_type_id     :&#61; l_rec_PSS.pss_rqmnt_type_sub_category_id;&#10;            --&#10;            IF l_rec.pss_rqmnt_type_id IS NOT NULL THEN&#10;                l_pss_rqmnt_cat :&#61; PKG_Lookups.funcgetTabRecord_CACHED(&#10;                                   p_table     &#61;&gt; &#39;R_PSS_RQMNT_TYPE_MAIN_CATEGORY RTC, R_STANDARD_REFERENCE_LIST RTCU&#39;,&#10;                                   p_ref_col   &#61;&gt; &#39;RTC.PSS_RQMNT_TYPE_MAIN_CAT_ID&#39;,&#10;                                   p_ref_val   &#61;&gt; TO_CHAR(l_rec.pss_rqmnt_type_id),&#10;                                   p_where     &#61;&gt; &#39;RTCU.standard_reference_list_id(+) &#61; RTC.units_id&#39;,&#10;                                   --&#10;                                   p_data_fld&#61;&gt; &#39;RTC.description || &#39;&#39;&#39; || lc_delim || &#39;&#39;&#39; || RTCU.code_description&#39;);&#10;                --&#10;                l_rec.pss_rqmnt_type_desc :&#61; PKG_LstUtl.list_next_elem(l_pss_rqmnt_cat, lc_delim);&#10;                l_rec.pss_rqmnt_length_unit_desc     :&#61; PKG_LstUtl.list_next_elem(l_pss_rqmnt_cat, lc_delim);&#10;                --&#10;                l_pss_rqmnt_cat :&#61; PKG_Lookups.funcgetTabRecord_CACHED(&#10;                                   p_table     &#61;&gt; &#39;R_PSS_RQMNT_TYPE_SUB_CATEGORY RTC&#39;,&#10;                                   p_ref_col   &#61;&gt; &#39;RTC.PSS_RQMNT_TYPE_SUB_CAT_ID&#39;,&#10;                                   p_ref_val   &#61;&gt; TO_CHAR(l_rec.pss_rqmnt_sub_type_id),&#10;                                   --&#10;                                   p_data_fld&#61;&gt; &#39;RTC.description&#39;);&#10;                --&#10;                l_rec.pss_rqmnt_sub_type_desc      :&#61; l_pss_rqmnt_cat;&#10;            END IF;&#10;            --&#10;        END IF;&#10;        --&#10;        PIPE ROW ( l_rec );&#10;        --&#10;    END LOOP;&#10;    --&#10;    IF PKG_Debug.funcgetDebugMode &#61; 1 THEN&#10;        l_dbg_msg :&#61;&#10;            &#39;procGetContactsTAB (step2) &#39; ||&#10;            &#39;(rows&#61;&#39;                || l_rows         || &#39;)&#39; ||&#10;            &#39;(&#39; || PKG_Debug.funcgetDbStats           || &#39;): &#39; ||&#10;            --&#10;            &#39;(p_offenderID&#61;&#39;        || p_offenderID       || &#39;)&#39; ||&#10;            &#39;(p_eventID&#61;&#39;           || p_eventID          || &#39;)&#39; ||&#10;            &#39;(p_licconID&#61;&#39;          || p_licconID         || &#39;)&#39; ||&#10;            &#39;(p_rqmntID&#61;&#39;           || p_rqmntID          || &#39;)&#39; ||&#10;            &#39;(p_pssRqmntID&#61;&#39;        || p_pssRqmntID       || &#39;)&#39; ||&#10;            &#39;(p_StartDate&#61;&#39;         || p_StartDate        || &#39;)&#39; ||&#10;            &#39;(p_EndDate&#61;&#39;           || p_EndDate          || &#39;)&#39; || CHR(10) ||&#10;            &#39;(p_offenderNsiID&#61;&#39;     || p_offenderNsiID    || &#39;)&#39; ||&#10;            &#39;(p_allOffenderNsi&#61;&#39;    || p_allOffenderNsi   || &#39;)&#39; ||&#10;            &#39;(p_eventNsiID&#61;&#39;        || p_eventNsiID       || &#39;)&#39; ||&#10;            &#39;(p_allEventNsi&#61;&#39;       || p_allEventNsi      || &#39;)&#39; || CHR(10) ||&#10;            &#39;(p_category&#61;&#39;          || p_category         || &#39;)&#39; ||&#10;            &#39;(p_exact_match_flag&#61;&#39;  || p_exact_match_flag || &#39;)&#39; ||&#10;            &#39;(p_exclude_sgc_flag&#61;&#39;  || p_exclude_sgc_flag || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_sgc_flag&#61;&#39;          || p_sgc_flag         || &#39;)&#39; ||&#10;            &#39;(p_attended_flag&#61;&#39;     || p_attended_flag    || &#39;)&#39; ||&#10;            &#39;(p_complied_flag&#61;&#39;     || p_complied_flag    || &#39;)&#39; ||&#10;            &#39;(p_outcome_overdue_flag&#61;&#39; || p_outcome_overdue_flag || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_drug_test_view_flag&#61;&#39; || p_drug_test_view_flag || &#39;)&#39; ||&#10;            &#39;(p_filter_type&#61;&#39;       || p_filter_type      || &#39;)&#39; ||&#10;            --&#10;            &#39;(all_contacts_FLAG&#61;&#39;   || bool_2_char(l_all_contacts)         || &#39;)&#39; ||&#10;            &#39;(offender_level_FLAG&#61;&#39; || bool_2_char(l_offender_level_FLAG)  || &#39;)&#39; ||&#10;            &#39;(event_level_FLAG&#61;&#39;    || bool_2_char(l_event_level_FLAG)     || &#39;)&#39; ||&#10;            &#39;(comp_level_FLAG&#61;&#39;     || bool_2_char(l_component_level_FLAG) || &#39;)&#39; ||&#10;            --&#10;            &#39;(exclude_offender_nsi_FLAG&#61;&#39; || bool_2_char(l_exclude_offender_nsi_FLAG) || &#39;)&#39; ||&#10;            &#39;(exclude_event_nsi_FLAG&#61;&#39;    || bool_2_char(l_exclude_event_nsi_FLAG)    || &#39;)&#39; ||&#10;            --&#10;            &#39;(offender_nsi_only_FLAG&#61;&#39;    || bool_2_char(l_offender_nsi_only_FLAG)    || &#39;)&#39; ||&#10;            &#39;(event_nsi_only_FLAG&#61;&#39;       || bool_2_char(l_event_nsi_only_FLAG)       || &#39;)&#39; ||&#10;            --&#10;            &#39;(p_max_rows&#61;&#39;          || p_max_rows        || &#39;)&#39; ||&#10;            &#39;(p_limit_rows_flag&#61;&#39;   || p_limit_rows_flag || &#39;)&#39; ||&#10;            --&#10;            &#39;(off_CNT&#61;&#39;             || l_off_CNT      || &#39;)&#39; ||&#10;            &#39;(nsi_CNT&#61;&#39;             || l_nsi_CNT      || &#39;)&#39; ||&#10;            &#39;(ec_CNT&#61;&#39;              || l_ev_CNT       || &#39;)&#39; ||&#10;            &#39;(lc_CNT&#61;&#39;              || l_lc_CNT       || &#39;)&#39; ||&#10;            &#39;(rq_CNT&#61;&#39;              || l_rq_CNT       || &#39;)&#39; ||&#10;            &#39;(pss_CNT&#61;&#39;             || l_pss_CNT      || &#39;)&#39; ||&#10;            &#39;(off_cache_HITS&#61;&#39;      || PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;            &#39;(off_cache_MISS&#61;&#39;      || PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39;;&#10;        procDebug(l_dbg_msg);&#10;    END IF;&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(&#10;        &#39;procGetContactsTAB ERROR: &#39; || SQLERRM || &#39; &#39; ||&#10;        --&#10;        &#39;(p_offenderID&#61;&#39;        || p_offenderID       || &#39;)&#39; ||&#10;        &#39;(p_eventID&#61;&#39;           || p_eventID          || &#39;)&#39; ||&#10;        &#39;(p_licconID&#61;&#39;          || p_licconID         || &#39;)&#39; ||&#10;        &#39;(p_rqmntID&#61;&#39;           || p_rqmntID          || &#39;)&#39; ||&#10;        &#39;(p_pssRqmntID&#61;&#39;        || p_pssRqmntID       || &#39;)&#39; ||&#10;        &#39;(p_StartDate&#61;&#39;         || p_StartDate        || &#39;)&#39; ||&#10;        &#39;(p_EndDate&#61;&#39;           || p_EndDate          || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_offenderNsiID&#61;&#39;     || p_offenderNsiID    || &#39;)&#39; ||&#10;        &#39;(p_allOffenderNsi&#61;&#39;    || p_allOffenderNsi   || &#39;)&#39; ||&#10;        &#39;(p_eventNsiID&#61;&#39;        || p_eventNsiID       || &#39;)&#39; ||&#10;        &#39;(p_allEventNsi&#61;&#39;       || p_allEventNsi      || &#39;)&#39; || CHR(10) ||&#10;        &#39;(p_category&#61;&#39;          || p_category         || &#39;)&#39; ||&#10;        &#39;(p_exact_match_flag&#61;&#39;  || p_exact_match_flag || &#39;)&#39; ||&#10;        &#39;(p_exclude_sgc_flag&#61;&#39;  || p_exclude_sgc_flag || &#39;)&#39; ||&#10;        --&#10;        &#39;(p_sgc_flag&#61;&#39;          || p_sgc_flag         || &#39;)&#39; ||&#10;        &#39;(p_attended_flag&#61;&#39;     || p_attended_flag    || &#39;)&#39; ||&#10;        &#39;(p_complied_flag&#61;&#39;     || p_complied_flag    || &#39;)&#39; ||&#10;        &#39;(p_outcome_overdue_flag&#61;&#39; || p_outcome_overdue_flag || &#39;)&#39; ||&#10;        --&#10;        &#39;(p_drug_test_view_flag&#61;&#39; || p_drug_test_view_flag || &#39;)&#39; ||&#10;        &#39;(p_filter_type&#61;&#39;       || p_filter_type      || &#39;)&#39; ||&#10;        --&#10;        &#39;(all_contacts_FLAG&#61;&#39;   || bool_2_char(l_all_contacts)         || &#39;)&#39; ||&#10;        &#39;(offender_level_FLAG&#61;&#39; || bool_2_char(l_offender_level_FLAG)  || &#39;)&#39; ||&#10;        &#39;(event_level_FLAG&#61;&#39;    || bool_2_char(l_event_level_FLAG)     || &#39;)&#39; ||&#10;        &#39;(comp_level_FLAG&#61;&#39;     || bool_2_char(l_component_level_FLAG) || &#39;)&#39; ||&#10;        --&#10;        &#39;(exclude_offender_nsi_FLAG&#61;&#39; || bool_2_char(l_exclude_offender_nsi_FLAG) || &#39;)&#39; ||&#10;        &#39;(exclude_event_nsi_FLAG&#61;&#39;    || bool_2_char(l_exclude_event_nsi_FLAG)    || &#39;)&#39; ||&#10;        --&#10;        &#39;(offender_nsi_only_FLAG&#61;&#39;    || bool_2_char(l_offender_nsi_only_FLAG)    || &#39;)&#39; ||&#10;        &#39;(event_nsi_only_FLAG&#61;&#39;       || bool_2_char(l_event_nsi_only_FLAG)       || &#39;)&#39; ||&#10;        --&#10;        &#39;(p_max_rows&#61;&#39;                || p_max_rows                               || &#39;)&#39; ||&#10;        &#39;(p_limit_rows_flag&#61;&#39;         || p_limit_rows_flag                        || &#39;)&#39; ||&#10;        l_SQL );&#10;    RAISE;&#10;END procGetContactsTAB;&#10;--&#10;--&#10;--&#10;FUNCTION procFindAlertContactsTAB(&#10;    p_date                 DATE,&#10;    p_team_id              NUMBER,&#10;    p_provider_team_id     NUMBER,&#10;    p_staff_id             NUMBER,&#10;    p_provider_employee_id NUMBER,&#10;    p_max_rows             INTEGER DEFAULT 100000)&#10;RETURN ttabOfficerDiary PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    l_SQL VARCHAR2(10000);&#10;    --&#10;    l_rec trecOfficerDiary;&#10;    l_tab ttabOfficerDiary;&#10;    l_row INTEGER :&#61; 0;&#10;    l_i   INTEGER;&#10;    --&#10;BEGIN&#10;    IF NOT (p_team_id IS NOT NULL OR p_staff_id IS NOT NULL OR p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL) THEN&#10;        raise_application_error(-20001, &#39;Error in procFindAlertContactsTAB: insufficient number of parameters specified&#39;);&#10;    END IF;&#10;    --&#10;    l_SQL :&#61;&#10;&#39;SELECT distinct&#10;  /*00*/ O.offender_id,&#10;  /*01*/ O.crn,&#10;  /*02*/ O.first_name,&#10;  /*03*/ O.second_name,&#10;  /*04*/ O.third_name,&#10;  /*05*/ O.surname,&#10;  /*06*/ O.current_highest_risk_colour,&#10;  /*07*/ O.current_restriction,&#10;  /*08*/ O.current_exclusion,&#10;  /*09*/ O.restriction_message,&#10;  /*10*/ O.exclusion_message,&#10;  /*11*/ C.contact_id,&#10;  /*12*/ C.contact_date,&#10;  /*13*/ C.contact_start_time,&#10;  /*14*/ CT.contact_type_id,&#10;  /*15*/ CT.code                    CONTACT_TYPE_CODE,&#10;  /*16*/ CT.description             CONTACT_TYPE_DESC,&#10;  /*17*/ C.contact_outcome_type_id,&#10;  /*18*/ OT.description             CONTACT_OUTCOME_TYPE_DESC,&#10;  /*19*/ TIER.code_description      TIER_DESCRIPTION,&#10;  /*20*/ O.current_tier,&#10;  /*21*/ null                       EA_DESC,&#10;  /*22*/ CT.EDITABLE                USER_EDITABLE,&#10;  --&#10;  /*23*/ NULL L1,&#10;  /*24*/ NULL L2,&#10;  /*25*/ NULL L3,&#10;  /*26*/ NULL date_of_birth,&#10;  --&#10;  /*27*/ C.description AS contact_description,&#10;  --&#10;  /*28*/ NULL AS staff_id,&#10;  /*29*/ NULL AS staff_code,&#10;  /*30*/ NULL AS staff_desc&#10;  --&#10;FROM&#10;  contact_alert ca,&#10;  contact C,&#10;  r_contact_type CT,&#10;  offender O,&#10;  r_contact_outcome_type OT,&#10;  r_standard_reference_list TIER&#10;  , &#39; || &#39;@&#39; || &#39;TABLE_NAME&#10;WHERE 1&#61;1&#10;  AND C.contact_id &#61; CA.contact_id&#10;  AND CT.contact_type_id &#61; CA.contact_type_id&#10;  AND O.offender_id &#61; CA.offender_id&#10;  AND OT.contact_outcome_type_id(+) &#61; C.contact_outcome_type_id&#10;  AND TIER.standard_reference_list_id(+) &#61; O.current_tier&#10;  -- KF - PDM 101 - User CONTACT_ALERT instead of alert flag&#10;  --AND C.alert_active &#61; &#39;&#39;Y&#39;&#39;&#10;  -- KF - End PDM 101&#10;  AND C.soft_deleted &#61; 0&#10;  -- NDM-104&#10;  AND O.soft_deleted &#61; 0&#39;;&#10;    --&#10;    IF p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;        SELECT l_SQL || CHR(10) ||&#10;          &#39; AND &#39; ||&#10;          DECODE(p_team_id , NULL, &#39;:p_team_id IS NULL &#39;, &#39;(@STAFF_TEAM_TABLE_NAME.trust_provider_team_id &#61; :p_team_id AND @STAFF_TEAM_TABLE_NAME.trust_provider_flag &#61; 0)&#39;) ||&#10;          &#39; AND &#39; ||&#10;          DECODE(p_staff_id, NULL, &#39;:p_staff_id IS NULL&#39;, &#39;(@STAFF_TEAM_TABLE_NAME.staff_employee_id &#61; :p_staff_id AND @STAFF_TEAM_TABLE_NAME.trust_provider_flag &#61; 0)&#39;)&#10;        INTO l_SQL&#10;        FROM dual;&#10;    ELSE&#10;        l_SQL :&#61; l_SQL || CHR(10) || &#39;  AND :p_team_id IS NULL AND :p_staff_id IS NULL&#39;;&#10;    END IF;&#10;    --&#10;    IF p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;        SELECT l_SQL || CHR(10) ||&#10;          &#39; AND &#39; ||&#10;          DECODE(p_provider_team_id    , NULL, &#39; :p_provider_team_id IS NULL&#39;    , &#39;(@STAFF_TEAM_TABLE_NAME.trust_provider_team_id &#61; :p_provider_team_id AND @STAFF_TEAM_TABLE_NAME.trust_provider_flag &#61; 1)&#39;) ||&#10;          &#39; AND &#39; ||&#10;          DECODE(p_provider_employee_id, NULL, &#39; :p_provider_employee_id IS NULL&#39;, &#39;(@STAFF_TEAM_TABLE_NAME.staff_employee_id &#61; :p_provider_employee_id AND @STAFF_TEAM_TABLE_NAME.trust_provider_flag &#61; 1)&#39;)&#10;        INTO l_SQL&#10;        FROM dual;&#10;    ELSE&#10;        l_SQL :&#61; l_SQL || CHR(10) || &#39;  AND :p_provider_team_id IS NULL AND :p_provider_employee_id IS NULL&#39;;&#10;    END IF;&#10;    --&#10;    l_SQL :&#61;&#10;        &#39;SELECT * FROM (&#39;                                                                                         || CHR(10) ||&#10;        --REPLACE(REPLACE(l_SQL, &#39;, @TABLE_NAME&#39;, &#39;&#39;), &#39;@STAFF_TEAM_TABLE_NAME&#39;, &#39;C&#39;)                               || CHR(10) ||&#10;        --&#39;UNION&#39;                                                                                                   || CHR(10) ||&#10;        REPLACE(REPLACE(l_SQL, &#39;@TABLE_NAME&#39;, &#39;OFFENDER_MANAGER&#39;), &#39;@STAFF_TEAM_TABLE_NAME&#39;, &#39;OFFENDER_MANAGER&#39;)  || CHR(10) ||&#10;        &#39;  AND OFFENDER_MANAGER.offender_id &#61; CA.offender_id&#39;                                                     || CHR(10) ||&#10;        &#39;  -- PDM v0.39: use ACTIVE_FLAG instead: 1 if NULL else 0&#39;                                               || CHR(10) ||&#10;        &#39;  --AND OFFENDER_MANAGER.end_date IS NULL&#39;                                                               || CHR(10) ||&#10;        &#39;  AND OFFENDER_MANAGER.active_flag &#61; 1&#39;                                                                  || CHR(10) ||&#10;        &#39;) ORDER BY contact_date, contact_start_time&#39;;&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      --p_date,&#10;      --p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id,&#10;      --p_date,&#10;      p_team_id, p_staff_id, p_provider_team_id, p_provider_employee_id;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab LIMIT p_max_rows;&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_row :&#61; l_row + 1;&#10;        --EXIT WHEN l_row &gt; NVL(p_max_rows, 100000);&#10;        --&#10;        PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;l_tab(l_i).offender_id, p_L1&#61;&gt;l_tab(l_i).L1, p_L2&#61;&gt;l_tab(l_i).L2, p_L3&#61;&gt;l_tab(l_i).L3);&#10;        --&#10;        PIPE ROW (l_tab(l_i));&#10;    END LOOP;&#10;    --&#10;    procDebug(&#39;procFindAlertContactsTAB (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;num_of_rows&#61;&#39; || l_row || &#39;, &#39; ||&#10;              &#39;p_date&#61;&gt;&#39; || p_date || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39; || p_team_id || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39; || p_staff_id  || &#39;, &#39; ||&#10;              &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id || &#39;, &#39; ||&#10;              &#39;p_provider_employee_id&#61;&gt;&#39; || p_provider_employee_id ||&#10;              &#39;(off_cache_HITS&#61;&#39;|| PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;              &#39;(off_cache_MISS&#61;&#39;|| PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39; || CHR(10) ||&#10;              l_SQL);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;              &#39;procFindAlertContactsTAB: &#39; ||&#10;              &#39;num_of_rows&#61;&#39; || l_row || &#39;, &#39; ||&#10;              &#39;p_date&#61;&gt;&#39; || p_date || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39; || p_team_id || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39; || p_staff_id  || &#39;, &#39; ||&#10;              &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id || &#39;, &#39; ||&#10;              &#39;p_provider_employee_id&#61;&gt;&#39; || p_provider_employee_id || CHR(10) ||    CHR(10) || l_SQL);&#10;    RAISE;&#10;END procFindAlertContactsTAB;&#10;--&#10;--&#10;--&#10;FUNCTION funcGetBreachDate(p_event_id NUMBER) RETURN DATE&#10;IS&#10;    v_ret DATE;&#10;BEGIN&#10;    v_ret :&#61;&#10;        PKG_Lookups.funcgetTabRecord_CACHED_1(&#10;            p_table &#61;&gt; &#39;contact C, r_contact_type CT&#39;,&#10;            p_data_fld &#61;&gt; &#39;C.contact_date&#39;,&#10;            p_ref_col &#61;&gt; &#39;C.event_id&#39;,&#10;            p_ref_val &#61;&gt; TO_CHAR(p_event_id),&#10;            p_where &#61;&gt;&#10;&#39;C.soft_deleted &#61; 0&#10;  AND CT.contact_type_id &#61; C.contact_type_id&#10;  AND CT.code &#61; :p_BREACH_INIT&#10;  AND NOT EXISTS(&#10;    SELECT 1 FROM contact C1, r_contact_type CT1&#10;    WHERE C1.contact_date &gt;&#61; C.contact_date&#10;      AND C1.soft_deleted &#61; 0&#10;      AND CT1.contact_type_id &#61; C1.contact_type_id&#10;      AND CT1.code IN (&#10;          :p_BREACH_WITHDRAWN,&#10;          :p_BREACH_NOT_PROVEN,&#10;          :p_BREACH_RESENTENCE,&#10;          :p_BREACH_CONCLUDED&#10;          /*:p_RECALL_RETURN_TO_PRISON*/&#10;          )&#10;    )&#39;,&#10;            --&#10;            p_bind_var1 &#61;&gt; &#39;AIBR&#39; /* Breach Initiated                 */,&#10;            p_bind_var2 &#61;&gt; &#39;ABWD&#39; /* Breach Withdrawn                 */,&#10;            p_bind_var3 &#61;&gt; &#39;ABNP&#39; /* Breach Not Proven                */,&#10;            p_bind_var4 &#61;&gt; &#39;ABPP&#39; /* Breach Proven, Resentenced       */,&#10;            p_bind_var5 &#61;&gt; &#39;ABPC&#39; /* Breach Proven, Order to Continue */,&#10;            --p_bind_var6 &#61;&gt; &#39;ERCL&#39; /* Recall/Return to Prison          */,&#10;            --&#10;            p_order_by &#61;&gt; &#39;C.contact_date DESC&#39;);&#10;    --&#10;    RETURN v_ret;&#10;END funcGetBreachDate;&#10;--&#10;FUNCTION funcGetBreachDateEnd(p_event_id NUMBER) RETURN DATE&#10;IS&#10;    v_breach_date DATE;&#10;    v_ret DATE;&#10;BEGIN&#10;    v_breach_date :&#61; funcGetBreachDate(p_event_id);&#10;    IF v_breach_date IS NULL THEN&#10;        v_ret :&#61; NULL;&#10;    ELSE&#10;        v_ret :&#61;&#10;            PKG_Lookups.funcgetTabRecord_CACHED_1(&#10;                p_table &#61;&gt; &#39;contact C, r_contact_type CT&#39;,&#10;                p_data_fld &#61;&gt; &#39;C.contact_date&#39;,&#10;                p_ref_col &#61;&gt; &#39;C.event_id&#39;,&#10;                p_ref_val &#61;&gt; TO_CHAR(p_event_id),&#10;                p_where &#61;&gt;&#10;&#39;C.soft_deleted &#61; 0&#10;  AND C.contact_date &gt;&#61; :p_breach_date&#10;  AND CT.contact_type_id &#61; C.contact_type_id&#10;  AND CT.code IN (&#10;      :p_BREACH_WITHDRAWN,&#10;      :p_BREACH_NOT_PROVEN,&#10;      :p_BREACH_RESENTENCE,&#10;      :p_BREACH_CONCLUDED&#10;      /*:p_RECALL_RETURN_TO_PRISON*/&#10;      )&#39;,&#10;            --&#10;                p_bind_var1 &#61;&gt; v_breach_date,&#10;                p_bind_var2 &#61;&gt; &#39;ABWD&#39; /* Breach Withdrawn                 */,&#10;                p_bind_var3 &#61;&gt; &#39;ABNP&#39; /* Breach Not Proven                */,&#10;                p_bind_var4 &#61;&gt; &#39;ABPP&#39; /* Breach Proven, Resentenced       */,&#10;                p_bind_var5 &#61;&gt; &#39;ABPC&#39; /* Breach Proven, Order to Continue */,&#10;                --p_bind_var6 &#61;&gt; &#39;ERCL&#39; /* Recall/Return to Prison          */,&#10;                --&#10;                p_order_by &#61;&gt; &#39;C.contact_date DESC&#39; );&#10;    END IF; -- IF v_breach_date IS NULL&#10;    --&#10;    RETURN v_ret;&#10;END funcGetBreachDateEnd;&#10;&#10;--&#10;--&#10;--&#10;/*&#10;  Pseudo-code:&#10;&#10;  BREACH End Date / Counter Reset &#61; latest ABNP, ABPC, ABPR or RECALL or 12_Months_Good_Behaviour&#10;&#10;  BREACHED &#61; ABRI with no subsequent ABRW, ABNP, ABPC, ABPR or RECALL&#10;&#10;  WHERE &#61;&#10;&#10;        CONTACT.EVENT.DISPOSAL.termination_date IS NULL&#10;    AND CONTACT.contact_date &lt;&#61; :p_date&#10;    AND C.contact_date &gt; :BREACH End Date / Counter Reset&#10;    AND ( (CONTACT.contact_date &lt; SYSDATE AND CONTACT.contact_outcome_type_id IS NULL AND R_CONTACT_TYPE.???contact_outcome_flag??? &#61; &#39;Y&#39;) OR&#10;          (CONTACT.ENFORCEMENT.R_ENFORCEMENT_ACTION.outstanding_contact_action &#61; &#39;Y&#39; (as if NO_FURTHER_ACTION &#61; &#39;N&#39;) ) )&#10;    AND [Team and Staff link on ORDER_MANAGER and OFFENDER_MANAGER]&#10;*/&#10;FUNCTION procFindEnforcementContactsTAB(&#10;    p_date                 DATE,&#10;    p_team_id              NUMBER,&#10;    p_provider_team_id     NUMBER,&#10;    p_staff_id             NUMBER,&#10;    p_provider_employee_id NUMBER,&#10;    p_filter               INTEGER,&#10;    p_max_rows             INTEGER DEFAULT 100000 )&#10;RETURN ttabOfficerDiary PIPELINED&#10;IS&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    --&#10;    l_rec trecOfficerDiary;&#10;    l_tab ttabOfficerDiary;&#10;    --&#10;    l_i   INTEGER;&#10;    l_row INTEGER :&#61; 0;&#10;    --&#10;BEGIN&#10;    IF NOT (p_team_id IS NOT NULL OR p_staff_id IS NOT NULL OR p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL) THEN&#10;        raise_application_error(-20001, &#39;Error in procFindEnforcementContactsTAB: insufficient number of parameters specified&#39;);&#10;    END IF;&#10;    --&#10;    procDebug(&#39;procFindEnforcementContactsTAB START: &#39; ||&#10;              &#39;p_date&#61;&gt;&#39; || p_date || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39; || p_team_id || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39; || p_staff_id  || &#39;, &#39; ||&#10;              &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id || &#39;, &#39; ||&#10;              &#39;p_provider_employee_id&#61;&gt;&#39; || p_provider_employee_id);&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    OPEN l_cur FOR&#10;      WITH T AS (&#10;        SELECT *&#10;        FROM TABLE( PKG_Lookups.procFindEnforcementEventsTAB(&#10;                        p_date                 &#61;&gt; p_date,&#10;                        p_team_id              &#61;&gt; p_team_id,&#10;                        p_provider_team_id     &#61;&gt; p_provider_team_id,&#10;                        p_staff_id             &#61;&gt; p_staff_id,&#10;                        p_provider_employee_id &#61;&gt; p_provider_employee_id,&#10;                        p_filter               &#61;&gt; p_filter,&#10;                        p_max_rows             &#61;&gt; NVL(p_max_rows, 10000) ) )&#10;      )&#10;      --&#10;      SELECT&#10;        /*00*/ T.offender_id,&#10;        --&#10;        /*01*/ T.crn,&#10;        /*02*/ T.first_name,&#10;        /*03*/ T.second_name,&#10;        /*04*/ T.third_name,&#10;        /*05*/ T.surname,&#10;        /*06*/ T.current_highest_risk_colour,&#10;        /*07*/ T.current_restriction,&#10;        /*08*/ T.current_exclusion,&#10;        /*09*/ T.restriction_message,&#10;        /*10*/ T.exclusion_message,&#10;        --&#10;        /*11*/ T.contact_id,&#10;        /*12*/ T.contact_date,&#10;        /*13*/ T.contact_start_time,&#10;        /*14*/ T.contact_type_id,&#10;        /*15*/ T.contact_type_code,&#10;        /*16*/ T.contact_type_desc,&#10;        /*17*/ T.contact_outcome_type_id,&#10;        /*18*/ PKG_Lookups.funcgetTabRecord_CACHED(&#10;                   p_table    &#61;&gt; &#39;r_contact_outcome_type&#39;,&#10;                   p_ref_col  &#61;&gt; &#39;contact_outcome_type_id&#39;,&#10;                   p_ref_val  &#61;&gt; TO_CHAR(T.contact_outcome_type_id),&#10;                   p_data_fld &#61;&gt; &#39;description&#39; )                     AS contact_outcome_type_desc,&#10;        /*19*/ PKG_Lookups.funcgetStdRefListCodeDesc(T.current_tier) AS tier_description,&#10;        /*20*/ T.current_tier,&#10;        /*21*/ T.ea_desc,&#10;        /*22*/ T.user_editable,&#10;        --&#10;        /*23*/ NULL L1,&#10;        /*24*/ NULL L2,&#10;        /*25*/ NULL L3,&#10;        --&#10;        /*26*/ T.date_of_birth,&#10;        --&#10;        /*27*/ NULL AS contact_description,&#10;        --&#10;        /*28*/ T.staff_id,&#10;        /*29*/ T.staff_code,&#10;        /*30*/ T.staff_desc&#10;        --&#10;      FROM T&#10;        --, offender O&#10;        --, contact C, r_contact_type CT&#10;      WHERE 1&#61;1&#10;        --AND O.offender_id &#61; T.offender_id&#10;        --&#10;    ;&#10;    --&#10;    FETCH l_cur BULK COLLECT INTO l_tab LIMIT p_max_rows;&#10;    CLOSE l_cur;&#10;    --&#10;    FOR l_i IN 1..l_tab.COUNT LOOP&#10;        l_row :&#61; l_row + 1;&#10;        --&#10;        PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;l_tab(l_i).offender_id, p_L1&#61;&gt;l_tab(l_i).L1, p_L2&#61;&gt;l_tab(l_i).L2, p_L3&#61;&gt;l_tab(l_i).L3);&#10;        --&#10;        PIPE ROW ( l_tab(l_i) );&#10;    END LOOP;&#10;    --&#10;    procDebug(&#39;procFindEnforcementContactsTAB (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;num_of_rows&#61;&#39; || l_row || &#39;, &#39; ||&#10;              &#39;p_date&#61;&gt;&#39; || p_date || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39; || p_team_id || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39; || p_staff_id  || &#39;, &#39; ||&#10;              &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id || &#39;, &#39; ||&#10;              &#39;p_provider_employee_id&#61;&gt;&#39; || p_provider_employee_id ||&#10;              --&#10;              &#39;(contact_cache_HITS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_HITS || &#39;)&#39; ||&#10;              &#39;(contact_cache_MISS&#61;&#39; || PKG_VpdSupport.get_tab_cont_off_CNT_MISS || &#39;)&#39;&#10;              );&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;              &#39;procFindEnforcementContactsTAB (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;num_of_rows&#61;&#39; || l_row || &#39;, &#39; ||&#10;              &#39;p_date&#61;&gt;&#39; || p_date || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39; || p_team_id || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39; || p_staff_id  || &#39;, &#39; ||&#10;              &#39;p_provider_team_id&#61;&gt;&#39; || p_provider_team_id || &#39;, &#39; ||&#10;              &#39;p_provider_employee_id&#61;&gt;&#39; || p_provider_employee_id);&#10;    RAISE;&#10;END procFindEnforcementContactsTAB;&#10;--&#10;&#10;--&#10;-- Visor Contact Search&#10;--&#10;FUNCTION procFindVisorContactTAB(&#10;    p_probation_area_id    NUMBER,&#10;    p_date_from            DATE,&#10;    p_date_to              DATE,&#10;    p_copy_to_visor        VARCHAR2,&#10;    p_exported_to_visor    VARCHAR2,&#10;    p_team_id              NUMBER  DEFAULT NULL,&#10;    p_staff_id             NUMBER  DEFAULT NULL,&#10;    p_offender_id          NUMBER  DEFAULT NULL,&#10;    p_borough_id           NUMBER DEFAULT NULL,&#10;    p_district_id          NUMBER DEFAULT NULL,&#10;    p_order_by             VARCHAR2 DEFAULT NULL,&#10;    p_max_rows             INTEGER  DEFAULT 100000 )&#10;RETURN ttabVisorContact PIPELINED&#10;IS&#10;    --&#10;    TYPE l_cur_TYP IS REF CURSOR;&#10;    l_cur l_cur_TYP;&#10;    l_SQL CLOB;&#10;    --&#10;    l_rec trecVisorContact;&#10;    l_row INTEGER :&#61; 0;&#10;    --&#10;    l_tab     ttabVisorContact;&#10;    --&#10;    l_trust_provider_team_id NUMBER;&#10;    l_staff_employee_id      NUMBER;&#10;    l_trust_provider_flag    NUMBER;&#10;    --&#10;BEGIN&#10;    --&#10;    IF p_probation_area_id           IS NULL           OR&#10;       NVL(p_copy_to_visor, &#39;x&#39;)     NOT IN (&#39;Y&#39;, &#39;N&#39;) OR&#10;       NVL(p_exported_to_visor, &#39;x&#39;) NOT IN (&#39;Y&#39;, &#39;N&#39;) OR&#10;       1&lt;&gt;1&#10;    THEN&#10;        raise_application_error(-20001,&#10;        /*procDebug(*/&#39;ERROR: unexpected combination of the parameter values: (&#39; ||&#10;              &#39;p_date_from&#61;&gt;&#39;         || TO_CHAR(p_date_from, &#39;YYYYMMDD&#39;) || &#39;, &#39; ||&#10;              &#39;p_date_to&#61;&gt;&#39;           || TO_CHAR(p_date_to, &#39;YYYYMMDD&#39;)   || &#39;, &#39; ||&#10;              &#39;p_copy_to_visor&#61;&gt;&#39;     || p_copy_to_visor     || &#39;, &#39; ||&#10;              &#39;p_exported_to_visor&#61;&gt;&#39; || p_exported_to_visor || &#39;, &#39; ||&#10;              &#39;p_probation_area_id&#61;&gt;&#39; || p_probation_area_id || &#39;, &#39; ||&#10;              &#39;p_district_id&#61;&gt;&#39;       || p_district_id       || &#39;, &#39; ||&#10;              &#39;p_borough_id&#61;&gt;&#39;        || p_borough_id        || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39;           || p_team_id           || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39;          || p_staff_id          || &#39;, &#39; ||&#10;              &#39;p_offender_id&#61;&gt;&#39;       || p_offender_id       || &#39;)&#39;);&#10;        RETURN/* ttabVisorContact()*/;&#10;    END IF;&#10;    --&#10;    IF p_team_id IS NOT NULL OR p_staff_id IS NOT NULL THEN&#10;        l_trust_provider_team_id :&#61; p_team_id;&#10;        l_staff_employee_id      :&#61; p_staff_id;&#10;        l_trust_provider_flag    :&#61; 0;&#10;--    ELSIF p_provider_team_id IS NOT NULL OR p_provider_employee_id IS NOT NULL THEN&#10;--        l_trust_provider_team_id :&#61; p_provider_team_id;&#10;--        l_staff_employee_id      :&#61; p_provider_employee_id;&#10;--        l_trust_provider_flag    :&#61; 1;&#10;    ELSE&#10;        l_trust_provider_team_id :&#61; NULL;&#10;        l_staff_employee_id      :&#61; NULL;&#10;        l_trust_provider_flag    :&#61; NULL;&#10;    END IF;&#10;    --&#10;    PKG_Debug.procrecordDbStats_START;&#10;    --&#10;    l_SQL :&#61;&#10;    --&#10;&#39;WITH OM1 AS (&#10;  SELECT&#10;    OM.offender_id,&#10;    OM.probation_area_id   AS probation_area_id,&#10;    PA.code                AS probation_area_code,&#10;    PA.description         AS probation_area_desc,&#10;    OM.team_id,&#10;    T1.code                AS team_code,&#10;    T1.description         AS team_desc,&#10;    OM.allocation_staff_id AS staff_id,&#10;    S1.officer_code        AS staff_code,&#10;    --PKG_LstUtl.concat(S1.surname, PKG_LstUtl.concat(S1.forename, S1.forename2, p_delim &#61;&gt; &#39;&#39; &#39;&#39;), p_delim &#61;&gt; &#39;&#39;, &#39;&#39;) AS staff_desc&#10;    RTRIM(S1.surname || &#39;&#39;, &#39;&#39; || S1.forename || &#39;&#39;, &#39;&#39; || S1.forename2, &#39;&#39;, &#39;&#39;) AS staff_desc&#10;  FROM&#10;    offender_manager OM&#10;      INNER JOIN probation_area PA ON PA.probation_area_id &#61; OM.probation_area_id&#10;      INNER JOIN all_team T ON T.trust_provider_team_id &#61; OM.trust_provider_team_id AND T.trust_provider_flag &#61; OM.trust_provider_flag&#10;        LEFT OUTER JOIN team T1 ON T1.team_id &#61; T.trust_provider_team_id AND T.trust_provider_flag &#61; 0&#10;          LEFT OUTER JOIN district D ON D.district_id &#61; T.district_id&#10;      INNER JOIN officer S ON S.staff_employee_id &#61; OM.staff_employee_id AND S.trust_provider_flag &#61; OM.trust_provider_flag&#10;        LEFT OUTER JOIN staff S1 ON S1.staff_id &#61; S.staff_employee_id AND S.trust_provider_flag &#61; 0&#10;  WHERE 1&#61;1&#10;    AND OM.active_flag &#61; 1&#10;    AND &#39; || CASE WHEN p_offender_id             IS NULL THEN &#39;:p_offender_id IS NULL&#39;            ELSE &#39;OM.offender_id &#61; :p_offender_id&#39;                       END || &#39;&#10;    AND OM.probation_area_id &#61; :p_probation_area_id&#10;    AND &#39; || CASE WHEN p_district_id             IS NULL THEN &#39;:p_district_id IS NULL&#39;            ELSE &#39;T.district_id &#61; :p_district_id&#39;                        END || &#39;&#10;    AND &#39; || CASE WHEN p_borough_id              IS NULL THEN &#39;:p_borough_id IS NULL&#39;             ELSE &#39;D.borough_id &#61; :p_borough_id&#39;                          END || &#39;&#10;    AND &#39; || CASE WHEN l_trust_provider_team_id  IS NULL THEN &#39;:p_trust_provider_team_id IS NULL&#39; ELSE &#39;OM.trust_provider_team_id &#61; :p_trust_provider_team_id&#39; END || &#39;&#10;    AND &#39; || CASE WHEN l_staff_employee_id       IS NULL THEN &#39;:p_staff_employee_id IS NULL&#39;      ELSE &#39;OM.staff_employee_id &#61; :p_staff_employee_id&#39;           END || &#39;&#10;    AND &#39; || CASE WHEN l_trust_provider_flag     IS NULL THEN &#39;:p_trust_provider_flag IS NULL&#39;    ELSE &#39;OM.trust_provider_flag &#61; :p_trust_provider_flag&#39;       END || &#39;&#10;),&#10;--&#10;-- VISOR_CONTACT   VISOR_EXPORTED  COUNT(1)&#10;-- -------------   --------------  ------------&#10;-- N               N               344075774&#10;-- N               Y               538969&#10;-- N                               106934294&#10;-- Y               N               147781&#10;-- Y               Y               89717&#10;-- Y                               20&#10;--                               2293752&#10;C1 AS (&#10;  SELECT&#10;    &#39; || CASE WHEN &#39;Y&#39; IN (p_copy_to_visor/*, p_exported_to_visor*/) THEN &#39;/*+ INDEX (C XIE24CONTACT) */&#39; ELSE &#39;--&#39; END || &#39;&#10;    C.offender_id,&#10;    C.event_id,&#10;    C.contact_id,&#10;    --&#10;    C.contact_date,&#10;    C.contact_start_time,&#10;    C.contact_end_time,&#10;    --&#10;    C.probation_area_id,&#10;    C.team_id,&#10;    C.staff_id,&#10;    --&#10;    C.provider_team_id,&#10;    C.provider_employee_id,&#10;    C.provider_location_id,&#10;    C.office_location_id,&#10;    --&#10;    C.contact_type_id,&#10;    C.contact_outcome_type_id,&#10;    --&#10;    C.visor_contact,&#10;    C.visor_exported,&#10;    --&#10;    C.sensitive,&#10;    C.attended,&#10;    C.complied,&#10;    C.notes,&#10;    C.description,&#10;    --&#10;    C.soft_deleted&#10;    --&#10;  FROM&#10;    contact C&#10;  WHERE 1&#61;1&#10;    AND C.contact_date &gt;&#61; :p_date_from&#10;    AND C.contact_date &lt;&#61; :p_date_to&#10;    AND C.soft_deleted &#61; 0&#10;    AND C.visor_contact &#61; :p_copy_to_visor&#10;    AND C.visor_exported &#61; :p_exported_to_visor&#10;  ORDER BY 1,2,3&#10;)&#10;--&#10;SELECT&#10;  /*00*/ C.contact_id,&#10;  --&#10;  /*01*/ C.offender_id,&#10;  /*02*/ O.crn,&#10;  /*03*/ O.surname,&#10;  /*04*/ O.first_name            AS forename,&#10;  /*05*/ O.second_name           AS forename2,&#10;  --&#10;  /*06*/ C.event_id,&#10;  --&#10;  /*07*/ C.probation_area_id,&#10;  /*08*/ PA.code                 AS probation_area_code,&#10;  /*09*/ PA.description          AS probation_area_desc,&#10;  --&#10;  /*10*/ OM1.probation_area_id   AS om_probation_area_id,&#10;  /*11*/ OM1.probation_area_code AS om_probation_area_code,&#10;  /*12*/ OM1.probation_area_desc AS om_probation_area_desc,&#10;  --&#10;  /*13*/ C.team_id,&#10;  /*14*/ T.code                  AS team_code,&#10;  /*15*/ T.description           AS team_desc,&#10;  /*16*/ C.staff_id,&#10;  /*17*/ S.officer_code          AS staff_code,&#10;  --/*18*/ PKG_LstUtl.concat(S.surname, PKG_LstUtl.concat(S.forename, S.forename2, p_delim &#61;&gt; &#39;&#39; &#39;&#39;), p_delim &#61;&gt; &#39;&#39;, &#39;&#39;) AS staff_desc&#10;  /*18*/ RTRIM(S.surname || &#39;&#39;, &#39;&#39; || S.forename || &#39;&#39;, &#39;&#39; || S.forename2, &#39;&#39;, &#39;&#39;) AS staff_desc,&#10;  --&#10;  /*19*/ OM1.team_id             AS om_team_id,&#10;  /*20*/ OM1.team_code           AS om_team_code,&#10;  /*21*/ OM1.team_desc           AS om_team_desc,&#10;  /*22*/ OM1.staff_id            AS om_staff_id,&#10;  /*23*/ OM1.staff_code          AS om_staff_code,&#10;  /*24*/ OM1.staff_desc          AS om_staff_desc,&#10;  --&#10;  /*25*/ C.provider_team_id,&#10;  /*26*/ C.provider_employee_id,&#10;  --&#10;  /*27*/ C.provider_location_id,&#10;  /*28*/ PL.code                 AS provider_location_code,&#10;  /*29*/ PL.description          AS provider_location_desc,&#10;  --&#10;  /*30*/ C.office_location_id,&#10;  /*31*/ OL.code                 AS office_location_code,&#10;  /*32*/ OL.description          AS office_location_desc,&#10;  --&#10;  /*33*/ C.contact_outcome_type_id,&#10;  /*34*/ OT.code                 AS contact_outcome_type_code,&#10;  /*35*/ OT.description          AS contact_outcome_type_desc,&#10;  --&#10;  /*36*/ C.contact_type_id,&#10;  /*37*/ CT.code                 AS contact_type_code,&#10;  /*38*/ CT.description          AS contact_type_desc,&#10;  --&#10;  /*39*/ C.visor_contact,&#10;  /*40*/ C.visor_exported,&#10;  --&#10;  /*41*/ C.sensitive,&#10;  /*42*/ C.attended,&#10;  /*43*/ C.complied,&#10;  /*44*/ C.contact_date,&#10;  /*45*/ C.contact_start_time,&#10;  /*46*/ C.contact_end_time,&#10;  /*47*/ C.notes,&#10;  --&#10;  /*48*/ C.soft_deleted,&#10;  /*49*/ O.DATE_OF_BIRTH_DATE,&#10;  /*50*/ S.forename,&#10;  /*51*/ S.forename2,&#10;  /*52*/ S.surname,&#10;  /*53*/ SG.CODE_DESCRIPTION,&#10;  /*54*/ S.officer_code,&#10;  /*55*/ TPA.DESCRIPTION         AS team_probation_area_desc,&#10;  /*56*/ O.CURRENT_RESTRICTION   AS CURRENT_RESTRICTION,&#10;  /*57*/ O.CURRENT_EXCLUSION     AS CURRENT_EXCLUSION,&#10;  /*58*/ O.RESTRICTION_MESSAGE   AS RESTRICTION_MESSAGE,&#10;  /*59*/ O.EXCLUSION_MESSAGE     AS EXCLUSION_MESSAGE,&#10;  /*60*/ ADI.IDENTIFIER          AS VISOR,&#10;  /*61*/ C.DESCRIPTION&#10;FROM&#10;  C1 C&#10;    --INNER JOIN contact C ON C.contact_id &#61; C1.contact_id&#10;      INNER JOIN probation_area PA ON PA.probation_area_id &#61; C.probation_area_id&#10;      INNER JOIN team T ON T.team_id &#61; C.team_id&#10;        INNER JOIN probation_area TPA ON TPA.probation_area_id &#61; T.probation_area_id&#10;      INNER JOIN staff S ON S.staff_id &#61; C.staff_id&#10;        LEFT OUTER JOIN r_standard_reference_list SG ON SG.STANDARD_REFERENCE_LIST_ID &#61; S.STAFF_GRADE_ID&#10;      LEFT OUTER JOIN r_contact_type CT ON CT.contact_type_id &#61; C.contact_type_id&#10;      LEFT OUTER JOIN r_contact_outcome_type OT ON OT.contact_outcome_type_id &#61; C.contact_outcome_type_id&#10;      LEFT OUTER JOIN provider_location PL ON PL.provider_location_id &#61; C.provider_location_id&#10;      LEFT OUTER JOIN office_location OL ON OL.office_location_id &#61; C.OFFICE_LOCATION_ID&#10;      --&#10;      INNER JOIN OM1 ON OM1.offender_id &#61; C.offender_id&#10;        INNER JOIN offender O ON O.offender_id &#61; OM1.offender_id&#10;          LEFT OUTER JOIN additional_identifier ADI ON ADI.offender_id &#61; O.offender_id&#10;                                                   AND ADI.additional_identifier_id &#61; (&#10;                                                       PKG_Lookups.funcgetTabRecord(&#10;                                                           p_table    &#61;&gt; &#39;&#39;ADDITIONAL_IDENTIFIER AI, R_STANDARD_REFERENCE_LIST S&#39;&#39;,&#10;                                                           p_data_fld &#61;&gt; &#39;&#39;AI.ADDITIONAL_IDENTIFIER_ID&#39;&#39;,&#10;                                                           p_ref_col  &#61;&gt; &#39;&#39;AI.offender_id&#39;&#39;,&#10;                                                           p_ref_val  &#61;&gt;  TO_CHAR(O.offender_id),&#10;                                                           p_where    &#61;&gt; &#39;&#39;S.standard_reference_list_id &#61; AI.identifier_name_id&#10;                                                                       AND S.code_value &#61; &#39;&#39;&#39;&#39;VISO&#39;&#39;&#39;&#39;&#10;                                                                       AND AI.soft_deleted &#61; 0&#39;&#39;,&#10;                                                           p_order_by &#61;&gt; &#39;&#39;AI.LAST_UPDATED_DATETIME DESC, AI.ADDITIONAL_IDENTIFIER_ID DESC&#39;&#39; ) )&#10;WHERE 1&#61;1&#10;ORDER BY &#39; || CASE WHEN p_order_by IS NOT NULL THEN p_order_by ELSE &#39;O.crn, C.contact_date, C.contact_start_time&#39; END;&#10;    --&#10;    OPEN l_cur FOR l_SQL&#10;    USING&#10;      p_offender_id,&#10;      p_probation_area_id,&#10;      p_district_id,&#10;      p_borough_id,&#10;      l_trust_provider_team_id,&#10;      l_staff_employee_id,&#10;      l_trust_provider_flag,&#10;      p_date_from,&#10;      p_date_to,&#10;      p_copy_to_visor,&#10;      p_exported_to_visor;&#10;    --&#10;    LOOP&#10;        FETCH l_cur BULK COLLECT INTO l_tab LIMIT 1000;&#10;        FOR l_tab_idx IN 1..l_tab.COUNT LOOP&#10;            --&#10;            l_rec :&#61; l_tab(l_tab_idx);&#10;            --IF NVLSTR(p_use_caseload_table, &#39;N&#39;) &#61; &#39;Y&#39; THEN&#10;            --    PKG_RBAC.do_set_rbac_levels(p_offender_id&#61;&gt;l_rec.offender_id, p_L1&#61;&gt;l_rec.L1, p_L2&#61;&gt;l_rec.L2, p_L3&#61;&gt;l_rec.L3);&#10;            --END IF;&#10;            --&#10;            PIPE ROW (l_rec);&#10;            l_row :&#61; l_row + 1;&#10;            --&#10;        END LOOP;&#10;        --&#10;        EXIT WHEN l_cur%NOTFOUND;&#10;        --&#10;        EXIT WHEN l_row &gt;&#61; NVL(p_max_rows, 100000);&#10;    END LOOP;&#10;    CLOSE l_cur;&#10;    --&#10;    procDebug(&#39;procFindVisorContactTAB (rows&#61;&#39; || l_row || &#39;)(&#39; || PKG_Debug.funcgetDbStats || &#39;): &#39; ||&#10;              &#39;dbusr&#61;&#39;  || UPPER(SYS_CONTEXT(&#39;USERENV&#39;, &#39;CURRENT_USER&#39;))   || &#39;,&#39; ||&#10;              &#39;schema&#61;&#39; || UPPER(SYS_CONTEXT(&#39;USERENV&#39;, &#39;CURRENT_SCHEMA&#39;)) || &#39;,&#39; ||&#10;              --&#10;              &#39;p_date_from&#61;&gt;&#39;         || TO_CHAR(p_date_from, &#39;YYYYMMDD&#39;) || &#39;, &#39; ||&#10;              &#39;p_date_to&#61;&gt;&#39;           || TO_CHAR(p_date_to, &#39;YYYYMMDD&#39;)   || &#39;, &#39; ||&#10;              &#39;p_copy_to_visor&#61;&gt;&#39;     || p_copy_to_visor     || &#39;, &#39; ||&#10;              &#39;p_exported_to_visor&#61;&gt;&#39; || p_exported_to_visor || &#39;, &#39; ||&#10;              &#39;p_probation_area_id&#61;&gt;&#39; || p_probation_area_id || &#39;, &#39; ||&#10;              &#39;p_district_id&#61;&gt;&#39;       || p_district_id       || &#39;, &#39; ||&#10;              &#39;p_borough_id&#61;&gt;&#39;        || p_borough_id        || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39;           || p_team_id           || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39;          || p_staff_id          || &#39;, &#39; ||&#10;              &#39;p_offender_id&#61;&gt;&#39;       || p_offender_id       || CHR(10) ||&#10;              l_SQL);&#10;    --&#10;EXCEPTION WHEN OTHERS THEN&#10;    procDebug(SQLERRM || CHR(10) ||&#10;              &#39;procFindVisorContactTAB (rows&#61;&#39; || l_row || &#39;): &#39; ||&#10;              --&#10;              &#39;p_date_from&#61;&gt;&#39;         || TO_CHAR(p_date_from, &#39;YYYYMMDD&#39;) || &#39;, &#39; ||&#10;              &#39;p_date_to&#61;&gt;&#39;           || TO_CHAR(p_date_to, &#39;YYYYMMDD&#39;)   || &#39;, &#39; ||&#10;              &#39;p_copy_to_visor&#61;&gt;&#39;     || p_copy_to_visor     || &#39;, &#39; ||&#10;              &#39;p_exported_to_visor&#61;&gt;&#39; || p_exported_to_visor || &#39;, &#39; ||&#10;              &#39;p_probation_area_id&#61;&gt;&#39; || p_probation_area_id || &#39;, &#39; ||&#10;              &#39;p_district_id&#61;&gt;&#39;       || p_district_id       || &#39;, &#39; ||&#10;              &#39;p_borough_id&#61;&gt;&#39;        || p_borough_id        || &#39;, &#39; ||&#10;              &#39;p_team_id&#61;&gt;&#39;           || p_team_id           || &#39;, &#39; ||&#10;              &#39;p_staff_id&#61;&gt;&#39;          || p_staff_id          || &#39;, &#39; ||&#10;              &#39;p_offender_id&#61;&gt;&#39;       || p_offender_id       || CHR(10) ||&#10;              l_SQL);&#10;    RAISE;&#10;END procFindVisorContactTAB;&#10;--&#10;&#10;--&#10;--&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;-- Package Body initialisation block&#10;--&#10;--&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;--&#10;--&#10;BEGIN&#10;    --&#10;    PKG_Global.do_init;&#10;    --&#10;END PKG_ContactLog;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>