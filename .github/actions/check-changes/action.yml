name: Check for changes
description: Check which projects have changed since branching from main

inputs:
  filters:
    description: Path patterns to use for matching changes
    default: |
      commons:
        - '*'
        - '.github/**'
        - 'templates/**'
        - 'buildSrc/**'
        - 'gradle/**'
        - 'libs/**'
      projects:
        - 'projects/**'

outputs:
  projects:
    description: A JSON array of projects that have changed
    value: ${{ steps.check-changes.outputs.projects }}

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - uses: dorny/paths-filter@4512585405083f25c027a35db413c2b3b9006d50 # v2.11.1
      id: paths-filter
      with:
        list-files: shell
        filters: ${{ inputs.filters }}
    - name: Check for changes
      id: check-changes
      shell: bash
      env:
        COMMONS_CHANGED: ${{ steps.paths-filter.outputs.commons }}
        PROJECT_FILES: ${{ steps.paths-filter.outputs.projects_files }}
      run: ./.github/actions/check-changes/parse-changes.sh
