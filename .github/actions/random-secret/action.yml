name: Generate secret
description: Generate an alphanumeric random value and store it in a GitHub secret

inputs:
  name:
    description: Name of the secret key. Should be uppercase and seperated by underscores.
    required: true
  length:
    description: Length of the secret value.
    required: true
    default: '16'
  environment:
    description: GitHub environment to create the secret in. If no environment is provided, the action will create a repository secret.
    required: false
  token:
    description: Personal access token used to create the secret.
    required: true

runs:
  using: composite
  steps:
    - run: |
        sudo apt-get install pwgen
        gh secret set '${{ inputs.name }}' --body "$(pwgen -N1 '${{ inputs.length }}')" --env '${{ inputs.environment }}' --app actions
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.token }}