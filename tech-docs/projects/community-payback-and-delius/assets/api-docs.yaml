openapi: 3.1.0
info:
  title: API Reference
  contact:
    name: Probation Integration Team
    url: https://mojdt.slack.com/archives/C02HQ4M2YQN
    email: probation-integration-team@digital.justice.gov.uk
  license:
    name: MIT
    url: https://github.com/ministryofjustice/hmpps-probation-integration-services/blob/main/LICENSE
  version: "1.0"
servers:
- url: /
security:
- hmpps-auth-token: []
paths:
  /projects/{projectCode}/appointments/{appointmentId}/outcome:
    put:
      tags:
      - projects-controller
      operationId: updateAppointmentOutcome
      parameters:
      - name: projectCode
        in: path
        required: true
        schema:
          type: string
      - name: appointmentId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AppointmentOutcomeRequest"
        required: true
      responses:
        "200":
          description: OK
  /projects/{projectCode}/appointments:
    get:
      tags:
      - projects-controller
      operationId: getSession
      parameters:
      - name: projectCode
        in: path
        required: true
        schema:
          type: string
      - name: date
        in: query
        required: true
        schema:
          type: string
          format: date
      - name: username
        in: query
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SessionResponse"
    post:
      tags:
      - projects-controller
      operationId: createAppointments
      parameters:
      - name: projectCode
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAppointmentsRequest"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CreatedAppointment"
  /supervisors:
    get:
      tags:
      - supervisors-controller
      operationId: getSupervisors
      parameters:
      - name: username
        in: query
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SupervisorResponse"
  /reference-data/unpaid-work-appointment-outcomes:
    get:
      tags:
      - reference-data-controller
      operationId: getUnpaidWorkAppointmentOutcomes
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CodeDescription"
  /reference-data/project-types:
    get:
      tags:
      - reference-data-controller
      operationId: getProjectTypes
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CodeDescription"
  /reference-data/non-working-days:
    get:
      tags:
      - reference-data-controller
      operationId: getNonWorkingDays
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  format: date
  /providers:
    get:
      tags:
      - providers-controller
      operationId: getProviders
      parameters:
      - name: username
        in: query
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProvidersResponse"
  /providers/{providerCode}/teams/{teamCode}/supervisors:
    get:
      tags:
      - providers-controller
      operationId: getSupervisors_1
      parameters:
      - name: providerCode
        in: path
        required: true
        schema:
          type: string
      - name: teamCode
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SupervisorsResponse"
  /providers/{providerCode}/teams/{teamCode}/sessions:
    get:
      tags:
      - providers-controller
      operationId: getSessions
      parameters:
      - name: providerCode
        in: path
        required: true
        schema:
          type: string
      - name: teamCode
        in: path
        required: true
        schema:
          type: string
      - name: startDate
        in: query
        required: true
        schema:
          type: string
          format: date
      - name: endDate
        in: query
        required: true
        schema:
          type: string
          format: date
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SessionsResponse"
  /providers/{providerCode}/teams/{teamCode}/projects:
    get:
      tags:
      - providers-controller
      operationId: getProjects
      parameters:
      - name: providerCode
        in: path
        required: true
        schema:
          type: string
      - name: teamCode
        in: path
        required: true
        schema:
          type: string
      - name: typeCode
        in: query
        required: false
        schema:
          type: array
          items:
            type: string
      - name: pageable
        in: query
        required: true
        schema:
          $ref: "#/components/schemas/Pageable"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PagedModelProjectOutcomeStats"
  /providers/{code}/teams:
    get:
      tags:
      - providers-controller
      operationId: getTeams
      parameters:
      - name: code
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TeamsResponse"
  /projects/{projectCode}:
    get:
      tags:
      - projects-controller
      operationId: getProject
      parameters:
      - name: projectCode
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
  /projects/{projectCode}/appointments/{appointmentId}:
    get:
      tags:
      - projects-controller
      operationId: getAppointment
      parameters:
      - name: projectCode
        in: path
        required: true
        schema:
          type: string
      - name: appointmentId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: username
        in: query
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppointmentResponse"
  /docs/asyncapi:
    get:
      tags:
      - async-api-controller
      operationId: asyncApi
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: string
  /case/{crn}/summary:
    get:
      tags:
      - case-controller
      operationId: getSummary
      parameters:
      - name: crn
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnpaidWorkDetails"
  /case/{crn}/event/{eventNumber}/appointments/schedule:
    get:
      tags:
      - case-controller
      operationId: getSchedule
      parameters:
      - name: crn
        in: path
        required: true
        schema:
          type: string
      - name: eventNumber
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScheduleResponse"
components:
  schemas:
    AppointmentOutcomeRequest:
      type: object
      properties:
        version:
          type: string
          format: uuid
        outcome:
          $ref: "#/components/schemas/Code"
        supervisor:
          $ref: "#/components/schemas/Code"
        startTime:
          type: string
        endTime:
          type: string
        notes:
          type: string
        hiVisWorn:
          type: boolean
        workedIntensively:
          type: boolean
        penaltyMinutes:
          type: integer
          format: int64
        minutesCredited:
          type: integer
          format: int64
        workQuality:
          type: string
          enum:
          - EXCELLENT
          - GOOD
          - NOT_APPLICABLE
          - POOR
          - SATISFACTORY
          - UNSATISFACTORY
        behaviour:
          type: string
          enum:
          - EXCELLENT
          - GOOD
          - NOT_APPLICABLE
          - POOR
          - SATISFACTORY
          - UNSATISFACTORY
        sensitive:
          type: boolean
        alertActive:
          type: boolean
      required:
      - endTime
      - startTime
      - supervisor
      - version
    Code:
      type: object
      properties:
        code:
          type: string
      required:
      - code
    CreateAppointmentPickUpData:
      type: object
      properties:
        time:
          type: string
        location:
          $ref: "#/components/schemas/Code"
    CreateAppointmentRequest:
      type: object
      properties:
        reference:
          type: string
          format: uuid
        crn:
          type: string
          pattern: "[A-Z][0-9]{6}"
        eventNumber:
          type: integer
          format: int32
        date:
          type: string
          format: date
        startTime:
          type: string
        endTime:
          type: string
        supervisor:
          $ref: "#/components/schemas/Code"
          description: The appointment supervisor. Defaults to the unallocated staff
            member in the project team.
        allocationId:
          type: integer
          format: int64
        pickUp:
          $ref: "#/components/schemas/CreateAppointmentPickUpData"
        minutesOffered:
          type: integer
          format: int64
          description: The minutes offered towards a person's unpaid work requirement.
            Defaults to the difference between the appointment startTime and endTime.
        outcome:
          $ref: "#/components/schemas/Code"
        penaltyMinutes:
          type: integer
          format: int64
        minutesCredited:
          type: integer
          format: int64
        hiVisWorn:
          type: boolean
        workedIntensively:
          type: boolean
        workQuality:
          type: string
          enum:
          - EXCELLENT
          - GOOD
          - NOT_APPLICABLE
          - POOR
          - SATISFACTORY
          - UNSATISFACTORY
        behaviour:
          type: string
          enum:
          - EXCELLENT
          - GOOD
          - NOT_APPLICABLE
          - POOR
          - SATISFACTORY
          - UNSATISFACTORY
        sensitive:
          type: boolean
        alertActive:
          type: boolean
        notes:
          type: string
      required:
      - crn
      - date
      - endTime
      - eventNumber
      - reference
      - startTime
    CreateAppointmentsRequest:
      type: object
      properties:
        appointments:
          type: array
          items:
            $ref: "#/components/schemas/CreateAppointmentRequest"
      required:
      - appointments
    CreatedAppointment:
      type: object
      properties:
        id:
          type: integer
          format: int64
        reference:
          type: string
          format: uuid
      required:
      - id
      - reference
    CodeDescription:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
      required:
      - code
      - description
    SupervisorResponse:
      type: object
      properties:
        code:
          type: string
        isUnpaidWorkTeamMember:
          type: boolean
        unpaidWorkTeams:
          type: array
          items:
            $ref: "#/components/schemas/SupervisorTeamsResponse"
      required:
      - code
      - isUnpaidWorkTeamMember
      - unpaidWorkTeams
    SupervisorTeamsResponse:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
        provider:
          $ref: "#/components/schemas/CodeDescription"
      required:
      - code
      - description
      - provider
    ProvidersResponse:
      type: object
      properties:
        providers:
          type: array
          items:
            $ref: "#/components/schemas/CodeDescription"
      required:
      - providers
    StaffName:
      type: object
      properties:
        forename:
          type: string
        middleName:
          type: string
        surname:
          type: string
      required:
      - forename
      - surname
    Supervisor:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/StaffName"
        code:
          type: string
        grade:
          $ref: "#/components/schemas/CodeDescription"
        unallocated:
          type: boolean
      required:
      - code
      - name
      - unallocated
    SupervisorsResponse:
      type: object
      properties:
        supervisors:
          type: array
          items:
            $ref: "#/components/schemas/Supervisor"
      required:
      - supervisors
    Session:
      type: object
      properties:
        project:
          $ref: "#/components/schemas/CodeDescription"
        date:
          type: string
          format: date
        allocatedCount:
          type: integer
          format: int64
        outcomeCount:
          type: integer
          format: int64
        enforcementActionCount:
          type: integer
          format: int64
      required:
      - allocatedCount
      - date
      - enforcementActionCount
      - outcomeCount
      - project
    SessionsResponse:
      type: object
      properties:
        sessions:
          type: array
          items:
            $ref: "#/components/schemas/Session"
      required:
      - sessions
    Pageable:
      type: object
      properties:
        page:
          type: integer
          format: int32
          minimum: 0
        size:
          type: integer
          format: int32
          minimum: 1
        sort:
          type: array
          items:
            type: string
    Beneficiary:
      type: object
      properties:
        name:
          type: string
        contactName:
          type: string
        emailAddress:
          type: string
        website:
          type: string
        telephoneNumber:
          type: string
        location:
          $ref: "#/components/schemas/ProjectAddress"
    CodeName:
      type: object
      properties:
        name:
          type: string
        code:
          type: string
      required:
      - code
      - name
    PageMetadata:
      type: object
      properties:
        size:
          type: integer
          format: int64
        number:
          type: integer
          format: int64
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int64
    PagedModelProjectOutcomeStats:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: "#/components/schemas/ProjectOutcomeStats"
        page:
          $ref: "#/components/schemas/PageMetadata"
    Project:
      type: object
      properties:
        name:
          type: string
        code:
          type: string
        type:
          $ref: "#/components/schemas/CodeName"
        team:
          $ref: "#/components/schemas/CodeName"
        provider:
          $ref: "#/components/schemas/CodeName"
        location:
          $ref: "#/components/schemas/ProjectAddress"
        beneficiary:
          $ref: "#/components/schemas/Beneficiary"
        hiVisRequired:
          type: boolean
        expectedEndDateExclusive:
          type: string
          format: date
        actualEndDateExclusive:
          type: string
          format: date
      required:
      - beneficiary
      - code
      - hiVisRequired
      - name
      - type
    ProjectAddress:
      type: object
      properties:
        streetName:
          type: string
        buildingName:
          type: string
        addressNumber:
          type: string
        townCity:
          type: string
        county:
          type: string
        postCode:
          type: string
    ProjectOutcomeStats:
      type: object
      properties:
        project:
          $ref: "#/components/schemas/Project"
        overdueOutcomesCount:
          type: integer
          format: int32
        oldestOverdueInDays:
          type: integer
          format: int32
      required:
      - oldestOverdueInDays
      - overdueOutcomesCount
      - project
    TeamsResponse:
      type: object
      properties:
        teams:
          type: array
          items:
            $ref: "#/components/schemas/CodeDescription"
      required:
      - teams
    AppointmentResponseCase:
      type: object
      properties:
        crn:
          type: string
        name:
          $ref: "#/components/schemas/PersonName"
        dateOfBirth:
          type: string
          format: date
        currentExclusion:
          type: boolean
        exclusionMessage:
          type: string
        currentRestriction:
          type: boolean
        restrictionMessage:
          type: string
      required:
      - crn
      - currentExclusion
      - currentRestriction
      - dateOfBirth
      - name
    PersonName:
      type: object
      properties:
        forename:
          type: string
        middleNames:
          type: array
          items:
            type: string
        surname:
          type: string
      required:
      - forename
      - middleNames
      - surname
    RequirementProgress:
      type: object
      properties:
        requiredMinutes:
          type: integer
          format: int64
        completedMinutes:
          type: integer
          format: int64
        adjustments:
          type: integer
          format: int64
      required:
      - adjustments
      - completedMinutes
      - requiredMinutes
    SessionResponse:
      type: object
      properties:
        project:
          $ref: "#/components/schemas/Project"
        appointmentSummaries:
          type: array
          items:
            $ref: "#/components/schemas/SessionResponseAppointmentSummary"
      required:
      - appointmentSummaries
      - project
    SessionResponseAppointmentSummary:
      type: object
      properties:
        id:
          type: integer
          format: int64
        case:
          $ref: "#/components/schemas/AppointmentResponseCase"
        outcome:
          $ref: "#/components/schemas/CodeDescription"
        requirementProgress:
          $ref: "#/components/schemas/RequirementProgress"
      required:
      - case
      - id
      - requirementProgress
    AppointmentResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        reference:
          type: string
          format: uuid
        version:
          type: string
          format: uuid
        project:
          $ref: "#/components/schemas/Project"
        projectType:
          $ref: "#/components/schemas/CodeName"
          deprecated: true
          description: Use project.type instead
        case:
          $ref: "#/components/schemas/AppointmentResponseCase"
        event:
          $ref: "#/components/schemas/EventResponse"
        supervisor:
          $ref: "#/components/schemas/Supervisor"
        team:
          $ref: "#/components/schemas/CodeName"
        provider:
          $ref: "#/components/schemas/CodeName"
        pickUpData:
          $ref: "#/components/schemas/PickUp"
        date:
          type: string
          format: date
        startTime:
          type: string
        endTime:
          type: string
        penaltyHours:
          type: string
        outcome:
          $ref: "#/components/schemas/CodeDescription"
        enforcementAction:
          $ref: "#/components/schemas/AppointmentResponseEnforcementAction"
        hiVisWorn:
          type: boolean
        workedIntensively:
          type: boolean
        workQuality:
          type: string
          enum:
          - EXCELLENT
          - GOOD
          - NOT_APPLICABLE
          - POOR
          - SATISFACTORY
          - UNSATISFACTORY
        behaviour:
          type: string
          enum:
          - EXCELLENT
          - GOOD
          - NOT_APPLICABLE
          - POOR
          - SATISFACTORY
          - UNSATISFACTORY
        notes:
          type: string
        updatedAt:
          type: string
          format: date-time
        sensitive:
          type: boolean
        alertActive:
          type: boolean
      required:
      - case
      - date
      - endTime
      - event
      - id
      - penaltyHours
      - project
      - projectType
      - provider
      - startTime
      - supervisor
      - team
      - updatedAt
      - version
    AppointmentResponseEnforcementAction:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
        respondBy:
          type: string
          format: date
      required:
      - code
      - description
    EventResponse:
      type: object
      properties:
        number:
          type: integer
          format: int32
      required:
      - number
    PickUp:
      type: object
      properties:
        time:
          type: string
        location:
          $ref: "#/components/schemas/PickUpLocation"
    PickUpLocation:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
        streetName:
          type: string
        buildingName:
          type: string
        addressNumber:
          type: string
        townCity:
          type: string
        county:
          type: string
        postCode:
          type: string
      required:
      - code
      - description
    UnpaidWorkDetails:
      type: object
      properties:
        unpaidWorkDetails:
          type: array
          items:
            $ref: "#/components/schemas/UnpaidWorkMinutes"
      required:
      - unpaidWorkDetails
    UnpaidWorkMinutes:
      type: object
      properties:
        eventNumber:
          type: integer
          format: int64
        requiredMinutes:
          type: integer
          format: int64
        adjustments:
          type: integer
          format: int64
        completedMinutes:
          type: integer
          format: int64
        completedEteMinutes:
          type: integer
          format: int64
      required:
      - adjustments
      - completedEteMinutes
      - completedMinutes
      - eventNumber
      - requiredMinutes
    AllocationResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        project:
          $ref: "#/components/schemas/Project"
        projectAvailability:
          $ref: "#/components/schemas/ProjectAvailabilityDetails"
        frequency:
          type: string
        dayOfWeek:
          type: string
        startDateInclusive:
          type: string
          format: date
        endDateInclusive:
          type: string
          format: date
        startTime:
          type: string
        endTime:
          type: string
        pickUp:
          $ref: "#/components/schemas/PickUp"
      required:
      - dayOfWeek
      - endTime
      - id
      - project
      - startTime
    AppointmentScheduleResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        version:
          type: string
          format: uuid
        project:
          $ref: "#/components/schemas/CodeName"
        date:
          type: string
          format: date
        startTime:
          type: string
        endTime:
          type: string
        outcome:
          $ref: "#/components/schemas/CodeDescription"
        minutesCredited:
          type: integer
          format: int64
        allocationId:
          type: integer
          format: int64
      required:
      - date
      - endTime
      - id
      - minutesCredited
      - project
      - startTime
      - version
    ProjectAvailabilityDetails:
      type: object
      properties:
        frequency:
          type: string
        endDateExclusive:
          type: string
          format: date
    ScheduleResponse:
      type: object
      properties:
        requirementProgress:
          $ref: "#/components/schemas/RequirementProgress"
        allocations:
          type: array
          items:
            $ref: "#/components/schemas/AllocationResponse"
        appointments:
          type: array
          items:
            $ref: "#/components/schemas/AppointmentScheduleResponse"
      required:
      - allocations
      - appointments
      - requirementProgress
  securitySchemes:
    hmpps-auth-token:
      type: http
      name: Authorization
      in: header
      scheme: bearer
      bearerFormat: JWT
